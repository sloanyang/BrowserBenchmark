/*
PluginDetect v0.7.7 www.pinlady.net/PluginDetect | www.pinlady.net/PluginDetect/license
[ getVersion isMinVersion ]
[ Silverlight ]
*/
var PluginDetect={version:"0.7.7",rDate:"04/11/2012",name:"PluginDetect",handler:function(c,b,a){return function(){c(b,a)}},isDefined:function(b){return typeof b!="undefined"},isArray:function(b){return(/array/i).test(Object.prototype.toString.call(b))},isFunc:function(b){return typeof b=="function"},isString:function(b){return typeof b=="string"},isNum:function(b){return typeof b=="number"},isStrNum:function(b){return(typeof b=="string"&&(/\d/).test(b))},getNumRegx:/[\d][\d\.\_,-]*/,splitNumRegx:/[\.\_,-]/g,getNum:function(b,c){var d=this,a=d.isStrNum(b)?(d.isDefined(c)?new RegExp(c):d.getNumRegx).exec(b):null;return a?a[0]:null},compareNums:function(h,f,d){var e=this,c,b,a,g=parseInt;if(e.isStrNum(h)&&e.isStrNum(f)){if(e.isDefined(d)&&d.compareNums){return d.compareNums(h,f)}c=h.split(e.splitNumRegx);b=f.split(e.splitNumRegx);for(a=0;a<Math.min(c.length,b.length);a++){if(g(c[a],10)>g(b[a],10)){return 1}if(g(c[a],10)<g(b[a],10)){return -1}}}return 0},formatNum:function(b,c){var d=this,a,e;if(!d.isStrNum(b)){return null}if(!d.isNum(c)){c=4}c--;e=b.replace(/\s/g,"").split(d.splitNumRegx).concat(["0","0","0","0"]);for(a=0;a<4;a++){if(/^(0+)(.+)$/.test(e[a])){e[a]=RegExp.$2}if(a>c||!(/\d/).test(e[a])){e[a]="0"}}return e.slice(0,4).join(",")},$$hasMimeType:function(a){return function(c){if(!a.isIE&&c){var f,e,b,d=a.isArray(c)?c:(a.isString(c)?[c]:[]);for(b=0;b<d.length;b++){if(a.isString(d[b])&&/[^\s]/.test(d[b])){f=navigator.mimeTypes[d[b]];e=f?f.enabledPlugin:0;if(e&&(e.name||e.description)){return f}}}}return null}},findNavPlugin:function(l,e,c){var j=this,h=new RegExp(l,"i"),d=(!j.isDefined(e)||e)?/\d/:0,k=c?new RegExp(c,"i"):0,a=navigator.plugins,g="",f,b,m;for(f=0;f<a.length;f++){m=a[f].description||g;b=a[f].name||g;if((h.test(m)&&(!d||d.test(RegExp.leftContext+RegExp.rightContext)))||(h.test(b)&&(!d||d.test(RegExp.leftContext+RegExp.rightContext)))){if(!k||!(k.test(m)||k.test(b))){return a[f]}}}return null},getMimeEnabledPlugin:function(k,m,c){var e=this,f,b=new RegExp(m,"i"),h="",g=c?new RegExp(c,"i"):0,a,l,d,j=e.isString(k)?[k]:k;for(d=0;d<j.length;d++){if((f=e.hasMimeType(j[d]))&&(f=f.enabledPlugin)){l=f.description||h;a=f.name||h;if(b.test(l)||b.test(a)){if(!g||!(g.test(l)||g.test(a))){return f}}}}return 0},AXO:window.ActiveXObject,getAXO:function(a){var f=null,d,b=this,c={};try{f=new b.AXO(a)}catch(d){}return f},convertFuncs:function(f){var a,g,d,b=/^[\$][\$]/,c=this;for(a in f){if(b.test(a)){try{g=a.slice(2);if(g.length>0&&!f[g]){f[g]=f[a](f);delete f[a]}}catch(d){}}}},initObj:function(e,b,d){var a,c;if(e){if(e[b[0]]==1||d){for(a=0;a<b.length;a=a+2){e[b[a]]=b[a+1]}}for(a in e){c=e[a];if(c&&c[b[0]]==1){this.initObj(c,b)}}}},initScript:function(){var c=this,a=navigator,e="/",f,i=a.userAgent||"",g=a.vendor||"",b=a.platform||"",h=a.product||"";c.initObj(c,["$",c]);for(f in c.Plugins){if(c.Plugins[f]){c.initObj(c.Plugins[f],["$",c,"$$",c.Plugins[f]],1)}};c.OS=100;if(b){var d=["Win",1,"Mac",2,"Linux",3,"FreeBSD",4,"iPhone",21.1,"iPod",21.2,"iPad",21.3,"Win.*CE",22.1,"Win.*Mobile",22.2,"Pocket\\s*PC",22.3,"",100];for(f=d.length-2;f>=0;f=f-2){if(d[f]&&new RegExp(d[f],"i").test(b)){c.OS=d[f+1];break}}}c.convertFuncs(c);c.head=(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.body||null);c.isIE=(new Function("return "+e+"*@cc_on!@*"+e+"false"))();c.verIE=c.isIE&&(/MSIE\s*(\d+\.?\d*)/i).test(i)?parseFloat(RegExp.$1,10):null;c.ActiveXEnabled=false;if(c.isIE){var f,j=["Msxml2.XMLHTTP","Msxml2.DOMDocument","Microsoft.XMLDOM","ShockwaveFlash.ShockwaveFlash","TDCCtl.TDCCtl","Shell.UIHelper","Scripting.Dictionary","wmplayer.ocx"];for(f=0;f<j.length;f++){if(c.getAXO(j[f])){c.ActiveXEnabled=true;break}}}c.isGecko=(/Gecko/i).test(h)&&(/Gecko\s*\/\s*\d/i).test(i);c.verGecko=c.isGecko?c.formatNum((/rv\s*\:\s*([\.\,\d]+)/i).test(i)?RegExp.$1:"0.9"):null;c.isChrome=(/Chrome\s*\/\s*(\d[\d\.]*)/i).test(i);c.verChrome=c.isChrome?c.formatNum(RegExp.$1):null;c.isSafari=((/Apple/i).test(g)||(!g&&!c.isChrome))&&(/Safari\s*\/\s*(\d[\d\.]*)/i).test(i);c.verSafari=c.isSafari&&(/Version\s*\/\s*(\d[\d\.]*)/i).test(i)?c.formatNum(RegExp.$1):null;c.isOpera=(/Opera\s*[\/]?\s*(\d+\.?\d*)/i).test(i);c.verOpera=c.isOpera&&((/Version\s*\/\s*(\d+\.?\d*)/i).test(i)||1)?parseFloat(RegExp.$1,10):null},init:function(d){var c=this,b,d,a={status:-3,plugin:0};if(!c.isString(d)){return a}if(d.length==1){c.getVersionDelimiter=d;return a}d=d.toLowerCase().replace(/\s/g,"");b=c.Plugins[d];if(!b||!b.getVersion){return a}a.plugin=b;if(!c.isDefined(b.installed)){b.installed=null;b.version=null;b.version0=null;b.getVersionDone=null;b.pluginName=d}c.garbage=false;if(c.isIE&&!c.ActiveXEnabled&&d!=="java"){a.status=-2;return a}a.status=1;return a},$$isMinVersion:function(a){return function(h,g,d,c){var e=a.init(h),f,b=-1,j={};if(e.status<0){return e.status}f=e.plugin;g=a.formatNum(a.isNum(g)?g.toString():(a.isStrNum(g)?a.getNum(g):"0"));if(f.getVersionDone!=1){f.getVersion(g,d,c);if(f.getVersionDone===null){f.getVersionDone=1}}a.cleanup();if(f.installed!==null){b=f.installed<=0.5?f.installed:(f.installed==0.7?1:(f.version===null?0:(a.compareNums(f.version,g,f)>=0?1:-0.1)))};return b}},getVersionDelimiter:",",$$getVersion:function(a){return function(g,d,c){var e=a.init(g),f,b,h={};if(e.status<0){return null};f=e.plugin;if(f.getVersionDone!=1){f.getVersion(null,d,c);if(f.getVersionDone===null){f.getVersionDone=1}}a.cleanup();b=(f.version||f.version0);b=b?b.replace(a.splitNumRegx,a.getVersionDelimiter):b;return b}},cleanup:function(){},Plugins:{silverlight:{mimeType:"application/x-silverlight",progID:"AgControl.AgControl",digits:[20,20,9,12,31],getVersion:function(){var e=this,c=e.$,k=document,i=null,b=null,f=null,h=true,a=[1,0,1,1,1],r=[1,0,1,1,1],j=function(d){return(d<10?"0":"")+d.toString()},n=function(s,d,u,v,t){return(s+"."+d+"."+u+j(v)+j(t)+".0")},o=function(s,d,t){return q(s,(d==0?t:r[0]),(d==1?t:r[1]),(d==2?t:r[2]),(d==3?t:r[3]),(d==4?t:r[4]))},q=function(v,t,s,x,w,u){var u;try{return v.IsVersionSupported(n(t,s,x,w,u))}catch(u){}return false};if(!c.isIE){var g;if(c.hasMimeType(e.mimeType)){g=c.isGecko&&c.compareNums(c.verGecko,c.formatNum("1.6"))<=0;if(c.isGecko&&g){h=false}f=c.findNavPlugin("Silverlight.*Plug-?in",0);if(f&&f.description){i=c.formatNum(f.description)}if(i){r=i.split(c.splitNumRegx);if(parseInt(r[2],10)>=30226&&parseInt(r[0],10)<2){r[0]="2"}i=r.join(",")}}e.installed=f&&h&&i?1:(f&&h?0:(f?-0.2:-1))}else{b=c.getAXO(e.progID);var m,l,p;if(b&&q(b,a[0],a[1],a[2],a[3],a[4])){for(m=0;m<e.digits.length;m++){p=r[m];for(l=p+(m==0?0:1);l<=e.digits[m];l++){if(o(b,m,l)){h=true;r[m]=l}else{break}}if(!h){break}}if(h){i=n(r[0],r[1],r[2],r[3],r[4])}}e.installed=b&&h&&i?1:(b&&h?0:(b?-0.2:-1))}e.version=c.formatNum(i)}},zz:0}};PluginDetect.initScript();

/* Cases where transition is disabled:
 * - in incompatible browsers (Opera 11 included)
 * - when the animated object is not an element
 * - when there is a special easing
 * - when there is a step function
 * - when jQuery.fx.off is true (should work out of the box)
 *
 * jQuery.fx.stop() will stop animations instead of pausing them (undocumented method and behavior anyway).
 */
(function(a){function n(){setTimeout(o,0);return h=a.now()}function o(){h=undefined}function p(e){if(!b[e]){var f=document.body,g=a("<"+e+">").appendTo(f),h=g.css("display");g.remove();if(h==="none"||h===""){if(!c){c=document.createElement("iframe");c.frameBorder=c.width=c.height=0}f.appendChild(c);if(!d||!c.createElement){d=(c.contentWindow||c.contentDocument).document;d.write((a.support.boxModel?"<!doctype html>":"")+"<html><body>");d.close()}g=d.createElement(e);d.body.appendChild(g);h=a.css(g,"display");f.removeChild(c)}b[e]=h}return b[e]}var b={},c,d,e=/^(?:toggle|show|hide)$/,f=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,g,h;var i=document.createElement("div"),j=i.style,k="Transition",l="cubic-bezier(",m;a.support.transition="Moz"+k in j?"Moz"+k:"Webkit"+k in j?"Webkit"+k:false;a.cssNumber.color=a.cssNumber.backgroundColor=true;m={linear:"linear",swing:"ease-out",bounce:l+"0,.35,.5,1.3)",easeInQuad:l+".55,.085,.68,.53)",easeInCubic:l+".55,.055,.675,.19)",easeInQuart:l+".895,.03,.685,.22)",easeInQuint:l+".755,.05,.855,.06)",easeInSine:l+".47,0,.745,.715)",easeInExpo:l+".95,.05,.795,.035)",easeInCirc:l+".6,.04,.98,.335)",easeOutQuad:l+".25,.46,.45,.94)",easeOutCubic:l+".215,.61,.355,1)",easeOutQuart:l+".165,.84,.44,1)",easeOutQuint:l+".23,1,.32,1)",easeOutSine:l+".39,.575,.565,1)",easeOutExpo:l+".19,1,.22,1)",easeOutCirc:l+".075,.82,.165,1)",easeInOutQuad:l+".455,.03,.515,.955)",easeInOutCubic:l+".645,.045,.355,1)",easeInOutQuart:l+".77,0,.175,1)",easeInOutQuint:l+".86,0,.07,1)",easeInOutSine:l+".445,.05,.55,.95)",easeInOutExpo:l+"1,0,0,1)",easeInOutCirc:l+".785,.135,.15,.86)"};a.fn.extend({animate:function(b,c,d,g){function i(){if(h.queue===false){a._mark(this)}var c=a.extend({},h),d=this.nodeType===1,g=d&&a(this).is(":hidden"),i,j,k,l,n,o,q,r,s,t,u,v=a.cssProps,w=!c.step&&a.support.transition,x,y=[],z,A,B,C;c.animatedProperties={};c.transition={};for(k in b){i=a.camelCase(k);if(k!==i){b[i]=b[k];delete b[k]}if((n=a.cssHooks[i])&&"expand"in n){o=n.expand(b[i]);delete b[i];for(k in o){if(!(k in b)){b[k]=o[k]}}}}for(i in b){j=b[i];if(a.isArray(j)){z=c.animatedProperties[i]=j[1];j=b[i]=j[0]}else{z=c.animatedProperties[i]=c.specialEasing&&c.specialEasing[i]||c.easing||"swing"}x=w&&d&&c.duration>0&&i.indexOf("scroll")&&m[z];if(x){A=v[i]||i;B=A.replace(/([A-Z])/g,"-$1").toLowerCase();x=B+" "+c.duration+"ms "+x;c.transition[i]={lower:B,real:A};y.push(x)}if(j==="hide"&&g||j==="show"&&!g){return c.complete.call(this)}if(d&&(i==="height"||i==="width")){c.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(a.css(this,"display")==="inline"&&a.css(this,"float")==="none"){if(!a.support.inlineBlockNeedsLayout||p(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.zoom=1}}}}if(c.overflow!=null){this.style.overflow="hidden"}for(k in b){l=new a.fx(this,c,k);j=b[k];if(e.test(j)){u=a._data(this,"toggle"+k)||(j==="toggle"?g?"show":"hide":0);if(u){a._data(this,"toggle"+k,u==="show"?"hide":"show");l[u]()}else{l[j]()}}else{q=f.exec(j);r=l.cur();if(q){s=parseFloat(q[2]);t=q[3]||(a.cssNumber[k]?"":"px");if(t!=="px"){a.style(this,k,(s||1)+t);r=(s||1)/l.cur()*r;a.style(this,k,r+t)}if(q[1]){s=(q[1]==="-="?-1:1)*s+r}l.custom(r,s,t)}else{l.custom(r,j,"")}}}if(w&&y.length){x=this.style[w];C=window.getComputedStyle(this);this.style[w]=y.join()+(x&&x.indexOf("none")?","+x:"");for(k in c.transition){C[k];a.style.apply(null,c.transition[k].styleToSet)}}return true}var h=a.speed(c,d,g);if(a.isEmptyObject(b)){return this.each(h.complete,[false])}b=a.extend({},b);return h.queue===false?this.each(i):this.queue(h.queue,i)},stop:function(b,c,d){if(typeof b!=="string"){d=c;c=b;b=undefined}if(c&&b!==false){this.queue(b||"fx",[])}return this.each(function(){function i(b,c,e){var f=c[e];a.removeData(b,e,true);f.stop(d)}var c,e=false,f=a.timers,g=a._data(this),h=a.support.transition;if(!d){a._unmark(true,this)}if(b==null){for(c in g){if(g[c]&&g[c].stop&&c.indexOf(".run")===c.length-4){i(this,g,c)}}}else if(g[c=b+".run"]&&g[c].stop){i(this,g,c)}for(c=f.length;c--;){if(f[c].elem===this&&(b==null||f[c].queue===b)){if(d||h){f[c](d)}if(!d){f[c].saveState()}e=true;f.splice(c,1)}}if(!(d&&e)){a.dequeue(this,b)}})}});a.extend(a.fx.prototype,{cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var b,c=a.css(this.elem,this.prop);return isNaN(b=parseFloat(c))?!c||c==="auto"?0:c:b},custom:function(b,c,d){function k(a){return e.step(a)}var e=this,f=a.fx,i=e.options.transition,j=this.prop;this.startTime=h||n();this.end=c;this.now=this.start=b;this.pos=this.state=0;this.unit=d||this.unit||(a.cssNumber[j]?"":"px");k.queue=this.options.queue;k.elem=this.elem;k.saveState=function(){if(a._data(e.elem,"fxshow"+e.prop)===undefined){if(e.options.hide){a._data(e.elem,"fxshow"+e.prop,e.start)}else if(e.options.show){a._data(e.elem,"fxshow"+e.prop,e.end)}}};if(k.transition=i[j]){a.timers.push(k);if(j!="transform"){e.elem.style[i[j].real]=b+e.unit}a.fx.step[j]&&(c=Math.max(0,c));i[j].styleToSet=[e.elem,j,c+e.unit];i[j].timeout=setTimeout(function(){a.timers.splice(a.timers.indexOf(k),1);e.step(true)},e.options.duration+30)}else if(k()&&a.timers.push(k)&&!g){g=setInterval(f.tick,f.interval)}},step:function(b){var c,d,e,f=h||n(),g=true,i=this.elem,j=this.options,k=j.transition[this.prop],l=f>=j.duration+this.startTime,m=a.support.transition;if(k||b||l){if(!k){this.now=this.end;this.pos=this.state=1;this.update()}else{clearTimeout(k.timeout);if(!b&&!l){this.elem.style[k.real]=a.css(this.elem,k.real)}}j.animatedProperties[this.prop]=true;for(c in j.animatedProperties){if(j.animatedProperties[c]!==true){g=false}}if(g){if(j.overflow!=null&&!a.support.shrinkWrapBlocks){a.each(["","X","Y"],function(a,b){i.style["overflow"+b]=j.overflow[a]})}if(j.hide){a(i).hide()}if(k){k=","+i.style[m];for(c in j.transition){k=k.split(j.transition[c].lower).join("_")}k=k.replace(/, ?_[^,]*/g,"").substr(1);i.style[m]=k||"none";!k&&(i.style[m]=k)}if(j.hide||j.show){for(c in j.animatedProperties){(b||l)&&a.style(i,c,j.orig[c]);a.removeData(i,"fxshow"+c,true);a.removeData(i,"toggle"+c,true)}}e=j.complete;if(e&&(b||l)){j.complete=false;e.call(i)}}return false}else{if(j.duration==Infinity){this.now=f}else{d=f-this.startTime;this.state=d/j.duration;this.pos=a.easing[j.animatedProperties[this.prop]](this.state,d,0,1,j.duration);this.now=this.start+(this.end-this.start)*this.pos}this.update()}return true}});a.extend(a.fx,{tick:function(){var b,c=a.timers,d=0;for(;d<c.length;d++){b=c[d];if(!b.transition&&!b()&&c[d]===b){c.splice(d--,1)}}if(!c.length){a.fx.stop()}}})})(jQuery)

/*
 * SceneJS WebGL Scene Graph Library for JavaScript
 * http://scenejs.org/
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://scenejs.org/license
 * Copyright 2010, Lindsay Kay
 *
 * Includes WebGLTrace
 * Various functions for helping debug WebGL apps.
 * http://github.com/jackpal/webgltrace
 * Copyright (c) 2009 The Chromium Authors. All rights reserved.
 *
 * Includes WebGL-Debug
 * Various functions for helping debug WebGL apps.
 * http://khronos.org/webgl/wiki/Debugging
 * Copyright (c) 2009 The Chromium Authors. All rights reserved.
 */
/** Generic map of IDs to items - can generate own IDs or accept given IDs.
 * Given IDs should be strings in order to not clash with internally generated IDs, which are numbers.
 */
function SceneJS_webgl_ensureImageSizePowerOfTwo(a){if(!SceneJS_webgl_isPowerOfTwo(a.width)||!SceneJS_webgl_isPowerOfTwo(a.height)){var b=document.createElement("canvas");b.width=SceneJS_webgl_nextHighestPowerOfTwo(a.width);b.height=SceneJS_webgl_nextHighestPowerOfTwo(a.height);var c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height,0,0,b.width,b.height);a=b}return a}function SceneJS_webgl_isPowerOfTwo(a){return(a&a-1)==0}function SceneJS_webgl_nextHighestPowerOfTwo(a){--a;for(var b=1;b<32;b<<=1){a=a|a>>b}return a+1}var SceneJS_Map=function(){this.items=[];this.lastUniqueId=0;this.addItem=function(){var a;if(arguments.length==2){var b=arguments[0];a=arguments[1];if(this.items[b]){throw SceneJS_errorModule.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+b+"'")}this.items[b]=a;return b}else{while(true){a=arguments[0];var c=this.lastUniqueId++;if(!this.items[c]){this.items[c]=a;return c}}}};this.removeItem=function(a){this.items[a]=null}};var SceneJS={VERSION:"2.0.0",SUPPORTED_WEBGL_CONTEXT_NAMES:["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],_nodeTypes:{},_scenes:{},createNodeType:function(a,b){if(!a){throw SceneJS_errorModule.fatalError("createNodeType param 'type' is null or undefined")}if(typeof a!="string"){throw SceneJS_errorModule.fatalError("createNodeType param 'type' should be a string")}if(this._nodeTypes[a]){throw SceneJS_errorModule.fatalError("createNodeType node of param 'type' already defined: '"+b+"'")}var c=this._nodeTypes[b];if(!c){c=SceneJS._Node}var d=function(){c.apply(this,arguments);this.attr.type=a};SceneJS._inherit(d,c);this._nodeTypes[a]=d;return d},_registerNode:function(a,b){this._nodeTypes[a]=b},createScene:function(a){if(!a){throw SceneJS_errorModule.fatalError("createScene param 'json' is null or undefined")}a.type="scene";if(!a.id){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"createScene 'id' is mandatory for 'scene' node")}if(this._scenes[a.id]){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"createScene - scene id '"+a.id+"' already taken by another scene")}var b=this._parseNodeJSON(a,undefined);this._scenes[a.id]=b;SceneJS_eventModule.fireEvent(SceneJS_eventModule.NODE_CREATED,{nodeId:b.attr.id,json:a});return SceneJS._selectNode(b)},sceneExists:function(a){return this._scenes[a]?true:false},scene:function(a){var b=this._scenes[a];if(!b){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"withScene scene not found: '"+a+"'")}return SceneJS._selectNode(b)},_parseNodeJSON:function(a,b){var c=this._createNode(a,b);b=b||c;c.scene=b;if(a.nodes){var d=a.nodes.length;for(var e=0;e<d;e++){c.addNode(SceneJS._parseNodeJSON(a.nodes[e],b))}}return c},_createNode:function(a,b){a.type=a.type||"node";var c;if(a.type=="node"){c=SceneJS._Node}else{c=this._nodeTypes[a.type];if(!c){throw SceneJS_errorModule.fatalError("Scene node type not supported in SceneJS "+SceneJS.VERSION+": '"+a.type+"'")}}return new c(a,b)},_copyCfg:function(a){var b={};for(var c in a){if(a.hasOwnProperty(c)&&c!="nodes"){b[c]=a[c]}}return b},_destroyedNodes:[],_actionNodeDestroys:function(){if(this._destroyedNodes.length>0){var a;for(var b=this._destroyedNodes.length-1;b>=0;b--){a=this._destroyedNodes[b];a._doDestroy();SceneJS_eventModule.fireEvent(SceneJS_eventModule.NODE_DESTROYED,{nodeId:a.attr.id})}this._destroyedNodes=[]}},Message:new function(){this.sendMessage=function(a){if(!a){throw SceneJS_errorModule.fatalError("sendMessage param 'message' null or undefined")}var b=a.command;if(!b){throw SceneJS_errorModule.fatalError("Message element expected: 'command'")}var c=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID);var d=c.getCommand(b);if(!d){throw SceneJS_errorModule.fatalError("Message command not supported: '"+b+"' - perhaps this command needs to be added to the SceneJS Command Service?")}var e={};d.execute(e,a)}},_inherit:function(a,b){a.prototype=new b;a.prototype.constructor=a},_namespace:function(){var a=arguments,o=null,i,j,d,rt;for(i=0;i<a.length;++i){d=a[i].split(".");rt=d[0];eval("if (typeof "+rt+' == "undefined"){'+rt+" = {};} o = "+rt+";");for(j=1;j<d.length;++j){o[d[j]]=o[d[j]]||{};o=o[d[j]]}}},_last_unique_id:0,_createKeyForMap:function(a,b){while(true){var c=b?b+SceneJS._last_unique_id++:SceneJS._last_unique_id++;if(!a[c]){return c}}},_createUUID:function(){var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];var b=["8","9","A","B"];var c=[];for(var d=0;d<38;d++){switch(d){case 8:c.push("-");break;case 13:c.push("-");break;case 18:c.push("-");break;case 14:c.push("4");break;case 19:c.push(b[Math.round(Math.random()*3)]);break;default:c.push(a[Math.round(Math.random()*15)]);break}}return c.join("")},_getBaseURL:function(a){var b=a.lastIndexOf("/");if(b==0||b==-1){return""}return a.substr(0,b+1)},_isArray:function(a){return a&&!a.propertyIsEnumerable("length")&&typeof a==="object"&&typeof a.length==="number"},_shallowClone:function(a){var b={};for(var c in a){if(a.hasOwnProperty(c)){b[c]=a[c]}}return b},_applyIf:function(a,b){for(var c in a){if(a.hasOwnProperty(c)){if(b[c]==undefined||b[c]==null){b[c]=a[c]}}}return b},_apply:function(a,b,c){var d;if(c){for(d in b){if(b.hasOwnProperty(d)){delete b[d]}}}for(d in a){if(a.hasOwnProperty(d)){b[d]=a[d]}}return b},_compilationStates:new function(){var a={};this.setSupplier=function(b,c){a[b]=c};this.getState=function(b,c,d){var e=a[b];if(!e){throw SceneJS_errorModule.fatalError("Internal error - Compilation state supplier not found: '"+b+"'")}return e.get(c,d)}}};SceneJS._Node=function(a,b){this.attr={};this.attr.type="node";this.attr.sid=null;this.attr.data={};if(a){this.attr.id=a.id;this.attr.type=a.type||"node";this.attr.data=a.data;this.attr.enabled=a.enabled===false?false:true;this.attr.sid=a.sid;this.attr.info=a.info;this.scene=b||this}this.children=[];this.parent=null;this.listeners={};this.numListeners=0;this._compileMemoLevel=0;if(this.attr.id){}if(this.scene&&this.scene.nodeMap){if(this.attr.id){this.scene.nodeMap.addItem(this.attr.id,this)}else{this.attr.id=this.scene.nodeMap.addItem(this)}}if(a){this._createCore(a.coreId||a.resource);this.setTags(a.tags||{});if(this._init){this._init(a)}}};SceneJS._Node.prototype.constructor=SceneJS._Node;SceneJS._Node.prototype._cores={};SceneJS._Node.prototype._createCore=function(a){var b=this.scene.attr.id;var c=this._cores[b];if(!c){c=this._cores[b]={}}var d=c[this.attr.type];if(!d){d=c[this.attr.type]={}}if(a){this.core=d[a];if(this.core){this.core._nodeCount++}}else{a=SceneJS._createUUID()}if(!this.core){this.core=d[a]={_coreId:a,_nodeCount:1}}return this.core};SceneJS._Node.prototype.getCoreId=function(){return this.core._coreId};SceneJS._Node.prototype.getResource=SceneJS._Node.prototype.getCoreId;SceneJS._Node.prototype._tags={};SceneJS._Node.prototype.setTags=function(a){};SceneJS._Node.prototype._resetCompilationMemos=function(){this._compileMemoLevel=0};SceneJS._Node.prototype._resetTreeCompilationMemos=function(){this._resetCompilationMemos();for(var a=0;a<this.children.length;a++){this.children[a]._resetTreeCompilationMemos()}};SceneJS._Node.prototype._flagDirty=function(){this._compileMemoLevel=0};SceneJS._Node.prototype._compile=function(){this._compileNodes()};SceneJS._Node.prototype._compileNodes=function(){if(this.listeners["rendered"]){SceneJS_nodeEventsModule.preVisitNode(this)}var a=this.children;var b=a.length;var c;var d;if(b>0){for(d=0;d<b;d++){c=a[d];if(SceneJS_compileModule.preVisitNode(c)){c._compile()}SceneJS_compileModule.postVisitNode(c)}}if(this.listeners["rendered"]){SceneJS_nodeEventsModule.postVisitNode(this)}};SceneJS._Node.prototype.getID=function(){return this.attr.id};SceneJS._Node.prototype.getId=SceneJS._Node.prototype.getID;SceneJS._Node.prototype.getType=function(){return this.attr.type};SceneJS._Node.prototype.getData=function(){return this.attr.data};SceneJS._Node.prototype.setData=function(a){this.attr.data=a;return this};SceneJS._Node.prototype.getSID=function(){return this.attr.sid};SceneJS._Node.prototype.getScene=function(){return this.scene};SceneJS._Node.prototype.getNumNodes=function(){return this.children.length};SceneJS._Node.prototype.getNodes=function(){var a=new Array(this.children.length);var b=this.children.length;for(var c=0;c<b;c++){a[c]=this.children[c]}return a};SceneJS._Node.prototype.getNodeAt=function(a){if(a<0||a>=this.children.length){return null}return this.children[a]};SceneJS._Node.prototype.getFirstNode=function(){if(this.children.length==0){return null}return this.children[0]};SceneJS._Node.prototype.getLastNode=function(){if(this.children.length==0){return null}return this.children[this.children.length-1]};SceneJS._Node.prototype.getNode=function(a){for(var b=0;b<this.children.length;b++){if(this.children[b].attr.id==a){return this.children[b]}}return null};SceneJS._Node.prototype.disconnectNodeAt=function(a){var b=this.children.splice(a,1);this._resetCompilationMemos();if(b.length>0){b[0].parent=null;return b[0]}else{return null}};SceneJS._Node.prototype.disconnect=function(){if(this.parent){for(var a=0;a<this.parent.children.length;a++){if(this.parent.children[a]===this){return this.parent.disconnectNodeAt(a)}}}};SceneJS._Node.prototype.removeNodeAt=function(a){var b=this.disconnectNodeAt(a);if(b){b.destroy()}};SceneJS._Node.prototype.removeNode=function(a){if(!a){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined")}if(!a._compile){if(typeof a=="string"){var b=this.scene.nodeMap.items[a];if(!b){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+a+"'")}a=b}}if(a._compile){for(var c=0;c<this.children.length;c++){if(this.children[c]===a){return this.removeNodeAt(c)}}}throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(a._compile?": "+a.attr.id:a))};SceneJS._Node.prototype.disconnectNodes=function(){for(var a=0;a<this.children.length;a++){this.children[a].parent=null}var b=this.children;this.children=[];this._resetCompilationMemos();return b};SceneJS._Node.prototype.removeNodes=function(){var a=this.disconnectNodes();for(var b=0;b<a.length;b++){this.children[b].destroy()}};SceneJS._Node.prototype.splice=function(){var a,b;if(this.parent==null){return null}var c=this.parent;var d=this.disconnectNodes();for(a=0,b=d.length;a<b;a++){d[a].parent=this.parent}for(a=0,b=c.children.length;a<b;a++){if(c.children[a]===this){c.children.splice.apply(c.children,[a,1].concat(d));this.parent=null;this.destroy();c._resetTreeCompilationMemos();SceneJS_compileModule.nodeUpdated(c);return c}}};SceneJS._Node.prototype.addNodes=function(a){if(!a){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNodes - nodes argument is undefined")}for(var b=a.length-1;b>=0;b--){this.addNode(a[b])}this._resetCompilationMemos();return this};SceneJS._Node.prototype.addNode=function(a){if(!a){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is undefined")}if(!a._compile){if(typeof a=="string"){var b=this.scene.nodeMap.items[a];if(!b){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+a+"'")}a=b}else{a=SceneJS._parseNodeJSON(a,this.scene)}}if(!a._compile){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is not a Node or subclass!")}if(a.parent!=null){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent!")}this.children.push(a);a.parent=this;a._resetTreeCompilationMemos();return a};SceneJS._Node.prototype.insertNode=function(a,b){if(!a){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is undefined")}if(!a._compile){a=SceneJS._parseNodeJSON(a,this.scene)}if(!a._compile){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is not a Node or subclass!")}if(a.parent!=null){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is still attached to another parent!")}if(b==undefined||b==null){var c=this.disconnectNodes();var d=a;while(d.getNumNodes()>0){d=d.getLastNode()}d.addNodes(c);this.addNode(a)}else if(b<0){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node index out of range: -1")}else if(b>=this.children.length){this.children.push(a)}else{this.children.splice(b,0,a)}a.parent=this;a._resetTreeCompilationMemos();return a};SceneJS._Node.prototype.mapNodes=function(a){if(a(this)){return this}var b;for(var c=0;c<this.children.length;c++){b=this.children[c].mapNodes(a);if(b){return b}}return null};SceneJS._Node.prototype.addListener=function(a,b,c){var d=this.listeners[a];if(!d){d=[];this.listeners[a]=d}d.push({eventName:a,fn:b,options:c||{}});this.numListeners++;this._resetCompilationMemos();return this};SceneJS._Node.prototype.destroy=function(){if(!this._destroyed){this._destroyed=true;this._scheduleNodeDestroy()}SceneJS_compileModule.nodeUpdated(this,"destroyed");return this};SceneJS._Node.prototype._scheduleNodeDestroy=function(){this.disconnect();this.scene.nodeMap.removeItem(this.attr.id);if(this.children.length>0){var a=this.children.slice(0);for(var b=0;b<a.length;b++){a[b]._scheduleNodeDestroy()}}SceneJS._destroyedNodes.push(this)};SceneJS._Node.prototype._doDestroy=function(){if(this._destroy){this._destroy()}if(--this.core._nodeCount<=0){this._cores[this.scene.attr.id][this.attr.type][this.core._coreId]=null}return this};SceneJS._Node.prototype._fireEvent=function(a,b,c){var d=this.listeners[a];if(d){if(!b){b={}}var e={name:a,params:b,options:c||{}};var f;for(var g=0,h=d.length;g<h;g++){f=d[g];if(f.options.scope){f.fn.call(f.options.scope,e)}else{f.fn.call(this,e)}}}};SceneJS._Node.prototype.removeListener=function(a,b){var c=this.listeners[a];if(!c){return null}for(var d=0;d<c.length;d++){if(c[d].fn==b){c.splice(d,1);return b}}this.numListeners--;return null};SceneJS._Node.prototype.hasListener=function(a){return this.listeners[a]};SceneJS._Node.prototype.hasListeners=function(){return this.numListeners>0};SceneJS._Node.prototype.removeListeners=function(){this.listeners={};this.numListeners=0;return this};SceneJS._Node.prototype.getParent=function(){return this.parent};SceneJS._Node.prototype.findNodesByType=function(a,b){return this._findNodesByType(a,[],b)};SceneJS._Node.prototype._findNodesByType=function(a,b,c){var d;for(d=0;d<this.children;d++){var e=this.children[d];if(e.type==a){b.add(e)}}if(c){for(d=0;d<this.children;d++){this.children[d]._findNodesByType(a,b,c)}}return b};SceneJS._Node.prototype.getJSON=function(){return this.attr};var SceneJS_State=function(a){this.core=a.core||{};this.state=a.state||{};if(a.parent){a.parent.addChild(this)}this.children=[];this.dirty=true;this._cleanFunc=a.cleanFunc};SceneJS_State.prototype.addChild=function(a){a.parent=this;this.children.push(a)};SceneJS_State.prototype.setDirty=function(){if(this.dirty){return}this.dirty=true;if(this.children.length>0){var a;for(var b=0,c=this.children.length;b<c;b++){a=this.children[b];if(!a.dirty){a.setDirty()}}}};SceneJS_State.prototype._cleanStack=[];SceneJS_State.prototype._cleanStackLen=0;SceneJS_State.prototype.setClean=function(){if(!this.dirty){return}if(!this._cleanFunc){return}if(!this.parent){this._cleanFunc(this.parent?this.parent:null,this);this.dirty=false;return}this._cleanStackLen=0;var a=this;while(a&&a.dirty){this._cleanStack[this._cleanStackLen++]=a;a=a.parent}if(a&&a.parent){this._cleanStack[this._cleanStackLen++]=a.parent}var b;for(var c=this._cleanStackLen-1;c>0;c--){b=this._cleanStack[c-1];a=this._cleanStack[c];this._cleanFunc(b,a);b.dirty=false;a.dirty=false}};SceneJS_State.prototype.reset=function(){this.children=[];this.dirty=true};SceneJS.Services=new function(){this.NODE_LOADER_SERVICE_ID="node-loader";this.GEO_LOADER_SERVICE_ID="geo-loader";this.MORPH_GEO_LOADER_SERVICE_ID="morph-geo-loader";this.COMMAND_SERVICE_ID="command";this._services={};this.addService=function(a,b){this._services[a]=b};this.hasService=function(a){var b=this._services[a];return b!=null&&b!=undefined};this.getService=function(a){return this._services[a]};this.addService(this.NODE_LOADER_SERVICE_ID,{loadNode:function(a,b){}});this.addService(this.GEO_LOADER_SERVICE_ID,{loadGeometry:function(a,b,c){throw SceneJS_errorModule.fatalError("SceneJS.Services service not installed: SceneJS.Services.GEO_LOADER_SERVICE_ID")}});this.addService(this.MORPH_GEO_LOADER_SERVICE_ID,{loadMorphGeometry:function(a,b,c){throw SceneJS_errorModule.fatalError("SceneJS.Services service not installed: SceneJS.Services.MORPH_GEO_LOADER_SERVICE_ID")}})};(function(){var a=function(a){this._targetNode=a;this._methods={}};SceneJS._selectNode=function(b){if(!b.__selector){b.__selector=new a(b)}return b.__selector};a.prototype.parent=function(){var a=this._targetNode.parent;if(!a){return null}return SceneJS._selectNode(a)};a.prototype.node=function(a){if(a===null||a===undefined){throw SceneJS_errorModule.fatalError("node param 'node' is null or undefined")}var b=typeof a;var c;if(b=="number"){c=this._targetNode.getNodeAt(a)}else if(b=="string"){c=this._targetNode.getNode(a)}else{throw SceneJS_errorModule.fatalError("node param 'node' should be either an index number or an ID string")}if(!c){throw"node not found: '"+a+"'"}return SceneJS._selectNode(c)};a.prototype.findNode=function(a){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('findNode attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'")}return this._targetNode.findNode(a)};a.prototype.findNodes=function(a){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('findNode attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'")}return this._targetNode.findNodes(a)};a.prototype.scene=function(){return SceneJS._selectNode(this._targetNode.scene)};a.prototype.hasNode=function(a){if(a===null||typeof a==="undefined"){throw SceneJS_errorModule.fatalError("hasNode param 'node' is null or undefined")}var b=typeof a;var c;if(b=="number"){c=this._targetNode.getNodeAt(a)}else if(b=="string"){c=this._targetNode.getNode(a)}else{throw SceneJS_errorModule.fatalError("hasNode param 'node' should be either an index number or an ID string")}return c!=undefined&&c!=null};a.prototype.eachParent=function(a){if(!a){throw SceneJS_errorModule.fatalError("eachParent param 'fn' is null or undefined")}var b;var c=0;var d=this._targetNode;while(d.parent){b=SceneJS._selectNode(d.parent);if(a.call(b,c++)===true){return b}d=d.parent}return undefined};a.prototype.eachNode=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("eachNode param 'fn' is null or undefined")}if(typeof a!="function"){throw SceneJS_errorModule.fatalError("eachNode param 'fn' should be a function")}var c;b=b||{};var d=0;if(b.andSelf){if(a.call(this,d++)===true){return this}}if(!b.depthFirst&&!b.breadthFirst){c=this._iterateEachNode(a,this._targetNode,d)}else if(b.depthFirst){c=this._iterateEachNodeDepthFirst(a,this._targetNode,d,false)}else{}if(c){return c}return undefined};a.prototype.numNodes=function(){return this._targetNode.children.length};a.prototype.set=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("set param 'attr' null or undefined")}if(typeof a=="string"){this._callNodeMethod("set",a,b,this._targetNode)}else{this._callNodeMethods("set",a,this._targetNode)}return this};a.prototype.add=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("add param 'attr' null or undefined")}if(typeof a=="string"){this._callNodeMethod("add",a,b,this._targetNode)}else{this._callNodeMethods("add",a,this._targetNode)}return this};a.prototype.inc=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("inc param 'attr' null or undefined")}if(typeof a=="string"){this._callNodeMethod("inc",a,b,this._targetNode)}else{this._callNodeMethods("inc",a,this._targetNode)}return this};a.prototype.insert=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("insert param 'attr' null or undefined")}if(typeof a=="string"){this._callNodeMethod("insert",a,b,this._targetNode)}else{this._callNodeMethods("insert",a,this._targetNode)}return this};a.prototype.remove=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("remove param 'attr' null or undefined")}if(typeof a=="string"){this._callNodeMethod("remove",a,b,this._targetNode)}else{this._callNodeMethods("remove",a,this._targetNode)}return this};a.prototype.get=function(a){if(!a){return this._targetNode.getJSON()}var b="get"+a.substr(0,1).toUpperCase()+a.substr(1);var c=this._targetNode[b];if(!c){throw SceneJS_errorModule.fatalError("Attribute '"+a+"' not found on node '"+this._targetNode.attr.id+"'")}return c.call(this._targetNode)};a.prototype.bind=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("bind param 'name' null or undefined")}if(typeof a!="string"){throw SceneJS_errorModule.fatalError("bind param 'name' should be a string")}if(!b){throw SceneJS_errorModule.fatalError("bind param 'handler' null or undefined")}if(typeof b!="function"){throw SceneJS_errorModule.fatalError("bind param 'handler' should be a function")}else{this._targetNode.addListener(a,b,{scope:this});SceneJS_compileModule.nodeUpdated(this._targetNode,"bind",a)}return this};a.prototype.unbind=function(a,b){if(!a){throw SceneJS_errorModule.fatalError("bind param 'name' null or undefined")}if(typeof a!="string"){throw SceneJS_errorModule.fatalError("bind param 'name' should be a string")}if(!b){throw SceneJS_errorModule.fatalError("bind param 'handler' null or undefined")}if(typeof b!="function"){throw SceneJS_errorModule.fatalError("bind param 'handler' should be a function")}else{this._targetNode.removeListener(a,b);SceneJS_compileModule.nodeUpdated(this._targetNode,"unbind",a)}return this};a.prototype.pick=function(a,b,c){if(!a){throw SceneJS_errorModule.fatalError("pick param 'offsetX' null or undefined")}if(typeof a!="number"){throw SceneJS_errorModule.fatalError("pick param 'offsetX' should be a number")}if(!b){throw SceneJS_errorModule.fatalError("pick param 'offsetY' null or undefined")}if(typeof b!="number"){throw SceneJS_errorModule.fatalError("pick param 'offsetY' should be a number")}if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('pick attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'")}return this._targetNode.pick(a,b,c)};a.prototype.renderFrame=function(a){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('renderFrame attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'")}return this._targetNode.renderFrame(a)};a.prototype.start=function(a){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('start attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'")}a=a||{};var b=this;if(a.idleFunc){var c=a.idleFunc;a.idleFunc=function(a){c.call(b,a)}}if(a.frameFunc){var d=a.frameFunc;a.frameFunc=function(){d.call(b)}}if(a.sleepFunc){var e=a.sleepFunc;a.sleepFunc=function(){e.call(b)}}this._targetNode.start(a);return this};a.prototype.stop=function(){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('stop attempted on node that is not a "scene" \''+this._targetNode.attr.id+"'")}this._targetNode.stop();return this};a.prototype.pause=function(a){if(this._targetNode.attr.type!="scene"){throw SceneJS_errorModule.fatalError('pause attempted on node that is not a "scene" \''+this._targetNode.attr.id+"'")}this._targetNode.pause(a);return this};a.prototype.splice=function(){this._targetNode.splice();return this};a.prototype.destroy=function(){this._targetNode.destroy();return this};a.prototype.data=function(a,b){if(!a){return this._targetNode.attr.data}this._targetNode.attr.data=this._targetNode.attr.data||{};if(typeof a=="string"){if(b!=undefined){this._targetNode.attr.data[a]=b;return this}else{return this._targetNode.attr.data[a]}}else{if(b!=undefined){this._targetNode.attr.data=b;return this}else{return this._targetNode.attr.data}}};a.prototype._iterateEachNode=function(a,b,c){var d=b.children.length;var e;for(var f=0;f<d;f++){e=SceneJS._selectNode(b.children[f]);if(a.call(e,c++)==true){return e}}return undefined};a.prototype._iterateEachNodeDepthFirst=function(a,b,c,d){var e;if(d){e=SceneJS._selectNode(b);if(a.call(e,c++)==true){return e}}d=true;var f=b.children.length;for(var g=0;g<f;g++){e=this._iterateEachNodeDepthFirst(a,b.children[g],c,d);if(e){return e}}return undefined};a.prototype._callNodeMethod=function(a,b,c,d){var e=this._methods[a];if(!e){e=this._methods[a]={}}var f=e[b];if(!f){b=b.replace(/^\s*/,"").replace(/\s*$/,"");var g=a+b.substr(0,1).toUpperCase()+b.substr(1);f=d[g];if(!f){throw SceneJS_errorModule.fatalError("Attribute '"+b+"' not found on node '"+d.attr.id+"' for "+a)}e[b]=f}f.call(d,c);var h={};h[b]=c;SceneJS_compileModule.nodeUpdated(d,a,b,c);d._fireEvent("updated",h)};a.prototype._callNodeMethods=function(a,b,c){var d=this._methods[a];if(!d){d=this._methods[a]={}}for(var e in b){if(b.hasOwnProperty(e)){var f=d[e];if(!f){e=e.replace(/^\s*/,"").replace(/\s*$/,"");var g=a+e.substr(0,1).toUpperCase()+e.substr(1);f=c[g];if(!f){throw SceneJS_errorModule.fatalError("Attribute '"+e+"' not found on node '"+c.attr.id+"' for "+a)}d[e]=f}f.call(c,b[e]);SceneJS_compileModule.nodeUpdated(c,a,e,b[e])}}c._fireEvent("updated",{attr:b})};a.prototype._parseAttr=function(a,b){var c=a.split(".");if(c.length<=1){return b}var d={};var e=d;var f;var g=0;var h=c.length-1;while(g<h){d[c[g++]]=b}d=d[f]={};return e}})();SceneJS.Services.addService(SceneJS.Services.COMMAND_SERVICE_ID,function(){var a={};return{addCommand:function(b,c){if(!c.execute){throw SceneJS_errorModule.fatalError("SceneJS Command Service (ID '"+SceneJS.Services.COMMAND_SERVICE_ID+") requires an 'execute' method on your '"+b+" command implementation")}a[b]=c},hasCommand:function(b){var c=a[b];return c!=null&&c!=undefined},getCommand:function(b){return a[b]},executeCommand:function(a,b){if(!b){throw SceneJS_errorModule.fatalError("sendMessage param 'message' null or undefined")}var c=b.command;if(!c){throw SceneJS_errorModule.fatalError("Message element expected: 'command'")}var d=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID);var e=d.getCommand(c);if(!e){throw SceneJS_errorModule.fatalError("Message command not supported: '"+c+"' - perhaps this command needs to be added to the SceneJS Command Service?")}e.execute(a,b)}}}());(function(){function b(a,b,c){var d;var e;for(var f=0;f<c.length;f++){d=c[f];if(b){e=a.findNode(b);if(!e){continue}e.add("node",c[f])}else{a.addNode(c[f])}}}function c(a,b,c){var e=a.findNode(b);if(!e){return}var f=c["set"];if(f){d("set",f,e)}if(c.insert){d("insert",c.insert,e)}if(c.inc){d("inc",c.inc,e)}if(c.dec){d("dec",c.dec,e)}if(c.add){d("add",c.add,e)}if(c.remove){d("remove",c.remove,e)}}function d(a,b,c){for(var d in b){if(b.hasOwnProperty(d)){c[a](b)}}}var a=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID);a.addCommand("create",function(){return{execute:function(a,c){var d=c.nodes;if(d){var e=c.target;var f;var g;if(a.scenes){f=a.scenes;for(var h=0,i=f.length;h<i;h++){g=f[h];if(g){b(g,e,d)}}}else{f=SceneJS._scenes;for(var j in f){if(f.hasOwnProperty(j)){g=f[j];if(g){b(g,e,d)}}}}}}}}());a.addCommand("update",{execute:function(b,d){var e,f;var g;var h=d.target;var i;if(b.scenes){g=b.scenes;for(e=0,f=g.length;e<f;e++){i=g[e];if(i){c(i,h,d)}}}else{g=SceneJS._scenes;for(var j in g){if(g.hasOwnProperty(j)){i=g[j];if(i){c(i,h,d)}}}}var k=d.messages;if(k&&k.length>0){for(e=0;e<k.length;e++){a.executeCommand(b,k[e])}}}});a.addCommand("selectScenes",{execute:function(b,c){var d,e;var f=c.scenes;if(f){var g=[];var h;var i;for(d=0,e=f.length;d<e;d++){h=f[d];if(SceneJS._scenes[h]){g.push(SceneJS.scene(h))}}b=SceneJS._shallowClone(b);b.scenes=g}var j=c.messages;if(j){for(d=0;d<j.length;d++){a.executeCommand(b,j[d])}}}})})();var SceneJS_debugModule=new function(){this.configs={};this.getConfigs=function(a){if(!a){return this.configs}else{var b=this.configs;var c=a.split(".");for(var d=0;b&&d<c.length;d++){b=b[c[d]]}return b||{}}};this.setConfigs=function(a,b){if(!a){this.configs=b}else{var c=a.split(".");var d=this.configs;var e;var f;for(var g=0;g<c.length-1;g++){f=c[g];e=d[f];if(!e){e=d[f]={}}d=e}d[c.length-1]=b}}};SceneJS.setConfigs=SceneJS.setDebugConfigs=function(){if(arguments.length==1){SceneJS_debugModule.setConfigs(null,arguments[0])}else if(arguments.length==2){SceneJS_debugModule.setConfigs(arguments[0],arguments[1])}else{throw SceneJS_errorModule.fatalError("Illegal arguments given to SceneJS.setDebugs - should be either ({String}:name, {Object}:cfg) or ({Object}:cfg)")}};SceneJS.getConfigs=SceneJS.getDebugConfigs=function(a){return SceneJS_debugModule.getConfigs(a)};SceneJS.errors={};SceneJS.errors.ERROR=0;SceneJS.errors.WEBGL_NOT_SUPPORTED=1;SceneJS.errors.NODE_CONFIG_EXPECTED=2;SceneJS.errors.ILLEGAL_NODE_CONFIG=3;SceneJS.errors.SHADER_COMPILATION_FAILURE=4;SceneJS.errors.SHADER_LINK_FAILURE=5;SceneJS.errors.CANVAS_NOT_FOUND=6;SceneJS.errors.OUT_OF_VRAM=7;SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=8;SceneJS.errors.INSTANCE_TARGET_NOT_FOUND=9;SceneJS.errors.INSTANCE_CYCLE=10;SceneJS.errors.NODE_NOT_FOUND=11;SceneJS.errors.NODE_ILLEGAL_STATE=12;SceneJS.errors.ID_CLASH=13;SceneJS.errors.ILLEGAL_MESSAGE=14;SceneJS.errors.SCENE_ILLEGAL_UPDATE=15;SceneJS.errors._getErrorName=function(a){for(var b in SceneJS.errors){if(SceneJS.errors.hasOwnProperty(b)&&SceneJS.errors[b]==a){return b}}return null};var SceneJS_math_divVec3=function(a,b,c){if(!c){c=a}c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};var SceneJS_math_negateVector4=function(a,b){if(!b){b=a}b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};var SceneJS_math_addVec4=function(a,b,c){if(!c){c=a}c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};var SceneJS_math_addVec4s=function(a,b,c){if(!c){c=a}c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;c[3]=a[3]+b;return c};var SceneJS_math_addVec3=function(a,b,c){if(!c){c=a}c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};var SceneJS_math_addVec3s=function(a,b,c){if(!c){c=a}c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c};var SceneJS_math_addScalarVec4=function(a,b,c){return SceneJS_math_addVec4s(b,a,c)};var SceneJS_math_subVec4=function(a,b,c){if(!c){c=a}c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};var SceneJS_math_subVec3=function(a,b,c){if(!c){c=a}c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};var SceneJS_math_lerpVec3=function(a,b,c,d,e){var f=(a-b)/(c-b);var g=1-f;return{x:d.x*g+e.x*f,y:d.y*g+e.y*f,z:d.z*g+e.z*f}};var SceneJS_math_subVec2=function(a,b,c){if(!c){c=a}c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c};var SceneJS_math_subVec4Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]-b;c[1]=a[1]-b;c[2]=a[2]-b;c[3]=a[3]-b;return c};var SceneJS_math_subScalarVec4=function(a,b,c){if(!c){c=a}c[0]=b-a[0];c[1]=b-a[1];c[2]=b-a[2];c[3]=b-a[3];return c};var SceneJS_math_mulVec4=function(a,b,c){if(!c){c=a}c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};var SceneJS_math_mulVec4Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};var SceneJS_math_mulVec3Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};var SceneJS_math_mulVec2Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]*b;c[1]=a[1]*b;return c};var SceneJS_math_divVec4=function(a,b,c){if(!c){c=a}c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};var SceneJS_math_divScalarVec3=function(a,b,c){if(!c){c=b}c[0]=a/b[0];c[1]=a/b[1];c[2]=a/b[2];return c};var SceneJS_math_divVec3s=function(a,b,c){if(!c){c=a}c[0]=a[0]/b;c[1]=a[1]/b;c[2]=a[2]/b;return c};var SceneJS_math_divVec4s=function(a,b,c){if(!c){c=a}c[0]=a[0]/b;c[1]=a[1]/b;c[2]=a[2]/b;c[3]=a[3]/b;return c};var SceneJS_math_divScalarVec4=function(a,b,c){if(!c){c=b}c[0]=a/b[0];c[1]=a/b[1];c[2]=a/b[2];c[3]=a/b[3];return c};var SceneJS_math_dotVector4=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};var SceneJS_math_cross3Vec4=function(a,b){var c=a[0],d=a[1],e=a[2];var f=b[0],g=b[1],h=b[2];return[d*h-e*g,e*f-c*h,c*g-d*f,0]};var SceneJS_math_cross3Vec3=function(a,b,c){if(!c){c=a}var d=a[0],e=a[1],f=a[2];var g=b[0],h=b[1],i=b[2];c[0]=e*i-f*h;c[1]=f*g-d*i;c[2]=d*h-e*g;return c};var SceneJS_math_sqLenVec4=function(a){return SceneJS_math_dotVector4(a,a)};var SceneJS_math_lenVec4=function(a){return Math.sqrt(SceneJS_math_sqLenVec4(a))};var SceneJS_math_dotVector3=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};var SceneJS_math_dotVector2=function(a,b){return a[0]*b[0]+a[1]*b[1]};var SceneJS_math_sqLenVec3=function(a){return SceneJS_math_dotVector3(a,a)};var SceneJS_math_sqLenVec2=function(a){return SceneJS_math_dotVector2(a,a)};var SceneJS_math_lenVec3=function(a){return Math.sqrt(SceneJS_math_sqLenVec3(a))};var SceneJS_math_lenVec2=function(a){return Math.sqrt(SceneJS_math_sqLenVec2(a))};var SceneJS_math_rcpVec3=function(a,b){return SceneJS_math_divScalarVec3(1,a,b)};var SceneJS_math_normalizeVec4=function(a,b){var c=1/SceneJS_math_lenVec4(a);return SceneJS_math_mulVec4Scalar(a,c,b)};var SceneJS_math_normalizeVec3=function(a,b){var c=1/SceneJS_math_lenVec3(a);return SceneJS_math_mulVec3Scalar(a,c,b)};var SceneJS_math_normalizeVec2=function(a,b){var c=1/SceneJS_math_lenVec2(a);return SceneJS_math_mulVec2Scalar(a,c,b)};var SceneJS_math_mat4=function(){return new Array(16)};var SceneJS_math_dupMat4=function(a){return a.slice(0,16)};var SceneJS_math_getCellMat4=function(a,b,c){return a[b+c*4]};var SceneJS_math_setCellMat4=function(a,b,c,d){a[b+c*4]=d};var SceneJS_math_getRowMat4=function(a,b){return[a[b],a[b+4],a[b+8],a[b+12]]};var SceneJS_math_setRowMat4=function(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]};var SceneJS_math_setRowMat4c=function(a,b,c,d,e,f){SceneJS_math_setRowMat4(a,b,[c,d,e,f])};var SceneJS_math_setRowMat4s=function(a,b,c){SceneJS_math_setRowMat4c(a,b,c,c,c,c)};var SceneJS_math_getColMat4=function(a,b){var c=b*4;return[a[c],a[c+1],a[c+2],a[c+3]]};var SceneJS_math_setColMat4v=function(a,b,c){var d=b*4;a[d]=c[0];a[d+1]=c[1];a[d+2]=c[2];a[d+3]=c[3]};var SceneJS_math_setColMat4c=function(a,b,c,d,e,f){SceneJS_math_setColMat4v(a,b,[c,d,e,f])};var SceneJS_math_setColMat4Scalar=function(a,b,c){SceneJS_math_setColMat4c(a,b,c,c,c,c)};var SceneJS_math_mat4To3=function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]]};var SceneJS_math_m4s=function(a){return[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a]};var SceneJS_math_setMat4ToZeroes=function(){return SceneJS_math_m4s(0)};var SceneJS_math_setMat4ToOnes=function(){return SceneJS_math_m4s(1)};var SceneJS_math_diagonalMat4v=function(a){return[a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,a[3]]};var SceneJS_math_diagonalMat4c=function(a,b,c,d){return SceneJS_math_diagonalMat4v([a,b,c,d])};var SceneJS_math_diagonalMat4s=function(a){return SceneJS_math_diagonalMat4c(a,a,a,a)};var SceneJS_math_identityMat4=function(){return SceneJS_math_diagonalMat4v([1,1,1,1])};var SceneJS_math_isIdentityMat4=function(a){if(a[0]!==1||a[1]!==0||a[2]!==0||a[3]!==0||a[4]!==0||a[5]!==1||a[6]!==0||a[7]!==0||a[8]!==0||a[9]!==0||a[10]!==1||a[11]!==0||a[12]!==0||a[13]!==0||a[14]!==0||a[15]!==1){return false}return true};var SceneJS_math_negateMat4=function(a,b){if(!b){b=a}b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];b[4]=-a[4];b[5]=-a[5];b[6]=-a[6];b[7]=-a[7];b[8]=-a[8];b[9]=-a[9];b[10]=-a[10];b[11]=-a[11];b[12]=-a[12];b[13]=-a[13];b[14]=-a[14];b[15]=-a[15];return b};var SceneJS_math_addMat4=function(a,b,c){if(!c){c=a}c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];c[4]=a[4]+b[4];c[5]=a[5]+b[5];c[6]=a[6]+b[6];c[7]=a[7]+b[7];c[8]=a[8]+b[8];c[9]=a[9]+b[9];c[10]=a[10]+b[10];c[11]=a[11]+b[11];c[12]=a[12]+b[12];c[13]=a[13]+b[13];c[14]=a[14]+b[14];c[15]=a[15]+b[15];return c};var SceneJS_math_addMat4Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;c[3]=a[3]+b;c[4]=a[4]+b;c[5]=a[5]+b;c[6]=a[6]+b;c[7]=a[7]+b;c[8]=a[8]+b;c[9]=a[9]+b;c[10]=a[10]+b;c[11]=a[11]+b;c[12]=a[12]+b;c[13]=a[13]+b;c[14]=a[14]+b;c[15]=a[15]+b;return c};var SceneJS_math_addScalarMat4=function(a,b,c){return SceneJS_math_addMat4Scalar(b,a,c)};var SceneJS_math_subMat4=function(a,b,c){if(!c){c=a}c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];c[4]=a[4]-b[4];c[5]=a[5]-b[5];c[6]=a[6]-b[6];c[7]=a[7]-b[7];c[8]=a[8]-b[8];c[9]=a[9]-b[9];c[10]=a[10]-b[10];c[11]=a[11]-b[11];c[12]=a[12]-b[12];c[13]=a[13]-b[13];c[14]=a[14]-b[14];c[15]=a[15]-b[15];return c};var SceneJS_math_subMat4Scalar=function(a,b,c){if(!c){c=a}c[0]=a[0]-b;c[1]=a[1]-b;c[2]=a[2]-b;c[3]=a[3]-b;c[4]=a[4]-b;c[5]=a[5]-b;c[6]=a[6]-b;c[7]=a[7]-b;c[8]=a[8]-b;c[9]=a[9]-b;c[10]=a[10]-b;c[11]=a[11]-b;c[12]=a[12]-b;c[13]=a[13]-b;c[14]=a[14]-b;c[15]=a[15]-b;return c};var SceneJS_math_subScalarMat4=function(a,b,c){if(!c){c=b}c[0]=a-b[0];c[1]=a-b[1];c[2]=a-b[2];c[3]=a-b[3];c[4]=a-b[4];c[5]=a-b[5];c[6]=a-b[6];c[7]=a-b[7];c[8]=a-b[8];c[9]=a-b[9];c[10]=a-b[10];c[11]=a-b[11];c[12]=a-b[12];c[13]=a-b[13];c[14]=a-b[14];c[15]=a-b[15];return c};var SceneJS_math_mulMat4=function(a,b,c){if(!c){c=a}var d=a[0],e=a[1],f=a[2],g=a[3];var h=a[4],i=a[5],j=a[6],k=a[7];var l=a[8],m=a[9],n=a[10],o=a[11];var p=a[12],q=a[13],r=a[14],s=a[15];var t=b[0],u=b[1],v=b[2],w=b[3];var x=b[4],y=b[5],z=b[6],A=b[7];var B=b[8],C=b[9],D=b[10],E=b[11];var F=b[12],G=b[13],H=b[14],I=b[15];c[0]=t*d+u*h+v*l+w*p;c[1]=t*e+u*i+v*m+w*q;c[2]=t*f+u*j+v*n+w*r;c[3]=t*g+u*k+v*o+w*s;c[4]=x*d+y*h+z*l+A*p;c[5]=x*e+y*i+z*m+A*q;c[6]=x*f+y*j+z*n+A*r;c[7]=x*g+y*k+z*o+A*s;c[8]=B*d+C*h+D*l+E*p;c[9]=B*e+C*i+D*m+E*q;c[10]=B*f+C*j+D*n+E*r;c[11]=B*g+C*k+D*o+E*s;c[12]=F*d+G*h+H*l+I*p;c[13]=F*e+G*i+H*m+I*q;c[14]=F*f+G*j+H*n+I*r;c[15]=F*g+G*k+H*o+I*s;return c};var SceneJS_math_mulMat4s=function(a,b,c){if(!c){c=a}c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;c[4]=a[4]*b;c[5]=a[5]*b;c[6]=a[6]*b;c[7]=a[7]*b;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12]*b;c[13]=a[13]*b;c[14]=a[14]*b;c[15]=a[15]*b;return c};var SceneJS_math_mulMat4v4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[a[0]*c+a[4]*d+a[8]*e+a[12]*f,a[1]*c+a[5]*d+a[9]*e+a[13]*f,a[2]*c+a[6]*d+a[10]*e+a[14]*f,a[3]*c+a[7]*d+a[11]*e+a[15]*f]};var SceneJS_math_transposeMat4=function(a,b){var c=a[4],d=a[14],e=a[8];var f=a[13],g=a[12],h=a[9];if(!b||a==b){var i=a[1],j=a[2],k=a[3];var l=a[6],m=a[7];var n=a[11];a[1]=c;a[2]=e;a[3]=g;a[4]=i;a[6]=h;a[7]=f;a[8]=j;a[9]=l;a[11]=d;a[12]=k;a[13]=m;a[14]=n;return a}b[0]=a[0];b[1]=c;b[2]=e;b[3]=g;b[4]=a[1];b[5]=a[5];b[6]=h;b[7]=f;b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=d;b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};var SceneJS_math_determinantMat4=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];var f=a[4],g=a[5],h=a[6],i=a[7];var j=a[8],k=a[9],l=a[10],m=a[11];var n=a[12],o=a[13],p=a[14],q=a[15];return n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*q+f*k*d*q+j*c*h*q-b*k*h*q-f*c*l*q+b*g*l*q};var SceneJS_math_inverseMat4=function(a,b){if(!b){b=a}var c=a[0],d=a[1],e=a[2],f=a[3];var g=a[4],h=a[5],i=a[6],j=a[7];var k=a[8],l=a[9],m=a[10],n=a[11];var o=a[12],p=a[13],q=a[14],r=a[15];var s=c*h-d*g;var t=c*i-e*g;var u=c*j-f*g;var v=d*i-e*h;var w=d*j-f*h;var x=e*j-f*i;var y=k*p-l*o;var z=k*q-m*o;var A=k*r-n*o;var B=l*q-m*p;var C=l*r-n*p;var D=m*r-n*q;var E=1/(s*D-t*C+u*B+v*A-w*z+x*y);b[0]=(h*D-i*C+j*B)*E;b[1]=(-d*D+e*C-f*B)*E;b[2]=(p*x-q*w+r*v)*E;b[3]=(-l*x+m*w-n*v)*E;b[4]=(-g*D+i*A-j*z)*E;b[5]=(c*D-e*A+f*z)*E;b[6]=(-o*x+q*u-r*t)*E;b[7]=(k*x-m*u+n*t)*E;b[8]=(g*C-h*A+j*y)*E;b[9]=(-c*C+d*A-f*y)*E;b[10]=(o*w-p*u+r*s)*E;b[11]=(-k*w+l*u-n*s)*E;b[12]=(-g*B+h*z-i*y)*E;b[13]=(c*B-d*z+e*y)*E;b[14]=(-o*v+p*t-q*s)*E;b[15]=(k*v-l*t+m*s)*E;return b};var SceneJS_math_traceMat4=function(a){return a[0]+a[5]+a[10]+a[15]};var SceneJS_math_translationMat4v=function(a){var b=SceneJS_math_identityMat4();b[12]=a[0];b[13]=a[1];b[14]=a[2];return b};var SceneJS_math_translationMat4c=function(a,b,c){return SceneJS_math_translationMat4v([a,b,c])};var SceneJS_math_translationMat4s=function(a){return SceneJS_math_translationMat4c(a,a,a)};var SceneJS_math_rotationMat4v=function(a,b){var c=SceneJS_math_normalizeVec4([b[0],b[1],b[2],0]);var d=Math.sin(a);var e=Math.cos(a);var f=1-e;var g=c[0];var h=c[1];var i=c[2];var j,k,l,m,n,o;j=g*h;k=h*i;l=i*g;m=g*d;n=h*d;o=i*d;var p=SceneJS_math_mat4();p[0]=f*g*g+e;p[1]=f*j+o;p[2]=f*l-n;p[3]=0;p[4]=f*j-o;p[5]=f*h*h+e;p[6]=f*k+m;p[7]=0;p[8]=f*l+n;p[9]=f*k-m;p[10]=f*i*i+e;p[11]=0;p[12]=0;p[13]=0;p[14]=0;p[15]=1;return p};var SceneJS_math_rotationMat4c=function(a,b,c,d){return SceneJS_math_rotationMat4v(a,[b,c,d])};var SceneJS_math_scalingMat4v=function(a){var b=SceneJS_math_identityMat4();b[0]=a[0];b[5]=a[1];b[10]=a[2];return b};var SceneJS_math_scalingMat4c=function(a,b,c){return SceneJS_math_scalingMat4v([a,b,c])};var SceneJS_math_scalingMat4s=function(a){return SceneJS_math_scalingMat4c(a,a,a)};var SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:1},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}};var SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,1],look:[0,0,0],up:[0,1,0]};var SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3};var SceneJS_math_lookAtMat4v=function(a,b,c,d){if(!d){d=SceneJS_math_mat4()}var e=a[0],f=a[1],g=a[2],h=c[0],i=c[1],j=c[2],k=b[0],l=b[1],m=b[2];if(e==k&&f==l&&g==m){return SceneJS_math_identityMat4()}var n,o,p,q,r,s,t,u,v,w;n=e-k;o=f-l;p=g-m;w=1/Math.sqrt(n*n+o*o+p*p);n*=w;o*=w;p*=w;q=i*p-j*o;r=j*n-h*p;s=h*o-i*n;w=Math.sqrt(q*q+r*r+s*s);if(!w){q=0;r=0;s=0}else{w=1/w;q*=w;r*=w;s*=w}t=o*s-p*r;u=p*q-n*s;v=n*r-o*q;w=Math.sqrt(t*t+u*u+v*v);if(!w){t=0;u=0;v=0}else{w=1/w;t*=w;u*=w;v*=w}d[0]=q;d[1]=t;d[2]=n;d[3]=0;d[4]=r;d[5]=u;d[6]=o;d[7]=0;d[8]=s;d[9]=v;d[10]=p;d[11]=0;d[12]=-(q*e+r*f+s*g);d[13]=-(t*e+u*f+v*g);d[14]=-(n*e+o*f+p*g);d[15]=1;return d};var SceneJS_math_lookAtMat4c=function(a,b,c,d,e,f,g,h,i){return SceneJS_math_lookAtMat4v([a,b,c],[d,e,f],[g,h,i])};var SceneJS_math_orthoMat4c=function(a,b,c,d,e,f,g){if(!g){g=SceneJS_math_mat4()}var h=b-a;var i=d-c;var j=f-e;g[0]=2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/i;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/j;g[11]=0;g[12]=-(a+b)/h;g[13]=-(d+c)/i;g[14]=-(f+e)/j;g[15]=1;return g};var SceneJS_math_frustumMat4v=function(a,b){var c=[a[0],a[1],a[2],0];var d=[b[0],b[1],b[2],0];var e=SceneJS_math_mat4();SceneJS_math_addVec4(d,c,e);var f=SceneJS_math_mat4();SceneJS_math_subVec4(d,c,f);var g=2*c[2];var h=SceneJS_math_mat4();var i=f[0],j=f[1],k=f[2];h[0]=g/i;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=g/j;h[6]=0;h[7]=0;h[8]=e[0]/i;h[9]=e[1]/j;h[10]=-e[2]/k;h[11]=-1;h[12]=0;h[13]=0;h[14]=-g*d[2]/k;h[15]=0;return h};var SceneJS_math_frustumMatrix4=function(a,b,c,d,e,f,g){if(!g){g=SceneJS_math_mat4()}var h=b-a;var i=d-c;var j=f-e;g[0]=e*2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=e*2/i;g[6]=0;g[7]=0;g[8]=(b+a)/h;g[9]=(d+c)/i;g[10]=-(f+e)/j;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(f*e*2)/j;g[15]=0;return g};var SceneJS_math_perspectiveMatrix4=function(a,b,c,d){var e=new Array(4);var f=new Array(4);e[2]=c;f[2]=d;f[1]=e[2]*Math.tan(a/2);e[1]=-f[1];f[0]=f[1]*b;e[0]=-f[0];return SceneJS_math_frustumMat4v(e,f)};var SceneJS_math_transformPoint3=function(a,b){var c=b[0],d=b[1],e=b[2];return[a[0]*c+a[4]*d+a[8]*e+a[12],a[1]*c+a[5]*d+a[9]*e+a[13],a[2]*c+a[6]*d+a[10]*e+a[14],a[3]*c+a[7]*d+a[11]*e+a[15]]};var SceneJS_math_transformPoints3=function(a,b){var c=new Array(b.length);var d=b.length;var e,f,g;var h;var i=a[0],j=a[1],k=a[2],l=a[3];var m=a[4],n=a[5],o=a[6],p=a[7];var q=a[8],r=a[9],s=a[10],t=a[11];var u=a[12],v=a[13],w=a[14],x=a[15];for(var y=0;y<d;++y){h=b[y];e=h[0];f=h[1];g=h[2];c[y]=[i*e+m*f+q*g+u,j*e+n*f+r*g+v,k*e+o*f+s*g+w,l*e+p*f+t*g+x]}return c};var SceneJS_math_transformVector3=function(a,b){var c=b[0],d=b[1],e=b[2];return[a[0]*c+a[4]*d+a[8]*e,a[1]*c+a[5]*d+a[9]*e,a[2]*c+a[6]*d+a[10]*e]};var SceneJS_math_transformVector4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[a[0]*c+a[4]*d+a[8]*e+a[12]*f,a[1]*c+a[5]*d+a[9]*e+a[13]*f,a[2]*c+a[6]*d+a[10]*e+a[14]*f,a[3]*c+a[7]*d+a[11]*e+a[15]*f]};var SceneJS_math_projectVec4=function(a){var b=1/a[3];return[a[0]*b,a[1]*b,a[2]*b,1]};var SceneJS_math_Plane3=function(a,b,c){this.normal=[0,0,1];this.offset=0;if(a&&b){var d=a[0],e=a[1],f=a[2];this.offset=b;if(c){var g=Math.sqrt(d*d+e*e+f*f);if(g>0){g=1/g;this.normal[0]=d*g;this.normal[1]=e*g;this.normal[2]=f*g;this.offset*=g}}}};var SceneJS_math_MAX_DOUBLE=Number.POSITIVE_INFINITY;var SceneJS_math_MIN_DOUBLE=Number.NEGATIVE_INFINITY;var SceneJS_math_Box3=function(a,b){this.min=a||[SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE];this.max=b||[SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE];this.init=function(a,b){this.min[0]=a[0];this.min[1]=a[1];this.min[2]=a[2];this.max[0]=b[0];this.max[1]=b[1];this.max[2]=b[2];return this};this.fromPoints=function(a){var b=a.length;for(var c=0;c<b;++c){var d=a[c][3];var e=a[c][0]/d;var f=a[c][1]/d;var g=a[c][2]/d;if(e<this.min[0]){this.min[0]=e}if(f<this.min[1]){this.min[1]=f}if(g<this.min[2]){this.min[2]=g}if(e>this.max[0]){this.max[0]=e}if(f>this.max[1]){this.max[1]=f}if(g>this.max[2]){this.max[2]=g}}return this};this.isEmpty=function(){return this.min[0]>=this.max[0]&&this.min[1]>=this.max[1]&&this.min[2]>=this.max[2]};this.getCenter=function(){return[(this.max[0]+this.min[0])/2,(this.max[1]+this.min[1])/2,(this.max[2]+this.min[2])/2]};this.getSize=function(){return[this.max[0]-this.min[0],this.max[1]-this.min[1],this.max[2]-this.min[2]]};this.getFacesAreas=function(){var a=this.size;return[a[1]*a[2],a[0]*a[2],a[0]*a[1]]};this.getSurfaceArea=function(){var a=this.getFacesAreas();return(a[0]+a[1]+a[2])*2};this.getVolume=function(){var a=this.size;return a[0]*a[1]*a[2]};this.getOffset=function(a){this.min[0]-=a;this.min[1]-=a;this.min[2]-=a;this.max[0]+=a;this.max[1]+=a;this.max[2]+=a;return this}};var SceneJS_math_AxisBox3=function(a,b){var c=a[0],d=a[1],e=a[2];var f=b[0],g=b[1],h=b[2];this.verts=[[c,d,e],[f,d,e],[f,g,e],[c,g,e],[c,d,h],[f,d,h],[f,g,h],[c,g,h]];this.toBox3=function(){var a=new SceneJS_math_Box3;for(var b=0;b<8;++b){var c=this.verts[b];for(var d=0;d<3;++d){if(c[d]<a.min[d]){a.min[d]=c[d]}if(c[d]>a.max[d]){a.max[d]=c[d]}}}}};var SceneJS_math_Sphere3=function(a,b){this.center=[a[0],a[1],a[2]];this.radius=b;this.isEmpty=function(){return this.radius===0};this.surfaceArea=function(){return 4*Math.PI*this.radius*this.radius};this.getVolume=function(){var a=this.radius;return 4/3*Math.PI*a*a*a}};var SceneJS_math_billboardMat=function(a){var b=[SceneJS_math_getColMat4(a,0),SceneJS_math_getColMat4(a,1),SceneJS_math_getColMat4(a,2)];var c=[SceneJS_math_lenVec4(b[0]),SceneJS_math_lenVec4(b[1]),SceneJS_math_lenVec4(b[2])];var d=SceneJS_math_mat4();SceneJS_math_rcpVec3(c,d);var e=SceneJS_math_scalingMat4v(c);SceneJS_math_mulVec4Scalar(b[0],d[0]);SceneJS_math_mulVec4Scalar(b[1],d[1]);SceneJS_math_mulVec4Scalar(b[2],d[2]);var f=SceneJS_math_identityMat4();SceneJS_math_setRowMat4(f,0,b[0]);SceneJS_math_setRowMat4(f,1,b[1]);SceneJS_math_setRowMat4(f,2,b[2]);return SceneJS_math_mulMat4(f,e)};var SceneJS_math_FrustumPlane=function(a,b,c,d){var e=1/Math.sqrt(a*a+b*b+c*c);this.normal=[a*e,b*e,c*e];this.offset=d*e;this.testVertex=[this.normal[0]>=0?1:0,this.normal[1]>=0?1:0,this.normal[2]>=0?1:0]};var SceneJS_math_OUTSIDE_FRUSTUM=3;var SceneJS_math_INTERSECT_FRUSTUM=4;var SceneJS_math_INSIDE_FRUSTUM=5;var SceneJS_math_Frustum=function(a,b,c){var d=SceneJS_math_mat4();SceneJS_math_mulMat4(b,a,d);var e=d[0],f=d[1],g=d[2],h=d[3];var i=d[4],j=d[5],k=d[6],l=d[7];var m=d[8],n=d[9],o=d[10],p=d[11];var q=d[12],r=d[13],s=d[14],t=d[15];var u=[new SceneJS_math_FrustumPlane(h-e,l-i,p-m,t-q),new SceneJS_math_FrustumPlane(h+e,l+i,p+m,t+q),new SceneJS_math_FrustumPlane(h-f,l-j,p-n,t-r),new SceneJS_math_FrustumPlane(h+f,l+j,p+n,t+r),new SceneJS_math_FrustumPlane(h-g,l-k,p-o,t-s),new SceneJS_math_FrustumPlane(h+g,l+k,p+o,t+s)];var v=[SceneJS_math_getColMat4(a,0),SceneJS_math_getColMat4(a,1),SceneJS_math_getColMat4(a,2)];var w=[SceneJS_math_lenVec4(v[0]),SceneJS_math_lenVec4(v[1]),SceneJS_math_lenVec4(v[2])];var x=SceneJS_math_rcpVec3(w);var y=SceneJS_math_scalingMat4v(w);var z=SceneJS_math_scalingMat4v(x);SceneJS_math_mulVec4Scalar(v[0],x[0]);SceneJS_math_mulVec4Scalar(v[1],x[1]);SceneJS_math_mulVec4Scalar(v[2],x[2]);var A=SceneJS_math_identityMat4();SceneJS_math_setRowMat4(A,0,v[0]);SceneJS_math_setRowMat4(A,1,v[1]);SceneJS_math_setRowMat4(A,2,v[2]);if(!this.matrix){this.matrix=SceneJS_math_mat4()}SceneJS_math_mulMat4(b,a,this.matrix);if(!this.billboardMatrix){this.billboardMatrix=SceneJS_math_mat4()}SceneJS_math_mulMat4(z,SceneJS_math_mulMat4(A,y),this.billboardMatrix);this.viewport=c.slice(0,4);this.textAxisBoxIntersection=function(a){var b=SceneJS_math_INSIDE_FRUSTUM;var c=[a.min,a.max];var d=null;for(var e=0;e<6;++e){d=u[e];if(d.normal[0]*c[d.testVertex[0]][0]+d.normal[1]*c[d.testVertex[1]][1]+d.normal[2]*c[d.testVertex[2]][2]+d.offset<0){return SceneJS_math_OUTSIDE_FRUSTUM}if(d.normal[0]*c[1-d.testVertex[0]][0]+d.normal[1]*c[1-d.testVertex[1]][1]+d.normal[2]*c[1-d.testVertex[2]][2]+d.offset<0){b=SceneJS_math_INTERSECT_FRUSTUM}}return b};this.getProjectedSize=function(a){var b=SceneJS_math_mat4();SceneJS_math_subVec3(a.max,a.min,b);var d=SceneJS_math_lenVec3(b);var e=Math.abs(d);var f=[(a.min[0]+a.max[0])*.5,(a.min[1]+a.max[1])*.5,(a.min[2]+a.max[2])*.5,0];var g=e*.5;var h=[-g,0,0,1];var i=[g,0,0,1];h=SceneJS_math_mulMat4v4(this.billboardMatrix,h);h=SceneJS_math_addVec4(h,f);h=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,h));i=SceneJS_math_mulMat4v4(this.billboardMatrix,i);i=SceneJS_math_addVec4(i,f);i=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,i));return c[2]*Math.abs(i[0]-h[0])};this.getProjectedState=function(a){var b=SceneJS_math_transformPoints3(this.matrix,a);var d=1e7,e=1e7;var f=-1e7,g=-1e7;var h,i,j;var k=b.length;for(var l=0;l<k;++l){h=SceneJS_math_projectVec4(b[l]);i=h[0];j=h[1];if(i<-.5){i=-.5}if(j<-.5){j=-.5}if(i>.5){i=.5}if(j>.5){j=.5}if(i<d){d=i}if(j<e){e=j}if(i>f){f=i}if(j>g){g=j}}d+=.5;e+=.5;f+=.5;g+=.5;var m=c[2],n=c[3];d=d*(m+15);e=e*(n+15);f=f*(m+15);g=g*(n+15);var o=SceneJS_math_mat4();SceneJS_math_subVec2([f,g],[d,e],o);var p=SceneJS_math_lenVec2(o);if(d<0){d=0}if(f>m){f=m}if(e<0){e=0}if(g>n){g=n}return{canvasBox:{min:[d,e],max:[f,g]},canvasSize:p}}};var SceneJS_math_identityQuaternion=function(){return[0,0,0,1]};var SceneJS_math_angleAxisQuaternion=function(a,b,c,d){var e=d/180*Math.PI;var f=e/2;var g=Math.sin(f);return[g*a,g*b,g*c,Math.cos(f)]};var SceneJS_math_mulQuaternions=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3];var g=b[0],h=b[1],i=b[2],j=b[3];return[f*g+c*j+d*i-e*h,f*h+d*j+e*g-c*i,f*i+e*j+c*h-d*g,f*j-c*g-d*h-e*i]};var SceneJS_math_newMat4FromQuaternion=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];var f=2*b;var g=2*c;var h=2*d;var i=f*e;var j=g*e;var k=h*e;var l=f*b;var m=g*b;var n=h*b;var o=g*c;var p=h*c;var q=h*d;var r=SceneJS_math_identityMat4();SceneJS_math_setCellMat4(r,0,0,1-(o+q));SceneJS_math_setCellMat4(r,0,1,m-k);SceneJS_math_setCellMat4(r,0,2,n+j);SceneJS_math_setCellMat4(r,1,0,m+k);SceneJS_math_setCellMat4(r,1,1,1-(l+q));SceneJS_math_setCellMat4(r,1,2,p-i);SceneJS_math_setCellMat4(r,2,0,n-j);SceneJS_math_setCellMat4(r,2,1,p+i);SceneJS_math_setCellMat4(r,2,2,1-(l+o));return r};var SceneJS_math_slerp=function(a,b,c){var d=b[3]*.0174532925;var e=c[3]*.0174532925;var f=d*e+b[0]*c[0]+b[1]*c[1]+b[2]*c[2];if(Math.abs(f)>=1){return[b[0],b[1],b[2],b[3]]}else{var g=Math.acos(f);var h=Math.sqrt(1-f*f);if(Math.abs(h)<.001){return[b[0]*.5+c[0]*.5,b[1]*.5+c[1]*.5,b[2]*.5+c[2]*.5,b[3]*.5+c[3]*.5]}else{var i=Math.sin((1-a)*g)/h;var j=Math.sin(a*g)/h;return[b[0]*i+c[0]*j,b[1]*i+c[1]*j,b[2]*i+c[2]*j,(d*i+e*j)*57.295779579]}}};var SceneJS_math_normalizeQuaternion=function(a){var b=SceneJS_math_lenVec4([a[0],a[1],a[2],a[3]]);return[a[0]/b,a[1]/b,a[2]/b,a[3]/b]};var SceneJS_math_conjugateQuaternion=function(a){return[-a[0],-a[1],-a[2],a[3]]};var SceneJS_math_angleAxisFromQuaternion=function(a){a=SceneJS_math_normalizeQuaternion(a);var b=a[3];var c=2*Math.acos(b);var d=Math.sqrt(1-b*b);if(d<.001){return{x:a[0],y:a[1],z:a[2],angle:c*57.295779579}}else{return{x:a[0]/d,y:a[1]/d,z:a[2]/d,angle:c*57.295779579}}};var SceneJS_webgl_enumMap={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"};var SceneJS_webgl_ProgramUniform=function(a,b,c,d,e,f,g){var h=null;if(d==a.BOOL){h=function(b){a.uniform1i(f,b)}}else if(d==a.BOOL_VEC2){h=function(b){a.uniform2iv(f,b)}}else if(d==a.BOOL_VEC3){h=function(b){a.uniform3iv(f,b)}}else if(d==a.BOOL_VEC4){h=function(b){a.uniform4iv(f,b)}}else if(d==a.INT){h=function(b){a.uniform1iv(f,b)}}else if(d==a.INT_VEC2){h=function(b){a.uniform2iv(f,b)}}else if(d==a.INT_VEC3){h=function(b){a.uniform3iv(f,b)}}else if(d==a.INT_VEC4){h=function(b){a.uniform4iv(f,b)}}else if(d==a.FLOAT){h=function(b){a.uniform1f(f,b)}}else if(d==a.FLOAT_VEC2){h=function(b){a.uniform2fv(f,b)}}else if(d==a.FLOAT_VEC3){h=function(b){a.uniform3fv(f,b)}}else if(d==a.FLOAT_VEC4){h=function(b){a.uniform4fv(f,b)}}else if(d==a.FLOAT_MAT2){h=function(b){a.uniformMatrix2fv(f,a.FALSE,b)}}else if(d==a.FLOAT_MAT3){h=function(b){a.uniformMatrix3fv(f,a.FALSE,b)}}else if(d==a.FLOAT_MAT4){h=function(b){a.uniformMatrix4fv(f,a.FALSE,b)}}else{throw"Unsupported shader uniform type: "+d}this.setValue=h;this.getValue=function(){return a.getUniform(b,f)};this.getLocation=function(){return f}};var SceneJS_webgl_ProgramSampler=function(a,b,c,d,e,f){this.bindTexture=function(b,c){if(b.bind(c)){a.uniform1i(f,c);return true}return false}};var SceneJS_webgl_ProgramAttribute=function(a,b,c,d,e,f){this.bindFloatArrayBuffer=function(b){b.bind();a.enableVertexAttribArray(f);a.vertexAttribPointer(f,b.itemSize,a.FLOAT,false,0,0)}};var SceneJS_webgl_Shader=function(a,b,c,d){this.handle=a.createShader(b);this.valid=true;a.shaderSource(this.handle,c);a.compileShader(this.handle);if(a.getShaderParameter(this.handle,a.COMPILE_STATUS)!=0){}else{this.valid=false;d.error("Shader compile failed:"+a.getShaderInfoLog(this.handle))}if(!this.valid){throw SceneJS_errorModule.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}};var SceneJS_webgl_Program=function(a,b,c,d,e){var f,g,h,i,j,k;this.hash=a;var l=[];for(g=0;g<c.length;g++){l.push(new SceneJS_webgl_Shader(b,b.VERTEX_SHADER,c[g],e))}for(g=0;g<d.length;g++){l.push(new SceneJS_webgl_Shader(b,b.FRAGMENT_SHADER,d[g],e))}var m=b.createProgram();for(g=0;g<l.length;g++){k=l[g];if(k.valid){b.attachShader(m,k.handle)}}b.linkProgram(m);this.valid=true;this.valid=this.valid&&b.getProgramParameter(m,b.LINK_STATUS)!=0;var n=SceneJS_debugModule.getConfigs("shading");if(n.validate!==false){b.validateProgram(m);this.valid=this.valid&&b.getProgramParameter(m,b.VALIDATE_STATUS)!=0}if(!this.valid){e.debug("Program link failed: "+b.getProgramInfoLog(m));throw SceneJS_errorModule.fatalError(SceneJS.errors.SHADER_LINK_FAILURE,"Shader program failed to link")}var o={};var p={};var q=b.getProgramParameter(m,b.ACTIVE_UNIFORMS);for(g=0;g<q;++g){h=b.getActiveUniform(m,g);if(h){i=h.name;if(i[i.length-1]=="\0"){i=i.substr(0,i.length-1)}j=b.getUniformLocation(m,i);if(h.type==b.SAMPLER_2D||h.type==b.SAMPLER_CUBE||h.type==35682){p[i]=new SceneJS_webgl_ProgramSampler(b,m,i,h.type,h.size,j,e)}else{o[i]=new SceneJS_webgl_ProgramUniform(b,m,i,h.type,h.size,j,e)}}}var r={};var s=b.getProgramParameter(m,b.ACTIVE_ATTRIBUTES);for(g=0;g<s;g++){f=b.getActiveAttrib(m,g);if(f){j=b.getAttribLocation(m,f.name);r[f.name]=new SceneJS_webgl_ProgramAttribute(b,m,f.name,f.type,f.size,j,e)}}this.setProfile=function(a){this._profile=a};this.bind=function(){b.useProgram(m);if(this._profile){this._profile.program++}};this.getUniformLocation=function(a){var b=o[a];if(b){return b.getLocation()}else{}};this.getUniform=function(a){var b=o[a];if(b){return b}else{}};this.setUniform=function(a,b){var c=o[a];if(c){c.setValue(b);if(this._profile){this._profile.uniform++}}else{}};this.getAttribute=function(a){var b=r[a];if(b){return b}else{}};this.bindFloatArrayBuffer=function(a,b){var c=r[a];if(c){c.bindFloatArrayBuffer(b);if(this._profile){this._profile.varying++}}else{}};this.bindTexture=function(a,b,c){var d=p[a];if(d){if(this._profile){this._profile.texture++}return d.bindTexture(b,c)}else{return false}};this.unbind=function(){};this.destroy=function(){if(this.valid){b.deleteProgram(m);for(var a in l){b.deleteShader(l[a].handle)}r=null;o=null;p=null;this.valid=false}}};var SceneJS_webgl_Texture2D=function(a,b,c){this._init=function(d){d=SceneJS_webgl_ensureImageSizePowerOfTwo(d);this.canvas=b.canvas;this.textureId=b.textureId;this.handle=a.createTexture();this.target=a.TEXTURE_2D;this.minFilter=b.minFilter;this.magFilter=b.magFilter;this.wrapS=b.wrapS;this.wrapT=b.wrapT;this.update=b.update;a.bindTexture(this.target,this.handle);try{a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d)}catch(e){a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d,null)}this.format=a.RGBA;this.width=d.width;this.height=d.height;this.isDepth=false;this.depthMode=0;this.depthCompareMode=0;this.depthCompareFunc=0;if(b.minFilter){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.minFilter)}if(b.magFilter){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,b.magFilter)}if(b.wrapS){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapS)}if(b.wrapT){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapT)}if(b.minFilter==a.NEAREST_MIPMAP_NEAREST||b.minFilter==a.LINEAR_MIPMAP_NEAREST||b.minFilter==a.NEAREST_MIPMAP_LINEAR||b.minFilter==a.LINEAR_MIPMAP_LINEAR){a.generateMipmap(a.TEXTURE_2D)}a.bindTexture(this.target,null);if(c){c(this)}};if(b.image){this._init(b.image)}else{if(!b.url){throw"texture 'image' or 'url' expected"}var d=this;var e=new Image;e.crossOrigin="anonymous";e.onload=function(){d._init(e)};e.src=b.url}this.bind=function(b){if(this.handle){a.activeTexture(a["TEXTURE"+b]);a.bindTexture(this.target,this.handle);if(this.update){this.update(a)}return true}return false};this.unbind=function(b){if(this.handle){a.activeTexture(a["TEXTURE"+b]);a.bindTexture(this.target,null)}};this.generateMipmap=function(){if(this.handle){a.generateMipmap(a.TEXTURE_2D)}};this.destroy=function(){if(this.handle){a.deleteTexture(this.handle);this.handle=null}}};var SceneJS_webgl_ArrayBuffer;(function(){var a=new SceneJS_Map;SceneJS_webgl_ArrayBuffer=function(b,c,d,e,f,g){this.handle=b.createBuffer();this.id=a.addItem(this);b.bindBuffer(c,this.handle);b.bufferData(c,d,g);this.handle.numItems=e;this.handle.itemSize=f;b.bindBuffer(c,null);this.type=c;this.numItems=e;this.itemSize=f;this.bind=function(){b.bindBuffer(c,this.handle)};this.setData=function(a,d){if(d||d===0){b.bufferSubData(c,d,new Float32Array(a))}else{b.bufferData(c,new Float32Array(a))}};this.unbind=function(){b.bindBuffer(c,null)};this.destroy=function(){b.deleteBuffer(this.handle);a.removeItem(this.id)}}})();var SceneJS_webgl_VertexBuffer;(function(){var a=new SceneJS_Map;SceneJS_webgl_VertexBuffer=function(b,c){this.handle=b.createBuffer();this.id=a.addItem(this);b.bindBuffer(b.ARRAY_BUFFER,this.handle);b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,null);this.bind=function(){b.bindBuffer(b.ARRAY_BUFFER,this.handle)};this.setData=function(a,c){if(c){b.bufferSubData(b.ARRAY_BUFFER,c,new Float32Array(a))}else{b.bufferData(b.ARRAY_BUFFER,new Float32Array(a))}};this.unbind=function(){b.bindBuffer(b.ARRAY_BUFFER,null)};this.destroy=function(){b.deleteBuffer(this.handle);a.removeItem(this.id)}}})();var WebGLDebugUtils=function(){function d(a){if(c==null){c={};for(var b in a){if(typeof a[b]=="number"){c[a[b]]=b}}}}function e(){if(c==null){throw"WebGLDebugUtils.init(ctx) not called"}}function f(a){e();return c[a]!==undefined}function g(a,c,d){if(!f(d))return false;return a in b&&c in b[a]}function h(a){e();var b=c[a];return b!==undefined?b:"*UNKNOWN WebGL ENUM (0x"+a.toString(16)+")"}function i(b,c){function e(a,b){var c="";for(var d=0;d<b.length;++d){c+=(d==0?"":", ")+(f(b[d])?h(b[d]):b[d])}return a+"("+c+")"}function l(a){var b="'";var c=a.length;for(var d=0;d<c;d++){var e=a.charAt(d);var f=a.charCodeAt(d);var g=k[e];if(g!=undefined){b+=g}else if(f<32||f>=128){var h="000"+f.toString(16);b+="\\u"+h.substring(h.length-4)}else{b+=a.charAt(d)}}b+="'";return b}function m(a){var b=0;return function(){var c=a+b;b++;return c}}function q(a){var b=p[a];if(b===undefined){return undefined}var c="new "+b+"( [";c+="] )";return c}function r(a,b){var c="";for(var d=0;d<b.length;++d){var e=b[d];if(d>0){c+=", "}var f;try{if(e!==null&&e!==undefined){f=e[o]}}catch(i){alert(a);throw i}var j=q(e);if(f!=undefined){c+=f}else if(j!=undefined){c+=j}else if(typeof e=="string"){c+=l(e)}else if(g(a,d,e)){c+="gl."+h(e)}else{c+=e}}return"gl."+a+"("+c+");"}function s(b,d){return function(){var e;if(j){var f="";var g=n[d];if(g!=undefined){e=g();f="var "+e+" = "}a(f+r(d,arguments))}var h=b[d].apply(b,arguments);if(j&&e!=undefined){h[o]=e}var k=b.getError();if(k!=0){i[k]=true;c(k,d,arguments)}return h}}d(b);c=c||function(a,b,c){alert("WebGL error "+h(a)+" in "+e(b,c))};var i={};var j=false;b.setTracing=function(b){if(!j&&b){a("gl.setTracing("+b+");")}j=b};var k={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"};var n={createBuffer:m("buffer"),createFrameBuffer:m("frameBuffer"),createProgram:m("program"),createRenderbuffer:m("renderBuffer"),createShader:m("shader"),createTexture:m("texture"),getUniformLocation:m("uniformLocation"),readPixels:m("pixels")};var o="__webgl_trace_name__";var p={"[object WebGLByteArray]":"WebGLByteArray","[object WebGLUnsignedByteArray]":"WebGLUnsignedByteArray","[object WebGLShortArray]":"WebGLShortArray","[object Uint16Array]":"Uint16Array","[object WebGLIntArray]":"WebGLIntArray","[object WebGLUnsignedIntArray]":"WebGLUnsignedIntArray","[object Float32Array]":"Float32Array"};var t={};for(var u in b){if(typeof b[u]=="function"){t[u]=s(b,u)}else{t[u]=b[u]}}t.getError=function(){for(var a in i){if(i[a]){i[a]=false;return a}}return b.NO_ERROR};return t}var a=function(a){if(window.console&&window.console.log){window.console.log(a)}};var b={enable:{0:true},disable:{0:true},getParameter:{0:true},drawArrays:{0:true},drawElements:{0:true,2:true},createShader:{0:true},getShaderParameter:{1:true},getProgramParameter:{1:true},getVertexAttrib:{1:true},vertexAttribPointer:{2:true},bindTexture:{0:true},activeTexture:{0:true},getTexParameter:{0:true,1:true},texParameterf:{0:true,1:true},texParameteri:{0:true,1:true,2:true},texImage2D:{0:true,2:true,6:true,7:true},texSubImage2D:{0:true,6:true,7:true},copyTexImage2D:{0:true,2:true},copyTexSubImage2D:{0:true},generateMipmap:{0:true},bindBuffer:{0:true},bufferData:{0:true,2:true},bufferSubData:{0:true},getBufferParameter:{0:true,1:true},pixelStorei:{0:true,1:true},readPixels:{4:true,5:true},bindRenderbuffer:{0:true},bindFramebuffer:{0:true},checkFramebufferStatus:{0:true},framebufferRenderbuffer:{0:true,1:true,2:true},framebufferTexture2D:{0:true,1:true,2:true},getFramebufferAttachmentParameter:{0:true,1:true,2:true},getRenderbufferParameter:{0:true,1:true},renderbufferStorage:{0:true,1:true},clear:{0:true},depthFunc:{0:true},blendFunc:{0:true,1:true},blendFuncSeparate:{0:true,1:true,2:true,3:true},blendEquation:{0:true},blendEquationSeparate:{0:true,1:true},stencilFunc:{0:true},stencilFuncSeparate:{0:true,1:true},stencilMaskSeparate:{0:true},stencilOp:{0:true,1:true,2:true},stencilOpSeparate:{0:true,1:true,2:true,3:true},cullFace:{0:true},frontFace:{0:true}};var c=null;return{init:d,mightBeEnum:f,glEnumToString:h,makeDebugContext:i}}();var SceneJS_eventModule=new function(){this.ERROR=0;this.INIT=1;this.RESET=2;this.TIME_UPDATED=3;this.SCENE_CREATED=4;this.SCENE_IDLE=5;this.SCENE_COMPILING=6;this.SCENE_COMPILED=7;this.SCENE_DESTROYED=8;this.RENDERER_UPDATED=9;this.RENDERER_EXPORTED=10;this.CANVAS_DEACTIVATED=11;this.GEOMETRY_UPDATED=13;this.GEOMETRY_EXPORTED=14;this.MODEL_TRANSFORM_UPDATED=15;this.MODEL_TRANSFORM_EXPORTED=16;this.PROJECTION_TRANSFORM_UPDATED=17;this.PROJECTION_TRANSFORM_EXPORTED=18;this.VIEW_TRANSFORM_UPDATED=19;this.VIEW_TRANSFORM_EXPORTED=20;this.LIGHTS_UPDATED=21;this.LIGHTS_EXPORTED=22;this.MATERIAL_UPDATED=23;this.MATERIAL_EXPORTED=24;this.TEXTURES_UPDATED=25;this.TEXTURES_EXPORTED=26;this.SHADER_ACTIVATE=27;this.SHADER_ACTIVATED=28;this.SCENE_RENDERING=29;this.LOGGING_ELEMENT_ACTIVATED=37;this.PICK_COLOR_EXPORTED=38;this.NODE_CREATED=39;this.NODE_UPDATED=40;this.NODE_DESTROYED=41;var a=new Array(37);this.addListener=function(b,c,d){var e=a[b];if(!e){e=[];a[b]=e}var f={command:c,priority:d==undefined?e.length:d};for(var g=0;g<e.length;g++){if(e[g].priority>f.priority){e.splice(g,0,f);return}}e.push(f)};this.fireEvent=function(b,c){var d=a[b];if(d){if(!c){c={}}for(var e=0;e<d.length;e++){d[e].command(c)}}}};SceneJS.bind=function(a,b){switch(a){case"error":SceneJS_eventModule.addListener(SceneJS_eventModule.ERROR,function(a){b({code:a.code,errorName:a.errorName,exception:a.exception,fatal:a.fatal})});break;case"reset":SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){b()});break;case"scene-created":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(a){b({sceneId:a.sceneId})});break;case"node-created":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_CREATED,function(a){b({nodeId:a.nodeId,json:a.json})});break;case"node-updated":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_UPDATED,function(a){b({nodeId:a.nodeId})});break;case"node-destroyed":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_DESTROYED,function(a){b({nodeId:a.nodeId})});break;case"scene-rendering":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(a){b({sceneId:a.sceneId})});break;case"scene-rendered":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILED,function(a){b({sceneId:a.sceneId})});break;case"scene-destroyed":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(a){b({sceneId:a.sceneId})});break;default:throw SceneJS_errorModule.fatalError("SceneJS.bind - this event type not supported: '"+a+"'")}};SceneJS.addListener=SceneJS.onEvent=SceneJS.bind;var SceneJS_compileCfg=new function(){this.COMPILE_NOTHING=-2;this.REDRAW=-1;this.COMPILE_SCENE=0;this.COMPILE_BRANCH=1;this.COMPILE_PATH=2;this.RESORT=3;this.levelNameStrings=["COMPILE_SCENE","COMPILE_BRANCH","COMPILE_SUBTREE","COMPILE_PATH","COMPILE_NODE"];this.config={node:{add:{attr:{node:{level:this.COMPILE_SCENE},nodes:{level:this.COMPILE_SCENE}},level:this.COMPILE_SCENE},remove:{attr:{node:{level:this.RESORT},nodes:{level:this.RESORT}},level:this.COMPILE_SCENE},insert:{attr:{node:{level:this.COMPILE_SCENE}},level:this.COMPILE_SCENE},bind:{attr:{rendered:{level:this.COMPILE_SCENE}}},unbind:{attr:{rendered:{level:this.COMPILE_SCENE}}},destroyed:{level:this.COMPILE_SCENE}},billboard:{alwaysCompile:true},clip:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},colortrans:{set:{level:this.REDRAW},inc:{level:this.REDRAW},mul:{level:this.REDRAW}},layer:{set:{attr:{priority:{level:this.RESORT},enabled:{level:this.RESORT}}}},lights:{},scene:{created:{level:this.COMPILE_SCENE},start:{level:this.COMPILE_SCENE},set:{attr:{tagMask:{level:this.RESORT}}}},scale:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},stationary:{alwaysCompile:true},tag:{set:{attr:{tag:{level:this.RESORT}}}},rotate:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},translate:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},quaternion:{set:{level:this.COMPILE_BRANCH},add:{level:this.COMPILE_BRANCH}},matrix:{set:{level:this.COMPILE_BRANCH}},xform:{set:{level:this.REDRAW}},material:{set:{level:this.REDRAW}},lookAt:{set:{level:this.COMPILE_PATH},inc:{level:this.COMPILE_PATH}},camera:{set:{level:this.COMPILE_PATH},inc:{level:this.COMPILE_PATH}},morphGeometry:{set:{level:this.REDRAW},loaded:{level:this.REDRAW}},texture:{set:{attr:{layers:{level:this.REDRAW}}},loaded:{level:this.REDRAW}},geometry:{set:{attr:{positions:{level:this.REDRAW},normals:{level:this.REDRAW},uv:{level:this.REDRAW},uv2:{level:this.REDRAW},indices:{level:this.REDRAW}}},loaded:{level:this.COMPILE_SCENE}},text:{loadedImage:{level:this.COMPILE_BRANCH}},shader:{set:{attr:{params:{level:this.REDRAW}}}},shaderParams:{set:{attr:{params:{level:this.REDRAW}}}},flags:{set:{attr:{flags:{level:this.RESORT}}},add:{attr:{flags:{attr:{level:this.RESORT}}}}}};this.getCompileLevel=function(a,b,c,d){var e=this.config[a];if(e){if(b){var f=e[b];if(f){if(f.attr){if(c){var g=f.attr[c];if(g){if(d){if(typeof d=="object"){var h=g.attr;if(h){var i;var j;for(var k in d){if(d.hasOwnProperty(k)){j=h[k];if(j){if(j.level!=undefined){if(i==undefined||j.level<i){i=j.level}}}}}if(i){return i}}}}if(g.level!=undefined){return g.level}}}}if(f.level!=undefined){return f.level}}}if(e.level!=undefined){return e.level}}return undefined}};var SceneJS_compileModule=new function(){this._debugCfg=null;this._enableCompiler=true;this._scenes={};this._scene=null;this._nodeStack=[];this._stackLen=0;var a=function(){this._bins=[];this.size=0;this.insert=function(a,b){var c=this._bins[a];if(!c){c=this._bins[a]=[];c.numNodes=0}var d=c[c.numNodes];if(!d){d=c[c.numNodes]={}}d.node=b;d.level=a;c.numNodes++;this.size++};this.remove=function(){var a;for(var b=SceneJS_compileCfg.COMPILE_NOTHING;b<=SceneJS_compileCfg.RESORT;b++){a=this._bins[b];if(a&&a.numNodes>0){this.size--;return a[--a.numNodes]}}return null};this.clear=function(){var a;for(var b=SceneJS_compileCfg.COMPILE_NOTHING;b<=SceneJS_compileCfg.RESORT;b++){a=this._bins[b];if(a){this._bins[b].numNodes=0}}this.size=0}};var b=this;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){b._debugCfg=SceneJS_debugModule.getConfigs("compilation")});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(c){b._scenes[c.sceneId]={flagSceneCompile:false,dirtyNodes:{},dirtyNodesWithinBranches:{},countTraversedSubtreesToCompile:0,compilationQueue:new a,nodeCompilationLevels:{},nodeAlwaysCompile:{},stats:{nodes:0}}});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(a){b._scenes[a.sceneId]=null});this.redraw=function(a){if(!this._enableCompiler){return}var b=this._scenes[a];if(b.compilingScene){return}b.redraw=true};this.nodeUpdated=function(a,b,c,d){if(!this._enableCompiler){return}var e=a.scene;var f=this._scenes[e.attr.id];if(f.compilingScene){return}var g=a.attr.type;var h=a.attr.id;var i;if(g!="node"){i=SceneJS_compileCfg.getCompileLevel("node",b,c,d)}if(i===undefined){i=SceneJS_compileCfg.getCompileLevel(g,b,c,d)}if(i==SceneJS_compileCfg.REDRAW){f.redraw=true;return}if(i==SceneJS_compileCfg.COMPILE_NOTHING){return}if(i===undefined){i=SceneJS_compileCfg.COMPILE_SCENE}if(i==SceneJS_compileCfg.COMPILE_SCENE){f.compilingScene=true;f.compilationQueue.clear();return}if(f.nodeCompilationLevels[h]<=i){return}f.nodeCompilationLevels[h]=i;f.compilationQueue.insert(i,a)};this.COMPILE_NOTHING=0;this.REDRAW=1;this.COMPILE_PARTIAL=2;this.COMPILE_EVERYTHING=3;this.beginSceneCompile=function(a){var b=this._scenes[a];this._scene=b;this._stackLen=0;b.countTraversedSubtreesToCompile=0;if(!this._enableCompiler){return{level:this.COMPILE_EVERYTHING}}b.nodeCompilationLevels={};if(b.compilingScene){b.flagSceneCompile=true;b.compilingScene=false;return{level:this.COMPILE_EVERYTHING}}var c=b.compilationQueue;if(c.size==0){if(b.redraw){b.redraw=false;return{level:this.REDRAW}}return{level:this.COMPILE_NOTHING}}var d;var e;var f;var g;b.stats={scene:0,branch:0,path:0,subtree:0,nodes:0};var h=b.stats;var i={level:this.REDRAW,resort:false};while(c.size>0){d=c.remove();g=d.level;e=d.node;f=e.attr.id;if(g==SceneJS_compileCfg.COMPILE_BRANCH){this._flagCompilePath(b,e);b.dirtyNodesWithinBranches[f]=true;i.level=this.COMPILE_PARTIAL}else if(g==SceneJS_compileCfg.COMPILE_PATH){this._flagCompilePath(b,e);i.level=this.COMPILE_PARTIAL}else if(g==SceneJS_compileCfg.RESORT){i.resort=true}}return i};this._flagCompilePath=function(a,b){var c=a.dirtyNodes;var d;var e=b;while(e){d=e.attr.id;if(c[d]){return}if(a.dirtyNodesWithinBranches[d]){return}c[d]=true;e=e.parent}};this.preVisitNode=function(a){if(!this._enableCompiler){return true}var b=this._scene;var c=SceneJS_compileCfg.config[a.attr.type];var d=a.attr.id;b.stats.nodes++;if(b.flagSceneCompile){b.nodeAlwaysCompile[d]=false;if(c&&c.alwaysCompile){this._alwaysCompilePath(b,a)}}this._nodeStack[this._stackLen++]=a;if(b.dirtyNodesWithinBranches[d]===true||c&&c.alwaysCompile){b.countTraversedSubtreesToCompile++}if(b.flagSceneCompile){return true}if(b.nodeAlwaysCompile[d]){return true}if(b.countTraversedSubtreesToCompile>0){return true}if(b.dirtyNodes[d]===true){return true}b.stats.nodes--;return false};this._alwaysCompilePath=function(a,b){var c;var d=b;if(a.nodeAlwaysCompile[d.attr.id]){return}while(d){c=d.attr.id;a.nodeAlwaysCompile[c]=true;d=d.parent}};this.postVisitNode=function(a){if(this._stackLen>0){var b=this._scene;var c=a.attr.id;var d=this._nodeStack[this._stackLen-1];if(d.attr.id==c){this._stackLen--;var e=SceneJS_compileCfg.config[a.attr.type];if(b.dirtyNodesWithinBranches[c]===true||e&&e.alwaysCompile){b.countTraversedSubtreesToCompile--}}b.dirtyNodes[c]=false;b.dirtyNodesWithinBranches[c]=false}};this.finishSceneCompile=function(){this._scene.flagSceneCompile=false}};var SceneJS_loggingModule=new function(){function f(a,b){if(SceneJS._isArray(b)){g(a,i(b));for(var c=0;c<b.length;c++){h(b[c])}}else{g(a,b);h(b)}}function g(d,f){f=a?e+a+": "+f:e+f;var g=b?b[d]:null;if(g){g(f)}else{var h=c[d];if(!h){h=c[d]=[]}h.push(f)}}function h(b){if(typeof console=="object"){b=a?e+a+": "+b:e+b;console.log(b)}}function i(a){var b=[];for(var c=0;c<a.length;c++){var d=c<10?"   ":c<100?"  ":c<1e3?" ":"";b.push(c+d+": "+a[c])}return b.join("<br/>")}function j(a){for(var b=0;b<a.length;b++){h(a[b])}}function k(a){var d=c[a];if(d){var e=b?b[a]:null;if(e){for(var f=0;f<d.length;f++){e(d[f])}c[a]=[]}}}var a;var b=null;var c={};var d=0;var e="";SceneJS_eventModule.addListener(SceneJS_eventModule.LOGGING_ELEMENT_ACTIVATED,function(a){var c=a.loggingElement;if(c){b={warn:function(b){c.innerHTML+='<p style="color:orange;">'+b+"</p>"},error:function(b){c.innerHTML+='<p style="color:darkred;">'+b+"</p>"},debug:function(b){c.innerHTML+='<p style="color:darkblue;">'+b+"</p>"},info:function(b){c.innerHTML+='<p style="color:darkgreen;">'+b+"</p>"}}}else{b=null}});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(b){a=b.sceneId});SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){c={};b=null},1e5);this.setIndent=function(a){d=a;var b=[];for(var c=0;c<d;c++){b.push("----")}e=b.join("")};this.error=function(a){f("error",a)};this.warn=function(a){f("warn",a)};this.info=function(a){f("info",a)};this.debug=function(a){f("debug",a)};this.getFuncs=function(){return b};this.setFuncs=function(a){if(a){b=a;for(var d in c){k(d)}}}};var SceneJS_errorModule=new function(){this.fatalError=function(a,b){if(typeof a=="string"){b=a;a=SceneJS.errors.ERROR}SceneJS_eventModule.fireEvent(SceneJS_eventModule.ERROR,{errorName:SceneJS.errors._getErrorName(a)||"ERROR",code:a,exception:b,fatal:true});return b};this.error=function(a,b){SceneJS_eventModule.fireEvent(SceneJS_eventModule.ERROR,{errorName:SceneJS.errors._getErrorName(a)||"ERROR",code:a,exception:b,fatal:false})}};(function(){this.DEFAULT_LAYER_NAME="___default";var a=[];var b=[];var c=0;var d=true;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setLayer(b[c-1],a[c-1])}else{SceneJS_DrawList.setLayer()}d=false}});var e=SceneJS.createNodeType("layer");e.prototype._init=function(a){if(this.core._nodeCount==1){this.core.priority=a.priority||0;this.core.enabled=a.enabled!==false}};e.prototype.setPriority=function(a){this.core.priority=a};e.prototype.getPriority=function(){return this.core.priority};e.prototype.setEnabled=function(a){this.core.enabled=a};e.prototype.getEnabled=function(){return this.core.enabled};e.prototype._compile=function(){a[c]=this.core;b[c]=this.attr.id;c++;d=true;this._compileNodes();c--;d=true}})();(function(){var a=SceneJS.createNodeType("library");a.prototype._compile=function(){}})();new function(){function e(a){var b;if(!a){b=document.getElementById(d.DEFAULT_LOGGING_ELEMENT_ID);if(!b){SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' omitted and failed to find default logging element with ID '"+d.DEFAULT_LOGGING_ELEMENT_ID+"' - that's OK, logging to browser console instead")}}else{b=document.getElementById(a);if(!b){b=document.getElementById(d.DEFAULT_LOGGING_ELEMENT_ID);if(!b){SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' unresolved and failed to find default logging element with ID '"+d.DEFAULT_LOGGING_ELEMENT_ID+"' - that's OK, logging to browser console instead")}else{SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' unresolved - found default logging element with ID '"+d.DEFAULT_LOGGING_ELEMENT_ID+"' - logging to browser console also")}}else{SceneJS_loggingModule.info("SceneJS.Scene logging to element with ID '"+a+"' - logging to browser console also")}}return b}function f(a,b){var c;if(!a){SceneJS_loggingModule.info("Scene attribute 'canvasId' omitted - looking for default canvas with ID '"+d.DEFAULT_CANVAS_ID+"'");a=d.DEFAULT_CANVAS_ID;c=document.getElementById(a);if(!c){throw SceneJS_errorModule.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"Scene failed to find default canvas with ID '"+d.DEFAULT_CANVAS_ID+"'")}}else{c=document.getElementById(a);if(!c){SceneJS_loggingModule.warn("Scene config 'canvasId' unresolved - looking for default canvas with "+"ID '"+d.DEFAULT_CANVAS_ID+"'");a=d.DEFAULT_CANVAS_ID;c=document.getElementById(a);if(!c){throw SceneJS_errorModule.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"Scene attribute 'canvasId' does not match any elements in the page and no "+"default canvas found with ID '"+d.DEFAULT_CANVAS_ID+"'")}}}c.width=c.clientWidth;c.height=c.clientHeight;var e;var f=SceneJS.SUPPORTED_WEBGL_CONTEXT_NAMES;for(var g=0;!e&&g<f.length;g++){try{if(SceneJS_debugModule.getConfigs("webgl.logTrace")==true){e=c.getContext(f[g],b);if(e){e=WebGLDebugUtils.makeDebugContext(e,function(a,b,c){SceneJS_loggingModule.error("WebGL error calling "+b+" on WebGL canvas context - see console log for details")});e.setTracing(true)}}else{e=c.getContext(f[g],b)}}catch(h){}}if(!e){throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Canvas document element with ID '"+a+"' failed to provide a supported WebGL context")}try{e.clearColor(0,0,0,1);e.clearDepth(1);e.enable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.depthRange(0,1);e.disable(e.SCISSOR_TEST)}catch(h){throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Canvas document element with ID '"+a+"' provided a supported WebGL context, but functions appear to be missing")}return{canvas:c,context:e,canvasId:a}}function g(){var a=[];for(var c in b){var d=b[c];if(d){a.push(d.scene)}}return a}function h(){}var a=false;var b={};var c=0;var d=SceneJS.createNodeType("scene");SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){b={};c=0});d.prototype._init=function(d){if(!d.canvasId){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Scene canvasId expected")}this._loggingElementId=d.loggingElementId;this._destroyed=false;this.scene=this;this.nodeMap=new SceneJS_Map;if(d.tagMask){this.setTagMask(d.tagMask)}this.canvas=f(d.canvasId,d.contextAttr);var g=this.attr.id;b[g]={sceneId:g,scene:this,canvas:this.canvas,loggingElement:e(this._loggingElementId)};c++;if(!a){SceneJS_loggingModule.info("SceneJS V"+SceneJS.VERSION+" initialised");SceneJS_eventModule.fireEvent(SceneJS_eventModule.INIT);a=true}SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_CREATED,{sceneId:g,canvas:this.canvas});SceneJS_loggingModule.info("Scene defined: "+g);SceneJS_compileModule.nodeUpdated(this,"created")};d.DEFAULT_CANVAS_ID="_scenejs-default-canvas";d.DEFAULT_LOGGING_ELEMENT_ID="_scenejs-default-logging";d.prototype.getZBufferDepth=function(){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}var a=this.canvas.context;return a.getParameter(a.DEPTH_BITS)};if(!self.Int32Array){self.Int32Array=Array;self.Float32Array=Array}(function(){var a=0;var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"RequestCancelAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(b,c){var d=(new Date).getTime();var e=Math.max(0,16-(d-a));var f=window.setTimeout(function(){b(d+e)},e);a=d+e;return f};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(a){clearTimeout(a)}})();d.prototype.setTagMask=function(a){if(!this.tagSelector){this.tagSelector={}}this.tagSelector.mask=a;this.tagSelector.regex=a?new RegExp(a):null};d.prototype.getTagMask=function(){return this.tagSelector?this.tagSelector.mask:null};d.prototype._compileScene=function(){var a=SceneJS_compileModule.beginSceneCompile(this.attr.id);if(a.level!=SceneJS_compileModule.COMPILE_NOTHING){SceneJS_DrawList.bindScene({sceneId:this.attr.id},{compileMode:a.level==SceneJS_compileModule.COMPILE_EVERYTHING?SceneJS_DrawList.COMPILE_SCENE:SceneJS_DrawList.COMPILE_NODES,resort:a.resort});this._compile();SceneJS_compileModule.finishSceneCompile();return true}return false};d.prototype.renderFrame=function(a){if(this._compileScene()){SceneJS_DrawList.renderFrame({tagSelector:this.tagSelector});return true}if(a&&a.force){SceneJS_DrawList.bindScene({sceneId:this.attr.id},{compileMode:SceneJS_DrawList.COMPILE_NODES,resort:false});SceneJS_DrawList.renderFrame({tagSelector:this.tagSelector});return true}return false};d.prototype.start=function(a){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}var b=this._setupFps();if(!this._running){a=a||{};this._running=true;this._paused=false;var c=this;var d="__scenejs_sceneLoop"+this.attr.id;var e=false;SceneJS_compileModule.nodeUpdated(this,"start");var f=c.attr.id;window[d]=function(){if(c._running&&!c._paused){if(a.idleFunc){a.idleFunc()}if(!c._running){return}SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_IDLE,{sceneId:f});if(c._compileScene()){e=false;SceneJS_DrawList.renderFrame({profileFunc:a.profileFunc,tagSelector:c.tagSelector});if(a.frameFunc){a.frameFunc({fps:b()})}window.requestAnimationFrame(window[d])}else{if(!e&&a.sleepFunc){a.sleepFunc()}e=true;window.requestAnimationFrame(window[d])}}else{window.requestAnimationFrame(window[d])}};this._startCfg=a;window.requestAnimationFrame(window[d])}};d.prototype._setupFps=function(){var a=new Date;var b=0;var c=0;return function(){b++;var d=new Date;if(d.getTime()-a.getTime()>1e3){var e=d.getTime()-a.getTime();c=Math.round(b*1e3/e);b=0;a=d}return c}};d.prototype.pause=function(a){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}this._paused=a};d.prototype.isRunning=function(){return this._running};d.prototype.pick=function(a,b,c){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}c=c||{};this._compileScene();var d=SceneJS_DrawList.pick({sceneId:this.attr.id,canvasX:a,canvasY:b,rayPick:c.rayPick,tagSelector:this.tagSelector});if(d){d.canvasX=a;d.canvasY=b}return d};d.prototype._compile=function(){SceneJS._actionNodeDestroys();var a=this.attr.id;var c=b[a];SceneJS_eventModule.fireEvent(SceneJS_eventModule.LOGGING_ELEMENT_ACTIVATED,{loggingElement:c.loggingElement});SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_COMPILING,{sceneId:a,nodeId:a,canvas:c.canvas});if(SceneJS_compileModule.preVisitNode(this)){this._compileNodes()}SceneJS_compileModule.postVisitNode(this);h()};d.prototype.destroy=function(){if(!this._destroyed){this.stop();this._destroyed=true;this._scheduleNodeDestroy();SceneJS._actionNodeDestroys();var a=this.attr.id;b[a]=null;c--;SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_DESTROYED,{sceneId:a});SceneJS_loggingModule.info("Scene destroyed: "+a);if(c==0){SceneJS_loggingModule.info("SceneJS reset");SceneJS_eventModule.fireEvent(SceneJS_eventModule.RESET)}}};d.prototype.isActive=function(){return!this._destroyed};d.prototype.stop=function(){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}if(this._running){this._running=false;window["__scenejs_sceneLoop"+this.attr.id]=null}};d.prototype.containsNode=function(a){if(this._destroyed){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed")}var b=this.nodeMap.items[a];return b?true:false};d.prototype.findNodes=function(a){var b=new RegExp(a);var c=[];var d=this.nodeMap.items;for(var e in d){if(d.hasOwnProperty(e)){if(b.test(e)){c.push(d[e])}}}return c};d.prototype.findNode=function(a){var b=this.nodeMap.items[a];return b?SceneJS._selectNode(b):null};d.prototype.getStatus=function(){return this._destroyed?{destroyed:true}:SceneJS._shallowClone(SceneJS_sceneStatusModule.sceneStatus[this.attr.id])};SceneJS.reset=function(){var a=g();var b=[];for(var c=0;c<a.length;c++){b.push(a[c])}while(b.length>0){b.pop().destroy()}}};var SceneJS_PickBuffer=function(a){var b=a.canvas;var c=b.context;var d;this.bound=false;this._touch=function(){var a=b.canvas.width;var e=b.canvas.height;if(d){if(d.width==a&&d.height==e){return}else{c.deleteTexture(d.texture);c.deleteFramebuffer(d.frameBuf);c.deleteRenderbuffer(d.renderBuf)}}d={frameBuf:c.createFramebuffer(),renderBuf:c.createRenderbuffer(),texture:c.createTexture(),width:a,height:e};c.bindFramebuffer(c.FRAMEBUFFER,d.frameBuf);c.bindTexture(c.TEXTURE_2D,d.texture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);try{c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,e,0,c.RGBA,c.UNSIGNED_BYTE,null)}catch(f){var g=new WebGLUnsignedByteArray(a*e*3);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,e,0,c.RGBA,c.UNSIGNED_BYTE,g)}c.bindRenderbuffer(c.RENDERBUFFER,d.renderBuf);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,e);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d.texture,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,d.renderBuf);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,d.frameBuf);if(!c.isFramebuffer(d.frameBuf)){throw SceneJS_errorModule.fatalError("Invalid framebuffer")}var h=c.checkFramebufferStatus(c.FRAMEBUFFER);switch(h){case c.FRAMEBUFFER_COMPLETE:break;case c.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case c.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case c.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case c.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: "+h)}this.bound=false};this.bind=function(){this._touch();if(this.bound){return}c.bindFramebuffer(c.FRAMEBUFFER,d.frameBuf);this.bound=true};this.clear=function(){if(!this.bound){throw"Pick buffer not bound"}c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.disable(c.BLEND)};this.read=function(a,d){var e=a;var f=b.canvas.height-d;var g=new Uint8Array(4);c.readPixels(e,f,1,1,c.RGBA,c.UNSIGNED_BYTE,g);return g};this.unbind=function(){c.bindFramebuffer(c.FRAMEBUFFER,null);this.bound=false}};var SceneJS_DrawList=new function(){this.SORT_ORDER_TEXTURE=0;this.SORT_ORDER_VBO=1;this._sortOrder=[this.SORT_ORDER_TEXTURE,this.SORT_ORDER_VBO];this._GEO=0;this._CLIPS=1;this._COLORTRANS=2;this._FLAGS=3;this._LAYER=4;this._FRAMEBUF=5;this._LIGHTS=6;this._MATERIAL=7;this._MORPH=8;this._PICKCOLOR=9;this._TEXTURE=10;this._RENDERER=11;this._MODEL_TRANSFORM=12;this._PROJ_TRANSFORM=13;this._VIEW_TRANSFORM=14;this._PICK_LISTENERS=15;this._NAME=16;this._TAG=17;this._RENDER_LISTENERS=18;this._SHADER=19;this._SHADER_PARAMS=20;var a=function(){var a=-1;return function(b){b._id=a;b._stateId=a--;b._nodeCount=0;b._default=true;return b}}();this._DEFAULT_MAT=new Float32Array(SceneJS_math_identityMat4());this._DEFAULT_NORMAL_MAT=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(SceneJS_math_identityMat4(),SceneJS_math_mat4())));this._DEFAULT_CLIP_STATE=a({clips:[],hash:""});this._DEFAULT_COLORTRANS_STATE=a({core:null,hash:"f"});this._DEFAULT_FLAGS_STATE=a({flags:{colortrans:true,picking:true,clipping:true,enabled:true,transparent:false,backfaces:true,frontface:"ccw"}});this._DEFAULT_LAYER_STATE=a({core:{priority:0,enabled:true}});this._DEFAULT_FRAMEBUF_STATE=a({frameBuf:null});this._DEFAULT_LIGHTS_STATE=a({lights:[],hash:""});this._DEFAULT_MATERIAL_STATE=a({material:{baseColor:[0,0,0],specularColor:[0,0,0],specular:1,shine:10,reflect:.8,alpha:1,emit:0}});this._DEFAULT_MORPH_STATE=a({morph:null,hash:""});this._DEFAULT_PICK_COLOR_STATE=a({pickColor:null,hash:""});this._DEFAULT_PICK_LISTENERS_STATE=a({listeners:[]});this._DEFAULT_NAME_STATE=a({core:null});this._DEFAULT_TAG_STATE=a({core:null});this._DEFAULT_TEXTURE_STATE=a({hash:""});this._DEFAULT_RENDERER_STATE=a({props:null});this._DEFAULT_MODEL_TRANSFORM_STATE=a({mat:this._DEFAULT_MAT,normalMat:this._DEFAULT_NORMAL_MAT});this._DEFAULT_PROJ_TRANSFORM_STATE=a({mat:new Float32Array(SceneJS_math_orthoMat4c(SceneJS_math_ORTHO_OBJ.left,SceneJS_math_ORTHO_OBJ.right,SceneJS_math_ORTHO_OBJ.bottom,SceneJS_math_ORTHO_OBJ.top,SceneJS_math_ORTHO_OBJ.near,SceneJS_math_ORTHO_OBJ.far)),optics:SceneJS_math_ORTHO_OBJ});this._DEFAULT_VIEW_TRANSFORM_STATE=a({mat:this._DEFAULT_MAT,normalMat:this._DEFAULT_NORMAL_MAT,lookAt:SceneJS_math_LOOKAT_ARRAYS});this._DEFAULT_RENDER_LISTENERS_STATE=a({listeners:[]});this._DEFAULT_SHADER_STATE=a({shader:{},hash:""});this._DEFAULT_SHADER_PARAMS_STATE=a({params:null});this._programs={};var b;this._sceneStates={};this._states=null;this._nodeMap=null;this._stateMap=null;var c;var d=0;this.COMPILE_SCENE=0;this.COMPILE_BRANCH=1;this.COMPILE_NODES=2;this.compileMode=null;var e;var f;var g;var h;var i;var j;var k;var l;var m;var n;var o;var p;var q;var r;var s;var t;var u;var v;var w;var x;var y;this._stateHash=null;var z=[];var A=this;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){b=SceneJS_debugModule.getConfigs("shading")});SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){var a=A._programs;var b;for(var c in a){if(a.hasOwnProperty(c)){b=a[c];b.pick.destroy();b.render.destroy()}}A._programs={};d=0});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(a){var b=a.sceneId;if(!A._sceneStates[b]){A._sceneStates[b]={sceneId:b,canvas:a.canvas,nodeRenderer:new SceneJS_DrawListRenderer({canvas:a.canvas.canvas,context:a.canvas.context}),bin:[],lenBin:0,visibleCacheBin:[],lenVisibleCacheBin:0,nodeMap:{},geoNodesMap:{},stateMap:{},pickCallListDirty:true,pickBufDirty:true}}});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(a){});this.setStateSortDelay=function(a){a=typeof a=="number"?a==undefined:this._DEFAULT_STATE_SORT_DELAY};this.bindScene=function(a,b){b=b||{};this._states=this._sceneStates[a.sceneId];this._nodeMap=this._states.nodeMap;this._stateMap=this._states.stateMap;this._stateHash=null;if(b.compileMode==SceneJS_DrawList.COMPILE_SCENE||b.compileMode==SceneJS_DrawList.COMPILE_BRANCH){s=this._DEFAULT_CLIP_STATE;j=this._DEFAULT_COLORTRANS_STATE;f=this._DEFAULT_FLAGS_STATE;g=this._DEFAULT_LAYER_STATE;r=this._DEFAULT_FRAMEBUF_STATE;i=this._DEFAULT_LIGHTS_STATE;k=this._DEFAULT_MATERIAL_STATE;t=this._DEFAULT_MORPH_STATE;q=this._DEFAULT_PICK_COLOR_STATE;h=this._DEFAULT_RENDERER_STATE;l=this._DEFAULT_TEXTURE_STATE;n=this._DEFAULT_MODEL_TRANSFORM_STATE;p=this._DEFAULT_PROJ_TRANSFORM_STATE;o=this._DEFAULT_VIEW_TRANSFORM_STATE;u=this._DEFAULT_NAME_STATE;v=this._DEFAULT_TAG_STATE;w=this._DEFAULT_RENDER_LISTENERS_STATE;x=this._DEFAULT_SHADER_STATE;y=this._DEFAULT_SHADER_PARAMS_STATE;this._forceStateSort(true);if(b.compileMode==SceneJS_DrawList.COMPILE_SCENE){this._states.lenBin=0;c=0;this._nodeMap=this._states.nodeMap={};this._stateMap=this._states.stateMap={}}}if(b.compileMode==SceneJS_DrawList.COMPILE_NODES){this._nodeMap=this._states.nodeMap;this._stateMap=this._states.stateMap;if(b.resort){this._forceStateSort(true)}}this.compileMode=b.compileMode;e=false};this.marshallStates=function(){SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_RENDERING,{fullCompile:this.compileMode===SceneJS_DrawList.COMPILE_SCENE})};this._getState=function(a,b){var d;var e=this._stateMap[a];if(!e){e=this._stateMap[a]={}}if(this.compileMode!=SceneJS_DrawList.COMPILE_SCENE){d=e[b];if(!d){d={_id:b,_stateId:c++,_stateType:a,_nodeCount:0};e[b]=d}}else{d={_id:b,_stateId:c++,_stateType:a,_nodeCount:0};if(b){e[b]=d}}return d};this._releaseState=function(a){if(a._stateType==undefined){return}if(a._nodeCount<=0){return}if(--a._nodeCount==0){var b=this._stateMap[a._stateType];if(b){delete b[a.id]}}};this.setClips=function(a,b){if(!a){s=this._DEFAULT_CLIP_STATE;this._stateHash=null;return}s=this._getState(this._CLIPS,a);b=b||[];if(true&&this.compileMode==SceneJS_DrawList.COMPILE_SCENE){if(b.length>0){var c=[];for(var d=0;d<b.length;d++){var e=b[d];c.push(e.mode)}s.hash=c.join("")}else{s.hash=""}this._stateHash=null}s.clips=b};this.setColortrans=function(a,b){if(!a){j=this._DEFAULT_COLORTRANS_STATE;this._stateHash=null;return}j=this._getState(this._COLORTRANS,a,true);j.core=b;if(true&&this.compileMode==SceneJS_DrawList.COMPILE_SCENE){j.hash=b?"t":"f";this._stateHash=null}};this.setFlags=function(a,b){if(arguments.length==0){f=this._DEFAULT_FLAGS_STATE;return}f=this._getState(this._FLAGS,a);b=b||this._DEFAULT_FLAGS_STATE.flags;f.flags=b||this._DEFAULT_FLAGS_STATE.flags};this.setLayer=function(a,b){if(arguments.length==0){g=this._DEFAULT_LAYER_STATE;return}g=this._getState(this._LAYER,a);g.core=b};this.setFrameBuf=function(a,b){if(arguments.length==0){r=this._DEFAULT_FRAMEBUF_STATE;return}r=this._getState(this._FRAMEBUF,a);r.frameBuf=b};this.setLights=function(a,b){if(arguments.length==0){i=this._DEFAULT_LIGHTS_STATE;this._stateHash=null;return}i=this._getState(this._LIGHTS,a);b=b||[];if(true&&this.compileMode==SceneJS_DrawList.COMPILE_SCENE){var c=[];for(var d=0;d<b.length;d++){var e=b[d];c.push(e.mode);if(e.specular){c.push("s")}if(e.diffuse){c.push("d")}}i.hash=c.join("");this._stateHash=null}i.lights=b};this.setMaterial=function(a,b){if(arguments.length==0){k=this._DEFAULT_MATERIAL_STATE;return}k=this._getState(this._MATERIAL,a,true);k.material=b||this._DEFAULT_MATERIAL_STATE.material};this.setMorph=function(a,b){if(arguments.length==0){t=this._DEFAULT_MORPH_STATE;this._stateHash=null;return}t=this._getState(this._MORPH,a);if(true&&this.compileMode==SceneJS_DrawList.COMPILE_SCENE){if(b){var c=b.targets[0];t.hash=[c.vertexBuf?"t":"f",c.normalBuf?"t":"f",c.uvBuf?"t":"f",c.uvBuf2?"t":"f"].join("")}else{t.hash=""}this._stateHash=null}t.morph=b};this.setTexture=function(a,b){if(arguments.length==0){l=this._DEFAULT_TEXTURE_STATE;this._stateHash=null;return}l=this._getState(this._TEXTURE,a);if(true&&this.compileMode==SceneJS_DrawList.COMPILE_SCENE){var c;if(b&&b.layers.length>0){var d=b.layers;var e=[];for(var f=0,g=d.length;f<g;f++){var h=d[f];e.push("/");e.push(h.applyFrom);e.push("/");e.push(h.applyTo);e.push("/");e.push(h.blendMode);if(h.matrix){e.push("/anim")}}c=e.join("")}else{c="__scenejs_no_tex"}l.hash=c;this._stateHash=null}l.core=b};this.setRenderer=function(a,b){if(arguments.length==0){h=this._DEFAULT_RENDERER_STATE;return}h=this._getState(this._RENDERER,a);h.props=b;this._stateHash=null};this.setModelTransform=function(a,b,c){if(arguments.length==0){n=this._DEFAULT_MODEL_TRANSFORM_STATE;return}n=this._getState(this._MODEL_TRANSFORM,a);n.mat=b||this._DEFAULT_MAT;n.normalMat=c||this._DEFAULT_NORMAL_MAT};this.setProjectionTransform=function(a,b){if(arguments.length==0){p=this._DEFAULT_PROJ_TRANSFORM_STATE;return}p=this._getState(this._PROJ_TRANSFORM,a);p.mat=b.matrixAsArray||this._DEFAULT_PROJ_TRANSFORM_STATE.mat;p.optics=b.optics||this._DEFAULT_PROJ_TRANSFORM_STATE.optics};this.setViewTransform=function(a,b,c,d){if(arguments.length==0){o=this._DEFAULT_VIEW_TRANSFORM_STATE;return}o=this._getState(this._VIEW_TRANSFORM,a);o.mat=b||this._DEFAULT_MAT;o.normalMat=c||this._DEFAULT_NORMAL_MAT;o.lookAt=d||SceneJS_math_LOOKAT_ARRAYS};this.setName=function(a,b){if(arguments.length==0){u=this._DEFAULT_NAME_STATE;return}u=this._getState(this._NAME,a);u.name=b};this.setTag=function(a,b){if(arguments.length==0){v=this._DEFAULT_TAG_STATE;return}v=this._getState(this._TAG,a);v.core=b};this.setRenderListeners=function(a,b){if(arguments.length==0){w=this._DEFAULT_RENDER_LISTENERS_STATE;return}w=this._getState(this._RENDER_LISTENERS,a);w.listeners=b||[]};this.setShader=function(a,b){if(arguments.length==0){x=this._DEFAULT_SHADER_STATE;this._stateHash=null;return}x=this._getState(this._SHADER,a);x.shader=b||{};x.hash=b.hash;this._stateHash=null};this.setShaderParams=function(a,b){if(arguments.length==0){y=this._DEFAULT_SHADER_PARAMS_STATE;return}y=this._getState(this._SHADER_PARAMS,a);y.paramsStack=b};this.setGeometry=function(a,b){this.marshallStates();var c;if(this.compileMode!=SceneJS_DrawList.COMPILE_SCENE){c=this._nodeMap[a];if(c.renderListenersState._stateId!=w._stateId){this._releaseState(c.renderListenersState);c.renderListenersState=w;w._nodeCount++}if(c.flagsState._stateId!=f._stateId){this._releaseState(c.flagsState);c.flagsState=f;f._nodeCount++}return}m=this._getState(this._GEO,a);m.geo=b;m.hash=[b.normalBuf?"t":"f",b.uvBuf?"t":"f",b.uvBuf2?"t":"f",b.colorBuf?"t":"f",b.primitive].join("");if(!this._stateHash){this._stateHash=this._getSceneHash()}var d=this._getProgram(this._stateHash);m._nodeCount++;f._nodeCount++;g._nodeCount++;h._nodeCount++;i._nodeCount++;j._nodeCount++;k._nodeCount++;n._nodeCount++;o._nodeCount++;p._nodeCount++;l._nodeCount++;q._nodeCount++;r._nodeCount++;s._nodeCount++;t._nodeCount++;u._nodeCount++;v._nodeCount++;w._nodeCount++;x._nodeCount++;y._nodeCount++;c={id:a,sortId:0,stateHash:this._stateHash,program:d,geoState:m,layerState:g,flagsState:f,rendererState:h,lightState:i,colortransState:j,materialState:k,modelXFormState:n,viewXFormState:o,projXFormState:p,texState:l,pickColorState:q,frameBufState:r,clipState:s,morphState:t,nameState:u,tagState:v,renderListenersState:w,shaderState:x,shaderParamsState:y};this._states.nodeMap[a]=c;this._states.bin[this._states.lenBin++]=c;var e=this._states.geoNodesMap[a];if(!e){e=this._states.geoNodesMap[a]=[]}e.push(c)};this._attachState=function(a,b,c){var d=a[b];if(d&&d._stateId!=c._stateId){this._releaseState(d)}a[b]=c;c._nodeCount++;return c};this.removeGeometry=function(a,b){var c=this._sceneStates[a];var d=c.geoNodesMap;var e=d[b];if(!e){return}for(var f=0,g=e.length;f<g;f++){var h=e[f];h.destroyed=true;this._releaseProgram(h.program);this._releaseState(h.geoState);this._releaseState(h.flagsState);this._releaseState(h.layerState);this._releaseState(h.rendererState);this._releaseState(h.lightState);this._releaseState(h.colortransState);this._releaseState(h.materialState);this._releaseState(h.modelXFormState);this._releaseState(h.viewXFormState);this._releaseState(h.projXFormState);this._releaseState(h.texState);this._releaseState(h.pickColorState);this._releaseState(h.frameBufState);this._releaseState(h.clipState);this._releaseState(h.morphState);this._releaseState(h.nameState);this._releaseState(h.tagState);this._releaseState(h.renderListenersState);this._releaseState(h.shaderState);this._releaseState(h.shaderParamsState)}d[b]=null;c.lenVisibleCacheBin=0};this._createStateStateSortIDs=function(a){if(this._states.stateSortIDsDirty){var b;for(var c=0,d=a.length;c<d;c++){b=a[c];b.sortId=b.layerState.core.priority*1e5+b.program.id}this._states.stateSortIDsDirty=false}};this._createStateStateSortIDsNew=function(a){if(this._states.stateSortIDsDirty){var b;var c;var d;var e;var f=0;var g=0;var h=0;var i=a.length;while(i--){b=a[i];if(b.program.id!=c){b.program._sortId=f;c=b.program.id;f++}if(b.texState._stateId!=d){b.texState._sortId=g;d=b.texState._stateId;g++}if(b.geoState._stateId!=e){b.geoState._sortId=h;e=b.geoState._stateId;h++}}i=a.length;while(i--){b=a[i];b.sortId=b.layerState.core.priority*f*g+b.program.id*g+b.texState._sortId*h+b.geoState._sortId}this._states.stateSortIDsDirty=false}};this._forceStateSort=function(a){if(a){this._states.stateSortIDsDirty=a}this._states.stateSortDirty=true};this._stateSortBins=function(){var a=this._states;if(a.stateSortIDsDirty){this._createStateStateSortIDs(a.bin)}a.bin.length=a.lenBin;a.bin.sort(this._stateSortNodes);a.lenVisibleCacheBin=0};this._stateSortNodes=function(a,b){return a.sortId-b.sortId};this.renderFrame=function(a){var b=this._states;if(!b){throw SceneJS_errorModule.fatalError("No scene bound")}b.pickBufDirty=true;a=a||{};var c=false;if(b.stateSortDirty){this._stateSortBins();b.stateSortDirty=false;c=true}var d=c||this.compileMode==SceneJS_DrawList.COMPILE_SCENE||this.compileMode==SceneJS_DrawList.COMPILE_BRANCH;var e=this.compileMode==SceneJS_DrawList.COMPILE_SCENE;if(d){b.pickCallListDirty=d}if(d){b.pickCallFuncsDirty=e}var f=a.profileFunc?true:false;var g=b.nodeRenderer;g.init({doProfile:f,pciking:false,callListDirty:d,callFuncsDirty:e});this._renderDrawList(b,false,a.tagSelector);g.cleanup();if(f){a.profileFunc(g.profile)}this._states=null};this.pick=function(a){var b=this._sceneStates[a.sceneId];if(!b){throw"No drawList found for scene '"+a.sceneId+"'"}var c=b.canvas.canvas;var d=null;var e=a.canvasX;var f=a.canvasY;var g=b.pickBuf;if(!g){g=b.pickBuf=new SceneJS_PickBuffer({canvas:b.canvas});b.pickBufDirty=true}var h=b.nodeRenderer;g.bind();g.clear();h.init({picking:true,callListDirty:b.pickCallListDirty,callFuncsDirty:b.pickCallFuncsDirty});this._renderDrawList(b,true,a.tagSelector);h.cleanup();b.pickCallListDirty=false;b.pickCallFuncsDirty=false;b.pickBufDirty=false;var i=g.read(e,f);var j=i[0]+i[1]*256+i[2]*65536;var k=j>=1?j-1:-1;g.unbind();var l=h.pickNameStates[k];if(l){d={name:l.name};if(a.rayPick){var m=b.rayPickBuf;if(!m){m=b.rayPickBuf=new SceneJS_PickBuffer({canvas:b.canvas})}m.bind();m.clear();h.init({pick:false,rayPick:true,callListDirty:false,callFuncsDirty:false});var n=b.visibleCacheBin;var o=b.lenVisibleCacheBin;var p;var q;for(var r=0;r<o;r++){p=n[r];q=p.flagsState.flags;if(q.picking===false){continue}h.renderNode(p)}h.cleanup();i=m.read(e,f);m.unbind();var s=this._unpackDepth(i);var t=c.width;var u=c.height;var v=(e-t/2)/(t/2);var w=-(f-u/2)/(u/2);var x=p.viewXFormState.mat;var y=p.projXFormState.mat;var z=SceneJS_math_mulMat4(y,x,[]);var A=SceneJS_math_inverseMat4(z,[]);var B=SceneJS_math_transformVector4(A,[v,w,-1,1]);B=SceneJS_math_mulVec4Scalar(B,1/B[3]);var C=SceneJS_math_transformVector4(A,[v,w,1,1]);C=SceneJS_math_mulVec4Scalar(C,1/C[3]);var D=SceneJS_math_subVec3(C,B,[]);var E=p.viewXFormState.lookAt.eye;var F=SceneJS_math_addVec4(B,SceneJS_math_mulVec4Scalar(D,s,[]),[]);d.canvasPos=[e,f];d.worldPos=F}}return d};this._unpackDepth=function(a){var b=[a[0]/256,a[1]/256,a[2]/256,a[3]/256];var c=[1/(256*256*256),1/(256*256),1/256,1];return SceneJS_math_dotVector4(b,c)};this._renderDrawList=function(a,b,c){var d=a.canvas.context;var e=a.visibleCacheBin;var f=a.lenVisibleCacheBin;var g=a.nodeRenderer;var h=0;var i=z;if(f>0){for(var j=0;j<f;j++){l=e[j];n=l.flagsState.flags;if(b&&n.picking===false){continue}if(!b&&n.transparent===true){i[h++]=l}else{g.renderNode(l)}}}else{var k=a.bin;var l;var m=0;var n;var o;var p=b;var q;var r;if(c){q=c.mask;r=c.regex}for(var j=0,s=a.lenBin;j<s;j++){l=k[j];if(l.destroyed){if(j<s){m++;k[j]=k[j+m]}continue}if(m>0){k[j]=k[j+m]}n=l.flagsState.flags;if(n.enabled===false){continue}if(q){o=l.tagState.core;if(o){if(o.mask!=q){o.mask=q;o.matches=r.test(o.tag)}if(!o.matches){continue}}}if(!l.layerState.core.enabled){continue}if(p&&n.picking===false){continue}if(!p&&n.transparent===true){i[h++]=l}else{g.renderNode(l)}e[a.lenVisibleCacheBin++]=l}if(m>0){k.length-=m;a.lenBin=k.length;s=k.length}}if(h>0){d.enable(d.BLEND);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);for(j=0,s=h;j<s;j++){g.renderNode(z[j])}d.disable(d.BLEND)}};this._getSceneHash=function(){return[this._states.canvas.canvasId,s.hash,j.hash,i.hash,t.hash,l.hash,x.hash,h.hash,m.hash].join(";")};this._getProgram=function(a){var c=this._programs[a];if(!c){if(b.logScripts===true){SceneJS_loggingModule.info("Creating render and pick shaders: '"+a+"'")}c=this._programs[a]={id:d++,render:this._createShader(this._composeRenderingVertexShader(),this._composeRenderingFragmentShader()),pick:this._createShader(this._composePickingVertexShader(),this._composePickingFragmentShader()),stateHash:a,refCount:0}}c.refCount++;return c};this._releaseProgram=function(a){if(--a.refCount<=0){}};this._createShader=function(a,b){try{return new SceneJS_webgl_Program(this._stateHash,this._states.canvas.context,[a.join("\n")],[b.join("\n")],SceneJS_loggingModule)}catch(c){console.error("-----------------------------------------------------------------------------------------:");console.error("Failed to create SceneJS Shader");console.error("SceneJS Version: "+SceneJS.VERSION);console.error("Error message: "+c);console.error("");console.error("Vertex shader:");console.error("");this._logShaderLoggingSource(a);console.error("");console.error("Fragment shader:");this._logShaderLoggingSource(b);console.error("-----------------------------------------------------------------------------------------:");throw SceneJS_errorModule.fatalError(SceneJS.errors.ERROR,"Failed to create SceneJS Shader: "+c)}};this._logShaderLoggingSource=function(a){for(var b=0,c=a.length;b<c;b++){console.error(a[b])}};this._writeHooks=function(a,b,c,d,e){for(var f=0,g=d.length;f<g;f++){if(e){a.push(b+"="+c+"("+b+");")}else{a.push(c+"("+b+");")}}};this._composePickingVertexShader=function(){var a=x.shader.shaders||{};var c=a.vertex||{};var d=c.hooks||{};var e=a.fragment||{};var f=e.hooks||{};var g=s.clips.length>0;var h=t.morph&&true;var i=this._hasNormals();var j=["precision mediump float;","attribute vec3 SCENEJS_aVertex;","attribute vec3 SCENEJS_aNormal;","uniform mat4 SCENEJS_uMMatrix;","uniform mat4 SCENEJS_uMNMatrix;","uniform mat4 SCENEJS_uVMatrix;","uniform mat4 SCENEJS_uVNMatrix;","uniform mat4 SCENEJS_uPMatrix;"];if(i&&(f.worldNormal||f.viewNormal)){j.push("varying   vec3 SCENEJS_vWorldNormal;");j.push("varying   vec3 SCENEJS_vViewNormal;")}j.push("varying vec4 SCENEJS_vModelVertex;");j.push("varying vec4 SCENEJS_vWorldVertex;");j.push("varying vec4 SCENEJS_vViewVertex;\n");j.push("varying vec4 SCENEJS_vProjVertex;\n");j.push("uniform vec3 SCENEJS_uEye;");j.push("varying vec3 SCENEJS_vEyeVec;");if(c.code){j.push("\n"+c.code+"\n")}if(h){j.push("uniform float SCENEJS_uMorphFactor;");if(t.morph.targets[0].vertexBuf){j.push("attribute vec3 SCENEJS_aMorphVertex;")}}j.push("void main(void) {");j.push("   vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); ");if(i){j.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); ")}j.push("  SCENEJS_vModelVertex = tmpVertex; ");if(d.modelPos){j.push("tmpVertex="+d.modelPos+"(tmpVertex);")}if(h){if(t.morph.targets[0].vertexBuf){j.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); ");if(d.modelPos){j.push("vMorphVertex="+d.modelPos+"(vMorphVertex);")}j.push("  tmpVertex = vec4(mix(tmpVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")}}j.push("  tmpVertex = SCENEJS_uMMatrix * tmpVertex; ");if(d.worldPos){j.push("tmpVertex="+d.worldPos+"(tmpVertex);")}j.push("  SCENEJS_vWorldVertex = tmpVertex; ");j.push("SCENEJS_vEyeVec = normalize(SCENEJS_uEye - tmpVertex.xyz);");j.push("  tmpVertex = SCENEJS_uVMatrix * tmpVertex; ");if(d.viewPos){j.push("tmpVertex="+d.viewPos+"(tmpVertex);")}j.push("  SCENEJS_vViewVertex = tmpVertex;");if(i&&(f.worldNormal||f.viewNormal)){j.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); ");j.push("  SCENEJS_vWorldNormal = worldNormal;");j.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")}j.push("  SCENEJS_vProjVertex = SCENEJS_uPMatrix * tmpVertex;");j.push("  gl_Position = SCENEJS_vProjVertex;");j.push("}");if(b.logScripts==true){SceneJS_loggingModule.info(j)}return j};this._composePickingFragmentShader=function(){var a=x.shader.shaders||{};var c=a.fragment||{};var d=c.hooks||{};var e=s&&s.clips.length>0;var f=this._hasNormals();var g=["precision mediump float;"];g.push("vec4 packDepth(const in float depth) {");g.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);");g.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);");g.push("  vec4 res = fract(depth * bitShift);");g.push("  res -= res.xxyz * bitMask;");g.push("  return res;");g.push("}");g.push("varying vec4 SCENEJS_vModelVertex;");g.push("varying vec4 SCENEJS_vWorldVertex;");g.push("varying vec4 SCENEJS_vViewVertex;");g.push("varying vec4 SCENEJS_vProjVertex;");g.push("uniform bool SCENEJS_uRayPickMode;");g.push("uniform vec3 SCENEJS_uPickColor;");g.push("uniform float SCENEJS_uZNear;");g.push("uniform float SCENEJS_uZFar;");g.push("varying vec3 SCENEJS_vEyeVec;");if(f&&(d.worldNormal||d.viewNormal)){g.push("varying vec3 SCENEJS_vWorldNormal;");g.push("varying vec3 SCENEJS_vViewNormal;")}if(e){for(var h=0;h<s.clips.length;h++){g.push("uniform float SCENEJS_uClipMode"+h+";");g.push("uniform vec4  SCENEJS_uClipNormalAndDist"+h+";")}}if(c.code){g.push("\n"+c.code+"\n")}g.push("void main(void) {");if(d.worldPosClip){g.push("if ("+d.worldPosClip+"(SCENEJS_vWorldVertex) == false) { discard; };")}if(d.viewPosClip){g.push("if (!"+d.viewPosClip+"(SCENEJS_vViewVertex) == false) { discard; };")}if(e){g.push("  float   dist;");for(var h=0;h<s.clips.length;h++){g.push("    if (SCENEJS_uClipMode"+h+" != 0.0) {");g.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+h+".xyz) - SCENEJS_uClipNormalAndDist"+h+".w;");g.push("        if (SCENEJS_uClipMode"+h+" == 1.0) {");g.push("            if (dist < 0.0) { discard; }");g.push("        }");g.push("        if (SCENEJS_uClipMode"+h+" == 2.0) {");g.push("            if (dist > 0.0) { discard; }");g.push("        }");g.push("    }")}}if(d.worldPos){g.push(d.worldPos+"(SCENEJS_vWorldVertex);")}if(d.viewPos){g.push(d.viewPos+"(SCENEJS_vViewVertex);")}if(d.worldEyeVec){g.push(d.worldEyeVec+"(SCENEJS_vEyeVec);")}if(f&&d.worldNormal){g.push(d.worldNormal+"(SCENEJS_vWorldNormal);")}if(f&&d.viewNormal){g.push(d.viewNormal+"(SCENEJS_vViewNormal);")}g.push("    if (SCENEJS_uRayPickMode) {");g.push("          float zNormalizedDepth = abs((SCENEJS_uZNear + SCENEJS_vViewVertex.z) / (SCENEJS_uZFar - SCENEJS_uZNear));");g.push("          gl_FragColor = packDepth(zNormalizedDepth); ");g.push("    } else {");g.push("          gl_FragColor = vec4(SCENEJS_uPickColor.rgb, 1.0);  ");g.push("    }");g.push("}");if(b.logScripts==true){SceneJS_loggingModule.info(g)}return g};this._isTexturing=function(){if(l.core&&l.core.layers.length>0){if(m.geo.uvBuf||m.geo.uvBuf2){return true}if(t.morph&&(t.morph.targets[0].uvBuf||t.morph.targets[0].uvBuf2)){return true}}return false};this._hasNormals=function(){if(m.geo.normalBuf){return true}if(t.morph&&t.morph.targets[0].normalBuf){return true}return false};this._composeRenderingVertexShader=function(){var a=x.shader.shaders||{};if(a.vertex&&a.vertex.code&&!a.vertex.hooks){return a.vertex.code}var c=a.vertex||{};var d=c.hooks||{};var e=a.fragment||{};var f=e.hooks||{};var g=this._isTexturing();var h=this._hasNormals();var j=s.clips.length>0;var k=t.morph&&true;var l=["precision mediump float;"];l.push("attribute vec3 SCENEJS_aVertex;");l.push("uniform vec3 SCENEJS_uEye;");l.push("varying vec3 SCENEJS_vEyeVec;");if(h){l.push("attribute vec3 SCENEJS_aNormal;");l.push("uniform   mat4 SCENEJS_uMNMatrix;");l.push("uniform   mat4 SCENEJS_uVNMatrix;");l.push("varying   vec3 SCENEJS_vWorldNormal;");l.push("varying   vec3 SCENEJS_vViewNormal;");for(var n=0;n<i.lights.length;n++){var o=i.lights[n];if(o.mode=="dir"){l.push("uniform vec3 SCENEJS_uLightDir"+n+";")}if(o.mode=="point"){l.push("uniform vec4 SCENEJS_uLightPos"+n+";")}if(o.mode=="spot"){l.push("uniform vec4 SCENEJS_uLightPos"+n+";")}l.push("varying vec4 SCENEJS_vLightVecAndDist"+n+";")}}if(g){if(m.geo.uvBuf){l.push("attribute vec2 SCENEJS_aUVCoord;")}if(m.geo.uvBuf2){l.push("attribute vec2 SCENEJS_aUVCoord2;")}}if(m.geo.colorBuf){l.push("attribute vec4 SCENEJS_aVertexColor;");l.push("varying vec4 SCENEJS_vColor;")}l.push("uniform mat4 SCENEJS_uMMatrix;");l.push("uniform mat4 SCENEJS_uVMatrix;");l.push("uniform mat4 SCENEJS_uPMatrix;");if(j||f.worldPos){l.push("varying vec4 SCENEJS_vWorldVertex;")}if(f.viewPos){l.push("varying vec4 SCENEJS_vViewVertex;")}if(g){if(m.geo.uvBuf){l.push("varying vec2 SCENEJS_vUVCoord;")}if(m.geo.uvBuf2){l.push("varying vec2 SCENEJS_vUVCoord2;")}}if(k){l.push("uniform float SCENEJS_uMorphFactor;");if(t.morph.targets[0].vertexBuf){l.push("attribute vec3 SCENEJS_aMorphVertex;")}if(h){if(t.morph.targets[0].normalBuf){l.push("attribute vec3 SCENEJS_aMorphNormal;")}}}if(c.code){l.push("\n"+c.code+"\n")}l.push("void main(void) {");l.push("vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); ");if(d.modelPos){l.push("tmpVertex="+d.modelPos+"(tmpVertex);")}l.push("  vec4 modelVertex = tmpVertex; ");if(h){l.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); ")}if(k){if(t.morph.targets[0].vertexBuf){l.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); ");l.push("  modelVertex = vec4(mix(modelVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")}if(h){if(t.morph.targets[0].normalBuf){l.push("  vec4 vMorphNormal = vec4(SCENEJS_aMorphNormal, 1.0); ");l.push("  modelNormal = vec4( mix(modelNormal.xyz, vMorphNormal.xyz, 0.0), 1.0); ")}}}l.push("  vec4 worldVertex = SCENEJS_uMMatrix * modelVertex; ");if(d.worldPos){l.push("worldVertex="+d.worldPos+"(worldVertex);")}if(d.viewMatrix){l.push("vec4 viewVertex = "+d.viewMatrix+"(SCENEJS_uVMatrix) * worldVertex;")}else{l.push("vec4 viewVertex  = SCENEJS_uVMatrix * worldVertex; ")}if(d.viewPos){l.push("viewVertex="+d.viewPos+"(viewVertex);")}if(h){l.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); ");l.push("  SCENEJS_vWorldNormal = worldNormal;");l.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")}if(j||f.worldPos){l.push("  SCENEJS_vWorldVertex = worldVertex;")}if(f.viewPos){l.push("  SCENEJS_vViewVertex = viewVertex;")}if(d.projMatrix){l.push("gl_Position = "+d.projMatrix+"(SCENEJS_uPMatrix) * viewVertex;")}else{l.push("  gl_Position = SCENEJS_uPMatrix * viewVertex;")}l.push("  vec3 tmpVec3;");if(h){for(var n=0;n<i.lights.length;n++){o=i.lights[n];if(o.mode=="dir"){l.push("SCENEJS_vLightVecAndDist"+n+" = vec4(-normalize(SCENEJS_uLightDir"+n+"), 0.0);")}if(o.mode=="point"){l.push("tmpVec3 = (SCENEJS_uLightPos"+n+".xyz - worldVertex.xyz);");l.push("SCENEJS_vLightVecAndDist"+n+" = vec4(normalize(tmpVec3), length(tmpVec3));")}if(o.mode=="spot"){}}}l.push("SCENEJS_vEyeVec = normalize(SCENEJS_uEye - worldVertex.xyz);");if(g){if(m.geo.uvBuf){l.push("SCENEJS_vUVCoord = SCENEJS_aUVCoord;")}if(m.geo.uvBuf2){l.push("SCENEJS_vUVCoord2 = SCENEJS_aUVCoord2;")}}if(m.geo.colorBuf){l.push("SCENEJS_vColor = SCENEJS_aVertexColor;")}l.push("}");if(b.logScripts===true){SceneJS_loggingModule.info(l)}return l};this._composeRenderingFragmentShader=function(){var a=x.shader.shaders||{};if(a.fragment&&a.fragment.code&&!a.fragment.hooks){return a.fragment.code}var c=a.fragment||{};var d=c.hooks||{};var e=this._isTexturing();var f=this._hasNormals();var g=s&&s.clips.length>0;var h=j&&j.core;var k=["\n"];k.push("precision mediump float;");if(g||d.worldPos){k.push("varying vec4 SCENEJS_vWorldVertex;")}if(d.viewPos){k.push("varying vec4 SCENEJS_vViewVertex;")}if(g){for(var n=0;n<s.clips.length;n++){k.push("uniform float SCENEJS_uClipMode"+n+";");k.push("uniform vec4  SCENEJS_uClipNormalAndDist"+n+";")}}if(e){if(m.geo.uvBuf){k.push("varying vec2 SCENEJS_vUVCoord;")}if(m.geo.uvBuf2){k.push("varying vec2 SCENEJS_vUVCoord2;")}var o;for(var n=0,p=l.core.layers.length;n<p;n++){o=l.core.layers[n];k.push("uniform sampler2D SCENEJS_uSampler"+n+";");if(o.matrix){k.push("uniform mat4 SCENEJS_uLayer"+n+"Matrix;")}k.push("uniform float SCENEJS_uLayer"+n+"BlendFactor;")}}k.push("uniform bool  SCENEJS_uBackfaceTexturing;");k.push("uniform bool  SCENEJS_uBackfaceLighting;");k.push("uniform bool  SCENEJS_uSpecularLighting;");k.push("uniform bool  SCENEJS_uTransparent;");if(m.geo.colorBuf){k.push("varying vec4 SCENEJS_vColor;")}k.push("uniform vec3  SCENEJS_uAmbient;");k.push("uniform vec3  SCENEJS_uMaterialBaseColor;");k.push("uniform float SCENEJS_uMaterialAlpha;");k.push("uniform float SCENEJS_uMaterialEmit;");k.push("uniform vec3  SCENEJS_uMaterialSpecularColor;");k.push("uniform float SCENEJS_uMaterialSpecular;");k.push("uniform float SCENEJS_uMaterialShine;");k.push("  vec3    ambientValue=SCENEJS_uAmbient;");k.push("  float   emit    = SCENEJS_uMaterialEmit;");k.push("varying vec3 SCENEJS_vEyeVec;");if(f){k.push("varying vec3 SCENEJS_vWorldNormal;");k.push("varying vec3 SCENEJS_vViewNormal;");var q;for(var n=0;n<i.lights.length;n++){q=i.lights[n];k.push("uniform vec3  SCENEJS_uLightColor"+n+";");if(q.mode=="point"){k.push("uniform vec3  SCENEJS_uLightAttenuation"+n+";")}k.push("varying vec4  SCENEJS_vLightVecAndDist"+n+";")}}if(h){k.push("uniform float  SCENEJS_uColorTransMode ;");k.push("uniform vec4   SCENEJS_uColorTransAdd;");k.push("uniform vec4   SCENEJS_uColorTransScale;");k.push("uniform float  SCENEJS_uColorTransSaturation;")}if(c.code){k.push("\n"+c.code+"\n")}k.push("void main(void) {");if(g){k.push("  float   dist;");for(var n=0;n<s.clips.length;n++){k.push("    if (SCENEJS_uClipMode"+n+" != 0.0) {");k.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+n+".xyz) - SCENEJS_uClipNormalAndDist"+n+".w;");k.push("        if (SCENEJS_uClipMode"+n+" == 1.0) {");k.push("            if (dist < 0.0) { discard; }");k.push("        }");k.push("        if (SCENEJS_uClipMode"+n+" == 2.0) {");k.push("            if (dist > 0.0) { discard; }");k.push("        }");k.push("    }")}}if(d.worldPos){k.push(d.worldPos+"(SCENEJS_vWorldVertex);")}if(d.viewPos){k.push(d.viewPos+"(SCENEJS_vViewVertex);")}if(d.worldEyeVec){k.push(d.worldEyeVec+"(SCENEJS_vEyeVec);")}if(f&&d.worldNormal){k.push(d.worldNormal+"(SCENEJS_vWorldNormal);")}if(f&&d.viewNormal){k.push(d.viewNormal+"(SCENEJS_vViewNormal);")}if(m.geo.colorBuf){k.push("  vec3    color   = SCENEJS_vColor.rgb;")}else{k.push("  vec3    color   = SCENEJS_uMaterialBaseColor;")}k.push("  float alpha         = SCENEJS_uMaterialAlpha;");k.push("  float emit          = SCENEJS_uMaterialEmit;");k.push("  float specular      = SCENEJS_uMaterialSpecular;");k.push("  vec3  specularColor = SCENEJS_uMaterialSpecularColor;");k.push("  float shine         = SCENEJS_uMaterialShine;");if(d.materialBaseColor){k.push("color="+d.materialBaseColor+"(color);")}if(d.materialAlpha){k.push("alpha="+d.materialAlpha+"(alpha);")}if(d.materialEmit){k.push("emit="+d.materialEmit+"(emit);")}if(d.materialSpecular){k.push("specular="+d.materialSpecular+"(specular);")}if(d.materialSpecularColor){k.push("specularColor="+d.materialSpecularColor+"(specularColor);")}if(d.materialShine){k.push("shine="+d.materialShine+"(shine);")}if(f){k.push("  float   attenuation = 1.0;");k.push("  vec3    normalVec=SCENEJS_vWorldNormal;")}var o;if(e){if(f){k.push("if (SCENEJS_uBackfaceTexturing || dot(SCENEJS_vWorldNormal, SCENEJS_vEyeVec) > 0.0) {")}k.push("  vec4    texturePos;");k.push("  vec2    textureCoord=vec2(0.0,0.0);");for(var n=0,p=l.core.layers.length;n<p;n++){o=l.core.layers[n];if(o.applyFrom=="normal"&&f){if(m.geo.normalBuf){k.push("texturePos=vec4(normalVec.xyz, 1.0);")}else{SceneJS_loggingModule.warn("Texture layer applyFrom='normal' but geo has no normal vectors");continue}}if(o.applyFrom=="uv"){if(m.geo.uvBuf){k.push("texturePos = vec4(SCENEJS_vUVCoord.s, SCENEJS_vUVCoord.t, 1.0, 1.0);")}else{SceneJS_loggingModule.warn("Texture layer applyTo='uv' but geometry has no UV coordinates");continue}}if(o.applyFrom=="uv2"){if(m.geo.uvBuf2){k.push("texturePos = vec4(SCENEJS_vUVCoord2.s, SCENEJS_vUVCoord2.t, 1.0, 1.0);")}else{SceneJS_loggingModule.warn("Texture layer applyTo='uv2' but geometry has no UV2 coordinates");continue}}if(o.matrix){k.push("textureCoord=(SCENEJS_uLayer"+n+"Matrix * texturePos).xy;")}else{k.push("textureCoord=texturePos.xy;")}if(o.applyTo=="alpha"){if(o.blendMode=="multiply"){k.push("alpha = alpha * (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);")}else if(o.blendMode=="add"){k.push("alpha = ((1.0 - SCENEJS_uLayer"+n+"BlendFactor) * alpha) + (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);")}}if(o.applyTo=="baseColor"){if(o.blendMode=="multiply"){k.push("color = color * (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);")}else{k.push("color = ((1.0 - SCENEJS_uLayer"+n+"BlendFactor) * color) + (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);")}}if(o.applyTo=="emit"){if(o.blendMode=="multiply"){k.push("emit  = emit * (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")}else{k.push("emit = ((1.0 - SCENEJS_uLayer"+n+"BlendFactor) * emit) + (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")}}if(o.applyTo=="specular"&&f){if(o.blendMode=="multiply"){k.push("specular  = specular * (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")}else{k.push("specular = ((1.0 - SCENEJS_uLayer"+n+"BlendFactor) * specular) + (SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")}}if(o.applyTo=="normals"&&f){k.push("vec3 bump = normalize(texture2D(SCENEJS_uSampler"+n+", textureCoord).xyz * 2.0 - 1.0);");k.push("normalVec *= -bump;")}}if(f){k.push("}")}}k.push("  vec4    fragColor;");if(f){k.push("if (SCENEJS_uBackfaceLighting || dot(SCENEJS_vWorldNormal, SCENEJS_vEyeVec) > 0.0) {");k.push("  vec3    lightValue      = SCENEJS_uAmbient;");k.push("  vec3    specularValue   = vec3(0.0, 0.0, 0.0);");k.push("  vec3    lightVec;");k.push("  float   dotN;");k.push("  float   lightDist;");var q;for(var n=0;n<i.lights.length;n++){q=i.lights[n];k.push("lightVec = SCENEJS_vLightVecAndDist"+n+".xyz;");if(q.mode=="point"){k.push("dotN = max(dot(normalVec, lightVec) ,0.0);");k.push("lightDist = SCENEJS_vLightVecAndDist"+n+".w;");k.push("  attenuation = 1.0 / ("+"  SCENEJS_uLightAttenuation"+n+"[0] + "+"  SCENEJS_uLightAttenuation"+n+"[1] * lightDist + "+"  SCENEJS_uLightAttenuation"+n+"[2] * lightDist * lightDist);");if(q.diffuse){k.push("  lightValue += dotN *  SCENEJS_uLightColor"+n+" * attenuation;")}if(q.specular){k.push("if (SCENEJS_uSpecularLighting) specularValue += attenuation * specularColor * SCENEJS_uLightColor"+n+" * specular  * pow(max(dot(reflect(lightVec, normalVec), SCENEJS_vEyeVec),0.0), shine);")}}if(q.mode=="dir"){k.push("dotN = max(dot(normalVec,lightVec),0.0);");if(q.diffuse){k.push("lightValue += dotN * SCENEJS_uLightColor"+n+";")}if(q.specular){k.push("if (SCENEJS_uSpecularLighting) specularValue += specularColor * SCENEJS_uLightColor"+n+" * specular  * pow(max(dot(reflect(lightVec, normalVec),SCENEJS_vEyeVec),0.0), shine);")}}}k.push("      fragColor = vec4((specularValue.rgb + color.rgb * lightValue.rgb) + (emit * color.rgb), alpha);");k.push("   } else {");k.push("      fragColor = vec4(color.rgb + (emit * color.rgb), alpha);");k.push("   }")}else{k.push("fragColor = vec4((emit * color.rgb) + (emit * color.rgb), alpha);")}if(h){}if(d.pixelColor){k.push("fragColor="+d.pixelColor+"(fragColor);")}if(b.whitewash==true){k.push("    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);")}else{k.push("    gl_FragColor = fragColor;")}k.push("}");if(b.logScripts==true){SceneJS_loggingModule.info(k)}return k}};var SceneJS_DrawListRenderer=function(a){this._canvas=a.canvas;this._context=a.context;this.pickNameStates=[];this._callCtx={};var b=this;this._queryFacade={_node:null,_setNode:function(a){this._node=a;this._mem={}},getCameraMatrix:function(){return this._mem.camMat?this._mem.camMat:this._mem.camMat=this._node.projXFormState.mat.slice(0)},getViewMatrix:function(){return this._mem.viewMat?this._mem.viewMat:this._mem.viewMat=this._node.viewXFormState.mat.slice(0)},getModelMatrix:function(){return this._mem.modelMat?this._mem.modelMat:this._mem.modelMat=this._node.modelXFormState.mat.slice(0)},getCanvasPos:function(a){this.getProjPos(a);if(!this._mem.canvasWidth){this._mem.canvasWidth=b._canvas.width;this._mem.canvasHeight=b._canvas.height}var c=this._mem.pc;var d=c[0]/c[3]*this._mem.canvasWidth*.5;var e=c[1]/c[3]*this._mem.canvasHeight*.5;return this._mem.canvasPos={x:d+b._canvas.width*.5,y:this._mem.canvasHeight-e-this._mem.canvasHeight*.5}},getCameraPos:function(a){this.getProjPos(a);this._mem.camPos=SceneJS_math_normalizeVec3(this._mem.pc,[0,0,0]);return{x:this._mem.camPos[0],y:this._mem.camPos[1],z:this._mem.camPos[2]}},getProjPos:function(a){this.getViewPos(a);this._mem.pc=SceneJS_math_transformPoint3(this._node.projXFormState.mat,this._mem.vc);return{x:this._mem.pc[0],y:this._mem.pc[1],z:this._mem.pc[2],w:this._mem.pc[3]}},getViewPos:function(a){this.getWorldPos(a);this._mem.vc=SceneJS_math_transformPoint3(this._node.viewXFormState.mat,this._mem.wc);return{x:this._mem.vc[0],y:this._mem.vc[1],z:this._mem.vc[2],w:this._mem.vc[3]}},getWorldPos:function(a){this._mem.wc=SceneJS_math_transformPoint3(this._node.modelXFormState.mat,a||[0,0,0]);return{x:this._mem.wc[0],y:this._mem.wc[1],z:this._mem.wc[2],w:this._mem.wc[3]}}};this.init=function(a){a=a||{};this._picking=a.picking;this._rayPicking=a.rayPick;this._callListDirty=a.callListDirty;this._callFuncsDirty=a.callFuncsDirty;this._program=null;this._lastFramebuf=null;this._lastFlagsState=null;this._lastRendererState=null;this._lastRenderListenersState=null;this._pickIndex=0;this._callCtx.picking=this._picking;this._callCtx.rayPicking=this._rayPicking;this._callCtx.lastFrameBuf=null;this._callCtx.lastRendererProps=null;this._callCtx.lastFlagsState=null;this.stateSortProfile={numTextures:0,numGeometries:0}};this.createCall=function(a){if(this._picking){this._node.__pickCallList[this._node.__pickCallListLen++]=a}else{this._node.__drawCallList[this._node.__drawCallListLen++]=a}a()};this.renderNode=function(a){var d,e,f;if(this._picking||this._rayPicking){if(!(this._callListDirty||this._callFuncsDirty)){var g=a.__pickCallList;for(d=0,e=a.__pickCallListLen;d<e;d++){g[d]()}return}if(!a.__pickCallList){a._pickCallFuncs=a._pickCallFuncs||{};a.__pickCallList=[]}a.__pickCallListLen=0;if(this._callFuncsDirty){a._pickCallFuncs={}}}else{this._queryFacade._setNode(a);if(!(this._callListDirty||this._callFuncsDirty)){var h=a.__drawCallList;for(d=0,e=a.__drawCallListLen;d<e;d++){h[d]()}return}if(!a.__drawCallList){a._drawCallFuncs=a._drawCallFuncs||{};a.__drawCallList=[]}a.__drawCallListLen=0;if(this._callFuncsDirty){a._drawCallFuncs={}}}this._node=a;this._callFuncs=this._picking?a._pickCallFuncs:a._drawCallFuncs;var i=a.flagsState;var j=a.geoState;if(!this._program||a.program.id!=this._lastProgramId){if(this._picking){this._program=a.program.pick}else{this._program=a.program.render}if(this.stateSortProfile){this._program.setProfile(this.profile)}if(this._picking){this.createCall(this._callFuncs["pickShader"]||(this._callFuncs["pickShader"]=function(){var c=a.program.pick;var d=b._context;var e=b._callCtx;var f;return function(){if(e.program){e.program.unbind()}c.bind();if(!f){f=c.getUniformLocation("SCENEJS_uRayPickMode")}d.uniform1i(f,!!e.rayPicking);e.program=c}}()))}else{this.createCall(this._callFuncs["renderShader"]||(this._callFuncs["renderShader"]=function(){var c=a.program.render;var d=b._callCtx;return function(){if(d.program){d.program.unbind()}c.bind();d.program=c}}()))}this._lastProgramId=a.program.id;this._lastShaderStateId=-1;this._lastShaderParamsStateId=-1;this._lastGeoStateId=-1;this._lastFlagsStateId=-1;this._lastColortransStateId=-1;this._lastLightStateId=-1;this._lastClipStateId=-1;this._lastMorphStateId=-1;this._lastTexStateId=-1;this._lastMaterialStateId=-1;this._lastViewXFormStateId=-1;this._lastModelXFormStateId=-1;this._lastProjXFormStateId=-1;this._lastPickStateId=-1;this._lastFramebufStateId=-1;this._lastRenderListenersStateId=-1;if(a.shaderState.shader&&a.shaderState.shader.paramsStack){if(this._lastShaderStateId!=a.shaderState._stateId){this.createCall(this._callFuncs["shader"]||(this._callFuncs["shader"]=function(){var c=b._program;var d=a.shaderState.shader.paramsStack;return function(){var a;var b;for(var e=0,f=d.length;e<f;e++){a=d[e];for(b in a){if(a.hasOwnProperty(b)){c.setUniform(b,a[b])}}}}}()));this._lastShaderStateId=a.shaderState._stateId}}}if(a.shaderParamsState.paramsStack){if(this._lastShaderParamsStateId!=a.shaderParamsState._stateId){this.createCall(this._callFuncs["shaderParams"]||(this._callFuncs["shaderParams"]=function(){var c=b._program;var d=a.shaderParamsState.paramsStack;return function(){var a;var b;for(var e=0,f=d.length;e<f;e++){a=d[e];for(b in a){if(a.hasOwnProperty(b)){c.setUniform(b,a[b])}}}}}()));this._lastShaderParamsStateId=a.shaderParamsState._stateId}}if(!this._lastFrameBuf||this._lastFramebufStateId!=a.frameBufState._stateId){this.createCall(this._callFuncs["frameBuf"]||(this._callFuncs["frameBuf"]=function(){var c=b._context;var d=b._callCtx;var e=a.frameBufState.frameBuf;return function(){if(d.lastFrameBuf){c.finish();d.lastFrameBuf.unbind()}if(e){e.bind()}d.lastFrameBuf=e}}()));this._lastFramebufStateId=a.frameBufState._stateId}if(!this._picking){if(a.texState._stateId!=this._lastTexStateId){var k=a.texState.core;if(k){this.createCall(this._callFuncs["texture"]||(this._callFuncs["texture"]=function(){var a=b._program;var c=k.layers.length;var d=k.layers;var e=[];for(var f=0;f<c;f++){e.push({texSamplerName:"SCENEJS_uSampler"+f,texMatrixName:"SCENEJS_uLayer"+f+"Matrix",texBlendFactorName:"SCENEJS_uLayer"+f+"BlendFactor"})}return function(){var b,f;for(var g=0,h=c;g<h;g++){b=d[g];f=e[g];if(b.texture){a.bindTexture(f.texSamplerName,b.texture,g);if(b.matrixAsArray){a.setUniform(f.texMatrixName,b.matrixAsArray)}a.setUniform(f.texBlendFactorName,b.blendFactor)}}}}()))}}this._lastTexStateId=a.texState._stateId}if(j._stateId!=this._lastGeoStateId||a.morphState.morph&&a.morphState._stateId!=this._lastMorphStateId){this.createCall(this._callFuncs["unbindVBOs"]||(this._callFuncs["unbindVBOs"]=function(){var a=b._context;return function(){for(var b=0;b<8;b++){a.disableVertexAttribArray(b)}}}()));var l=false;var m=false;var n=false;var o=false;if(a.morphState.morph&&a.morphState._stateId!=this._lastMorphStateId){this.createCall(this._callFuncs["morph"]||(this._callFuncs["morph"]=function(){var c=b._program;var d=b._context;var e=c.getAttribute("SCENEJS_aVertex");var f=c.getAttribute("SCENEJS_aMorphVertex");var g=c.getAttribute("SCENEJS_aNormal");var h=c.getAttribute("SCENEJS_aMorphNormal");var i=c.getAttribute("SCENEJS_aMorphUVCoord");var j=c.getUniformLocation("SCENEJS_uMorphFactor");var k=a.morphState.morph;return function(){var a=k.targets[k.key1];var b=k.targets[k.key2];if(e){e.bindFloatArrayBuffer(a.vertexBuf);f.bindFloatArrayBuffer(b.vertexBuf);l=true}if(h){g.bindFloatArrayBuffer(a.normalBuf);h.bindFloatArrayBuffer(b.normalBuf);m=true}else if(g&&a.normalBuf){g.bindFloatArrayBuffer(a.normalBuf);m=true}if(i&&a.uvBuf){c.bindFloatArrayBuffer(a.uvBuf);c.bindFloatArrayBuffer(b.uvBuf);n=true}if(j){d.uniform1f(j,k.factor)}}}()));this._lastMorphStateId=a.morphState._stateId}this.createCall(this._callFuncs["geo"]||(this._callFuncs["geo"]=function(){var a=b._program;var c=j.geo;var d=c.vertexBuf;var e=c.normalBuf;var f=c.colorBuf;var g=!l&&d?a.getAttribute("SCENEJS_aVertex"):undefined;var h=!m&&e?a.getAttribute("SCENEJS_aNormal"):undefined;var i=f?a.getAttribute("SCENEJS_aVertexColor"):undefined;return function(){if(g){g.bindFloatArrayBuffer(d)}if(h){h.bindFloatArrayBuffer(e)}if(i){i.bindFloatArrayBuffer(f)}}}()));if(!this._picking){if(a.texState&&a.texState.core&&a.texState.core.layers.length>0){this.createCall(this._callFuncs["uvs"]||(this._callFuncs["uvs"]=function(){var a=b._program;var c=j.geo;var d=c.uvBuf;var e=c.uvBuf2;var f=d?a.getAttribute("SCENEJS_aUVCoord"):undefined;var g=d?a.getAttribute("SCENEJS_aUVCoord2"):undefined;return function(){if(f){f.bindFloatArrayBuffer(d)}if(g){g.bindFloatArrayBuffer(e)}}}()))}}this.createCall(this._callFuncs["ibo"]||(this._callFuncs["ibo"]=function(){var a=j.geo.indexBuf;return function(){a.bind()}}()));this.stateSortProfile.numGeometries++;this._lastGeoStateId=j._stateId}if(!this._lastRendererState||a.rendererState._stateId!=this._lastRendererState._stateId){this.createCall(this._callFuncs["bindProps"]||(this._callFuncs["bindProps"]=function(){var c=b._context;var d=b._callCtx;var e=a.rendererState;return function(){if(d.lastRendererProps){d.lastRendererProps.restoreProps(c)}if(e.props){e.props.setProps(c)}d.lastRendererProps=e.props}}()));this.createCall(this._callFuncs["ambient"]||(this._callFuncs["ambient"]=function(){var c=b._context;var d=b._program;var e=a.rendererState;var f=[0,0,0];var g=d.getUniformLocation("SCENEJS_uAmbient");return function(){if(g){var a=e.props;if(a&&a.clearColor){var b=a.clearColor;c.uniform3fv(g,[b.r,b.g,b.b])}else{c.uniform3fv(g,f)}}}}()));this._lastRendererState=a.rendererState}if(a.viewXFormState._stateId!=this._lastViewXFormStateId){this.createCall(this._callFuncs["lookAt"]||(this._callFuncs["lookAt"]=function(){var c=b._program;var d=b._context;var e=a.viewXFormState;var f=c.getUniformLocation("SCENEJS_uVMatrix");var g=c.getUniformLocation("SCENEJS_uVNMatrix");var h=c.getUniformLocation("SCENEJS_uEye");return function(){var a=e.mat;var b=e.normalMat;var c=e.lookAt;if(f){d.uniformMatrix4fv(f,d.FALSE,a)}if(g){d.uniformMatrix4fv(g,d.FALSE,b)}if(h){d.uniform3fv(h,c.eye)}}}()));this._lastViewXFormStateId=a.viewXFormState._stateId}if(a.modelXFormState._stateId!=this._lastModelXFormStateId){this.createCall(this._callFuncs["modelXF"]||(this._callFuncs["modelXF"]=function(){var c=b._program;var d=b._context;var e=a.modelXFormState;var f=c.getUniformLocation("SCENEJS_uMMatrix");var g=c.getUniformLocation("SCENEJS_uMNMatrix");return function(){var a=e.mat;var b=e.normalMat;if(f){d.uniformMatrix4fv(f,d.FALSE,a)}if(g){d.uniformMatrix4fv(g,d.FALSE,b)}}}()));this._lastModelXFormStateId=a.modelXFormState._stateId}if(a.projXFormState._stateId!=this._lastProjXFormStateId){this.createCall(this._callFuncs["camera"]||(this._callFuncs["camera"]=function(){var c=b._program;var d=b._context;var e=b._callCtx;var f=a.projXFormState;var g=c.getUniformLocation("SCENEJS_uPMatrix");var h=c.getUniformLocation("SCENEJS_uZNear");var i=c.getUniformLocation("SCENEJS_uZFar");return function(){var a=f.mat;var b=f.optics;if(g){d.uniformMatrix4fv(g,d.FALSE,a)}if(e.rayPicking){if(i){d.uniform1f(h,b.near)}if(i){d.uniform1f(i,b.far)}}}}()));this._lastProjXFormStateId=a.projXFormState._stateId}if(a.clipState&&(a.clipState._stateId!=this._lastClipStateId||i._stateId!=this._lastFlagsStateId)){var p=a.clipState.clips;for(f=0,e=p.length;f<e;f++){this.createCall(function(){var a=b._context;var c=b._program;var d=p[f];var e=i.flags;var g=c.getUniformLocation("SCENEJS_uClipMode"+f);var h=c.getUniformLocation("SCENEJS_uClipNormalAndDist"+f);return function(){if(g&&h){if(e.clipping===false){a.uniform1f(g,0)}else if(d.mode=="inside"){a.uniform1f(g,2)}else if(d.mode=="outside"){a.uniform1f(g,1)}else{a.uniform1f(g,0)}a.uniform4fv(h,d.normalAndDist)}}}())}this._lastClipStateId=a.clipState._stateId}if(!this._picking&&!this._rayPicking){if(a.colortransState&&a.colortransState.core&&(a.colortransState._stateId!=this._lastColortransStateId||i._stateId!=this._lastFlagsStateId)){this.createCall(this._callFuncs["colortrans"]||(this._callFuncs["colortrans"]=function(){var c=b._program;var d=i.flags;var e=a.colortransState.core;return function(){if(d.colortrans===false){c.setUniform("SCENEJS_uColorTransMode",0)}else{var a=e.scale;var b=e.add;c.setUniform("SCENEJS_uColorTransMode",1);c.setUniform("SCENEJS_uColorTransScale",[a.r,a.g,a.b,a.a]);c.setUniform("SCENEJS_uColorTransAdd",[b.r,b.g,b.b,b.a]);c.setUniform("SCENEJS_uColorTransSaturation",e.saturation)}}}()));this._lastColortransStateId=a.colortransState._stateId}}if(!this._picking){if(a.materialState&&a.materialState!=this._lastMaterialStateId){this.createCall(this._callFuncs["material"]||(this._callFuncs["material"]=function(){var c=b._program;var d=b._context;var e=c.getUniformLocation("SCENEJS_uMaterialBaseColor");var f=c.getUniformLocation("SCENEJS_uMaterialSpecularColor");var g=c.getUniformLocation("SCENEJS_uMaterialSpecular");var h=c.getUniformLocation("SCENEJS_uMaterialShine");var i=c.getUniformLocation("SCENEJS_uMaterialEmit");var j=c.getUniformLocation("SCENEJS_uMaterialAlpha");return function(){var b=a.materialState.material;if(e){d.uniform3fv(e,b.baseColor)}if(f){d.uniform3fv(f,b.specularColor)}if(g){d.uniform1f(g,b.specular)}if(h){d.uniform1f(h,b.shine)}if(i){d.uniform1f(i,b.emit)}if(j){d.uniform1f(j,b.alpha)}}}()));this._lastMaterialStateId=a.materialState._stateId}}if(!this._picking){if(a.lightState&&a.lightState._stateId!=this._lastLightStateId){var q=a.lightState.lights;for(f=0,e=q.length;f<e;f++){this.createCall(this._callFuncs["light"+f]||(this._callFuncs["light"+f]=function(){var a=b._program;var c=b._context;var d=a.getUniformLocation("SCENEJS_uLightColor"+f);var e=a.getUniformLocation("SCENEJS_uLightDir"+f);var g=a.getUniformLocation("SCENEJS_uLightPos"+f);var h=a.getUniformLocation("SCENEJS_uLightCutOff"+f);var i=a.getUniformLocation("SCENEJS_uLightSpotExpOff"+f);var j=a.getUniformLocation("SCENEJS_uLightAttenuation"+f);var k=q[f];switch(k.mode){case"ambient":return function(){if(d){c.uniform3fv(d,k.color)}};case"dir":return function(){if(d){c.uniform3fv(d,k.color)}if(e){c.uniform3fv(e,k.worldDir)}};case"point":return function(){if(d){c.uniform3fv(d,k.color)}if(g){c.uniform3fv(g,k.worldPos)}};case"spot":return function(){}}}()))}this._lastLightStateId=a.lightState._stateId}}if(this._picking){if(!this._lastNameState||a.nameState._stateId!=this._lastNameState._stateId){this.createCall(this._callFuncs["name"]||(this._callFuncs["name"]=function(){var c=b._program;var d=b._context;var e=b._callCtx;var f=a.nameState;var g=c.getUniformLocation("SCENEJS_uPickColor");return function(){if(e.picking){if(f.name){b.pickNameStates[b._pickIndex++]=f;var a=b._pickIndex>>16&255;var c=b._pickIndex>>8&255;var h=b._pickIndex&255;d.uniform3fv(g,[h/255,c/255,a/255])}}}}()));this._lastNameState=a.nameState}}if(!this._picking){if(!this._lastRenderListenersState||a.renderListenersState._stateId!=this._lastRenderListenersState._stateId){this.createCall(this._callFuncs["rendered"]||(this._callFuncs["rendered"]=function(){var c=a.renderListenersState.listeners;var d=b._queryFacade;return function(){for(var a=c.length-1;a>=0;a--){c[a](d)}}}()));this._lastRenderListenersState=a.renderListenersState}}if(!this._lastFlagsState||i._stateId!=this._lastFlagsState._stateId){this.createCall(this._callFuncs["flags"]||(this._callFuncs["flags"]=function(){var a=b._context;var d=b._program;var e=b._callCtx;var f=d.getUniformLocation("SCENEJS_uBackfaceTexturing");var g=d.getUniformLocation("SCENEJS_uBackfaceLighting");var h=d.getUniformLocation("SCENEJS_uSpecularLighting");var j=i;return function(){var b=j.flags;var d=e.lastFlagsState;var i=d?d.flags:null;if(!i||b.backfaces!=i.backfaces){if(b.backfaces){a.disable(a.CULL_FACE)}else{a.enable(a.CULL_FACE)}}if(!i||b.frontface!=i.frontface){if(b.frontface=="cw"){a.frontFace(a.CW)}else{a.frontFace(a.CCW)}}if(!i||b.blendFunc!=i.blendFunc){if(b.blendFunc){a.blendFunc(c(a,b.blendFunc.sfactor||"one"),c(a,b.blendFunc.dfactor||"zero"))}else{a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)}}a.uniform1i(f,b.backfaceTexturing==undefined?true:!!b.backfaceTexturing);a.uniform1i(g,b.backfaceLighting==undefined?true:!!b.backfaceLighting);a.uniform1i(h,b.specular==undefined?true:!!b.specular)}}()));this._lastFlagsState=i}this.createCall(this._callFuncs["draw"]||(this._callFuncs["draw"]=function(){var a=b._context;var c=j.geo.primitive;var d=j.geo.indexBuf.numItems;return function(){a.drawElements(c,d,a.UNSIGNED_SHORT,0)}}()))};var c=function(a,b){if(!b){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Null SceneJS.renderer node config: "'+b+'"')}var c=SceneJS_webgl_enumMap[b];if(!c){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Unrecognised SceneJS.renderer node config value: "'+b+'"')}var d=a[c];if(!d){throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG,"This browser's WebGL does not support renderer node config value: \""+b+'"')}return d};this.cleanup=function(){this._context.flush();var a=this._callCtx;this._lastRendererState=null;if(a.lastRendererProps){a.lastRendererProps.restoreProps(this._context)}this._lastFlagsState=null;this._lastFrameBufState=null;this._lastNameState=null;if(a.lastFrameBuf){a.lastFrameBuf.unbind();a.lastFrameBuf=null}this._lastProgramId=-1;this._program=null}};new function(){function f(a){var b;if(d>0){b={};for(var c in a){if(a.hasOwnProperty(c)){if(!(a[c]==undefined)){b[c]=g(c)}}}}a=h(a);return{props:a,setProps:function(b){i(b,a)},restoreProps:function(a){if(b){j(a,b)}}}}function h(a){var b;for(var c in a){if(a.hasOwnProperty(c)){b=a[c];if(b!=undefined&&b!=null){if(m[c]){a[c]=m[c](null,b)}else if(n[c]){a[c]=n[c](null,b)}}}}return a}function k(a,f){b[d]=a;c[d]=f;d++;e=true}function o(){var a=c[d-1];d--;var b=c[d-1];e=true}var a;var b=[];var c=[];var d=0;var e;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(b){d=0;e=true;a=b.canvas;d=0;var c=f({clear:{depth:true,color:true},clearDepth:1,enableDepthTest:true,enableCullFace:false,frontFace:"ccw",cullFace:"back",depthFunc:"less",depthRange:{zNear:0,zFar:1},enableScissorTest:false,viewport:{x:1,y:1,width:a.canvas.width,height:a.canvas.height},wireframe:false,highlight:false,enableClip:undefined,enableBlend:false,blendFunc:{sfactor:"srcAlpha",dfactor:"one"}});i(a.context,c.props);k("__scenejs_default_props",c)});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(e){if(d>0){SceneJS_DrawList.setRenderer(b[d-1],c[d-1])}else{SceneJS_DrawList.setRenderer()}e=false}});var g=function(a){var b;var e;for(var f=d-1;f>=0;f--){b=c[f].props;e=b[a];if(e!=undefined&&e!=null){return b[a]}}return null};var i=function(a,b){for(var c in b){if(b.hasOwnProperty(c)){var d=m[c];if(d){d(a,b[c])}}}if(b.viewport){n.viewport(a,b.viewport)}if(b.scissor){n.clear(a,b.scissor)}if(b.clear){n.clear(a,b.clear)}};var j=function(a,b){var c;for(var d in b){if(b.hasOwnProperty(d)){c=b[d];if(c!=undefined&&c!=null){var e=m[d];if(e){e(a,c)}}}}if(b.viewport){n.viewport(a,b.viewport)}if(b.scissor){n.clear(a,b.scissor)}};var l=function(a,b){if(!b){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Null SceneJS.renderer node config: "'+b+'"')}var c=SceneJS_webgl_enumMap[b];if(!c){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Unrecognised SceneJS.renderer node config value: "'+b+'"')}var d=a[c];if(!d){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"This browser's WebGL does not support renderer node config value: \""+b+'"')}return d};var m={enableBlend:function(a,b){if(!a){if(b==null||b==undefined){b=false}return b}if(b){a.enable(a.BLEND)}else{a.disable(a.BLEND)}},blendColor:function(a,b){if(!a){b=b||{};return{r:b.r||0,g:b.g||0,b:b.b||0,a:b.a==undefined||b.a==null?1:b.a}}a.blendColor(b.r,b.g,b.b,b.a)},blendEquation:function(a,b){if(!a){return b||"funcAdd"}a.blendEquation(a,l(a,b))},blendEquationSeparate:function(a,b){if(!a){b=b||{};return{rgb:b.rgb||"funcAdd",alpha:b.alpha||"funcAdd"}}a.blendEquation(l(a,b.rgb),l(a,b.alpha))},blendFunc:function(a,b){if(!a){b=b||{};return{sfactor:b.sfactor||"srcAlpha",dfactor:b.dfactor||"oneMinusSrcAlpha"}}a.blendFunc(l(a,b.sfactor||"srcAlpha"),l(a,b.dfactor||"oneMinusSrcAlpha"))},blendFuncSeparate:function(a,b){if(!a){b=b||{};return{srcRGB:b.srcRGB||"zero",dstRGB:b.dstRGB||"zero",srcAlpha:b.srcAlpha||"zero",dstAlpha:b.dstAlpha||"zero"}}a.blendFuncSeparate(l(a,b.srcRGB||"zero"),l(a,b.dstRGB||"zero"),l(a,b.srcAlpha||"zero"),l(a,b.dstAlpha||"zero"))},clearColor:function(a,b){if(!a){b=b||{};return{r:b.r||0,g:b.g||0,b:b.b||0,a:b.a==undefined||b.a==null?1:b.a}}a.clearColor(b.r,b.g,b.b,b.a)},clearDepth:function(a,b){if(!a){return b==null||b==undefined?1:b}a.clearDepth(b)},clearStencil:function(a,b){if(!a){return b||0}a.clearStencil(b)},colorMask:function(a,b){if(!a){b=b||{};return{r:b.r||0,g:b.g||0,b:b.b||0,a:b.a==undefined||b.a==null?1:b.a}}a.colorMask(b.r,b.g,b.b,b.a)},enableCullFace:function(a,b){if(!a){return b}if(b){a.enable(a.CULL_FACE)}else{a.disable(a.CULL_FACE)}},cullFace:function(a,b){if(!a){return b||"back"}a.cullFace(l(a,b))},enableDepthTest:function(a,b){if(!a){if(b==null||b==undefined){b=true}return b}if(b){a.enable(a.DEPTH_TEST)}else{a.disable(a.DEPTH_TEST)}},depthFunc:function(a,b){if(!a){return b||"less"}a.depthFunc(l(a,b))},enableDepthMask:function(a,b){if(!a){if(b==null||b==undefined){b=true}return b}a.depthMask(b)},depthRange:function(a,b){if(!a){b=b||{};return{zNear:b.zNear==undefined||b.zNear==null?0:b.zNear,zFar:b.zFar==undefined||b.zFar==null?1:b.zFar}}a.depthRange(b.zNear,b.zFar)},frontFace:function(a,b){if(!a){return b||"ccw"}a.frontFace(l(a,b))},lineWidth:function(a,b){if(!a){return b||1}a.lineWidth(b)},enableScissorTest:function(a,b){if(!a){return b}if(b){a.enable(a.SCISSOR_TEST)}else{b=false;a.disable(a.SCISSOR_TEST)}}};var n={viewport:function(b,c){if(!b){c=c||{};return{x:c.x||1,y:c.y||1,width:c.width||a.canvas.width,height:c.height||a.canvas.height}}b.viewport(c.x,c.y,c.width,c.height)},scissor:function(a,b){if(!a){b=b||{};return{x:b.x||0,y:b.y||0,width:b.width||1,height:b.height||1}}a.scissor(b.x,b.y,b.width,b.height)},clear:function(a,b){if(!a){b=b||{};return b}var c;if(b.color){c=a.COLOR_BUFFER_BIT}if(b.depth){c=c|a.DEPTH_BUFFER_BIT}if(b.stencil){c=c|a.STENCIL_BUFFER_BIT}if(c){a.clear(c)}}};var p=SceneJS.createNodeType("renderer");p.prototype._init=function(a){if(this.core._nodeCount==1){for(var b in a){if(a.hasOwnProperty(b)){this.core[b]=a[b]}}}};p.prototype.setViewport=function(a){this.core.viewport=a?{x:a.x||1,y:a.y||1,width:a.width||1e3,height:a.height||1e3}:undefined};p.prototype.getViewport=function(){return this.core.viewport?{x:this.core.viewport.x,y:this.core.viewport.y,width:this.core.viewport.width,height:this.core.viewport.height}:undefined};p.prototype.setScissor=function(a){this.core.scissor=a?{x:a.x||1,y:a.y||1,width:a.width||1e3,height:a.height||1e3}:undefined};p.prototype.getScissor=function(){return this.core.scissor?{x:this.core.scissor.x,y:this.core.scissor.y,width:this.core.scissor.width,height:this.core.scissor.height}:undefined};p.prototype.setClear=function(a){this.core.clear=a?{r:a.r||0,g:a.g||0,b:a.b||0}:undefined};p.prototype.getClear=function(){return this.core.clear?{r:this.core.clear.r,g:this.core.clear.g,b:this.core.clear.b}:null};p.prototype.setEnableBlend=function(a){this.core.enableBlend=a};p.prototype.getEnableBlend=function(){return this.core.enableBlend};p.prototype.setBlendColor=function(a){this.core.blendColor=a?{r:a.r||0,g:a.g||0,b:a.b||0,a:a.a==undefined||a.a==null?1:a.a}:undefined};p.prototype.getBlendColor=function(){return this.core.blendColor?{r:this.core.blendColor.r,g:this.core.blendColor.g,b:this.core.blendColor.b,a:this.core.blendColor.a}:undefined};p.prototype.setBlendEquation=function(a){this.core.blendEquation=a};p.prototype.getBlendEquation=function(){return this.core.blendEquation};p.prototype.setBlendEquationSeparate=function(a){this.core.blendEquationSeparate=a?{rgb:a.rgb||"funcAdd",alpha:a.alpha||"funcAdd"}:undefined};p.prototype.getBlendEquationSeparate=function(){return this.core.blendEquationSeparate?{rgb:this.core.rgb,alpha:this.core.alpha}:undefined};p.prototype.setBlendFunc=function(a){this.core.blendFunc=a?{sfactor:a.sfactor||"srcAlpha",dfactor:a.dfactor||"one"}:undefined};p.prototype.getBlendFunc=function(){return this.core.blendFunc?{sfactor:this.core.sfactor,dfactor:this.core.dfactor}:undefined};p.prototype.setBlendFuncSeparate=function(a){this.core.blendFuncSeparate=a?{srcRGB:a.srcRGB||"zero",dstRGB:a.dstRGB||"zero",srcAlpha:a.srcAlpha||"zero",dstAlpha:a.dstAlpha||"zero"}:undefined};p.prototype.getBlendFuncSeparate=function(){return this.core.blendFuncSeparate?{srcRGB:this.core.blendFuncSeparate.srcRGB,dstRGB:this.core.blendFuncSeparate.dstRGB,srcAlpha:this.core.blendFuncSeparate.srcAlpha,dstAlpha:this.core.blendFuncSeparate.dstAlpha}:undefined};p.prototype.setEnableCullFace=function(a){this.core.enableCullFace=a};p.prototype.getEnableCullFace=function(){return this.core.enableCullFace};p.prototype.setCullFace=function(a){this.core.cullFace=a};p.prototype.getCullFace=function(){return this.core.cullFace};p.prototype.setEnableDepthTest=function(a){this.core.enableDepthTest=a};p.prototype.getEnableDepthTest=function(){return this.core.enableDepthTest};p.prototype.setDepthFunc=function(a){this.core.depthFunc=a};p.prototype.getDepthFunc=function(){return this.core.depthFunc};p.prototype.setEnableDepthMask=function(a){this.core.enableDepthMask=a};p.prototype.getEnableDepthMask=function(){return this.core.enableDepthMask};p.prototype.setClearDepth=function(a){this.core.clearDepth=a};p.prototype.getClearDepth=function(){return this.core.clearDepth};p.prototype.setDepthRange=function(a){this.core.depthRange=a?{zNear:a.zNear==undefined||a.zNear==null?0:a.zNear,zFar:a.zFar==undefined||a.zFar==null?1:a.zFar}:undefined};p.prototype.getDepthRange=function(){return this.core.depthRange?{zNear:this.core.depthRange.zNear,zFar:this.core.depthRange.zFar}:undefined};p.prototype.setFrontFace=function(a){this.core.frontFace=a};p.prototype.getFrontFace=function(){return this.core.frontFace};p.prototype.setLineWidth=function(a){this.core.lineWidth=a};p.prototype.getLineWidth=function(){return this.core.lineWidth};p.prototype.setEnableScissorTest=function(a){this.core.enableScissorTest=a};p.prototype.getEnableScissorTest=function(){return this.core.enableScissorTest};p.prototype.setClearStencil=function(a){this.core.clearStencil=a};p.prototype.getClearStencil=function(){return this.core.clearStencil};p.prototype.setColorMask=function(a){this.core.colorMask=a?{r:a.r||0,g:a.g||0,b:a.b||0,a:a.a==undefined||a.a==null?1:a.a}:undefined};p.prototype.getColorMask=function(){return this.core.colorMask?{r:this.core.colorMask.r,g:this.core.colorMask.g,b:this.core.colorMask.b,a:this.core.colorMask.a}:undefined};p.prototype.setWireframe=function(a){this.core.wireframe=a};p.prototype.getWireframe=function(){return this.core.wireframe};p.prototype.setHighlight=function(a){this.core.highlight=a};p.prototype.getHighlight=function(){return this.core.highlight};p.prototype.setEnableClip=function(a){this.core.enableClip=a};p.prototype.getEnableClip=function(){return this.core.enableClip};p.prototype.setEnableFog=function(a){this.core.enableFog=a};p.prototype.getEnableFog=function(){return this.core.enableFog};p.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};p.prototype._preCompile=function(){if(this._compileMemoLevel==0){this._props=f(this.core);this._compileMemoLevel=1}k(this.core.id,this._props)};p.prototype._postCompile=function(){o()}};(function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(e){if(d){if(c>0){SceneJS_DrawList.setFlags(a[c-1],b[c-1])}else{SceneJS_DrawList.setFlags()}d=false}});var e=SceneJS.createNodeType("flags");e.prototype._init=function(a){if(this.core._nodeCount==1){if(!a.flags){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"flags node 'flags' attribute missing ")}this.core.flags={};this.setFlags(a.flags)}};e.prototype.setFlags=function(a){SceneJS._apply(a,this.core.flags,true)};e.prototype.addFlags=function(a){SceneJS._apply(a,this.core.flags)};e.prototype.getFlags=function(){return SceneJS._shallowClone(this.core.flags)};e.prototype._compile=function(){a[c]=this.attr.id;b[c]=this.core.flags;c++;d=true;this._compileNodes();c--;d=true}})();(function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(e){if(d){if(c>0){SceneJS_DrawList.setTag(a[c-1],b[c-1])}else{SceneJS_DrawList.setTag()}d=false}});var e=SceneJS.createNodeType("tag");e.prototype._init=function(a){if(this.core._nodeCount==1){if(!a.tag){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"tag node attribute missing : 'tag'")}this.core.tag="enabled";this.setTag(a.tag)}};e.prototype.setTag=function(a){var b=this.core;b.tag=a;b.pattern=null;b.matched=false};e.prototype.getTag=function(){return this.core.tag};e.prototype._compile=function(){a[c]=this.attr.id;b[c]=this.core;c++;d=true;this._compileNodes();c--;d=true}})();var SceneJS_sceneStatusModule=new function(){this.sceneStatus={};var a=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(b){a.sceneStatus[b.sceneId]={numLoading:0}});this.nodeLoading=function(a){this.sceneStatus[a.scene.attr.id].numLoading++};this.nodeLoaded=function(a){this.sceneStatus[a.scene.attr.id].numLoading--}};new function(){function c(a){if(document.getElementById(a.canvas.canvasId)){if(a.vertexBuf){a.vertexBuf.destroy()}if(a.normalBuf){a.normalBuf.destroy()}if(a.indexBuf){a.indexBuf.destroy()}if(a.uvBuf){a.uvBuf.destroy()}if(a.uvBuf2){a.uvBuf2.destroy()}if(a.colorBuf){a.colorBuf.destroy()}}}function d(a,b){switch(b){case"points":return a.POINTS;case"lines":return a.LINES;case"line-loop":return a.LINE_LOOP;case"line-strip":return a.LINE_STRIP;case"triangles":return a.TRIANGLES;case"triangle-strip":return a.TRIANGLE_STRIP;case"triangle-fan":return a.TRIANGLE_FAN;default:throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.geometry primitive unsupported: '"+b+"' - supported types are: 'points', 'lines', 'line-loop', "+"'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}}function e(a,b,c,d){if(typeof b=="string"){var e=SceneJS.Services.getService(SceneJS.Services.GEO_LOADER_SERVICE_ID);e.loadGeometry(b,function(b){c(g(a,b,d))})}else{var h=f(b,d);h.primitive=b.primitive;return g(a,h)}}function f(a,b){return{positions:a.positions?new Float32Array(b.scale||b.origin?h(a.positions,b):a.positions):undefined,normals:a.normals?new Float32Array(a.normals):undefined,uv:a.uv?new Float32Array(a.uv):undefined,uv2:a.uv2?new Float32Array(a.uv2):undefined,colors:a.colors?new Float32Array(a.colors):undefined,indices:a.indices?new Int32Array(a.indices):undefined}}function g(a,b){var c=a.canvas.context;if(!b.primitive){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"SceneJS.geometry node property expected : primitive")}var e=c.STATIC_DRAW;var f;var g;var h;var i;var j;var k;try{if(b.positions&&b.positions.length>0){f=new SceneJS_webgl_ArrayBuffer(c,c.ARRAY_BUFFER,b.positions,b.positions.length,3,e)}if(b.normals&&b.normals.length>0){g=new SceneJS_webgl_ArrayBuffer(c,c.ARRAY_BUFFER,b.normals,b.normals.length,3,e)}if(b.uv&&b.uv.length>0){if(b.uv){h=new SceneJS_webgl_ArrayBuffer(c,c.ARRAY_BUFFER,b.uv,b.uv.length,2,e)}}if(b.uv2&&b.uv2.length>0){if(b.uv2){i=new SceneJS_webgl_ArrayBuffer(c,c.ARRAY_BUFFER,b.uv2,b.uv2.length,2,e)}}if(b.colors&&b.colors.length>0){if(b.colors){j=new SceneJS_webgl_ArrayBuffer(c,c.ARRAY_BUFFER,b.colors,b.colors.length,4,e)}}var l;if(b.indices&&b.indices.length>0){l=d(c,b.primitive);k=new SceneJS_webgl_ArrayBuffer(c,c.ELEMENT_ARRAY_BUFFER,new Uint16Array(b.indices),b.indices.length,3,e)}var m={fixed:true,primitive:l,scene:a,canvas:a.canvas,context:c,vertexBuf:f,normalBuf:g,indexBuf:k,uvBuf:h,uvBuf2:i,colorBuf:j,arrays:b};if(b.positions){}return m}catch(n){if(f){f.destroy()}if(g){g.destroy()}if(h){h.destroy()}if(i){i.destroy()}if(j){j.destroy()}if(k){k.destroy()}throw n}}function h(a,b){var c=a.slice(0);if(b.scale){var d=b.scale.x!=undefined?b.scale.x:1;var e=b.scale.y!=undefined?b.scale.y:1;var f=b.scale.z!=undefined?b.scale.z:1;for(var g=0,h=c.length;g<h;g+=3){c[g+0]*=d;c[g+1]*=e;c[g+2]*=f}}if(b.origin){var i=b.origin.x!=undefined?b.origin.x:0;var j=b.origin.y!=undefined?b.origin.y:0;var k=b.origin.z!=undefined?b.origin.z:0;for(var g=0,h=c.length;g<h;g+=3){c[g+0]-=i;c[g+1]-=j;c[g+2]-=k}}return c}function i(a){c(a)}function j(c,d){if(!d.vertexBuf){d=k(d)}if(d.indexBuf){SceneJS_DrawList.setGeometry(c,d)}a[b++]=d}function k(c){var d={primitive:c.primitive,boundary:c.boundary,normalBuf:c.normalBuf,uvBuf:c.uvBuf,uvBuf2:c.uvBuf2,colorBuf:c.colorBuf,indexBuf:c.indexBuf};for(var e=b-1;e>=0;e--){if(a[e].vertexBuf){d.vertexBuf=a[e].vertexBuf;d.boundary=a[e].boundary;d.normalBuf=a[e].normalBuf;d.uvBuf=a[e].uvBuf;d.uvBuf2=a[e].uvBuf2;d.colorBuf=a[e].colorBuf;return d}}return d}function l(){b--}var a=[];var b=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(){b=0});window.SceneJS_geometry=SceneJS.createNodeType("geometry");SceneJS_geometry.prototype._init=function(a){if(this.core._nodeCount==1){var b={origin:a.origin,scale:a.scale};if(a.create instanceof Function){var c=a.create();SceneJS._apply(e(this.scene,c,null,b),this.core)}else if(a.stream){this._stream=a.stream;this.core._loading=true;var d=this;e(this.scene,this._stream,function(a){SceneJS._apply(a,d.core);d.core._loading=false;SceneJS_compileModule.nodeUpdated(d,"loaded")},b)}else{var f={positions:a.positions||[],normals:a.normals||[],colors:a.colors||[],indices:a.indices||[],uv:a.uv||[],uv2:a.uv2||[],primitive:a.primitive||"triangles"};SceneJS._apply(e(this.scene,f,null,b),this.core)}}};SceneJS_geometry.prototype.getStream=function(){return this._stream};SceneJS_geometry.prototype.getPositions=function(){return this._getArrays().positions};SceneJS_geometry.prototype.setPositions=function(a){this.core.vertexBuf.bind();this.core.vertexBuf.setData(a.positions,a.offset||0)};SceneJS_geometry.prototype.getNormals=function(){return this._getArrays().normals};SceneJS_geometry.prototype.setNormals=function(a){this.core.normalBuf.bind();this.core.normalBuf.setData(a.normals,a.offset||0)};SceneJS_geometry.prototype.getColors=function(){return this._getArrays().colors};SceneJS_geometry.prototype.setColors=function(a){this.core.colorBuf.bind();this.core.colorBuf.setData(a.colors,a.offset||0)};SceneJS_geometry.prototype.getIndices=function(){return this._getArrays().indices};SceneJS_geometry.prototype.getUv=function(){return this._getArrays().uv};SceneJS_geometry.prototype.setUv=function(a){this.core.uvBuf.bind();this.core.uvBuf.setData(a.uv,a.offset||0)};SceneJS_geometry.prototype.getUv2=function(){return this._getArrays().uv2};SceneJS_geometry.prototype.setUv2=function(a){this.core.uvBuf2.bind();this.core.uvBuf2.setData(a.uv2,a.offset||0)};SceneJS_geometry.prototype.getPrimitive=function(){return this.attr.primitive};SceneJS_geometry.prototype._getArrays=function(){if(this.attr.positions){return this.attr}else{if(!this.core){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Invalid node state exception: geometry stream not loaded yet - can't query geometry data yet")}return this.core.arrays}};SceneJS_geometry.prototype.getBoundary=function(){if(this._boundary){return this._boundary}var a=this._getArrays().positions;this._boundary={xmin:SceneJS_math_MAX_DOUBLE,ymin:SceneJS_math_MAX_DOUBLE,zmin:SceneJS_math_MAX_DOUBLE,xmax:SceneJS_math_MIN_DOUBLE,ymax:SceneJS_math_MIN_DOUBLE,zmax:SceneJS_math_MIN_DOUBLE};var b,c,d;for(var e=0,f=a.length-2;e<f;e+=3){b=a[e];c=a[e+1];d=a[e+2];if(b<this._boundary.xmin){this._boundary.xmin=b}if(c<this._boundary.ymin){this._boundary.ymin=c}if(d<this._boundary.zmin){this._boundary.zmin=d}if(b>this._boundary.xmax){this._boundary.xmax=b}if(c>this._boundary.ymax){this._boundary.ymax=c}if(d>this._boundary.zmax){this._boundary.zmax=d}}return this._boundary};SceneJS_geometry.prototype._compile=function(){if(!this.core._loading){j(this.attr.id,this.core)}this._compileNodes();if(!this.core._loading){l()}};SceneJS_geometry.prototype._destroy=function(){if(this.core._nodeCount==1){i(this.core);SceneJS_DrawList.removeGeometry(this.scene.attr.id,this.attr.id)}}};(function(){function a(){var a=[[-3,1.65,0],[-2.98711,1.65,-.098438],[-2.98711,1.65,.098438],[-2.98538,1.56732,-.049219],[-2.98538,1.56732,.049219],[-2.9835,1.48308,0],[-2.98189,1.72347,-.049219],[-2.98189,1.72347,.049219],[-2.97656,1.79853,0],[-2.9709,1.48621,-.098438],[-2.9709,1.48621,.098438],[-2.96388,1.79534,-.098438],[-2.96388,1.79534,.098438],[-2.96221,1.57017,-.133594],[-2.96221,1.57017,.133594],[-2.95864,1.72057,-.133594],[-2.95864,1.72057,.133594],[-2.95313,1.65,-.16875],[-2.95313,1.65,.16875],[-2.95247,1.40374,-.049219],[-2.95247,1.40374,.049219],[-2.9377,1.49447,-.16875],[-2.9377,1.49447,.16875],[-2.93523,1.85215,-.049219],[-2.93523,1.85215,.049219],[-2.93359,1.32012,0],[-2.93045,1.78693,-.16875],[-2.93045,1.78693,.16875],[-2.93037,1.4115,-.133594],[-2.93037,1.4115,.133594],[-2.92188,1.32553,-.098438],[-2.92188,1.32553,.098438],[-2.91278,1.84417,-.133594],[-2.91278,1.84417,.133594],[-2.90625,1.91016,0],[-2.89423,1.90457,-.098438],[-2.89423,1.90457,.098438],[-2.89138,1.5791,-.196875],[-2.89138,1.5791,.196875],[-2.89099,1.3398,-.16875],[-2.89099,1.3398,.16875],[-2.89065,1.71208,-.196875],[-2.89065,1.71208,.196875],[-2.88346,1.24579,-.048343],[-2.88346,1.24579,.048343],[-2.86346,1.25713,-.132718],[-2.86346,1.25713,.132718],[-2.86266,1.43483,-.196875],[-2.86266,1.43483,.196875],[-2.86255,1.88983,-.16875],[-2.86255,1.88983,.16875],[-2.85,1.65,-.225],[-2.85,1.65,.225],[-2.84971,1.16155,0],[-2.8471,1.82082,-.196875],[-2.8471,1.82082,.196875],[-2.84194,1.94692,-.049219],[-2.84194,1.94692,.049219],[-2.829,1.7614,-.225],[-2.829,1.7614,.225],[-2.82867,1.17598,-.094933],[-2.82867,1.17598,.094933],[-2.8247,1.52194,-.225],[-2.8247,1.52194,.225],[-2.82115,1.9352,-.133594],[-2.82115,1.9352,.133594],[-2.81231,1.18719,-.16875],[-2.81231,1.18719,.16875],[-2.80501,1.28997,-.196875],[-2.80501,1.28997,.196875],[-2.79727,1.38311,-.225],[-2.79727,1.38311,.225],[-2.78906,1.99014,0],[-2.78836,1.69932,-.196875],[-2.78836,1.69932,.196875],[-2.77821,1.98283,-.098438],[-2.77821,1.98283,.098438],[-2.77442,1.52738,-.196875],[-2.77442,1.52738,.196875],[-2.77356,1.0986,-.084375],[-2.77356,1.0986,.084375],[-2.76641,1.84512,-.225],[-2.76641,1.84512,.225],[-2.76034,1.9009,-.196875],[-2.76034,1.9009,.196875],[-2.7496,1.96356,-.16875],[-2.7496,1.96356,.16875],[-2.74831,1.7857,-.196875],[-2.74831,1.7857,.196875],[-2.74688,1.65,-.16875],[-2.74688,1.65,.16875],[-2.73125,1.00781,0],[-2.72756,1.73587,-.16875],[-2.72756,1.73587,.16875],[-2.72036,1.69083,-.133594],[-2.72036,1.69083,.133594],[-2.71948,1.24977,-.225],[-2.71948,1.24977,.225],[-2.71678,1.14468,-.196875],[-2.71678,1.14468,.196875],[-2.71289,1.65,-.098438],[-2.71289,1.65,.098438],[-2.70899,1.54177,-.133594],[-2.70899,1.54177,.133594],[-2.70354,1.42641,-.16875],[-2.70354,1.42641,.16875],[-2.70098,1.03784,-.16875],[-2.70098,1.03784,.16875],[-2.7,1.65,0],[-2.69965,2.01079,-.048346],[-2.69965,2.01079,.048346],[-2.69712,1.68793,-.049219],[-2.69712,1.68793,.049219],[-2.69413,1.72746,-.098438],[-2.69413,1.72746,.098438],[-2.68662,1.54669,-.049219],[-2.68662,1.54669,.049219],[-2.68263,1.76235,-.133594],[-2.68263,1.76235,.133594],[-2.68148,1.99646,-.132721],[-2.68148,1.99646,.132721],[-2.68144,1.72427,0],[-2.67574,1.27085,-.196875],[-2.67574,1.27085,.196875],[-2.67265,1.44068,-.098438],[-2.67265,1.44068,.098438],[-2.67026,1.8004,-.16875],[-2.67026,1.8004,.16875],[-2.6678,1.84623,-.196875],[-2.6678,1.84623,.196875],[-2.66279,1.9051,-.225],[-2.66279,1.9051,.225],[-2.66094,1.44609,0],[-2.66018,1.75437,-.049219],[-2.66018,1.75437,.049219],[-2.63858,1.78567,-.098438],[-2.63858,1.78567,.098438],[-2.63438,1.10391,-.225],[-2.63438,1.10391,.225],[-2.63074,1.95674,-.196875],[-2.63074,1.95674,.196875],[-2.62656,1.78008,0],[-2.625,2.04375,0],[-2.62464,1.30502,-.132813],[-2.62464,1.30502,.132813],[-2.60642,1.31745,-.048438],[-2.60642,1.31745,.048438],[-2.60632,2.02644,-.094945],[-2.60632,2.02644,.094945],[-2.5918,2.01299,-.16875],[-2.5918,2.01299,.16875],[-2.57173,1.83429,-.16875],[-2.57173,1.83429,.16875],[-2.56777,1.16997,-.16875],[-2.56777,1.16997,.16875],[-2.5546,1.18304,-.095315],[-2.5546,1.18304,.095315],[-2.54975,1.89059,-.196875],[-2.54975,1.89059,.196875],[-2.54954,.878984,-.084375],[-2.54954,.878984,.084375],[-2.54643,1.83197,-.132721],[-2.54643,1.83197,.132721],[-2.5375,1.2,0],[-2.52721,1.8192,-.048346],[-2.52721,1.8192,.048346],[-2.51875,1.94531,-.225],[-2.51875,1.94531,.225],[-2.51683,.932671,-.196875],[-2.51683,.932671,.196875],[-2.47184,1.00649,-.196875],[-2.47184,1.00649,.196875],[-2.4457,1.87764,-.16875],[-2.4457,1.87764,.16875],[-2.43913,1.06018,-.084375],[-2.43913,1.06018,.084375],[-2.43118,1.86418,-.094945],[-2.43118,1.86418,.094945],[-2.4125,1.84687,0],[-2.38828,.716602,0],[-2.38225,.737663,-.095854],[-2.38225,.737663,.095854],[-2.37884,2.05202,-.084375],[-2.37884,2.05202,.084375],[-2.37766,.75368,-.16875],[-2.37766,.75368,.16875],[-2.36475,.798761,-.199836],[-2.36475,.798761,.199836],[-2.3543,.835254,-.225],[-2.3543,.835254,.225],[-2.34384,.871747,-.199836],[-2.34384,.871747,.199836],[-2.34115,1.99972,-.196875],[-2.34115,1.99972,.196875],[-2.33093,.916827,-.16875],[-2.33093,.916827,.16875],[-2.32031,.953906,0],[-2.28932,1.92782,-.196875],[-2.28932,1.92782,.196875],[-2.25162,1.87552,-.084375],[-2.25162,1.87552,.084375],[-2.24741,.882285,-.084375],[-2.24741,.882285,.084375],[-2.17363,.844043,0],[-2.16853,.826951,-.097184],[-2.16853,.826951,.097184],[-2.16477,.814364,-.16875],[-2.16477,.814364,.16875],[-2.15688,.786694,-.187068],[-2.15688,.786694,.187068],[-2.15625,2.09297,0],[-2.15412,.74052,-.215193],[-2.15412,.74052,.215193],[-2.15017,.694734,-.215193],[-2.15017,.694734,.215193],[-2.14742,.64856,-.187068],[-2.14742,.64856,.187068],[-2.14496,.612777,-.132948],[-2.14496,.612777,.132948],[-2.14371,.591789,-.048573],[-2.14371,.591789,.048573],[-2.14233,2.05836,-.16875],[-2.14233,2.05836,.16875],[-2.11172,1.98223,-.225],[-2.11172,1.98223,.225],[-2.08447,.789526,-.048905],[-2.08447,.789526,.048905],[-2.0811,1.90609,-.16875],[-2.0811,1.90609,.16875],[-2.07834,.770387,-.13328],[-2.07834,.770387,.13328],[-2.06719,1.87148,0],[-2,.75,0],[-1.9957,.737109,-.098438],[-1.9957,.737109,.098438],[-1.98438,.703125,-.16875],[-1.98438,.703125,.16875],[-1.97852,.59165,0],[-1.96937,.670825,-.202656],[-1.96937,.670825,.202656],[-1.96836,.655078,-.210938],[-1.96836,.655078,.210938],[-1.96,.75,-.4075],[-1.96,.75,.4075],[-1.95873,.925195,-.201561],[-1.95873,.925195,.201561],[-1.95703,1.10039,0],[-1.95,.6,-.225],[-1.95,.6,.225],[-1.93895,.59165,-.403123],[-1.93895,.59165,.403123],[-1.93164,.544922,-.210938],[-1.93164,.544922,.210938],[-1.93069,.522583,-.198676],[-1.93069,.522583,.198676],[-1.92188,.453516,0],[-1.91789,1.10039,-.398745],[-1.91789,1.10039,.398745],[-1.91562,.496875,-.16875],[-1.91562,.496875,.16875],[-1.9043,.462891,-.098438],[-1.9043,.462891,.098438],[-1.9,.45,0],[-1.89228,.670825,-.593047],[-1.89228,.670825,.593047],[-1.88344,.453516,-.391582],[-1.88344,.453516,.391582],[-1.88206,.925195,-.589845],[-1.88206,.925195,.589845],[-1.88139,1.28613,-.193602],[-1.88139,1.28613,.193602],[-1.85512,.522583,-.581402],[-1.85512,.522583,.581402],[-1.845,.75,-.785],[-1.845,.75,.785],[-1.84375,1.47187,0],[-1.83317,1.89068,-.084375],[-1.83317,1.89068,.084375],[-1.8318,1.94649,-.196875],[-1.8318,1.94649,.196875],[-1.82992,2.02323,-.196875],[-1.82992,2.02323,.196875],[-1.82855,2.07904,-.084375],[-1.82855,2.07904,.084375],[-1.82518,.59165,-.776567],[-1.82518,.59165,.776567],[-1.81758,.343945,-.187036],[-1.81758,.343945,.187036],[-1.80775,1.28613,-.566554],[-1.80775,1.28613,.566554],[-1.80687,1.47187,-.375664],[-1.80687,1.47187,.375664],[-1.80536,1.10039,-.768135],[-1.80536,1.10039,.768135],[-1.77293,.453516,-.754336],[-1.77293,.453516,.754336],[-1.75,.234375,0],[-1.74644,.343945,-.547339],[-1.74644,.343945,.547339],[-1.74433,.670825,-.949871],[-1.74433,.670825,.949871],[-1.73491,.925195,-.944741],[-1.73491,.925195,.944741],[-1.715,.234375,-.356563],[-1.715,.234375,.356562],[-1.71008,.522583,-.931218],[-1.71008,.522583,.931218],[-1.70086,1.47187,-.723672],[-1.70086,1.47187,.723672],[-1.6664,1.28613,-.907437],[-1.6664,1.28613,.907437],[-1.6625,.75,-1.125],[-1.6625,.75,1.125],[-1.65516,1.86094,-.170322],[-1.65516,1.86094,.170322],[-1.64742,.159961,-.169526],[-1.64742,.159961,.169526],[-1.64464,.59165,-1.11292],[-1.64464,.59165,1.11292],[-1.62678,1.10039,-1.10083],[-1.62678,1.10039,1.10083],[-1.61437,.234375,-.686875],[-1.61437,.234375,.686875],[-1.60989,.343945,-.87666],[-1.60989,.343945,.87666],[-1.6,1.875,0],[-1.59756,.453516,-1.08106],[-1.59756,.453516,1.08106],[-1.59037,1.86094,-.498428],[-1.59037,1.86094,.498428],[-1.58438,1.91016,-.16875],[-1.58438,1.91016,.16875],[-1.58294,.159961,-.496099],[-1.58294,.159961,.496099],[-1.57813,.085547,0],[-1.55,1.9875,-.225],[-1.55,1.9875,.225],[-1.54656,.085547,-.321543],[-1.54656,.085547,.321543],[-1.53297,.670825,-1.26567],[-1.53297,.670825,1.26567],[-1.53262,1.47187,-1.03711],[-1.53262,1.47187,1.03711],[-1.52469,.925195,-1.25883],[-1.52469,.925195,1.25883],[-1.52367,.042773,-.156792],[-1.52367,.042773,.156792],[-1.51563,2.06484,-.16875],[-1.51563,2.06484,.16875],[-1.50287,.522583,-1.24081],[-1.50287,.522583,1.24081],[-1.5,0,0],[-1.5,2.1,0],[-1.5,2.25,0],[-1.47,0,-.305625],[-1.47,0,.305625],[-1.47,2.25,-.305625],[-1.47,2.25,.305625],[-1.46602,1.86094,-.79832],[-1.46602,1.86094,.79832],[-1.46449,1.28613,-1.20912],[-1.46449,1.28613,1.20912],[-1.46403,.042773,-.458833],[-1.46403,.042773,.458833],[-1.45986,2.28691,-.150226],[-1.45986,2.28691,.150226],[-1.45917,.159961,-.79459],[-1.45917,.159961,.79459],[-1.45582,.085547,-.619414],[-1.45582,.085547,.619414],[-1.45469,.234375,-.984375],[-1.45469,.234375,.984375],[-1.44922,2.32383,0],[-1.42023,2.32383,-.295278],[-1.42023,2.32383,.295278],[-1.42,.75,-1.42],[-1.42,.75,1.42],[-1.41482,.343945,-1.16812],[-1.41482,.343945,1.16812],[-1.41191,2.33613,-.145291],[-1.41191,2.33613,.145291],[-1.40475,.59165,-1.40475],[-1.40475,.59165,1.40475],[-1.40313,2.34844,0],[-1.40272,2.28691,-.439618],[-1.40272,2.28691,.439618],[-1.4,2.25,0],[-1.38949,1.10039,-1.38949],[-1.38949,1.10039,1.38949],[-1.38375,0,-.58875],[-1.38375,0,.58875],[-1.38375,2.25,-.58875],[-1.38375,2.25,.58875],[-1.38047,2.32383,0],[-1.37788,2.33613,-.141789],[-1.37788,2.33613,.141789],[-1.37633,2.28691,-.14163],[-1.37633,2.28691,.14163],[-1.37506,2.34844,-.285887],[-1.37506,2.34844,.285887],[-1.372,2.25,-.28525],[-1.372,2.25,.28525],[-1.36453,.453516,-1.36453],[-1.36453,.453516,1.36453],[-1.35665,2.33613,-.425177],[-1.35665,2.33613,.425177],[-1.35286,2.32383,-.281271],[-1.35286,2.32383,.281271],[-1.34957,.042773,-.734902],[-1.34957,.042773,.734902],[-1.3369,2.32383,-.568818],[-1.3369,2.32383,.568818],[-1.32395,2.33613,-.414929],[-1.32395,2.33613,.414929],[-1.32246,2.28691,-.414464],[-1.32246,2.28691,.414464],[-1.31182,.085547,-.887695],[-1.31182,.085547,.887695],[-1.30906,1.47187,-1.30906],[-1.30906,1.47187,1.30906],[-1.3,2.25,0],[-1.29438,2.34844,-.550727],[-1.29438,2.34844,.550727],[-1.29305,2.28691,-.704126],[-1.29305,2.28691,.704126],[-1.2915,2.25,-.5495],[-1.2915,2.25,.5495],[-1.28839,1.86094,-1.06373],[-1.28839,1.86094,1.06373],[-1.28237,.159961,-1.05876],[-1.28237,.159961,1.05876],[-1.274,2.25,-.264875],[-1.274,2.25,.264875],[-1.27348,2.32383,-.541834],[-1.27348,2.32383,.541834],[-1.26766,2.2749,-.130448],[-1.26766,2.2749,.130448],[-1.26567,.670825,-1.53297],[-1.26567,.670825,1.53297],[-1.26094,2.2998,0],[-1.25883,.925195,-1.52469],[-1.25883,.925195,1.52469],[-1.25057,2.33613,-.680997],[-1.25057,2.33613,.680997],[-1.24688,0,-.84375],[-1.24688,0,.84375],[-1.24688,2.25,-.84375],[-1.24688,2.25,.84375],[-1.2425,.234375,-1.2425],[-1.2425,.234375,1.2425],[-1.24081,.522583,-1.50287],[-1.24081,.522583,1.50287],[-1.23572,2.2998,-.256916],[-1.23572,2.2998,.256916],[-1.22043,2.33613,-.664583],[-1.22043,2.33613,.664583],[-1.21906,2.28691,-.663837],[-1.21906,2.28691,.663837],[-1.21805,2.2749,-.38174],[-1.21805,2.2749,.38174],[-1.20912,1.28613,-1.46449],[-1.20912,1.28613,1.46449],[-1.20466,2.32383,-.815186],[-1.20466,2.32383,.815186],[-1.19925,2.25,-.51025],[-1.19925,2.25,.51025],[-1.19651,2.31943,-.123125],[-1.19651,2.31943,.123125],[-1.18604,.042773,-.979229],[-1.18604,.042773,.979229],[-1.16812,.343945,-1.41482],[-1.16812,.343945,1.41482],[-1.16635,2.34844,-.789258],[-1.16635,2.34844,.789258],[-1.16375,2.25,-.7875],[-1.16375,2.25,.7875],[-1.16322,2.2998,-.494918],[-1.16322,2.2998,.494918],[-1.15625,2.33906,0],[-1.14968,2.31943,-.360312],[-1.14968,2.31943,.360312],[-1.14752,2.32383,-.776514],[-1.14752,2.32383,.776514],[-1.13637,2.28691,-.93822],[-1.13637,2.28691,.93822],[-1.13312,2.33906,-.235586],[-1.13312,2.33906,.235586],[-1.125,.75,-1.6625],[-1.125,.75,1.6625],[-1.12281,2.2749,-.611424],[-1.12281,2.2749,.611424],[-1.12047,.085547,-1.12047],[-1.12047,.085547,1.12047],[-1.11292,.59165,-1.64464],[-1.11292,.59165,1.64464],[-1.10083,1.10039,-1.62678],[-1.10083,1.10039,1.62678],[-1.09904,2.33613,-.907402],[-1.09904,2.33613,.907402],[-1.08106,.453516,-1.59756],[-1.08106,.453516,1.59756],[-1.08063,2.25,-.73125],[-1.08063,2.25,.73125],[-1.07255,2.33613,-.885531],[-1.07255,2.33613,.885531],[-1.07135,2.28691,-.884537],[-1.07135,2.28691,.884537],[-1.06664,2.33906,-.453828],[-1.06664,2.33906,.453828],[-1.065,0,-1.065],[-1.065,0,1.065],[-1.065,2.25,-1.065],[-1.065,2.25,1.065],[-1.06373,1.86094,-1.28839],[-1.06373,1.86094,1.28839],[-1.05979,2.31943,-.577104],[-1.05979,2.31943,.577104],[-1.05876,.159961,-1.28237],[-1.05876,.159961,1.28237],[-1.04815,2.2998,-.709277],[-1.04815,2.2998,.709277],[-1.03711,1.47187,-1.53262],[-1.03711,1.47187,1.53262],[-1.02894,2.32383,-1.02894],[-1.02894,2.32383,1.02894],[-.996219,2.34844,-.996219],[-.996219,2.34844,.996219],[-.994,2.25,-.994],[-.994,2.25,.994],[-.986761,2.2749,-.814698],[-.986761,2.2749,.814698],[-.984375,.234375,-1.45469],[-.984375,.234375,1.45469],[-.980719,2.36953,-.10092],[-.980719,2.36953,.10092],[-.980133,2.32383,-.980133],[-.980133,2.32383,.980133],[-.979229,.042773,-1.18604],[-.979229,.042773,1.18604],[-.961133,2.33906,-.650391],[-.961133,2.33906,.650391],[-.949871,.670825,-1.74433],[-.949871,.670825,1.74433],[-.944741,.925195,-1.73491],[-.944741,.925195,1.73491],[-.942332,2.36953,-.29533],[-.942332,2.36953,.29533],[-.93822,2.28691,-1.13637],[-.93822,2.28691,1.13637],[-.931373,2.31943,-.768968],[-.931373,2.31943,.768968],[-.931218,.522583,-1.71008],[-.931218,.522583,1.71008],[-.923,2.25,-.923],[-.923,2.25,.923],[-.907437,1.28613,-1.6664],[-.907437,1.28613,1.6664],[-.907402,2.33613,-1.09904],[-.907402,2.33613,1.09904],[-.895266,2.2998,-.895266],[-.895266,2.2998,.895266],[-.887695,.085547,-1.31182],[-.887695,.085547,1.31182],[-.885531,2.33613,-1.07255],[-.885531,2.33613,1.07255],[-.884537,2.28691,-1.07135],[-.884537,2.28691,1.07135],[-.87666,.343945,-1.60989],[-.87666,.343945,1.60989],[-.868654,2.36953,-.473023],[-.868654,2.36953,.473023],[-.84375,0,-1.24688],[-.84375,0,1.24688],[-.84375,2.25,-1.24688],[-.84375,2.25,1.24688],[-.825,2.4,0],[-.820938,2.33906,-.820938],[-.820938,2.33906,.820938],[-.815186,2.32383,-1.20466],[-.815186,2.32383,1.20466],[-.814698,2.2749,-.986761],[-.814698,2.2749,.986761],[-.8085,2.4,-.168094],[-.8085,2.4,.168094],[-.79832,1.86094,-1.46602],[-.79832,1.86094,1.46602],[-.79459,.159961,-1.45917],[-.79459,.159961,1.45917],[-.789258,2.34844,-1.16635],[-.789258,2.34844,1.16635],[-.7875,2.25,-1.16375],[-.7875,2.25,1.16375],[-.785,.75,-1.845],[-.785,.75,1.845],[-.776567,.59165,-1.82518],[-.776567,.59165,1.82518],[-.776514,2.32383,-1.14752],[-.776514,2.32383,1.14752],[-.768968,2.31943,-.931373],[-.768968,2.31943,.931373],[-.768135,1.10039,-1.80536],[-.768135,1.10039,1.80536],[-.7634,2.36953,-.630285],[-.7634,2.36953,.630285],[-.761063,2.4,-.323813],[-.761063,2.4,.323813],[-.754336,.453516,-1.77293],[-.754336,.453516,1.77293],[-.734902,.042773,-1.34957],[-.734902,.042773,1.34957],[-.73125,2.25,-1.08063],[-.73125,2.25,1.08063],[-.723672,1.47187,-1.70086],[-.723672,1.47187,1.70086],[-.709277,2.2998,-1.04815],[-.709277,2.2998,1.04815],[-.704126,2.28691,-1.29305],[-.704126,2.28691,1.29305],[-.686875,.234375,-1.61437],[-.686875,.234375,1.61437],[-.685781,2.4,-.464063],[-.685781,2.4,.464063],[-.680997,2.33613,-1.25057],[-.680997,2.33613,1.25057],[-.664583,2.33613,-1.22043],[-.664583,2.33613,1.22043],[-.663837,2.28691,-1.21906],[-.663837,2.28691,1.21906],[-.650391,2.33906,-.961133],[-.650391,2.33906,.961133],[-.631998,2.43047,-.064825],[-.631998,2.43047,.064825],[-.630285,2.36953,-.7634],[-.630285,2.36953,.7634],[-.619414,.085547,-1.45582],[-.619414,.085547,1.45582],[-.611424,2.2749,-1.12281],[-.611424,2.2749,1.12281],[-.607174,2.43047,-.190548],[-.607174,2.43047,.190548],[-.593047,.670825,-1.89228],[-.593047,.670825,1.89228],[-.589845,.925195,-1.88206],[-.589845,.925195,1.88206],[-.58875,0,-1.38375],[-.58875,0,1.38375],[-.58875,2.25,-1.38375],[-.58875,2.25,1.38375],[-.58575,2.4,-.58575],[-.58575,2.4,.58575],[-.581402,.522583,-1.85512],[-.581402,.522583,1.85512],[-.577104,2.31943,-1.05979],[-.577104,2.31943,1.05979],[-.568818,2.32383,-1.3369],[-.568818,2.32383,1.3369],[-.566554,1.28613,-1.80775],[-.566554,1.28613,1.80775],[-.559973,2.43047,-.304711],[-.559973,2.43047,.304711],[-.550727,2.34844,-1.29438],[-.550727,2.34844,1.29438],[-.5495,2.25,-1.2915],[-.5495,2.25,1.2915],[-.547339,.343945,-1.74644],[-.547339,.343945,1.74644],[-.541834,2.32383,-1.27348],[-.541834,2.32383,1.27348],[-.51025,2.25,-1.19925],[-.51025,2.25,1.19925],[-.498428,1.86094,-1.59037],[-.498428,1.86094,1.59037],[-.496099,.159961,-1.58294],[-.496099,.159961,1.58294],[-.494918,2.2998,-1.16322],[-.494918,2.2998,1.16322],[-.491907,2.43047,-.40641],[-.491907,2.43047,.40641],[-.473023,2.36953,-.868654],[-.473023,2.36953,.868654],[-.464063,2.4,-.685781],[-.464063,2.4,.685781],[-.458833,.042773,-1.46403],[-.458833,.042773,1.46403],[-.45625,2.46094,0],[-.453828,2.33906,-1.06664],[-.453828,2.33906,1.06664],[-.439618,2.28691,-1.40272],[-.439618,2.28691,1.40272],[-.438241,2.46094,-.091207],[-.438241,2.46094,.091207],[-.425177,2.33613,-1.35665],[-.425177,2.33613,1.35665],[-.420891,2.46094,-.179078],[-.420891,2.46094,.179078],[-.414929,2.33613,-1.32395],[-.414929,2.33613,1.32395],[-.414464,2.28691,-1.32246],[-.414464,2.28691,1.32246],[-.4075,.75,-1.96],[-.4075,.75,1.96],[-.40641,2.43047,-.491907],[-.40641,2.43047,.491907],[-.403123,.59165,-1.93895],[-.403123,.59165,1.93895],[-.398745,1.10039,-1.91789],[-.398745,1.10039,1.91789],[-.391582,.453516,-1.88344],[-.391582,.453516,1.88344],[-.38174,2.2749,-1.21805],[-.38174,2.2749,1.21805],[-.375664,1.47187,-1.80687],[-.375664,1.47187,1.80687],[-.372159,2.46094,-.251889],[-.372159,2.46094,.251889],[-.362109,2.89717,0],[-.360312,2.31943,-1.14968],[-.360312,2.31943,1.14968],[-.356563,.234375,1.715],[-.356562,.234375,-1.715],[-.340625,2.95078,0],[-.337859,2.92397,-.069278],[-.337859,2.92397,.069278],[-.334238,2.89717,-.142705],[-.334238,2.89717,.142705],[-.330325,2.86421,-.067672],[-.330325,2.86421,.067672],[-.325,2.83125,0],[-.323938,2.46094,-.323938],[-.323938,2.46094,.323938],[-.323813,2.4,-.761063],[-.323813,2.4,.761063],[-.321543,.085547,-1.54656],[-.321543,.085547,1.54656],[-.31541,2.50547,-.064395],[-.31541,2.50547,.064395],[-.314464,2.95078,-.134407],[-.314464,2.95078,.134407],[-.305625,0,-1.47],[-.305625,0,1.47],[-.305625,2.25,-1.47],[-.305625,2.25,1.47],[-.304711,2.43047,-.559973],[-.304711,2.43047,.559973],[-.299953,2.83125,-.127984],[-.299953,2.83125,.127984],[-.29533,2.36953,-.942332],[-.29533,2.36953,.942332],[-.295278,2.32383,-1.42023],[-.295278,2.32383,1.42023],[-.287197,2.92397,-.1943],[-.287197,2.92397,.1943],[-.285887,2.34844,-1.37506],[-.285887,2.34844,1.37506],[-.28525,2.25,-1.372],[-.28525,2.25,1.372],[-.281271,2.32383,-1.35286],[-.281271,2.32383,1.35286],[-.280732,2.86421,-.189856],[-.280732,2.86421,.189856],[-.274421,2.9688,-.05638],[-.274421,2.9688,.05638],[-.267832,2.50547,-.180879],[-.267832,2.50547,.180879],[-.264875,2.25,-1.274],[-.264875,2.25,1.274],[-.25761,2.89717,-.25761],[-.25761,2.89717,.25761],[-.256916,2.2998,-1.23572],[-.256916,2.2998,1.23572],[-.251889,2.46094,-.372159],[-.251889,2.46094,.372159],[-.250872,2.75742,-.051347],[-.250872,2.75742,.051347],[-.242477,2.95078,-.242477],[-.242477,2.95078,.242477],[-.235586,2.33906,-1.13312],[-.235586,2.33906,1.13312],[-.233382,2.9688,-.158018],[-.233382,2.9688,.158018],[-.231125,2.83125,-.231125],[-.231125,2.83125,.231125],[-.230078,2.98682,0],[-.213159,2.75742,-.144103],[-.213159,2.75742,.144103],[-.212516,2.98682,-.091113],[-.212516,2.98682,.091113],[-.202656,.670825,-1.96937],[-.202656,.670825,1.96937],[-.201561,.925195,-1.95873],[-.201561,.925195,1.95873],[-.2,2.55,0],[-.198676,.522583,-1.93069],[-.198676,.522583,1.93069],[-.196875,2.68359,0],[-.1943,2.92397,-.287197],[-.1943,2.92397,.287197],[-.193602,1.28613,-1.88139],[-.193602,1.28613,1.88139],[-.190548,2.43047,-.607174],[-.190548,2.43047,.607174],[-.189856,2.86421,-.280732],[-.189856,2.86421,.280732],[-.187036,.343945,-1.81758],[-.187036,.343945,1.81758],[-.1845,2.55,-.0785],[-.1845,2.55,.0785],[-.181661,2.68359,-.077405],[-.181661,2.68359,.077405],[-.180879,2.50547,-.267832],[-.180879,2.50547,.267832],[-.179078,2.46094,-.420891],[-.179078,2.46094,.420891],[-.176295,2.5812,-.036001],[-.176295,2.5812,.036001],[-.174804,2.648,-.035727],[-.174804,2.648,.035727],[-.170322,1.86094,-1.65516],[-.170322,1.86094,1.65516],[-.169526,.159961,-1.64742],[-.169526,.159961,1.64742],[-.168094,2.4,-.8085],[-.168094,2.4,.8085],[-.166797,2.6124,0],[-.164073,2.98682,-.164073],[-.164073,2.98682,.164073],[-.158018,2.9688,-.233382],[-.158018,2.9688,.233382],[-.156792,.042773,-1.52367],[-.156792,.042773,1.52367],[-.153882,2.6124,-.065504],[-.153882,2.6124,.065504],[-.150226,2.28691,-1.45986],[-.150226,2.28691,1.45986],[-.14971,2.5812,-.101116],[-.14971,2.5812,.101116],[-.148475,2.648,-.100316],[-.148475,2.648,.100316],[-.145291,2.33613,-1.41191],[-.145291,2.33613,1.41191],[-.144103,2.75742,-.213159],[-.144103,2.75742,.213159],[-.142705,2.89717,-.334238],[-.142705,2.89717,.334238],[-.142,2.55,-.142],[-.142,2.55,.142],[-.141789,2.33613,-1.37788],[-.141789,2.33613,1.37788],[-.14163,2.28691,-1.37633],[-.14163,2.28691,1.37633],[-.139898,2.68359,-.139898],[-.139898,2.68359,.139898],[-.134407,2.95078,-.314464],[-.134407,2.95078,.314464],[-.130448,2.2749,-1.26766],[-.130448,2.2749,1.26766],[-.127984,2.83125,-.299953],[-.127984,2.83125,.299953],[-.123125,2.31943,-1.19651],[-.123125,2.31943,1.19651],[-.118458,2.6124,-.118458],[-.118458,2.6124,.118458],[-.110649,2.99341,-.022778],[-.110649,2.99341,.022778],[-.101116,2.5812,-.14971],[-.101116,2.5812,.14971],[-.10092,2.36953,-.980719],[-.10092,2.36953,.980719],[-.100316,2.648,-.148475],[-.100316,2.648,.148475],[-.094147,2.99341,-.063797],[-.094147,2.99341,.063797],[-.091207,2.46094,-.438241],[-.091207,2.46094,.438241],[-.091113,2.98682,-.212516],[-.091113,2.98682,.212516],[-.0785,2.55,-.1845],[-.0785,2.55,.1845],[-.077405,2.68359,-.181661],[-.077405,2.68359,.181661],[-.069278,2.92397,-.337859],[-.069278,2.92397,.337859],[-.067672,2.86421,-.330325],[-.067672,2.86421,.330325],[-.065504,2.6124,-.153882],[-.065504,2.6124,.153882],[-.064825,2.43047,-.631998],[-.064825,2.43047,.631998],[-.064395,2.50547,-.31541],[-.064395,2.50547,.31541],[-.063797,2.99341,-.094147],[-.063797,2.99341,.094147],[-.05638,2.9688,-.274421],[-.05638,2.9688,.274421],[-.051347,2.75742,-.250872],[-.051347,2.75742,.250872],[-.036001,2.5812,-.176295],[-.036001,2.5812,.176295],[-.035727,2.648,-.174804],[-.035727,2.648,.174804],[-.022778,2.99341,-.110649],[-.022778,2.99341,.110649],[0,0,-1.5],[0,0,1.5],[0,.085547,-1.57813],[0,.085547,1.57813],[0,.234375,-1.75],[0,.234375,1.75],[0,.453516,-1.92188],[0,.453516,1.92188],[0,.59165,-1.97852],[0,.59165,1.97852],[0,.75,-2],[0,.75,2],[0,1.10039,-1.95703],[0,1.10039,1.95703],[0,1.47187,-1.84375],[0,1.47187,1.84375],[0,2.25,-1.5],[0,2.25,-1.4],[0,2.25,-1.3],[0,2.25,1.3],[0,2.25,1.4],[0,2.25,1.5],[0,2.2998,-1.26094],[0,2.2998,1.26094],[0,2.32383,-1.44922],[0,2.32383,-1.38047],[0,2.32383,1.38047],[0,2.32383,1.44922],[0,2.33906,-1.15625],[0,2.33906,1.15625],[0,2.34844,-1.40313],[0,2.34844,1.40313],[0,2.4,-.825],[0,2.4,.825],[0,2.46094,-.45625],[0,2.46094,.45625],[0,2.55,-.2],[0,2.55,.2],[0,2.6124,-.166797],[0,2.6124,.166797],[0,2.68359,-.196875],[0,2.68359,.196875],[0,2.83125,-.325],[0,2.83125,.325],[0,2.89717,-.362109],[0,2.89717,.362109],[0,2.95078,-.340625],[0,2.95078,.340625],[0,2.98682,-.230078],[0,2.98682,.230078],[0,3,0],[.022778,2.99341,-.110649],[.022778,2.99341,.110649],[.035727,2.648,-.174804],[.035727,2.648,.174804],[.036001,2.5812,-.176295],[.036001,2.5812,.176295],[.051347,2.75742,-.250872],[.051347,2.75742,.250872],[.05638,2.9688,-.274421],[.05638,2.9688,.274421],[.063797,2.99341,-.094147],[.063797,2.99341,.094147],[.064395,2.50547,-.31541],[.064395,2.50547,.31541],[.064825,2.43047,-.631998],[.064825,2.43047,.631998],[.065504,2.6124,-.153882],[.065504,2.6124,.153882],[.067672,2.86421,-.330325],[.067672,2.86421,.330325],[.069278,2.92397,-.337859],[.069278,2.92397,.337859],[.077405,2.68359,-.181661],[.077405,2.68359,.181661],[.0785,2.55,-.1845],[.0785,2.55,.1845],[.091113,2.98682,-.212516],[.091113,2.98682,.212516],[.091207,2.46094,-.438241],[.091207,2.46094,.438241],[.094147,2.99341,-.063797],[.094147,2.99341,.063797],[.100316,2.648,-.148475],[.100316,2.648,.148475],[.10092,2.36953,-.980719],[.10092,2.36953,.980719],[.101116,2.5812,-.14971],[.101116,2.5812,.14971],[.110649,2.99341,-.022778],[.110649,2.99341,.022778],[.118458,2.6124,-.118458],[.118458,2.6124,.118458],[.123125,2.31943,-1.19651],[.123125,2.31943,1.19651],[.127984,2.83125,-.299953],[.127984,2.83125,.299953],[.130448,2.2749,-1.26766],[.130448,2.2749,1.26766],[.134407,2.95078,-.314464],[.134407,2.95078,.314464],[.139898,2.68359,-.139898],[.139898,2.68359,.139898],[.14163,2.28691,-1.37633],[.14163,2.28691,1.37633],[.141789,2.33613,-1.37788],[.141789,2.33613,1.37788],[.142,2.55,-.142],[.142,2.55,.142],[.142705,2.89717,-.334238],[.142705,2.89717,.334238],[.144103,2.75742,-.213159],[.144103,2.75742,.213159],[.145291,2.33613,-1.41191],[.145291,2.33613,1.41191],[.148475,2.648,-.100316],[.148475,2.648,.100316],[.14971,2.5812,-.101116],[.14971,2.5812,.101116],[.150226,2.28691,-1.45986],[.150226,2.28691,1.45986],[.153882,2.6124,-.065504],[.153882,2.6124,.065504],[.156792,.042773,-1.52367],[.156792,.042773,1.52367],[.158018,2.9688,-.233382],[.158018,2.9688,.233382],[.164073,2.98682,-.164073],[.164073,2.98682,.164073],[.166797,2.6124,0],[.168094,2.4,-.8085],[.168094,2.4,.8085],[.169526,.159961,-1.64742],[.169526,.159961,1.64742],[.170322,1.86094,-1.65516],[.170322,1.86094,1.65516],[.174804,2.648,-.035727],[.174804,2.648,.035727],[.176295,2.5812,-.036001],[.176295,2.5812,.036001],[.179078,2.46094,-.420891],[.179078,2.46094,.420891],[.180879,2.50547,-.267832],[.180879,2.50547,.267832],[.181661,2.68359,-.077405],[.181661,2.68359,.077405],[.1845,2.55,-.0785],[.1845,2.55,.0785],[.187036,.343945,-1.81758],[.187036,.343945,1.81758],[.189856,2.86421,-.280732],[.189856,2.86421,.280732],[.190548,2.43047,-.607174],[.190548,2.43047,.607174],[.193602,1.28613,-1.88139],[.193602,1.28613,1.88139],[.1943,2.92397,-.287197],[.1943,2.92397,.287197],[.196875,2.68359,0],[.198676,.522583,-1.93069],[.198676,.522583,1.93069],[.2,2.55,0],[.201561,.925195,-1.95873],[.201561,.925195,1.95873],[.202656,.670825,-1.96937],[.202656,.670825,1.96937],[.212516,2.98682,-.091113],[.212516,2.98682,.091113],[.213159,2.75742,-.144103],[.213159,2.75742,.144103],[.230078,2.98682,0],[.231125,2.83125,-.231125],[.231125,2.83125,.231125],[.233382,2.9688,-.158018],[.233382,2.9688,.158018],[.235586,2.33906,-1.13312],[.235586,2.33906,1.13312],[.242477,2.95078,-.242477],[.242477,2.95078,.242477],[.250872,2.75742,-.051347],[.250872,2.75742,.051347],[.251889,2.46094,-.372159],[.251889,2.46094,.372159],[.256916,2.2998,-1.23572],[.256916,2.2998,1.23572],[.25761,2.89717,-.25761],[.25761,2.89717,.25761],[.264875,2.25,-1.274],[.264875,2.25,1.274],[.267832,2.50547,-.180879],[.267832,2.50547,.180879],[.274421,2.9688,-.05638],[.274421,2.9688,.05638],[.280732,2.86421,-.189856],[.280732,2.86421,.189856],[.281271,2.32383,-1.35286],[.281271,2.32383,1.35286],[.28525,2.25,-1.372],[.28525,2.25,1.372],[.285887,2.34844,-1.37506],[.285887,2.34844,1.37506],[.287197,2.92397,-.1943],[.287197,2.92397,.1943],[.295278,2.32383,-1.42023],[.295278,2.32383,1.42023],[.29533,2.36953,-.942332],[.29533,2.36953,.942332],[.299953,2.83125,-.127984],[.299953,2.83125,.127984],[.304711,2.43047,-.559973],[.304711,2.43047,.559973],[.305625,0,-1.47],[.305625,0,1.47],[.305625,2.25,-1.47],[.305625,2.25,1.47],[.314464,2.95078,-.134407],[.314464,2.95078,.134407],[.31541,2.50547,-.064395],[.31541,2.50547,.064395],[.321543,.085547,-1.54656],[.321543,.085547,1.54656],[.323813,2.4,-.761063],[.323813,2.4,.761063],[.323938,2.46094,-.323938],[.323938,2.46094,.323938],[.325,2.83125,0],[.330325,2.86421,-.067672],[.330325,2.86421,.067672],[.334238,2.89717,-.142705],[.334238,2.89717,.142705],[.337859,2.92397,-.069278],[.337859,2.92397,.069278],[.340625,2.95078,0],[.356562,.234375,1.715],[.356563,.234375,-1.715],[.360312,2.31943,-1.14968],[.360312,2.31943,1.14968],[.362109,2.89717,0],[.372159,2.46094,-.251889],[.372159,2.46094,.251889],[.375664,1.47187,-1.80687],[.375664,1.47187,1.80687],[.38174,2.2749,-1.21805],[.38174,2.2749,1.21805],[.391582,.453516,-1.88344],[.391582,.453516,1.88344],[.398745,1.10039,-1.91789],[.398745,1.10039,1.91789],[.403123,.59165,-1.93895],[.403123,.59165,1.93895],[.40641,2.43047,-.491907],[.40641,2.43047,.491907],[.4075,.75,-1.96],[.4075,.75,1.96],[.414464,2.28691,-1.32246],[.414464,2.28691,1.32246],[.414929,2.33613,-1.32395],[.414929,2.33613,1.32395],[.420891,2.46094,-.179078],[.420891,2.46094,.179078],[.425177,2.33613,-1.35665],[.425177,2.33613,1.35665],[.438241,2.46094,-.091207],[.438241,2.46094,.091207],[.439618,2.28691,-1.40272],[.439618,2.28691,1.40272],[.453828,2.33906,-1.06664],[.453828,2.33906,1.06664],[.45625,2.46094,0],[.458833,.042773,-1.46403],[.458833,.042773,1.46403],[.464063,2.4,-.685781],[.464063,2.4,.685781],[.473023,2.36953,-.868654],[.473023,2.36953,.868654],[.491907,2.43047,-.40641],[.491907,2.43047,.40641],[.494918,2.2998,-1.16322],[.494918,2.2998,1.16322],[.496099,.159961,-1.58294],[.496099,.159961,1.58294],[.498428,1.86094,-1.59037],[.498428,1.86094,1.59037],[.51025,2.25,-1.19925],[.51025,2.25,1.19925],[.541834,2.32383,-1.27348],[.541834,2.32383,1.27348],[.547339,.343945,-1.74644],[.547339,.343945,1.74644],[.5495,2.25,-1.2915],[.5495,2.25,1.2915],[.550727,2.34844,-1.29438],[.550727,2.34844,1.29438],[.559973,2.43047,-.304711],[.559973,2.43047,.304711],[.566554,1.28613,-1.80775],[.566554,1.28613,1.80775],[.568818,2.32383,-1.3369],[.568818,2.32383,1.3369],[.577104,2.31943,-1.05979],[.577104,2.31943,1.05979],[.581402,.522583,-1.85512],[.581402,.522583,1.85512],[.58575,2.4,-.58575],[.58575,2.4,.58575],[.58875,0,-1.38375],[.58875,0,1.38375],[.58875,2.25,-1.38375],[.58875,2.25,1.38375],[.589845,.925195,-1.88206],[.589845,.925195,1.88206],[.593047,.670825,-1.89228],[.593047,.670825,1.89228],[.607174,2.43047,-.190548],[.607174,2.43047,.190548],[.611424,2.2749,-1.12281],[.611424,2.2749,1.12281],[.619414,.085547,-1.45582],[.619414,.085547,1.45582],[.630285,2.36953,-.7634],[.630285,2.36953,.7634],[.631998,2.43047,-.064825],[.631998,2.43047,.064825],[.650391,2.33906,-.961133],[.650391,2.33906,.961133],[.663837,2.28691,-1.21906],[.663837,2.28691,1.21906],[.664583,2.33613,-1.22043],[.664583,2.33613,1.22043],[.680997,2.33613,-1.25057],[.680997,2.33613,1.25057],[.685781,2.4,-.464063],[.685781,2.4,.464063],[.686875,.234375,-1.61437],[.686875,.234375,1.61437],[.704126,2.28691,-1.29305],[.704126,2.28691,1.29305],[.709277,2.2998,-1.04815],[.709277,2.2998,1.04815],[.723672,1.47187,-1.70086],[.723672,1.47187,1.70086],[.73125,2.25,-1.08063],[.73125,2.25,1.08063],[.734902,.042773,-1.34957],[.734902,.042773,1.34957],[.754336,.453516,-1.77293],[.754336,.453516,1.77293],[.761063,2.4,-.323813],[.761063,2.4,.323813],[.7634,2.36953,-.630285],[.7634,2.36953,.630285],[.768135,1.10039,-1.80536],[.768135,1.10039,1.80536],[.768968,2.31943,-.931373],[.768968,2.31943,.931373],[.776514,2.32383,-1.14752],[.776514,2.32383,1.14752],[.776567,.59165,-1.82518],[.776567,.59165,1.82518],[.785,.75,-1.845],[.785,.75,1.845],[.7875,2.25,-1.16375],[.7875,2.25,1.16375],[.789258,2.34844,-1.16635],[.789258,2.34844,1.16635],[.79459,.159961,-1.45917],[.79459,.159961,1.45917],[.79832,1.86094,-1.46602],[.79832,1.86094,1.46602],[.8085,2.4,-.168094],[.8085,2.4,.168094],[.814698,2.2749,-.986761],[.814698,2.2749,.986761],[.815186,2.32383,-1.20466],[.815186,2.32383,1.20466],[.820938,2.33906,-.820938],[.820938,2.33906,.820938],[.825,2.4,0],[.84375,0,-1.24688],[.84375,0,1.24688],[.84375,2.25,-1.24688],[.84375,2.25,1.24688],[.868654,2.36953,-.473023],[.868654,2.36953,.473023],[.87666,.343945,-1.60989],[.87666,.343945,1.60989],[.884537,2.28691,-1.07135],[.884537,2.28691,1.07135],[.885531,2.33613,-1.07255],[.885531,2.33613,1.07255],[.887695,.085547,-1.31182],[.887695,.085547,1.31182],[.895266,2.2998,-.895266],[.895266,2.2998,.895266],[.907402,2.33613,-1.09904],[.907402,2.33613,1.09904],[.907437,1.28613,-1.6664],[.907437,1.28613,1.6664],[.923,2.25,-.923],[.923,2.25,.923],[.931218,.522583,-1.71008],[.931218,.522583,1.71008],[.931373,2.31943,-.768968],[.931373,2.31943,.768968],[.93822,2.28691,-1.13637],[.93822,2.28691,1.13637],[.942332,2.36953,-.29533],[.942332,2.36953,.29533],[.944741,.925195,-1.73491],[.944741,.925195,1.73491],[.949871,.670825,-1.74433],[.949871,.670825,1.74433],[.961133,2.33906,-.650391],[.961133,2.33906,.650391],[.979229,.042773,-1.18604],[.979229,.042773,1.18604],[.980133,2.32383,-.980133],[.980133,2.32383,.980133],[.980719,2.36953,-.10092],[.980719,2.36953,.10092],[.984375,.234375,-1.45469],[.984375,.234375,1.45469],[.986761,2.2749,-.814698],[.986761,2.2749,.814698],[.994,2.25,-.994],[.994,2.25,.994],[.996219,2.34844,-.996219],[.996219,2.34844,.996219],[1.02894,2.32383,-1.02894],[1.02894,2.32383,1.02894],[1.03711,1.47187,-1.53262],[1.03711,1.47187,1.53262],[1.04815,2.2998,-.709277],[1.04815,2.2998,.709277],[1.05876,.159961,-1.28237],[1.05876,.159961,1.28237],[1.05979,2.31943,-.577104],[1.05979,2.31943,.577104],[1.06373,1.86094,-1.28839],[1.06373,1.86094,1.28839],[1.065,0,-1.065],[1.065,0,1.065],[1.065,2.25,-1.065],[1.065,2.25,1.065],[1.06664,2.33906,-.453828],[1.06664,2.33906,.453828],[1.07135,2.28691,-.884537],[1.07135,2.28691,.884537],[1.07255,2.33613,-.885531],[1.07255,2.33613,.885531],[1.08063,2.25,-.73125],[1.08063,2.25,.73125],[1.08106,.453516,-1.59756],[1.08106,.453516,1.59756],[1.09904,2.33613,-.907402],[1.09904,2.33613,.907402],[1.10083,1.10039,-1.62678],[1.10083,1.10039,1.62678],[1.11292,.59165,-1.64464],[1.11292,.59165,1.64464],[1.12047,.085547,-1.12047],[1.12047,.085547,1.12047],[1.12281,2.2749,-.611424],[1.12281,2.2749,.611424],[1.125,.75,-1.6625],[1.125,.75,1.6625],[1.13312,2.33906,-.235586],[1.13312,2.33906,.235586],[1.13637,2.28691,-.93822],[1.13637,2.28691,.93822],[1.14752,2.32383,-.776514],[1.14752,2.32383,.776514],[1.14968,2.31943,-.360312],[1.14968,2.31943,.360312],[1.15625,2.33906,0],[1.16322,2.2998,-.494918],[1.16322,2.2998,.494918],[1.16375,2.25,-.7875],[1.16375,2.25,.7875],[1.16635,2.34844,-.789258],[1.16635,2.34844,.789258],[1.16812,.343945,-1.41482],[1.16812,.343945,1.41482],[1.18604,.042773,-.979229],[1.18604,.042773,.979229],[1.19651,2.31943,-.123125],[1.19651,2.31943,.123125],[1.19925,2.25,-.51025],[1.19925,2.25,.51025],[1.20466,2.32383,-.815186],[1.20466,2.32383,.815186],[1.20912,1.28613,-1.46449],[1.20912,1.28613,1.46449],[1.21805,2.2749,-.38174],[1.21805,2.2749,.38174],[1.21906,2.28691,-.663837],[1.21906,2.28691,.663837],[1.22043,2.33613,-.664583],[1.22043,2.33613,.664583],[1.23572,2.2998,-.256916],[1.23572,2.2998,.256916],[1.24081,.522583,-1.50287],[1.24081,.522583,1.50287],[1.2425,.234375,-1.2425],[1.2425,.234375,1.2425],[1.24688,0,-.84375],[1.24688,0,.84375],[1.24688,2.25,-.84375],[1.24688,2.25,.84375],[1.25057,2.33613,-.680997],[1.25057,2.33613,.680997],[1.25883,.925195,-1.52469],[1.25883,.925195,1.52469],[1.26094,2.2998,0],[1.26567,.670825,-1.53297],[1.26567,.670825,1.53297],[1.26766,2.2749,-.130448],[1.26766,2.2749,.130448],[1.27348,2.32383,-.541834],[1.27348,2.32383,.541834],[1.274,2.25,-.264875],[1.274,2.25,.264875],[1.28237,.159961,-1.05876],[1.28237,.159961,1.05876],[1.28839,1.86094,-1.06373],[1.28839,1.86094,1.06373],[1.2915,2.25,-.5495],[1.2915,2.25,.5495],[1.29305,2.28691,-.704126],[1.29305,2.28691,.704126],[1.29438,2.34844,-.550727],[1.29438,2.34844,.550727],[1.3,2.25,0],[1.30906,1.47187,-1.30906],[1.30906,1.47187,1.30906],[1.31182,.085547,-.887695],[1.31182,.085547,.887695],[1.32246,2.28691,-.414464],[1.32246,2.28691,.414464],[1.32395,2.33613,-.414929],[1.32395,2.33613,.414929],[1.3369,2.32383,-.568818],[1.3369,2.32383,.568818],[1.34957,.042773,-.734902],[1.34957,.042773,.734902],[1.35286,2.32383,-.281271],[1.35286,2.32383,.281271],[1.35665,2.33613,-.425177],[1.35665,2.33613,.425177],[1.36453,.453516,-1.36453],[1.36453,.453516,1.36453],[1.372,2.25,-.28525],[1.372,2.25,.28525],[1.37506,2.34844,-.285887],[1.37506,2.34844,.285887],[1.37633,2.28691,-.14163],[1.37633,2.28691,.14163],[1.37788,2.33613,-.141789],[1.37788,2.33613,.141789],[1.38047,2.32383,0],[1.38375,0,-.58875],[1.38375,0,.58875],[1.38375,2.25,-.58875],[1.38375,2.25,.58875],[1.38949,1.10039,-1.38949],[1.38949,1.10039,1.38949],[1.4,2.25,0],[1.40272,2.28691,-.439618],[1.40272,2.28691,.439618],[1.40313,2.34844,0],[1.40475,.59165,-1.40475],[1.40475,.59165,1.40475],[1.41191,2.33613,-.145291],[1.41191,2.33613,.145291],[1.41482,.343945,-1.16812],[1.41482,.343945,1.16812],[1.42,.75,-1.42],[1.42,.75,1.42],[1.42023,2.32383,-.295278],[1.42023,2.32383,.295278],[1.44922,2.32383,0],[1.45469,.234375,-.984375],[1.45469,.234375,.984375],[1.45582,.085547,-.619414],[1.45582,.085547,.619414],[1.45917,.159961,-.79459],[1.45917,.159961,.79459],[1.45986,2.28691,-.150226],[1.45986,2.28691,.150226],[1.46403,.042773,-.458833],[1.46403,.042773,.458833],[1.46449,1.28613,-1.20912],[1.46449,1.28613,1.20912],[1.46602,1.86094,-.79832],[1.46602,1.86094,.79832],[1.47,0,-.305625],[1.47,0,.305625],[1.47,2.25,-.305625],[1.47,2.25,.305625],[1.5,0,0],[1.5,2.25,0],[1.50287,.522583,-1.24081],[1.50287,.522583,1.24081],[1.52367,.042773,-.156792],[1.52367,.042773,.156792],[1.52469,.925195,-1.25883],[1.52469,.925195,1.25883],[1.53262,1.47187,-1.03711],[1.53262,1.47187,1.03711],[1.53297,.670825,-1.26567],[1.53297,.670825,1.26567],[1.54656,.085547,-.321543],[1.54656,.085547,.321543],[1.57813,.085547,0],[1.58294,.159961,-.496099],[1.58294,.159961,.496099],[1.59037,1.86094,-.498428],[1.59037,1.86094,.498428],[1.59756,.453516,-1.08106],[1.59756,.453516,1.08106],[1.60989,.343945,-.87666],[1.60989,.343945,.87666],[1.61437,.234375,-.686875],[1.61437,.234375,.686875],[1.62678,1.10039,-1.10083],[1.62678,1.10039,1.10083],[1.64464,.59165,-1.11292],[1.64464,.59165,1.11292],[1.64742,.159961,-.169526],[1.64742,.159961,.169526],[1.65516,1.86094,-.170322],[1.65516,1.86094,.170322],[1.6625,.75,-1.125],[1.6625,.75,1.125],[1.6664,1.28613,-.907437],[1.6664,1.28613,.907437],[1.7,.45,0],[1.7,.485449,-.216563],[1.7,.485449,.216563],[1.7,.578906,-.37125],[1.7,.578906,.37125],[1.7,.711035,-.464063],[1.7,.711035,.464063],[1.7,.8625,-.495],[1.7,.8625,.495],[1.7,1.01397,-.464063],[1.7,1.01397,.464063],[1.7,1.14609,-.37125],[1.7,1.14609,.37125],[1.7,1.23955,-.216563],[1.7,1.23955,.216563],[1.7,1.275,0],[1.70086,1.47187,-.723672],[1.70086,1.47187,.723672],[1.71008,.522583,-.931218],[1.71008,.522583,.931218],[1.715,.234375,-.356562],[1.715,.234375,.356563],[1.73491,.925195,-.944741],[1.73491,.925195,.944741],[1.74433,.670825,-.949871],[1.74433,.670825,.949871],[1.74644,.343945,-.547339],[1.74644,.343945,.547339],[1.75,.234375,0],[1.77293,.453516,-.754336],[1.77293,.453516,.754336],[1.80536,1.10039,-.768135],[1.80536,1.10039,.768135],[1.80687,1.47187,-.375664],[1.80687,1.47187,.375664],[1.80775,1.28613,-.566554],[1.80775,1.28613,.566554],[1.80868,.66944,-.415335],[1.80868,.66944,.415335],[1.81523,.556498,-.292881],[1.81523,.556498,.292881],[1.81758,.343945,-.187036],[1.81758,.343945,.187036],[1.8185,.493823,-.107904],[1.8185,.493823,.107904],[1.82518,.59165,-.776567],[1.82518,.59165,.776567],[1.84375,1.47187,0],[1.84408,1.27311,-.106836],[1.84408,1.27311,.106836],[1.845,.75,-.785],[1.845,.75,.785],[1.84989,1.21245,-.289984],[1.84989,1.21245,.289984],[1.85512,.522583,-.581402],[1.85512,.522583,.581402],[1.86007,1.10628,-.412082],[1.86007,1.10628,.412082],[1.87286,.97282,-.473131],[1.87286,.97282,.473131],[1.88139,1.28613,-.193602],[1.88139,1.28613,.193602],[1.88206,.925195,-.589845],[1.88206,.925195,.589845],[1.88344,.453516,-.391582],[1.88344,.453516,.391582],[1.88652,.830257,-.473131],[1.88652,.830257,.473131],[1.89228,.670825,-.593047],[1.89228,.670825,.593047],[1.90898,.762851,-.457368],[1.90898,.762851,.457368],[1.91789,1.10039,-.398745],[1.91789,1.10039,.398745],[1.92188,.453516,0],[1.92572,.624968,-.36866],[1.92572,.624968,.36866],[1.93069,.522583,-.198676],[1.93069,.522583,.198676],[1.9352,.536667,-.215052],[1.9352,.536667,.215052],[1.93879,.503174,0],[1.93895,.59165,-.403123],[1.93895,.59165,.403123],[1.95703,1.10039,0],[1.95873,.925195,-.201561],[1.95873,.925195,.201561],[1.96,.75,-.4075],[1.96,.75,.4075],[1.96937,.670825,-.202656],[1.96937,.670825,.202656],[1.97852,.59165,0],[1.98496,1.30459,0],[1.99136,1.27331,-.210782],[1.99136,1.27331,.210782],[2,.75,0],[2.00799,.721263,-.409761],[2.00799,.721263,.409761],[2.00821,1.19084,-.36134],[2.00821,1.19084,.36134],[2.02471,.614949,-.288958],[2.02471,.614949,.288958],[2.03205,1.07424,-.451675],[2.03205,1.07424,.451675],[2.03379,.556062,-.106458],[2.03379,.556062,.106458],[2.05938,.940576,-.481787],[2.05938,.940576,.481787],[2.08644,1.33048,-.101581],[2.08644,1.33048,.101581],[2.0867,.806915,-.451675],[2.0867,.806915,.451675],[2.10141,1.27815,-.27572],[2.10141,1.27815,.27572],[2.11053,.690317,-.36134],[2.11053,.690317,.36134],[2.12739,.607845,-.210782],[2.12739,.607845,.210782],[2.1276,1.18656,-.391812],[2.1276,1.18656,.391812],[2.13379,.576563,0],[2.16054,1.07143,-.449859],[2.16054,1.07143,.449859],[2.16922,.790259,-.39936],[2.16922,.790259,.39936],[2.17969,1.38516,0],[2.18976,1.35887,-.195542],[2.18976,1.35887,.195542],[2.19481,.691761,-.281559],[2.19481,.691761,.281559],[2.19571,.948444,-.449859],[2.19571,.948444,.449859],[2.20837,.637082,-.103732],[2.20837,.637082,.103732],[2.21631,1.28957,-.335215],[2.21631,1.28957,.335215],[2.2202,.891314,-.434457],[2.2202,.891314,.434457],[2.24857,1.433,-.092384],[2.24857,1.433,.092384],[2.25384,1.1916,-.419019],[2.25384,1.1916,.419019],[2.25944,.772489,-.349967],[2.25944,.772489,.349967],[2.26857,1.39016,-.250758],[2.26857,1.39016,.250758],[2.28189,.696393,-.204147],[2.28189,.696393,.204147],[2.29041,.667529,0],[2.29688,1.0793,-.446953],[2.29688,1.0793,.446953],[2.29925,.874953,-.384664],[2.29925,.874953,.384664],[2.30358,1.3152,-.35634],[2.30358,1.3152,.35634],[2.30644,1.5044,0],[2.31838,1.48356,-.173996],[2.31838,1.48356,.173996],[2.33069,.784406,-.271218],[2.33069,.784406,.271218],[2.33991,.966989,-.419019],[2.33991,.966989,.419019],[2.34759,.734271,-.099922],[2.34759,.734271,.099922],[2.34759,1.22096,-.409131],[2.34759,1.22096,.409131],[2.34984,1.42864,-.298279],[2.34984,1.42864,.298279],[2.35318,1.56816,-.080823],[2.35318,1.56816,.080823],[2.37575,1.53531,-.219377],[2.37575,1.53531,.219377],[2.37744,.869019,-.335215],[2.37744,.869019,.335215],[2.3875,1.65,0],[2.39432,1.35098,-.372849],[2.39432,1.35098,.372849],[2.3946,1.1203,-.409131],[2.3946,1.1203,.409131],[2.40039,1.63469,-.149297],[2.40039,1.63469,.149297],[2.40399,.799722,-.195542],[2.40399,.799722,.195542],[2.41406,.773438,0],[2.41524,1.47781,-.311747],[2.41524,1.47781,.311747],[2.43438,1.59434,-.255938],[2.43438,1.59434,.255938],[2.43861,1.02606,-.35634],[2.43861,1.02606,.35634],[2.44531,1.26196,-.397705],[2.44531,1.26196,.397705],[2.45168,1.80534,-.063087],[2.45168,1.80534,.063087],[2.46489,1.40552,-.357931],[2.46489,1.40552,.357931],[2.47362,.951099,-.250758],[2.47362,.951099,.250758],[2.47768,1.78638,-.171237],[2.47768,1.78638,.171237],[2.48242,1.53728,-.319922],[2.48242,1.53728,.319922],[2.49362,.908264,-.092384],[2.49362,.908264,.092384],[2.4963,1.17295,-.372849],[2.4963,1.17295,.372849],[2.50156,1.97109,0],[2.51727,1.96555,-.103052],[2.51727,1.96555,.103052],[2.51792,1.32831,-.357931],[2.51792,1.32831,.357931],[2.52318,1.75322,-.243336],[2.52318,1.75322,.243336],[2.5375,1.47187,-.34125],[2.5375,1.47187,.34125],[2.54078,1.09529,-.298279],[2.54078,1.09529,.298279],[2.54911,2.04464,-.047716],[2.54911,2.04464,.047716],[2.55869,1.95095,-.17666],[2.55869,1.95095,.17666],[2.56757,1.25603,-.311747],[2.56757,1.25603,.311747],[2.57225,1.04036,-.173996],[2.57225,1.04036,.173996],[2.5791,2.12197,0],[2.58039,1.71153,-.279386],[2.58039,1.71153,.279386],[2.58101,2.03773,-.129515],[2.58101,2.03773,.129515],[2.58418,1.01953,0],[2.59258,1.40647,-.319922],[2.59258,1.40647,.319922],[2.59849,2.11992,-.087812],[2.59849,2.11992,.087812],[2.60178,1.55472,-.304019],[2.60178,1.55472,.304019],[2.60707,1.19853,-.219377],[2.60707,1.19853,.219377],[2.61162,1.69128,-.287908],[2.61162,1.69128,.287908],[2.61725,1.93031,-.220825],[2.61725,1.93031,.220825],[2.62963,1.16568,-.080823],[2.62963,1.16568,.080823],[2.63788,2.02555,-.180818],[2.63788,2.02555,.180818],[2.64063,1.34941,-.255938],[2.64063,1.34941,.255938],[2.6496,2.11451,-.150535],[2.6496,2.11451,.150535],[2.65084,2.18547,-.042461],[2.65084,2.18547,.042461],[2.65391,1.5042,-.264113],[2.65391,1.5042,.264113],[2.66542,1.64925,-.266995],[2.66542,1.64925,.266995],[2.67461,1.30906,-.149297],[2.67461,1.30906,.149297],[2.67823,1.78254,-.252819],[2.67823,1.78254,.252819],[2.68438,1.90664,-.235547],[2.68438,1.90664,.235547],[2.6875,1.29375,0],[2.6919,2.18361,-.115251],[2.6919,2.18361,.115251],[2.69645,1.4638,-.185857],[2.69645,1.4638,.185857],[2.7,2.25,0],[2.70808,2.01037,-.208084],[2.70808,2.01037,.208084],[2.71703,1.61167,-.213596],[2.71703,1.61167,.213596],[2.72076,1.44072,-.068474],[2.72076,1.44072,.068474],[2.72578,2.25,-.082031],[2.72578,2.25,.082031],[2.72599,2.10643,-.17525],[2.72599,2.10643,.17525],[2.736,1.75155,-.219519],[2.736,1.75155,.219519],[2.75021,2.26919,-.039734],[2.75021,2.26919,.039734],[2.7515,1.88297,-.220825],[2.7515,1.88297,.220825],[2.75354,1.58508,-.124598],[2.75354,1.58508,.124598],[2.76738,1.575,0],[2.77556,2.284,0],[2.78099,1.99437,-.208084],[2.78099,1.99437,.208084],[2.78303,1.7267,-.154476],[2.78303,1.7267,.154476],[2.79375,2.25,-.140625],[2.79375,2.25,.140625],[2.79782,2.27175,-.107849],[2.79782,2.27175,.107849],[2.79949,2.29275,-.076904],[2.79949,2.29275,.076904],[2.8,2.25,0],[2.80469,2.0981,-.200713],[2.80469,2.0981,.200713],[2.8099,1.7125,-.056912],[2.8099,1.7125,.056912],[2.81006,1.86233,-.17666],[2.81006,1.86233,.17666],[2.81201,2.17815,-.169843],[2.81201,2.17815,.169843],[2.81274,2.29754,-.035632],[2.81274,2.29754,.035632],[2.81719,2.25,-.049219],[2.81719,2.25,.049219],[2.825,2.30625,0],[2.83011,2.27129,-.025891],[2.83011,2.27129,.025891],[2.84063,2.29219,0],[2.84479,2.29964,-.029993],[2.84479,2.29964,.029993],[2.85092,2.30716,-.065625],[2.85092,2.30716,.065625],[2.85118,1.97919,-.180818],[2.85118,1.97919,.180818],[2.85148,1.84773,-.103052],[2.85148,1.84773,.103052],[2.86048,2.30093,-.096716],[2.86048,2.30093,.096716],[2.8625,2.25,-.084375],[2.8625,2.25,.084375],[2.86263,2.29298,-.054346],[2.86263,2.29298,.054346],[2.86574,2.27201,-.070276],[2.86574,2.27201,.070276],[2.86719,1.84219,0],[2.87228,2.29425,-.131836],[2.87228,2.29425,.131836],[2.88339,2.08977,-.17525],[2.88339,2.08977,.17525],[2.88836,2.30119,-.081409],[2.88836,2.30119,.081409],[2.89827,2.17088,-.194382],[2.89827,2.17088,.194382],[2.90805,1.967,-.129515],[2.90805,1.967,.129515],[2.91924,2.30955,-.1125],[2.91924,2.30955,.1125],[2.92064,2.29507,-.093164],[2.92064,2.29507,.093164],[2.93279,2.13103,-.172211],[2.93279,2.13103,.172211],[2.9398,2.27326,-.158936],[2.9398,2.27326,.158936],[2.93996,1.9601,-.047716],[2.93996,1.9601,.047716],[2.95978,2.08168,-.150535],[2.95978,2.08168,.150535],[2.96995,2.27412,-.103564],[2.96995,2.27412,.103564],[3,2.25,-.1875],[3,2.25,-.1125],[3,2.25,.1125],[3,2.25,.1875],[3.00281,2.30484,-.142529],[3.00281,2.30484,.142529],[3.01089,2.07627,-.087812],[3.01089,2.07627,.087812],[3.01578,2.30571,-.119971],[3.01578,2.30571,.119971],[3.03027,2.07422,0],[3.0415,2.12567,-.116276],[3.0415,2.12567,.116276],[3.04323,2.21108,-.166431],[3.04323,2.21108,.166431],[3.06842,2.17345,-.143215],[3.06842,2.17345,.143215],[3.07929,2.12306,-.042838],[3.07929,2.12306,.042838],[3.09316,2.29878,-.175781],[3.09316,2.29878,.175781],[3.09668,2.30142,-.124219],[3.09668,2.30142,.124219],[3.12656,2.3168,-.15],[3.12656,2.3168,.15],[3.12672,2.27729,-.103564],[3.12672,2.27729,.103564],[3.12691,2.17128,-.083542],[3.12691,2.17128,.083542],[3.1375,2.25,-.084375],[3.1375,2.25,.084375],[3.1491,2.17046,0],[3.15337,2.27552,-.158936],[3.15337,2.27552,.158936],[3.16895,2.21118,-.112353],[3.16895,2.21118,.112353],[3.18281,2.25,-.049219],[3.18281,2.25,.049219],[3.2,2.25,0],[3.20625,2.25,-.140625],[3.20625,2.25,.140625],[3.20746,2.31251,-.119971],[3.20746,2.31251,.119971],[3.21256,2.21043,-.041393],[3.21256,2.21043,.041393],[3.21692,2.31073,-.142529],[3.21692,2.31073,.142529],[3.23094,2.2794,-.070276],[3.23094,2.2794,.070276],[3.26724,2.27814,-.025891],[3.26724,2.27814,.025891],[3.27272,2.30776,-.093164],[3.27272,2.30776,.093164],[3.27422,2.25,-.082031],[3.27422,2.25,.082031],[3.29534,2.27703,-.107849],[3.29534,2.27703,.107849],[3.3,2.25,0],[3.31405,2.30331,-.131836],[3.31405,2.30331,.131836],[3.33073,2.30985,-.054346],[3.33073,2.30985,.054346],[3.33389,2.32405,-.1125],[3.33389,2.32405,.1125],[3.33489,2.31702,-.081409],[3.33489,2.31702,.081409],[3.34236,2.28006,-.039734],[3.34236,2.28006,.039734],[3.35543,2.3027,0],[3.35925,2.31465,-.096716],[3.35925,2.31465,.096716],[3.37912,2.31658,-.029993],[3.37912,2.31658,.029993],[3.38684,2.30481,-.076904],[3.38684,2.30481,.076904],[3.40221,2.32644,-.065625],[3.40221,2.32644,.065625],[3.40639,2.3185,-.035632],[3.40639,2.3185,.035632],[3.40838,2.31543,0],[3.42812,2.32734,0]];var b=[[1454,1468,1458],[1448,1454,1458],[1461,1448,1458],[1468,1461,1458],[1429,1454,1440],[1421,1429,1440],[1448,1421,1440],[1454,1448,1440],[1380,1429,1398],[1373,1380,1398],[1421,1373,1398],[1429,1421,1398],[1327,1380,1349],[1319,1327,1349],[1373,1319,1349],[1380,1373,1349],[1448,1461,1460],[1456,1448,1460],[1471,1456,1460],[1461,1471,1460],[1421,1448,1442],[1433,1421,1442],[1456,1433,1442],[1448,1456,1442],[1373,1421,1400],[1382,1373,1400],[1433,1382,1400],[1421,1433,1400],[1319,1373,1351],[1329,1319,1351],[1382,1329,1351],[1373,1382,1351],[1264,1327,1289],[1258,1264,1289],[1319,1258,1289],[1327,1319,1289],[1192,1264,1228],[1188,1192,1228],[1258,1188,1228],[1264,1258,1228],[1100,1192,1157],[1098,1100,1157],[1188,1098,1157],[1192,1188,1157],[922,1100,1006],[928,922,1006],[1098,928,1006],[1100,1098,1006],[1258,1319,1291],[1266,1258,1291],[1329,1266,1291],[1319,1329,1291],[1188,1258,1230],[1194,1188,1230],[1266,1194,1230],[1258,1266,1230],[1098,1188,1159],[1102,1098,1159],[1194,1102,1159],[1188,1194,1159],[928,1098,1008],[933,928,1008],[1102,933,1008],[1098,1102,1008],[1456,1471,1475],[1481,1456,1475],[1482,1481,1475],[1471,1482,1475],[1433,1456,1450],[1444,1433,1450],[1481,1444,1450],[1456,1481,1450],[1382,1433,1412],[1392,1382,1412],[1444,1392,1412],[1433,1444,1412],[1329,1382,1357],[1331,1329,1357],[1392,1331,1357],[1382,1392,1357],[1481,1482,1490],[1500,1481,1490],[1502,1500,1490],[1482,1502,1490],[1444,1481,1470],[1465,1444,1470],[1500,1465,1470],[1481,1500,1470],[1392,1444,1431],[1410,1392,1431],[1465,1410,1431],[1444,1465,1431],[1331,1392,1371],[1345,1331,1371],[1410,1345,1371],[1392,1410,1371],[1266,1329,1297],[1276,1266,1297],[1331,1276,1297],[1329,1331,1297],[1194,1266,1232],[1200,1194,1232],[1276,1200,1232],[1266,1276,1232],[1102,1194,1163],[1106,1102,1163],[1200,1106,1163],[1194,1200,1163],[933,1102,1016],[929,933,1016],[1106,929,1016],[1102,1106,1016],[1276,1331,1307],[1283,1276,1307],[1345,1283,1307],[1331,1345,1307],[1200,1276,1238],[1210,1200,1238],[1283,1210,1238],[1276,1283,1238],[1106,1200,1167],[1116,1106,1167],[1210,1116,1167],[1200,1210,1167],[929,1106,1022],[923,929,1022],[1116,923,1022],[1106,1116,1022],[755,922,849],[757,755,849],[928,757,849],[922,928,849],[663,755,698],[667,663,698],[757,667,698],[755,757,698],[591,663,627],[597,591,627],[667,597,627],[663,667,627],[528,591,566],[536,528,566],[597,536,566],[591,597,566],[757,928,847],[753,757,847],[933,753,847],[928,933,847],[667,757,696],[661,667,696],[753,661,696],[757,753,696],[597,667,625],[589,597,625],[661,589,625],[667,661,625],[536,597,564],[526,536,564],[589,526,564],[597,589,564],[475,528,506],[482,475,506],[536,482,506],[528,536,506],[426,475,457],[434,426,457],[482,434,457],[475,482,457],[401,426,415],[407,401,415],[434,407,415],[426,434,415],[386,401,397],[393,386,397],[407,393,397],[401,407,397],[482,536,504],[473,482,504],[526,473,504],[536,526,504],[434,482,455],[422,434,455],[473,422,455],[482,473,455],[407,434,413],[399,407,413],[422,399,413],[434,422,413],[393,407,395],[383,393,395],[399,383,395],[407,399,395],[753,933,839],[749,753,839],[929,749,839],[933,929,839],[661,753,692],[655,661,692],[749,655,692],[753,749,692],[589,661,623],[579,589,623],[655,579,623],[661,655,623],[526,589,558],[524,526,558],[579,524,558],[589,579,558],[749,929,833],[741,749,833],[923,741,833],[929,923,833],[655,749,688],[647,655,688],[741,647,688],[749,741,688],[579,655,617],[574,579,617],[647,574,617],[655,647,617],[524,579,548],[512,524,548],[574,512,548],[579,574,548],[473,526,498],[463,473,498],[524,463,498],[526,524,498],[422,473,443],[411,422,443],[463,411,443],[473,463,443],[399,422,405],[374,399,405],[411,374,405],[422,411,405],[383,399,380],[372,383,380],[374,372,380],[399,374,380],[463,524,484],[447,463,484],[512,447,484],[524,512,484],[411,463,424],[392,411,424],[447,392,424],[463,447,424],[374,411,385],[357,374,385],[392,357,385],[411,392,385],[372,374,365],[353,372,365],[357,353,365],[374,357,365],[400,386,396],[406,400,396],[393,406,396],[386,393,396],[425,400,414],[433,425,414],[406,433,414],[400,406,414],[474,425,456],[481,474,456],[433,481,456],[425,433,456],[527,474,505],[535,527,505],[481,535,505],[474,481,505],[406,393,394],[398,406,394],[383,398,394],[393,383,394],[433,406,412],[421,433,412],[398,421,412],[406,398,412],[481,433,454],[472,481,454],[421,472,454],[433,421,454],[535,481,503],[525,535,503],[472,525,503],[481,472,503],[590,527,565],[596,590,565],[535,596,565],[527,535,565],[662,590,626],[666,662,626],[596,666,626],[590,596,626],[754,662,697],[756,754,697],[666,756,697],[662,666,697],[919,754,848],[927,919,848],[756,927,848],[754,756,848],[596,535,563],[588,596,563],[525,588,563],[535,525,563],[666,596,624],[660,666,624],[588,660,624],[596,588,624],[756,666,695],[752,756,695],[660,752,695],[666,660,695],[927,756,846],[932,927,846],[752,932,846],[756,752,846],[398,383,379],[373,398,379],[372,373,379],[383,372,379],[421,398,404],[410,421,404],[373,410,404],[398,373,404],[472,421,442],[462,472,442],[410,462,442],[421,410,442],[525,472,497],[523,525,497],[462,523,497],[472,462,497],[373,372,364],[356,373,364],[353,356,364],[372,353,364],[410,373,384],[391,410,384],[356,391,384],[373,356,384],[462,410,423],[446,462,423],[391,446,423],[410,391,423],[523,462,483],[511,523,483],[446,511,483],[462,446,483],[588,525,557],[578,588,557],[523,578,557],[525,523,557],[660,588,622],[654,660,622],[578,654,622],[588,578,622],[752,660,691],[748,752,691],[654,748,691],[660,654,691],[932,752,838],[926,932,838],[748,926,838],[752,748,838],[578,523,547],[573,578,547],[511,573,547],[523,511,547],[654,578,616],[646,654,616],[573,646,616],[578,573,616],[748,654,687],[740,748,687],[646,740,687],[654,646,687],[926,748,832],[918,926,832],[740,918,832],[748,740,832],[1099,919,1005],[1097,1099,1005],[927,1097,1005],[919,927,1005],[1191,1099,1156],[1187,1191,1156],[1097,1187,1156],[1099,1097,1156],[1263,1191,1227],[1257,1263,1227],[1187,1257,1227],[1191,1187,1227],[1326,1263,1288],[1318,1326,1288],[1257,1318,1288],[1263,1257,1288],[1097,927,1007],[1101,1097,1007],[932,1101,1007],[927,932,1007],[1187,1097,1158],[1193,1187,1158],[1101,1193,1158],[1097,1101,1158],[1257,1187,1229],[1265,1257,1229],[1193,1265,1229],[1187,1193,1229],[1318,1257,1290],[1328,1318,1290],[1265,1328,1290],[1257,1265,1290],[1379,1326,1348],[1372,1379,1348],[1318,1372,1348],[1326,1318,1348],[1428,1379,1397],[1420,1428,1397],[1372,1420,1397],[1379,1372,1397],[1453,1428,1439],[1447,1453,1439],[1420,1447,1439],[1428,1420,1439],[1468,1453,1457],[1461,1468,1457],[1447,1461,1457],[1453,1447,1457],[1372,1318,1350],[1381,1372,1350],[1328,1381,1350],[1318,1328,1350],[1420,1372,1399],[1432,1420,1399],[1381,1432,1399],[1372,1381,1399],[1447,1420,1441],[1455,1447,1441],[1432,1455,1441],[1420,1432,1441],[1461,1447,1459],[1471,1461,1459],[1455,1471,1459],[1447,1455,1459],[1101,932,1015],[1105,1101,1015],[926,1105,1015],[932,926,1015],[1193,1101,1162],[1199,1193,1162],[1105,1199,1162],[1101,1105,1162],[1265,1193,1231],[1275,1265,1231],[1199,1275,1231],[1193,1199,1231],[1328,1265,1296],[1330,1328,1296],[1275,1330,1296],[1265,1275,1296],[1105,926,1021],[1115,1105,1021],[918,1115,1021],[926,918,1021],[1199,1105,1166],[1209,1199,1166],[1115,1209,1166],[1105,1115,1166],[1275,1199,1237],[1282,1275,1237],[1209,1282,1237],[1199,1209,1237],[1330,1275,1306],[1344,1330,1306],[1282,1344,1306],[1275,1282,1306],[1381,1328,1356],[1391,1381,1356],[1330,1391,1356],[1328,1330,1356],[1432,1381,1411],[1443,1432,1411],[1391,1443,1411],[1381,1391,1411],[1455,1432,1449],[1480,1455,1449],[1443,1480,1449],[1432,1443,1449],[1471,1455,1474],[1482,1471,1474],[1480,1482,1474],[1455,1480,1474],[1391,1330,1370],[1409,1391,1370],[1344,1409,1370],[1330,1344,1370],[1443,1391,1430],[1464,1443,1430],[1409,1464,1430],[1391,1409,1430],[1480,1443,1469],[1499,1480,1469],[1464,1499,1469],[1443,1464,1469],[1482,1480,1489],[1502,1482,1489],[1499,1502,1489],[1480,1499,1489],[1500,1502,1533],[1572,1500,1533],[1585,1572,1533],[1502,1585,1533],[1465,1500,1519],[1555,1465,1519],[1572,1555,1519],[1500,1572,1519],[1410,1465,1496],[1510,1410,1496],[1555,1510,1496],[1465,1555,1496],[1345,1410,1427],[1436,1345,1427],[1510,1436,1427],[1410,1510,1427],[1283,1345,1341],[1333,1283,1341],[1436,1333,1341],[1345,1436,1341],[1210,1283,1270],[1242,1210,1270],[1333,1242,1270],[1283,1333,1270],[1116,1210,1184],[1143,1116,1184],[1242,1143,1184],[1210,1242,1184],[923,1116,1037],[917,923,1037],[1143,917,1037],[1116,1143,1037],[1572,1585,1599],[1611,1572,1599],[1622,1611,1599],[1585,1622,1599],[1555,1572,1574],[1570,1555,1574],[1611,1570,1574],[1572,1611,1574],[1510,1555,1537],[1527,1510,1537],[1570,1527,1537],[1555,1570,1537],[1436,1510,1494],[1467,1436,1494],[1527,1467,1494],[1510,1527,1494],[1611,1622,1624],[1626,1611,1624],[1633,1626,1624],[1622,1633,1624],[1570,1611,1601],[1589,1570,1601],[1626,1589,1601],[1611,1626,1601],[1527,1570,1561],[1535,1527,1561],[1589,1535,1561],[1570,1589,1561],[1467,1527,1508],[1479,1467,1508],[1535,1479,1508],[1527,1535,1508],[1333,1436,1394],[1359,1333,1394],[1467,1359,1394],[1436,1467,1394],[1242,1333,1299],[1254,1242,1299],[1359,1254,1299],[1333,1359,1299],[1143,1242,1198],[1149,1143,1198],[1254,1149,1198],[1242,1254,1198],[917,1143,1057],[915,917,1057],[1149,915,1057],[1143,1149,1057],[1359,1467,1414],[1367,1359,1414],[1479,1367,1414],[1467,1479,1414],[1254,1359,1311],[1262,1254,1311],[1367,1262,1311],[1359,1367,1311],[1149,1254,1212],[1155,1149,1212],[1262,1155,1212],[1254,1262,1212],[915,1149,1065],[913,915,1065],[1155,913,1065],[1149,1155,1065],[741,923,818],[712,741,818],[917,712,818],[923,917,818],[647,741,671],[613,647,671],[712,613,671],[741,712,671],[574,647,585],[522,574,585],[613,522,585],[647,613,585],[512,574,514],[419,512,514],[522,419,514],[574,522,514],[447,512,428],[342,447,428],[419,342,428],[512,419,428],[392,447,359],[308,392,359],[342,308,359],[447,342,359],[357,392,329],[291,357,329],[308,291,329],[392,308,329],[353,357,314],[275,353,314],[291,275,314],[357,291,314],[712,917,798],[706,712,798],[915,706,798],[917,915,798],[613,712,657],[601,613,657],[706,601,657],[712,706,657],[522,613,556],[496,522,556],[601,496,556],[613,601,556],[419,522,461],[388,419,461],[496,388,461],[522,496,461],[706,915,790],[700,706,790],[913,700,790],[915,913,790],[601,706,643],[593,601,643],[700,593,643],[706,700,643],[496,601,544],[488,496,544],[593,488,544],[601,593,544],[388,496,441],[376,388,441],[488,376,441],[496,488,441],[342,419,361],[320,342,361],[388,320,361],[419,388,361],[308,342,310],[293,308,310],[320,293,310],[342,320,310],[291,308,289],[257,291,289],[293,257,289],[308,293,289],[275,291,270],[246,275,270],[257,246,270],[291,257,270],[320,388,344],[312,320,344],[376,312,344],[388,376,344],[293,320,302],[274,293,302],[312,274,302],[320,312,302],[257,293,268],[243,257,268],[274,243,268],[293,274,268],[246,257,245],[232,246,245],[243,232,245],[257,243,245],[356,353,313],[290,356,313],[275,290,313],[353,275,313],[391,356,328],[307,391,328],[290,307,328],[356,290,328],[446,391,358],[341,446,358],[307,341,358],[391,307,358],[511,446,427],[418,511,427],[341,418,427],[446,341,427],[573,511,513],[521,573,513],[418,521,513],[511,418,513],[646,573,584],[612,646,584],[521,612,584],[573,521,584],[740,646,670],[711,740,670],[612,711,670],[646,612,670],[918,740,817],[916,918,817],[711,916,817],[740,711,817],[290,275,269],[256,290,269],[246,256,269],[275,246,269],[307,290,288],[292,307,288],[256,292,288],[290,256,288],[341,307,309],[319,341,309],[292,319,309],[307,292,309],[418,341,360],[387,418,360],[319,387,360],[341,319,360],[256,246,244],[242,256,244],[232,242,244],[246,232,244],[292,256,267],[273,292,267],[242,273,267],[256,242,267],[319,292,301],[311,319,301],[273,311,301],[292,273,301],[387,319,343],[375,387,343],[311,375,343],[319,311,343],[521,418,460],[495,521,460],[387,495,460],[418,387,460],[612,521,555],[600,612,555],[495,600,555],[521,495,555],[711,612,656],[705,711,656],[600,705,656],[612,600,656],[916,711,797],[914,916,797],[705,914,797],[711,705,797],[495,387,440],[487,495,440],[375,487,440],[387,375,440],[600,495,543],[592,600,543],[487,592,543],[495,487,543],[705,600,642],[699,705,642],[592,699,642],[600,592,642],[914,705,789],[912,914,789],[699,912,789],[705,699,789],[1115,918,1036],[1142,1115,1036],[916,1142,1036],[918,916,1036],[1209,1115,1183],[1241,1209,1183],[1142,1241,1183],[1115,1142,1183],[1282,1209,1269],[1332,1282,1269],[1241,1332,1269],[1209,1241,1269],[1344,1282,1340],[1435,1344,1340],[1332,1435,1340],[1282,1332,1340],[1409,1344,1426],[1509,1409,1426],[1435,1509,1426],[1344,1435,1426],[1464,1409,1495],[1554,1464,1495],[1509,1554,1495],[1409,1509,1495],[1499,1464,1518],[1571,1499,1518],[1554,1571,1518],[1464,1554,1518],[1502,1499,1532],[1585,1502,1532],[1571,1585,1532],[1499,1571,1532],[1142,916,1056],[1148,1142,1056],[914,1148,1056],[916,914,1056],[1241,1142,1197],[1253,1241,1197],[1148,1253,1197],[1142,1148,1197],[1332,1241,1298],[1358,1332,1298],[1253,1358,1298],[1241,1253,1298],[1435,1332,1393],[1466,1435,1393],[1358,1466,1393],[1332,1358,1393],[1148,914,1064],[1154,1148,1064],[912,1154,1064],[914,912,1064],[1253,1148,1211],[1261,1253,1211],[1154,1261,1211],[1148,1154,1211],[1358,1253,1310],[1366,1358,1310],[1261,1366,1310],[1253,1261,1310],[1466,1358,1413],[1478,1466,1413],[1366,1478,1413],[1358,1366,1413],[1509,1435,1493],[1526,1509,1493],[1466,1526,1493],[1435,1466,1493],[1554,1509,1536],[1569,1554,1536],[1526,1569,1536],[1509,1526,1536],[1571,1554,1573],[1610,1571,1573],[1569,1610,1573],[1554,1569,1573],[1585,1571,1598],[1622,1585,1598],[1610,1622,1598],[1571,1610,1598],[1526,1466,1507],[1534,1526,1507],[1478,1534,1507],[1466,1478,1507],[1569,1526,1560],[1588,1569,1560],[1534,1588,1560],[1526,1534,1560],[1610,1569,1600],[1625,1610,1600],[1588,1625,1600],[1569,1588,1600],[1622,1610,1623],[1633,1622,1623],[1625,1633,1623],[1610,1625,1623],[1626,1633,1628],[1621,1626,1628],[1629,1621,1628],[1633,1629,1628],[1589,1626,1607],[1584,1589,1607],[1621,1584,1607],[1626,1621,1607],[1621,1629,1616],[1603,1621,1616],[1612,1603,1616],[1629,1612,1616],[1584,1621,1593],[1568,1584,1593],[1603,1568,1593],[1621,1603,1593],[1535,1589,1563],[1529,1535,1563],[1584,1529,1563],[1589,1584,1563],[1479,1535,1512],[1473,1479,1512],[1529,1473,1512],[1535,1529,1512],[1529,1584,1557],[1521,1529,1557],[1568,1521,1557],[1584,1568,1557],[1473,1529,1504],[1452,1473,1504],[1521,1452,1504],[1529,1521,1504],[1603,1612,1580],[1559,1603,1580],[1566,1559,1580],[1612,1566,1580],[1568,1603,1565],[1525,1568,1565],[1559,1525,1565],[1603,1559,1565],[1521,1568,1523],[1484,1521,1523],[1525,1484,1523],[1568,1525,1523],[1452,1521,1477],[1406,1452,1477],[1484,1406,1477],[1521,1484,1477],[1367,1479,1417],[1361,1367,1417],[1473,1361,1417],[1479,1473,1417],[1262,1367,1313],[1260,1262,1313],[1361,1260,1313],[1367,1361,1313],[1361,1473,1404],[1355,1361,1404],[1452,1355,1404],[1473,1452,1404],[1260,1361,1303],[1248,1260,1303],[1355,1248,1303],[1361,1355,1303],[1155,1262,1214],[1151,1155,1214],[1260,1151,1214],[1262,1260,1214],[913,1155,1067],[911,913,1067],[1151,911,1067],[1155,1151,1067],[1151,1260,1204],[1147,1151,1204],[1248,1147,1204],[1260,1248,1204],[911,1151,1062],[909,911,1062],[1147,909,1062],[1151,1147,1062],[1355,1452,1384],[1323,1355,1384],[1406,1323,1384],[1452,1406,1384],[1248,1355,1287],[1236,1248,1287],[1323,1236,1287],[1355,1323,1287],[1147,1248,1190],[1135,1147,1190],[1236,1135,1190],[1248,1236,1190],[909,1147,1051],[907,909,1051],[1135,907,1051],[1147,1135,1051],[1559,1566,1531],[1514,1559,1531],[1515,1514,1531],[1566,1515,1531],[1525,1559,1517],[1486,1525,1517],[1514,1486,1517],[1559,1514,1517],[1484,1525,1488],[1438,1484,1488],[1486,1438,1488],[1525,1486,1488],[1406,1484,1425],[1363,1406,1425],[1438,1363,1425],[1484,1438,1425],[1514,1515,1506],[1498,1514,1506],[1501,1498,1506],[1515,1501,1506],[1486,1514,1492],[1463,1486,1492],[1498,1463,1492],[1514,1498,1492],[1438,1486,1446],[1408,1438,1446],[1463,1408,1446],[1486,1463,1446],[1363,1438,1386],[1343,1363,1386],[1408,1343,1386],[1438,1408,1386],[1323,1406,1337],[1293,1323,1337],[1363,1293,1337],[1406,1363,1337],[1236,1323,1268],[1220,1236,1268],[1293,1220,1268],[1323,1293,1268],[1135,1236,1182],[1122,1135,1182],[1220,1122,1182],[1236,1220,1182],[907,1135,1035],[905,907,1035],[1122,905,1035],[1135,1122,1035],[1293,1363,1317],[1281,1293,1317],[1343,1281,1317],[1363,1343,1317],[1220,1293,1246],[1208,1220,1246],[1281,1208,1246],[1293,1281,1246],[1122,1220,1172],[1114,1122,1172],[1208,1114,1172],[1220,1208,1172],[905,1122,1026],[903,905,1026],[1114,903,1026],[1122,1114,1026],[700,913,788],[704,700,788],[911,704,788],[913,911,788],[593,700,641],[595,593,641],[704,595,641],[700,704,641],[704,911,793],[708,704,793],[909,708,793],[911,909,793],[595,704,651],[607,595,651],[708,607,651],[704,708,651],[488,593,542],[494,488,542],[595,494,542],[593,595,542],[376,488,438],[382,376,438],[494,382,438],[488,494,438],[494,595,552],[500,494,552],[607,500,552],[595,607,552],[382,494,451],[403,382,451],[500,403,451],[494,500,451],[708,909,804],[718,708,804],[907,718,804],[909,907,804],[607,708,665],[619,607,665],[718,619,665],[708,718,665],[500,607,568],[532,500,568],[619,532,568],[607,619,568],[403,500,471],[449,403,471],[532,449,471],[500,532,471],[312,376,340],[318,312,340],[382,318,340],[376,382,340],[274,312,300],[285,274,300],[318,285,300],[312,318,300],[318,382,350],[327,318,350],[403,327,350],[382,403,350],[285,318,306],[295,285,306],[327,295,306],[318,327,306],[243,274,264],[250,243,264],[285,250,264],[274,285,264],[232,243,239],[237,232,239],[250,237,239],[243,250,239],[250,285,272],[266,250,272],[295,266,272],[285,295,272],[237,250,254],[255,237,254],[266,255,254],[250,266,254],[327,403,378],[371,327,378],[449,371,378],[403,449,378],[295,327,324],[322,295,324],[371,322,324],[327,371,324],[266,295,298],[304,266,298],[322,304,298],[295,322,298],[255,266,287],[296,255,287],[304,296,287],[266,304,287],[718,907,820],[733,718,820],[905,733,820],[907,905,820],[619,718,673],[635,619,673],[733,635,673],[718,733,673],[532,619,587],[562,532,587],[635,562,587],[619,635,587],[449,532,518],[492,449,518],[562,492,518],[532,562,518],[733,905,829],[739,733,829],[903,739,829],[905,903,829],[635,733,683],[645,635,683],[739,645,683],[733,739,683],[562,635,609],[572,562,609],[645,572,609],[635,645,609],[492,562,538],[510,492,538],[572,510,538],[562,572,538],[371,449,430],[417,371,430],[492,417,430],[449,492,430],[322,371,367],[369,322,367],[417,369,367],[371,417,367],[304,322,333],[338,304,333],[369,338,333],[322,369,333],[296,304,316],[334,296,316],[338,334,316],[304,338,316],[417,492,469],[445,417,469],[510,445,469],[492,510,469],[369,417,409],[390,369,409],[445,390,409],[417,445,409],[338,369,363],[355,338,363],[390,355,363],[369,390,363],[334,338,346],[351,334,346],[355,351,346],[338,355,346],[242,232,238],[249,242,238],[237,249,238],[232,237,238],[273,242,263],[284,273,263],[249,284,263],[242,249,263],[249,237,253],[265,249,253],[255,265,253],[237,255,253],[284,249,271],[294,284,271],[265,294,271],[249,265,271],[311,273,299],[317,311,299],[284,317,299],[273,284,299],[375,311,339],[381,375,339],[317,381,339],[311,317,339],[317,284,305],[326,317,305],[294,326,305],[284,294,305],[381,317,349],[402,381,349],[326,402,349],[317,326,349],[265,255,286],[303,265,286],[296,303,286],[255,296,286],[294,265,297],[321,294,297],[303,321,297],[265,303,297],[326,294,323],[370,326,323],[321,370,323],[294,321,323],[402,326,377],[448,402,377],[370,448,377],[326,370,377],[487,375,437],[493,487,437],[381,493,437],[375,381,437],[592,487,541],[594,592,541],[493,594,541],[487,493,541],[493,381,450],[499,493,450],[402,499,450],[381,402,450],[594,493,551],[606,594,551],[499,606,551],[493,499,551],[699,592,640],[703,699,640],[594,703,640],[592,594,640],[912,699,787],[910,912,787],[703,910,787],[699,703,787],[703,594,650],[707,703,650],[606,707,650],[594,606,650],[910,703,792],[908,910,792],[707,908,792],[703,707,792],[499,402,470],[531,499,470],[448,531,470],[402,448,470],[606,499,567],[618,606,567],[531,618,567],[499,531,567],[707,606,664],[719,707,664],[618,719,664],[606,618,664],[908,707,803],[906,908,803],[719,906,803],[707,719,803],[303,296,315],[337,303,315],[334,337,315],[296,334,315],[321,303,332],[368,321,332],[337,368,332],[303,337,332],[370,321,366],[416,370,366],[368,416,366],[321,368,366],[448,370,429],[491,448,429],[416,491,429],[370,416,429],[337,334,345],[354,337,345],[351,354,345],[334,351,345],[368,337,362],[389,368,362],[354,389,362],[337,354,362],[416,368,408],[444,416,408],[389,444,408],[368,389,408],[491,416,468],[509,491,468],[444,509,468],[416,444,468],[531,448,517],[561,531,517],[491,561,517],[448,491,517],[618,531,586],[634,618,586],[561,634,586],[531,561,586],[719,618,672],[732,719,672],[634,732,672],[618,634,672],[906,719,819],[904,906,819],[732,904,819],[719,732,819],[561,491,537],[571,561,537],[509,571,537],[491,509,537],[634,561,608],[644,634,608],[571,644,608],[561,571,608],[732,634,682],[738,732,682],[644,738,682],[634,644,682],[904,732,828],[902,904,828],[738,902,828],[732,738,828],[1154,912,1066],[1150,1154,1066],[910,1150,1066],[912,910,1066],[1261,1154,1213],[1259,1261,1213],[1150,1259,1213],[1154,1150,1213],[1150,910,1061],[1146,1150,1061],[908,1146,1061],[910,908,1061],[1259,1150,1203],[1247,1259,1203],[1146,1247,1203],[1150,1146,1203],[1366,1261,1312],[1360,1366,1312],[1259,1360,1312],[1261,1259,1312],[1478,1366,1416],[1472,1478,1416],[1360,1472,1416],[1366,1360,1416],[1360,1259,1302],[1354,1360,1302],[1247,1354,1302],[1259,1247,1302],[1472,1360,1403],[1451,1472,1403],[1354,1451,1403],[1360,1354,1403],[1146,908,1050],[1136,1146,1050],[906,1136,1050],[908,906,1050],[1247,1146,1189],[1235,1247,1189],[1136,1235,1189],[1146,1136,1189],[1354,1247,1286],[1322,1354,1286],[1235,1322,1286],[1247,1235,1286],[1451,1354,1383],[1405,1451,1383],[1322,1405,1383],[1354,1322,1383],[1534,1478,1511],[1528,1534,1511],[1472,1528,1511],[1478,1472,1511],[1588,1534,1562],[1583,1588,1562],[1528,1583,1562],[1534,1528,1562],[1528,1472,1503],[1520,1528,1503],[1451,1520,1503],[1472,1451,1503],[1583,1528,1556],[1567,1583,1556],[1520,1567,1556],[1528,1520,1556],[1625,1588,1606],[1620,1625,1606],[1583,1620,1606],[1588,1583,1606],[1633,1625,1627],[1629,1633,1627],[1620,1629,1627],[1625,1620,1627],[1620,1583,1592],[1602,1620,1592],[1567,1602,1592],[1583,1567,1592],[1629,1620,1615],[1612,1629,1615],[1602,1612,1615],[1620,1602,1615],[1520,1451,1476],[1483,1520,1476],[1405,1483,1476],[1451,1405,1476],[1567,1520,1522],[1524,1567,1522],[1483,1524,1522],[1520,1483,1522],[1602,1567,1564],[1558,1602,1564],[1524,1558,1564],[1567,1524,1564],[1612,1602,1579],[1566,1612,1579],[1558,1566,1579],[1602,1558,1579],[1136,906,1034],[1121,1136,1034],[904,1121,1034],[906,904,1034],[1235,1136,1181],[1219,1235,1181],[1121,1219,1181],[1136,1121,1181],[1322,1235,1267],[1292,1322,1267],[1219,1292,1267],[1235,1219,1267],[1405,1322,1336],[1362,1405,1336],[1292,1362,1336],[1322,1292,1336],[1121,904,1025],[1113,1121,1025],[902,1113,1025],[904,902,1025],[1219,1121,1171],[1207,1219,1171],[1113,1207,1171],[1121,1113,1171],[1292,1219,1245],[1280,1292,1245],[1207,1280,1245],[1219,1207,1245],[1362,1292,1316],[1342,1362,1316],[1280,1342,1316],[1292,1280,1316],[1483,1405,1424],[1437,1483,1424],[1362,1437,1424],[1405,1362,1424],[1524,1483,1487],[1485,1524,1487],[1437,1485,1487],[1483,1437,1487],[1558,1524,1516],[1513,1558,1516],[1485,1513,1516],[1524,1485,1516],[1566,1558,1530],[1515,1566,1530],[1513,1515,1530],[1558,1513,1530],[1437,1362,1385],[1407,1437,1385],[1342,1407,1385],[1362,1342,1385],[1485,1437,1445],[1462,1485,1445],[1407,1462,1445],[1437,1407,1445],[1513,1485,1491],[1497,1513,1491],[1462,1497,1491],[1485,1462,1491],[1515,1513,1505],[1501,1515,1505],[1497,1501,1505],[1513,1497,1505],[331,325,277],[228,331,277],[231,228,277],[325,231,277],[336,331,279],[224,336,279],[228,224,279],[331,228,279],[228,231,200],[173,228,200],[178,173,200],[231,178,200],[224,228,198],[167,224,198],[173,167,198],[228,173,198],[348,336,281],[222,348,281],[224,222,281],[336,224,281],[352,348,283],[210,352,283],[222,210,283],[348,222,283],[222,224,193],[150,222,193],[167,150,193],[224,167,193],[210,222,183],[142,210,183],[150,142,183],[222,150,183],[177,178,165],[136,177,165],[141,136,165],[178,141,165],[173,177,162],[127,173,162],[136,127,162],[177,136,162],[167,173,158],[131,167,158],[152,131,158],[173,152,158],[131,152,129],[82,131,129],[127,82,129],[152,127,129],[136,141,134],[114,136,134],[121,114,134],[141,121,134],[127,136,118],[93,127,118],[114,93,118],[136,114,118],[114,121,112],[101,114,112],[108,101,112],[121,108,112],[93,114,95],[90,93,95],[101,90,95],[114,101,95],[82,127,88],[59,82,88],[93,59,88],[127,93,88],[59,93,74],[52,59,74],[90,52,74],[93,90,74],[150,167,140],[86,150,140],[131,86,140],[167,131,140],[86,131,84],[50,86,84],[82,50,84],[131,82,84],[148,150,120],[76,148,120],[86,76,120],[150,86,120],[142,148,110],[72,142,110],[76,72,110],[148,76,110],[76,86,65],[36,76,65],[50,36,65],[86,50,65],[72,76,57],[34,72,57],[36,34,57],[76,36,57],[50,82,55],[27,50,55],[59,27,55],[82,59,55],[27,59,42],[18,27,42],[52,18,42],[59,52,42],[36,50,33],[12,36,33],[27,12,33],[50,27,33],[34,36,24],[8,34,24],[12,8,24],[36,12,24],[12,27,16],[2,12,16],[18,2,16],[27,18,16],[8,12,7],[0,8,7],[2,0,7],[12,2,7],[347,352,282],[221,347,282],[210,221,282],[352,210,282],[335,347,280],[223,335,280],[221,223,280],[347,221,280],[221,210,182],[149,221,182],[142,149,182],[210,142,182],[223,221,192],[166,223,192],[149,166,192],[221,149,192],[330,335,278],[227,330,278],[223,227,278],[335,223,278],[325,330,276],[231,325,276],[227,231,276],[330,227,276],[227,223,197],[172,227,197],[166,172,197],[223,166,197],[231,227,199],[178,231,199],[172,178,199],[227,172,199],[147,142,109],[75,147,109],[72,75,109],[142,72,109],[149,147,119],[85,149,119],[75,85,119],[147,75,119],[75,72,56],[35,75,56],[34,35,56],[72,34,56],[85,75,64],[49,85,64],[35,49,64],[75,35,64],[166,149,139],[130,166,139],[85,130,139],[149,85,139],[130,85,83],[81,130,83],[49,81,83],[85,49,83],[35,34,23],[11,35,23],[8,11,23],[34,8,23],[49,35,32],[26,49,32],[11,26,32],[35,11,32],[11,8,6],[1,11,6],[0,1,6],[8,0,6],[26,11,15],[17,26,15],[1,17,15],[11,1,15],[81,49,54],[58,81,54],[26,58,54],[49,26,54],[58,26,41],[51,58,41],[17,51,41],[26,17,41],[172,166,157],[151,172,157],[130,151,157],[166,130,157],[151,130,128],[126,151,128],[81,126,128],[130,81,128],[176,172,161],[135,176,161],[126,135,161],[172,126,161],[178,176,164],[141,178,164],[135,141,164],[176,135,164],[126,81,87],[92,126,87],[58,92,87],[81,58,87],[92,58,73],[89,92,73],[51,89,73],[58,51,73],[135,126,117],[113,135,117],[92,113,117],[126,92,117],[141,135,133],[121,141,133],[113,121,133],[135,113,133],[113,92,94],[100,113,94],[89,100,94],[92,89,94],[121,113,111],[108,121,111],[100,108,111],[113,100,111],[101,108,116],[125,101,116],[132,125,116],[108,132,116],[90,101,103],[105,90,103],[125,105,103],[101,125,103],[52,90,78],[71,52,78],[105,71,78],[90,105,78],[125,132,146],[156,125,146],[163,156,146],[132,163,146],[105,125,144],[154,105,144],[156,154,144],[125,156,144],[71,105,123],[138,71,123],[154,138,123],[105,154,123],[18,52,38],[22,18,38],[63,22,38],[52,63,38],[22,63,48],[40,22,48],[71,40,48],[63,71,48],[2,18,14],[10,2,14],[22,10,14],[18,22,14],[0,2,4],[5,0,4],[10,5,4],[2,10,4],[10,22,29],[31,10,29],[40,31,29],[22,40,29],[5,10,20],[25,5,20],[31,25,20],[10,31,20],[40,71,69],[67,40,69],[97,67,69],[71,97,69],[67,97,99],[107,67,99],[138,107,99],[97,138,99],[31,40,46],[61,31,46],[67,61,46],[40,67,46],[25,31,44],[53,25,44],[61,53,44],[31,61,44],[53,67,80],[91,53,80],[107,91,80],[67,107,80],[154,163,175],[195,154,175],[196,195,175],[163,196,175],[138,154,171],[189,138,171],[195,189,171],[154,195,171],[195,196,202],[207,195,202],[203,207,202],[196,203,202],[205,203,226],[234,205,226],[232,234,226],[203,232,226],[207,205,230],[236,207,230],[234,236,230],[205,234,230],[191,195,209],[241,191,209],[236,241,209],[195,236,209],[189,191,212],[248,189,212],[241,248,212],[191,241,212],[107,138,169],[185,107,169],[189,185,169],[138,189,169],[91,107,160],[179,91,160],[185,179,160],[107,185,160],[187,189,214],[252,187,214],[248,252,214],[189,248,214],[185,187,216],[259,185,216],[252,259,216],[187,252,216],[181,185,218],[261,181,218],[259,261,218],[185,259,218],[179,181,220],[262,179,220],[261,262,220],[181,261,220],[1,0,3],[9,1,3],[5,9,3],[0,5,3],[17,1,13],[21,17,13],[9,21,13],[1,9,13],[9,5,19],[30,9,19],[25,30,19],[5,25,19],[21,9,28],[39,21,28],[30,39,28],[9,30,28],[51,17,37],[62,51,37],[21,62,37],[17,21,37],[62,21,47],[70,62,47],[39,70,47],[21,39,47],[30,25,43],[60,30,43],[53,60,43],[25,53,43],[39,30,45],[66,39,45],[60,66,45],[30,60,45],[66,53,79],[106,66,79],[91,106,79],[53,91,79],[70,39,68],[96,70,68],[66,96,68],[39,66,68],[96,66,98],[137,96,98],[106,137,98],[66,106,98],[89,51,77],[104,89,77],[70,104,77],[51,70,77],[100,89,102],[124,100,102],[104,124,102],[89,104,102],[108,100,115],[132,108,115],[124,132,115],[100,124,115],[104,70,122],[153,104,122],[137,153,122],[70,137,122],[124,104,143],[155,124,143],[153,155,143],[104,153,143],[132,124,145],[163,132,145],[155,163,145],[124,155,145],[106,91,159],[184,106,159],[179,184,159],[91,179,159],[137,106,168],[188,137,168],[184,188,168],[106,184,168],[180,179,219],[260,180,219],[262,260,219],[179,262,219],[184,180,217],[258,184,217],[260,258,217],[180,260,217],[186,184,215],[251,186,215],[258,251,215],[184,258,215],[188,186,213],[247,188,213],[251,247,213],[186,251,213],[153,137,170],[194,153,170],[188,194,170],[137,188,170],[163,153,174],[196,163,174],[194,196,174],[153,194,174],[190,188,211],[240,190,211],[247,240,211],[188,247,211],[194,190,208],[235,194,208],[240,235,208],[190,240,208],[196,194,201],[203,196,201],[206,203,201],[194,206,201],[204,206,229],[233,204,229],[235,233,229],[206,235,229],[203,204,225],[232,203,225],[233,232,225],[204,233,225],[1552,1553,1587],[1632,1552,1587],[1630,1632,1587],[1553,1630,1587],[1550,1552,1591],[1637,1550,1591],[1632,1637,1591],[1552,1632,1591],[1632,1630,1647],[1665,1632,1647],[1663,1665,1647],[1630,1663,1647],[1637,1632,1651],[1673,1637,1651],[1665,1673,1651],[1632,1665,1651],[1548,1550,1595],[1641,1548,1595],[1637,1641,1595],[1550,1637,1595],[1546,1548,1597],[1645,1546,1597],[1641,1645,1597],[1548,1641,1597],[1641,1637,1657],[1679,1641,1657],[1673,1679,1657],[1637,1673,1657],[1645,1641,1660],[1688,1645,1660],[1679,1688,1660],[1641,1679,1660],[1665,1663,1677],[1695,1665,1677],[1693,1695,1677],[1663,1693,1677],[1673,1665,1683],[1705,1673,1683],[1695,1705,1683],[1665,1695,1683],[1695,1693,1707],[1718,1695,1707],[1712,1718,1707],[1693,1712,1707],[1705,1695,1709],[1725,1705,1709],[1718,1725,1709],[1695,1718,1709],[1679,1673,1692],[1714,1679,1692],[1705,1714,1692],[1673,1705,1692],[1688,1679,1703],[1729,1688,1703],[1714,1729,1703],[1679,1714,1703],[1714,1705,1723],[1739,1714,1723],[1725,1739,1723],[1705,1725,1723],[1729,1714,1733],[1752,1729,1733],[1739,1752,1733],[1714,1739,1733],[1544,1546,1605],[1649,1544,1605],[1645,1649,1605],[1546,1645,1605],[1542,1544,1576],[1614,1542,1576],[1609,1614,1576],[1544,1609,1576],[1614,1609,1635],[1653,1614,1635],[1649,1653,1635],[1609,1649,1635],[1649,1645,1669],[1699,1649,1669],[1688,1699,1669],[1645,1688,1669],[1653,1649,1662],[1681,1653,1662],[1675,1681,1662],[1649,1675,1662],[1681,1675,1690],[1711,1681,1690],[1699,1711,1690],[1675,1699,1690],[1540,1542,1578],[1618,1540,1578],[1614,1618,1578],[1542,1614,1578],[1618,1614,1639],[1655,1618,1639],[1653,1655,1639],[1614,1653,1639],[1538,1540,1582],[1619,1538,1582],[1618,1619,1582],[1540,1618,1582],[1619,1618,1643],[1658,1619,1643],[1655,1658,1643],[1618,1655,1643],[1655,1653,1667],[1685,1655,1667],[1681,1685,1667],[1653,1681,1667],[1685,1681,1697],[1720,1685,1697],[1711,1720,1697],[1681,1711,1697],[1658,1655,1671],[1686,1658,1671],[1685,1686,1671],[1655,1685,1671],[1686,1685,1701],[1721,1686,1701],[1720,1721,1701],[1685,1720,1701],[1699,1688,1716],[1743,1699,1716],[1729,1743,1716],[1688,1729,1716],[1711,1699,1727],[1754,1711,1727],[1743,1754,1727],[1699,1743,1727],[1743,1729,1748],[1770,1743,1748],[1752,1770,1748],[1729,1752,1748],[1754,1743,1760],[1786,1754,1760],[1770,1786,1760],[1743,1770,1760],[1720,1711,1735],[1762,1720,1735],[1754,1762,1735],[1711,1754,1735],[1721,1720,1741],[1768,1721,1741],[1762,1768,1741],[1720,1762,1741],[1762,1754,1776],[1796,1762,1776],[1786,1796,1776],[1754,1786,1776],[1768,1762,1782],[1801,1768,1782],[1796,1801,1782],[1762,1796,1782],[1718,1712,1731],[1746,1718,1731],[1744,1746,1731],[1712,1744,1731],[1725,1718,1737],[1758,1725,1737],[1746,1758,1737],[1718,1746,1737],[1739,1725,1750],[1780,1739,1750],[1758,1780,1750],[1725,1758,1750],[1752,1739,1765],[1800,1752,1765],[1780,1800,1765],[1739,1780,1765],[1746,1744,1756],[1772,1746,1756],[1763,1772,1756],[1744,1763,1756],[1758,1746,1767],[1788,1758,1767],[1772,1788,1767],[1746,1772,1767],[1772,1763,1790],[1814,1772,1790],[1806,1814,1790],[1763,1806,1790],[1788,1772,1803],[1832,1788,1803],[1814,1832,1803],[1772,1814,1803],[1780,1758,1784],[1816,1780,1784],[1788,1816,1784],[1758,1788,1784],[1800,1780,1808],[1839,1800,1808],[1816,1839,1808],[1780,1816,1808],[1839,1788,1845],[1898,1839,1845],[1832,1898,1845],[1788,1832,1845],[1770,1752,1774],[1794,1770,1774],[1778,1794,1774],[1752,1778,1774],[1786,1770,1792],[1810,1786,1792],[1794,1810,1792],[1770,1794,1792],[1794,1778,1798],[1822,1794,1798],[1800,1822,1798],[1778,1800,1798],[1810,1794,1818],[1843,1810,1818],[1822,1843,1818],[1794,1822,1818],[1796,1786,1805],[1824,1796,1805],[1810,1824,1805],[1786,1810,1805],[1801,1796,1812],[1825,1801,1812],[1824,1825,1812],[1796,1824,1812],[1824,1810,1830],[1861,1824,1830],[1843,1861,1830],[1810,1843,1830],[1825,1824,1841],[1870,1825,1841],[1861,1870,1841],[1824,1861,1841],[1822,1800,1828],[1874,1822,1828],[1839,1874,1828],[1800,1839,1828],[1843,1822,1859],[1892,1843,1859],[1874,1892,1859],[1822,1874,1859],[1892,1839,1886],[1911,1892,1886],[1878,1911,1886],[1839,1878,1886],[1911,1878,1909],[1935,1911,1909],[1898,1935,1909],[1878,1898,1909],[1861,1843,1880],[1902,1861,1880],[1892,1902,1880],[1843,1892,1880],[1870,1861,1890],[1905,1870,1890],[1902,1905,1890],[1861,1902,1890],[1902,1892,1907],[1923,1902,1907],[1911,1923,1907],[1892,1911,1907],[1923,1911,1930],[1949,1923,1930],[1935,1949,1930],[1911,1935,1930],[1905,1902,1913],[1926,1905,1913],[1923,1926,1913],[1902,1923,1913],[1926,1923,1939],[1952,1926,1939],[1949,1952,1939],[1923,1949,1939],[1539,1538,1581],[1617,1539,1581],[1619,1617,1581],[1538,1619,1581],[1617,1619,1642],[1654,1617,1642],[1658,1654,1642],[1619,1658,1642],[1541,1539,1577],[1613,1541,1577],[1617,1613,1577],[1539,1617,1577],[1613,1617,1638],[1652,1613,1638],[1654,1652,1638],[1617,1654,1638],[1654,1658,1670],[1684,1654,1670],[1686,1684,1670],[1658,1686,1670],[1684,1686,1700],[1719,1684,1700],[1721,1719,1700],[1686,1721,1700],[1652,1654,1666],[1680,1652,1666],[1684,1680,1666],[1654,1684,1666],[1680,1684,1696],[1710,1680,1696],[1719,1710,1696],[1684,1719,1696],[1543,1541,1575],[1608,1543,1575],[1613,1608,1575],[1541,1613,1575],[1608,1613,1634],[1648,1608,1634],[1652,1648,1634],[1613,1652,1634],[1545,1543,1604],[1644,1545,1604],[1648,1644,1604],[1543,1648,1604],[1648,1652,1661],[1674,1648,1661],[1680,1674,1661],[1652,1680,1661],[1674,1680,1689],[1698,1674,1689],[1710,1698,1689],[1680,1710,1689],[1644,1648,1668],[1687,1644,1668],[1698,1687,1668],[1648,1698,1668],[1719,1721,1740],[1761,1719,1740],[1768,1761,1740],[1721,1768,1740],[1710,1719,1734],[1753,1710,1734],[1761,1753,1734],[1719,1761,1734],[1761,1768,1781],[1795,1761,1781],[1801,1795,1781],[1768,1801,1781],[1753,1761,1775],[1785,1753,1775],[1795,1785,1775],[1761,1795,1775],[1698,1710,1726],[1742,1698,1726],[1753,1742,1726],[1710,1753,1726],[1687,1698,1715],[1728,1687,1715],[1742,1728,1715],[1698,1742,1715],[1742,1753,1759],[1769,1742,1759],[1785,1769,1759],[1753,1785,1759],[1728,1742,1747],[1751,1728,1747],[1769,1751,1747],[1742,1769,1747],[1547,1545,1596],[1640,1547,1596],[1644,1640,1596],[1545,1644,1596],[1549,1547,1594],[1636,1549,1594],[1640,1636,1594],[1547,1640,1594],[1640,1644,1659],[1678,1640,1659],[1687,1678,1659],[1644,1687,1659],[1636,1640,1656],[1672,1636,1656],[1678,1672,1656],[1640,1678,1656],[1551,1549,1590],[1631,1551,1590],[1636,1631,1590],[1549,1636,1590],[1553,1551,1586],[1630,1553,1586],[1631,1630,1586],[1551,1631,1586],[1631,1636,1650],[1664,1631,1650],[1672,1664,1650],[1636,1672,1650],[1630,1631,1646],[1663,1630,1646],[1664,1663,1646],[1631,1664,1646],[1678,1687,1702],[1713,1678,1702],[1728,1713,1702],[1687,1728,1702],[1672,1678,1691],[1704,1672,1691],[1713,1704,1691],[1678,1713,1691],[1713,1728,1732],[1738,1713,1732],[1751,1738,1732],[1728,1751,1732],[1704,1713,1722],[1724,1704,1722],[1738,1724,1722],[1713,1738,1722],[1664,1672,1682],[1694,1664,1682],[1704,1694,1682],[1672,1704,1682],[1663,1664,1676],[1693,1663,1676],[1694,1693,1676],[1664,1694,1676],[1694,1704,1708],[1717,1694,1708],[1724,1717,1708],[1704,1724,1708],[1693,1694,1706],[1712,1693,1706],[1717,1712,1706],[1694,1717,1706],[1795,1801,1811],[1823,1795,1811],[1825,1823,1811],[1801,1825,1811],[1785,1795,1804],[1809,1785,1804],[1823,1809,1804],[1795,1823,1804],[1823,1825,1840],[1860,1823,1840],[1870,1860,1840],[1825,1870,1840],[1809,1823,1829],[1842,1809,1829],[1860,1842,1829],[1823,1860,1829],[1769,1785,1791],[1793,1769,1791],[1809,1793,1791],[1785,1809,1791],[1751,1769,1773],[1777,1751,1773],[1793,1777,1773],[1769,1793,1773],[1793,1809,1817],[1821,1793,1817],[1842,1821,1817],[1809,1842,1817],[1777,1793,1797],[1799,1777,1797],[1821,1799,1797],[1793,1821,1797],[1860,1870,1889],[1901,1860,1889],[1905,1901,1889],[1870,1905,1889],[1842,1860,1879],[1891,1842,1879],[1901,1891,1879],[1860,1901,1879],[1901,1905,1912],[1922,1901,1912],[1926,1922,1912],[1905,1926,1912],[1922,1926,1938],[1948,1922,1938],[1952,1948,1938],[1926,1952,1938],[1891,1901,1906],[1910,1891,1906],[1922,1910,1906],[1901,1922,1906],[1910,1922,1929],[1934,1910,1929],[1948,1934,1929],[1922,1948,1929],[1821,1842,1858],[1873,1821,1858],[1891,1873,1858],[1842,1891,1858],[1799,1821,1827],[1838,1799,1827],[1873,1838,1827],[1821,1873,1827],[1838,1891,1885],[1877,1838,1885],[1910,1877,1885],[1891,1910,1885],[1877,1910,1908],[1895,1877,1908],[1934,1895,1908],[1910,1934,1908],[1738,1751,1764],[1779,1738,1764],[1799,1779,1764],[1751,1799,1764],[1724,1738,1749],[1757,1724,1749],[1779,1757,1749],[1738,1779,1749],[1717,1724,1736],[1745,1717,1736],[1757,1745,1736],[1724,1757,1736],[1712,1717,1730],[1744,1712,1730],[1745,1744,1730],[1717,1745,1730],[1779,1799,1807],[1815,1779,1807],[1838,1815,1807],[1799,1838,1807],[1757,1779,1783],[1787,1757,1783],[1815,1787,1783],[1779,1815,1783],[1787,1838,1844],[1831,1787,1844],[1895,1831,1844],[1838,1895,1844],[1745,1757,1766],[1771,1745,1766],[1787,1771,1766],[1757,1787,1766],[1744,1745,1755],[1763,1744,1755],[1771,1763,1755],[1745,1771,1755],[1771,1787,1802],[1813,1771,1802],[1831,1813,1802],[1787,1831,1802],[1763,1771,1789],[1806,1763,1789],[1813,1806,1789],[1771,1813,1789],[1814,1806,1820],[1836,1814,1820],[1826,1836,1820],[1806,1826,1820],[1832,1814,1834],[1872,1832,1834],[1836,1872,1834],[1814,1836,1834],[1898,1832,1888],[1915,1898,1888],[1872,1915,1888],[1832,1872,1888],[1836,1826,1847],[1857,1836,1847],[1850,1857,1847],[1826,1850,1847],[1872,1836,1863],[1882,1872,1863],[1857,1882,1863],[1836,1857,1863],[1915,1872,1900],[1919,1915,1900],[1882,1919,1900],[1872,1882,1900],[1935,1898,1928],[1954,1935,1928],[1915,1954,1928],[1898,1915,1928],[1949,1935,1951],[1969,1949,1951],[1954,1969,1951],[1935,1954,1951],[1952,1949,1962],[1974,1952,1962],[1969,1974,1962],[1949,1969,1962],[1954,1915,1941],[1958,1954,1941],[1919,1958,1941],[1915,1919,1941],[1969,1954,1965],[1971,1969,1965],[1958,1971,1965],[1954,1958,1965],[1974,1969,1973],[1975,1974,1973],[1971,1975,1973],[1969,1971,1973],[1857,1850,1855],[1867,1857,1855],[1853,1867,1855],[1850,1853,1855],[1882,1857,1876],[1884,1882,1876],[1867,1884,1876],[1857,1867,1876],[1919,1882,1904],[1917,1919,1904],[1884,1917,1904],[1882,1884,1904],[1867,1853,1852],[1849,1867,1852],[1837,1849,1852],[1853,1837,1852],[1884,1867,1869],[1865,1884,1869],[1849,1865,1869],[1867,1849,1869],[1917,1884,1894],[1897,1917,1894],[1865,1897,1894],[1884,1865,1894],[1958,1919,1937],[1947,1958,1937],[1917,1947,1937],[1919,1917,1937],[1971,1958,1960],[1956,1971,1960],[1947,1956,1960],[1958,1947,1960],[1975,1971,1967],[1963,1975,1967],[1956,1963,1967],[1971,1956,1967],[1947,1917,1921],[1925,1947,1921],[1897,1925,1921],[1917,1897,1921],[1956,1947,1943],[1932,1956,1943],[1925,1932,1943],[1947,1925,1943],[1963,1956,1945],[1933,1963,1945],[1932,1933,1945],[1956,1932,1945],[1948,1952,1961],[1968,1948,1961],[1974,1968,1961],[1952,1974,1961],[1934,1948,1950],[1953,1934,1950],[1968,1953,1950],[1948,1968,1950],[1895,1934,1927],[1914,1895,1927],[1953,1914,1927],[1934,1953,1927],[1968,1974,1972],[1970,1968,1972],[1975,1970,1972],[1974,1975,1972],[1953,1968,1964],[1957,1953,1964],[1970,1957,1964],[1968,1970,1964],[1914,1953,1940],[1918,1914,1940],[1957,1918,1940],[1953,1957,1940],[1831,1895,1887],[1871,1831,1887],[1914,1871,1887],[1895,1914,1887],[1813,1831,1833],[1835,1813,1833],[1871,1835,1833],[1831,1871,1833],[1806,1813,1819],[1826,1806,1819],[1835,1826,1819],[1813,1835,1819],[1871,1914,1899],[1881,1871,1899],[1918,1881,1899],[1914,1918,1899],[1835,1871,1862],[1856,1835,1862],[1881,1856,1862],[1871,1881,1862],[1826,1835,1846],[1850,1826,1846],[1856,1850,1846],[1835,1856,1846],[1970,1975,1966],[1955,1970,1966],[1963,1955,1966],[1975,1963,1966],[1957,1970,1959],[1946,1957,1959],[1955,1946,1959],[1970,1955,1959],[1918,1957,1936],[1916,1918,1936],[1946,1916,1936],[1957,1946,1936],[1955,1963,1944],[1931,1955,1944],[1933,1931,1944],[1963,1933,1944],[1946,1955,1942],[1924,1946,1942],[1931,1924,1942],[1955,1931,1942],[1916,1946,1920],[1896,1916,1920],[1924,1896,1920],[1946,1924,1920],[1881,1918,1903],[1883,1881,1903],[1916,1883,1903],[1918,1916,1903],[1856,1881,1875],[1866,1856,1875],[1883,1866,1875],[1881,1883,1875],[1850,1856,1854],[1853,1850,1854],[1866,1853,1854],[1856,1866,1854],[1883,1916,1893],[1864,1883,1893],[1896,1864,1893],[1916,1896,1893],[1866,1883,1868],[1848,1866,1868],[1864,1848,1868],[1883,1864,1868],[1853,1866,1851],[1837,1853,1851],[1848,1837,1851],[1866,1848,1851],[1069,952,992],[1072,1069,992],[952,1072,992],[1069,1072,1094],[1118,1069,1094],[1134,1118,1094],[1072,1134,1094],[1030,952,984],[1069,1030,984],[952,1069,984],[1030,1069,1076],[1080,1030,1076],[1118,1080,1076],[1069,1118,1076],[1118,1134,1133],[1131,1118,1133],[1139,1131,1133],[1134,1139,1133],[1131,1139,1129],[1110,1131,1129],[1127,1110,1129],[1139,1127,1129],[1080,1118,1104],[1088,1080,1104],[1131,1088,1104],[1118,1131,1104],[1088,1131,1096],[1074,1088,1096],[1110,1074,1096],[1131,1110,1096],[980,952,964],[1030,980,964],[952,1030,964],[980,1030,1028],[1002,980,1028],[1080,1002,1028],[1030,1080,1028],[951,952,954],[980,951,954],[952,980,954],[951,980,962],[949,951,962],[1002,949,962],[980,1002,962],[1002,1080,1059],[1012,1002,1059],[1088,1012,1059],[1080,1088,1059],[1012,1088,1053],[998,1012,1053],[1074,998,1053],[1088,1074,1053],[949,1002,974],[947,949,974],[1012,947,974],[1002,1012,974],[947,1012,972],[945,947,972],[998,945,972],[1012,998,972],[1110,1127,1082],[1047,1110,1082],[1060,1047,1082],[1127,1060,1082],[1074,1110,1071],[1004,1074,1071],[1047,1004,1071],[1110,1047,1071],[1047,1060,1039],[1024,1047,1039],[1031,1024,1039],[1060,1031,1039],[1024,1031,1041],[1049,1024,1041],[1063,1049,1041],[1031,1063,1041],[1004,1047,1018],[994,1004,1018],[1024,994,1018],[1047,1024,1018],[994,1024,1020],[1010,994,1020],[1049,1010,1020],[1024,1049,1020],[998,1074,1014],[976,998,1014],[1004,976,1014],[1074,1004,1014],[945,998,960],[943,945,960],[976,943,960],[998,976,960],[976,1004,986],[970,976,986],[994,970,986],[1004,994,986],[970,994,990],[978,970,990],[1010,978,990],[994,1010,990],[943,976,956],[941,943,956],[970,941,956],[976,970,956],[941,970,958],[939,941,958],[978,939,958],[970,978,958],[875,952,901],[951,875,901],[952,951,901],[875,951,893],[853,875,893],[949,853,893],[951,949,893],[825,952,891],[875,825,891],[952,875,891],[825,875,827],[775,825,827],[853,775,827],[875,853,827],[853,949,881],[843,853,881],[947,843,881],[949,947,881],[843,947,883],[857,843,883],[945,857,883],[947,945,883],[775,853,796],[767,775,796],[843,767,796],[853,843,796],[767,843,802],[781,767,802],[857,781,802],[843,857,802],[786,952,871],[825,786,871],[952,825,871],[786,825,779],[737,786,779],[775,737,779],[825,775,779],[782,952,863],[786,782,863],[952,786,863],[782,786,761],[720,782,761],[737,720,761],[786,737,761],[737,775,751],[724,737,751],[767,724,751],[775,767,751],[724,767,759],[745,724,759],[781,745,759],[767,781,759],[720,737,722],[715,720,722],[724,715,722],[737,724,722],[715,724,726],[727,715,726],[745,727,726],[724,745,726],[857,945,895],[879,857,895],[943,879,895],[945,943,895],[781,857,841],[851,781,841],[879,851,841],[857,879,841],[879,943,899],[885,879,899],[941,885,899],[943,941,899],[885,941,897],[877,885,897],[939,877,897],[941,939,897],[851,879,869],[861,851,869],[885,861,869],[879,885,869],[861,885,865],[845,861,865],[877,845,865],[885,877,865],[745,781,784],[808,745,784],[851,808,784],[781,851,784],[727,745,773],[794,727,773],[808,794,773],[745,808,773],[808,851,837],[831,808,837],[861,831,837],[851,861,837],[831,861,835],[806,831,835],[845,806,835],[861,845,835],[794,808,816],[823,794,816],[831,823,816],[808,831,816],[823,831,814],[791,823,814],[806,791,814],[831,806,814],[785,952,862],[782,785,862],[952,782,862],[785,782,760],[736,785,760],[720,736,760],[782,720,760],[824,952,870],[785,824,870],[952,785,870],[824,785,778],[774,824,778],[736,774,778],[785,736,778],[736,720,721],[723,736,721],[715,723,721],[720,715,721],[723,715,725],[744,723,725],[727,744,725],[715,727,725],[774,736,750],[766,774,750],[723,766,750],[736,723,750],[766,723,758],[780,766,758],[744,780,758],[723,744,758],[874,952,890],[824,874,890],[952,824,890],[874,824,826],[852,874,826],[774,852,826],[824,774,826],[950,952,900],[874,950,900],[952,874,900],[950,874,892],[948,950,892],[852,948,892],[874,852,892],[852,774,795],[842,852,795],[766,842,795],[774,766,795],[842,766,801],[856,842,801],[780,856,801],[766,780,801],[948,852,880],[946,948,880],[842,946,880],[852,842,880],[946,842,882],[944,946,882],[856,944,882],[842,856,882],[744,727,772],[807,744,772],[794,807,772],[727,794,772],[780,744,783],[850,780,783],[807,850,783],[744,807,783],[807,794,815],[830,807,815],[823,830,815],[794,823,815],[830,823,813],[805,830,813],[791,805,813],[823,791,813],[850,807,836],[860,850,836],[830,860,836],[807,830,836],[860,830,834],[844,860,834],[805,844,834],[830,805,834],[856,780,840],[878,856,840],[850,878,840],[780,850,840],[944,856,894],[942,944,894],[878,942,894],[856,878,894],[878,850,868],[884,878,868],[860,884,868],[850,860,868],[884,860,864],[876,884,864],[844,876,864],[860,844,864],[942,878,898],[940,942,898],[884,940,898],[878,884,898],[940,884,896],[938,940,896],[876,938,896],[884,876,896],[979,952,953],[950,979,953],[952,950,953],[979,950,961],[1001,979,961],[948,1001,961],[950,948,961],[1029,952,963],[979,1029,963],[952,979,963],[1029,979,1027],[1079,1029,1027],[1001,1079,1027],[979,1001,1027],[1001,948,973],[1011,1001,973],[946,1011,973],[948,946,973],[1011,946,971],[997,1011,971],[944,997,971],[946,944,971],[1079,1001,1058],[1087,1079,1058],[1011,1087,1058],[1001,1011,1058],[1087,1011,1052],[1073,1087,1052],[997,1073,1052],[1011,997,1052],[1068,952,983],[1029,1068,983],[952,1029,983],[1068,1029,1075],[1117,1068,1075],[1079,1117,1075],[1029,1079,1075],[1072,952,991],[1068,1072,991],[952,1068,991],[1072,1068,1093],[1134,1072,1093],[1117,1134,1093],[1068,1117,1093],[1117,1079,1103],[1130,1117,1103],[1087,1130,1103],[1079,1087,1103],[1130,1087,1095],[1109,1130,1095],[1073,1109,1095],[1087,1073,1095],[1134,1117,1132],[1139,1134,1132],[1130,1139,1132],[1117,1130,1132],[1139,1130,1128],[1127,1139,1128],[1109,1127,1128],[1130,1109,1128],[997,944,959],[975,997,959],[942,975,959],[944,942,959],[1073,997,1013],[1003,1073,1013],[975,1003,1013],[997,975,1013],[975,942,955],[969,975,955],[940,969,955],[942,940,955],[969,940,957],[977,969,957],[938,977,957],[940,938,957],[1003,975,985],[993,1003,985],[969,993,985],[975,969,985],[993,969,989],[1009,993,989],[977,1009,989],[969,977,989],[1109,1073,1070],[1046,1109,1070],[1003,1046,1070],[1073,1003,1070],[1127,1109,1081],[1060,1127,1081],[1046,1060,1081],[1109,1046,1081],[1046,1003,1017],[1023,1046,1017],[993,1023,1017],[1003,993,1017],[1023,993,1019],[1048,1023,1019],[1009,1048,1019],[993,1009,1019],[1060,1046,1038],[1031,1060,1038],[1023,1031,1038],[1046,1023,1038],[1031,1023,1040],[1063,1031,1040],[1048,1063,1040],[1023,1048,1040],[1049,1063,1120],[1161,1049,1120],[1170,1161,1120],[1063,1170,1120],[1010,1049,1092],[1126,1010,1092],[1161,1126,1092],[1049,1161,1092],[1165,1170,1224],[1272,1165,1224],[1279,1272,1224],[1170,1279,1224],[1161,1165,1216],[1250,1161,1216],[1272,1250,1216],[1165,1272,1216],[1141,1161,1196],[1234,1141,1196],[1250,1234,1196],[1161,1250,1196],[1126,1141,1178],[1206,1126,1178],[1234,1206,1178],[1141,1234,1178],[978,1010,1045],[1043,978,1045],[1126,1043,1045],[1010,1126,1045],[939,978,966],[937,939,966],[1043,937,966],[978,1043,966],[1084,1126,1153],[1174,1084,1153],[1206,1174,1153],[1126,1206,1153],[1043,1084,1112],[1124,1043,1112],[1174,1124,1112],[1084,1174,1112],[982,1043,1055],[1033,982,1055],[1124,1033,1055],[1043,1124,1055],[937,982,968],[935,937,968],[1033,935,968],[982,1033,968],[1272,1279,1321],[1369,1272,1321],[1376,1369,1321],[1279,1376,1321],[1250,1272,1309],[1347,1250,1309],[1369,1347,1309],[1272,1369,1309],[1234,1250,1285],[1315,1234,1285],[1347,1315,1285],[1250,1347,1285],[1206,1234,1252],[1278,1206,1252],[1315,1278,1252],[1234,1315,1252],[1369,1376,1388],[1402,1369,1388],[1415,1402,1388],[1376,1415,1388],[1347,1369,1375],[1378,1347,1375],[1402,1378,1375],[1369,1402,1375],[1402,1415,1419],[1423,1402,1419],[1434,1423,1419],[1415,1434,1419],[1378,1402,1396],[1390,1378,1396],[1423,1390,1396],[1402,1423,1396],[1315,1347,1339],[1335,1315,1339],[1378,1335,1339],[1347,1378,1339],[1278,1315,1305],[1295,1278,1305],[1335,1295,1305],[1315,1335,1305],[1335,1378,1365],[1353,1335,1365],[1390,1353,1365],[1378,1390,1365],[1295,1335,1325],[1301,1295,1325],[1353,1301,1325],[1335,1353,1325],[1174,1206,1222],[1226,1174,1222],[1278,1226,1222],[1206,1278,1222],[1124,1174,1176],[1169,1124,1176],[1226,1169,1176],[1174,1226,1176],[1033,1124,1108],[1078,1033,1108],[1169,1078,1108],[1124,1169,1108],[935,1033,988],[931,935,988],[1078,931,988],[1033,1078,988],[1226,1278,1256],[1240,1226,1256],[1295,1240,1256],[1278,1295,1256],[1169,1226,1202],[1180,1169,1202],[1240,1180,1202],[1226,1240,1202],[1240,1295,1274],[1244,1240,1274],[1301,1244,1274],[1295,1301,1274],[1180,1240,1218],[1186,1180,1218],[1244,1186,1218],[1240,1244,1218],[1078,1169,1138],[1086,1078,1138],[1180,1086,1138],[1169,1180,1138],[931,1078,996],[925,931,996],[1086,925,996],[1078,1086,996],[1086,1180,1145],[1090,1086,1145],[1186,1090,1145],[1180,1186,1145],[925,1086,1e3],[921,925,1e3],[1090,921,1e3],[1086,1090,1e3],[877,939,889],[812,877,889],[937,812,889],[939,937,889],[845,877,810],[729,845,810],[812,729,810],[877,812,810],[873,937,887],[822,873,887],[935,822,887],[937,935,887],[812,873,800],[731,812,800],[822,731,800],[873,822,800],[771,812,743],[681,771,743],[731,681,743],[812,731,743],[729,771,702],[649,729,702],[681,649,702],[771,681,702],[806,845,763],[694,806,763],[729,694,763],[845,729,763],[791,806,735],[684,791,735],[694,684,735],[806,694,735],[714,729,677],[621,714,677],[649,621,677],[729,649,677],[694,714,659],[605,694,659],[621,605,659],[714,621,659],[690,694,639],[583,690,639],[605,583,639],[694,605,639],[684,690,631],[575,684,631],[583,575,631],[690,583,631],[822,935,867],[777,822,867],[931,777,867],[935,931,867],[731,822,747],[686,731,747],[777,686,747],[822,777,747],[681,731,679],[629,681,679],[686,629,679],[731,686,679],[649,681,633],[577,649,633],[629,577,633],[681,629,633],[777,931,859],[769,777,859],[925,769,859],[931,925,859],[686,777,717],[675,686,717],[769,675,717],[777,769,717],[769,925,855],[765,769,855],[921,765,855],[925,921,855],[675,769,710],[669,675,710],[765,669,710],[769,765,710],[629,686,653],[615,629,653],[675,615,653],[686,675,653],[577,629,599],[560,577,599],[615,560,599],[629,615,599],[615,675,637],[611,615,637],[669,611,637],[675,669,637],[560,615,581],[554,560,581],[611,554,581],[615,611,581],[621,649,603],[540,621,603],[577,540,603],[649,577,603],[605,621,570],[508,605,570],[540,508,570],[621,540,570],[583,605,546],[486,583,546],[508,486,546],[605,508,546],[575,583,534],[478,575,534],[486,478,534],[583,486,534],[540,577,550],[520,540,550],[560,520,550],[577,560,550],[508,540,516],[477,508,516],[520,477,516],[540,520,516],[520,560,530],[502,520,530],[554,502,530],[560,554,530],[477,520,490],[465,477,490],[502,465,490],[520,502,490],[486,508,480],[453,486,480],[477,453,480],[508,477,480],[478,486,467],[439,478,467],[453,439,467],[486,453,467],[453,477,459],[432,453,459],[465,432,459],[477,465,459],[439,453,436],[420,439,436],[432,420,436],[453,432,436],[805,791,734],[693,805,734],[684,693,734],[791,684,734],[844,805,762],[728,844,762],[693,728,762],[805,693,762],[689,684,630],[582,689,630],[575,582,630],[684,575,630],[693,689,638],[604,693,638],[582,604,638],[689,582,638],[713,693,658],[620,713,658],[604,620,658],[693,604,658],[728,713,676],[648,728,676],[620,648,676],[713,620,676],[876,844,809],[811,876,809],[728,811,809],[844,728,809],[938,876,888],[936,938,888],[811,936,888],[876,811,888],[770,728,701],[680,770,701],[648,680,701],[728,648,701],[811,770,742],[730,811,742],[680,730,742],[770,680,742],[872,811,799],[821,872,799],[730,821,799],[811,730,799],[936,872,886],[934,936,886],[821,934,886],[872,821,886],[582,575,533],[485,582,533],[478,485,533],[575,478,533],[604,582,545],[507,604,545],[485,507,545],[582,485,545],[620,604,569],[539,620,569],[507,539,569],[604,507,569],[648,620,602],[576,648,602],[539,576,602],[620,539,602],[485,478,466],[452,485,466],[439,452,466],[478,439,466],[507,485,479],[476,507,479],[452,476,479],[485,452,479],[452,439,435],[431,452,435],[420,431,435],[439,420,435],[476,452,458],[464,476,458],[431,464,458],[452,431,458],[539,507,515],[519,539,515],[476,519,515],[507,476,515],[576,539,549],[559,576,549],[519,559,549],[539,519,549],[519,476,489],[501,519,489],[464,501,489],[476,464,489],[559,519,529],[553,559,529],[501,553,529],[519,501,529],[680,648,632],[628,680,632],[576,628,632],[648,576,632],[730,680,678],[685,730,678],[628,685,678],[680,628,678],[821,730,746],[776,821,746],[685,776,746],[730,685,746],[934,821,866],[930,934,866],[776,930,866],[821,776,866],[628,576,598],[614,628,598],[559,614,598],[576,559,598],[685,628,652],[674,685,652],[614,674,652],[628,614,652],[614,559,580],[610,614,580],[553,610,580],[559,553,580],[674,614,636],[668,674,636],[610,668,636],[614,610,636],[776,685,716],[768,776,716],[674,768,716],[685,674,716],[930,776,858],[924,930,858],[768,924,858],[776,768,858],[768,674,709],[764,768,709],[668,764,709],[674,668,709],[924,768,854],[920,924,854],[764,920,854],[768,764,854],[977,938,965],[1042,977,965],[936,1042,965],[938,936,965],[1009,977,1044],[1125,1009,1044],[1042,1125,1044],[977,1042,1044],[981,936,967],[1032,981,967],[934,1032,967],[936,934,967],[1042,981,1054],[1123,1042,1054],[1032,1123,1054],[981,1032,1054],[1083,1042,1111],[1173,1083,1111],[1123,1173,1111],[1042,1123,1111],[1125,1083,1152],[1205,1125,1152],[1173,1205,1152],[1083,1173,1152],[1048,1009,1091],[1160,1048,1091],[1125,1160,1091],[1009,1125,1091],[1063,1048,1119],[1170,1063,1119],[1160,1170,1119],[1048,1160,1119],[1140,1125,1177],[1233,1140,1177],[1205,1233,1177],[1125,1205,1177],[1160,1140,1195],[1249,1160,1195],[1233,1249,1195],[1140,1233,1195],[1164,1160,1215],[1271,1164,1215],[1249,1271,1215],[1160,1249,1215],[1170,1164,1223],[1279,1170,1223],[1271,1279,1223],[1164,1271,1223],[1032,934,987],[1077,1032,987],[930,1077,987],[934,930,987],[1123,1032,1107],[1168,1123,1107],[1077,1168,1107],[1032,1077,1107],[1173,1123,1175],[1225,1173,1175],[1168,1225,1175],[1123,1168,1175],[1205,1173,1221],[1277,1205,1221],[1225,1277,1221],[1173,1225,1221],[1077,930,995],[1085,1077,995],[924,1085,995],[930,924,995],[1168,1077,1137],[1179,1168,1137],[1085,1179,1137],[1077,1085,1137],[1085,924,999],[1089,1085,999],[920,1089,999],[924,920,999],[1179,1085,1144],[1185,1179,1144],[1089,1185,1144],[1085,1089,1144],[1225,1168,1201],[1239,1225,1201],[1179,1239,1201],[1168,1179,1201],[1277,1225,1255],[1294,1277,1255],[1239,1294,1255],[1225,1239,1255],[1239,1179,1217],[1243,1239,1217],[1185,1243,1217],[1179,1185,1217],[1294,1239,1273],[1300,1294,1273],[1243,1300,1273],[1239,1243,1273],[1233,1205,1251],[1314,1233,1251],[1277,1314,1251],[1205,1277,1251],[1249,1233,1284],[1346,1249,1284],[1314,1346,1284],[1233,1314,1284],[1271,1249,1308],[1368,1271,1308],[1346,1368,1308],[1249,1346,1308],[1279,1271,1320],[1376,1279,1320],[1368,1376,1320],[1271,1368,1320],[1314,1277,1304],[1334,1314,1304],[1294,1334,1304],[1277,1294,1304],[1346,1314,1338],[1377,1346,1338],[1334,1377,1338],[1314,1334,1338],[1334,1294,1324],[1352,1334,1324],[1300,1352,1324],[1294,1300,1324],[1377,1334,1364],[1389,1377,1364],[1352,1389,1364],[1334,1352,1364],[1368,1346,1374],[1401,1368,1374],[1377,1401,1374],[1346,1377,1374],[1376,1368,1387],[1415,1376,1387],[1401,1415,1387],[1368,1401,1387],[1401,1377,1395],[1422,1401,1395],[1389,1422,1395],[1377,1389,1395],[1415,1401,1418],[1434,1415,1418],[1422,1434,1418],[1401,1422,1418]];var c=function(a,b){var c=new Array(a.length);for(var d=0;d<b.length;d++){var e=b[d][0];var f=b[d][1];var g=b[d][2];var h=a[e];var i=a[f];var j=a[g];i=SceneJS_math_subVec4(i,h,[0,0,0,0]);j=SceneJS_math_subVec4(j,h,[0,0,0,0]);var k=SceneJS_math_normalizeVec4(SceneJS_math_cross3Vec4(i,j,[0,0,0,0]),[0,0,0,0]);if(!c[e])c[e]=[];if(!c[f])c[f]=[];if(!c[g])c[g]=[];c[e].push(k);c[f].push(k);c[g].push(k)}var l=new Array(a.length);for(var d=0;d<c.length;d++){var m=c[d].length;var n=0;var o=0;var p=0;for(var q=0;q<m;q++){n+=c[d][q][0];o+=c[d][q][1];p+=c[d][q][2]}l[d]=[-(n/m),-(o/m),-(p/m)]}return l};var d=function(a,b){var c=[];for(var d=0;d<a.length;d++){if(b&&a[d].length!=b)throw SceneJS_errorModule.fatalError("Bad geometry array element");for(var e=0;e<a[d].length;e++)c.push(a[d][e])}return c};return{primitive:"triangles",positions:d(a,3),indices:d(b,3),normals:d(c(a,b),3)}}var b=SceneJS.createNodeType("teapot","geometry");b.prototype._init=function(){this.attr.type="teapot";SceneJS_geometry.prototype._init.call(this,{coreId:"teapot",create:a})}})();(function(){var a=SceneJS.createNodeType("box","geometry");a.prototype._init=function(a){this.attr.type="box";var b=a.xSize||1;var c=a.ySize||1;var d=a.zSize||1;var e=a.solid!=undefined?a.solid:true;SceneJS_geometry.prototype._init.call(this,{resource:"box_"+b+"_"+c+"_"+d+(e?"_solid":"wire"),create:function(){var a=[b,c,d,-b,c,d,-b,-c,d,b,-c,d,b,c,d,b,-c,d,b,-c,-d,b,c,-d,b,c,d,b,c,-d,-b,c,-d,-b,c,d,-b,c,d,-b,c,-d,-b,-c,-d,-b,-c,d,-b,-c,-d,b,-c,-d,b,-c,d,-b,-c,d,b,-c,-d,-b,-c,-d,-b,c,-d,b,c,-d];var f=[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1];var g=[b,c,0,c,0,0,b,0,0,c,0,0,b,0,b,c,b,0,b,c,0,c,0,0,b,c,0,c,0,0,b,0,0,0,b,0,b,c,0,c,0,0,b,0,b,c,0,c];var h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{primitive:e?"triangles":"lines",positions:a,normals:f,uv:g,indices:h,colors:[]}}})};SceneJS.createNodeType("cube","box")})();(function(){var a=SceneJS.createNodeType("sphere","geometry");a.prototype._init=function(a){var b=a.slices||30;var c=a.rings||30;var d=a.radius||1;var e=a.semiMajorAxis||1;var f=1/e;var g=a.sweep||1;if(g>1){g=1}var h=a.sliceDepth||1;if(h>1){h=1}var i=c*g;var j=b*h;SceneJS_geometry.prototype._init.call(this,{coreId:a.coreId||"sphere_"+d+"_"+c+"_"+b+"_"+e+"_"+g+"_"+h,scale:a.scale,origin:a.origin,create:function(){var a=[];var g=[];var k=[];var l,m,n;for(m=0;m<=b;m++){if(m>j)break;var o=m*Math.PI/b;var p=Math.sin(o);var q=Math.cos(o);for(l=0;l<=c;l++){if(l>i)break;var r=l*2*Math.PI/c;var s=f*Math.sin(r);var t=e*Math.cos(r);var u=t*p;var v=q;var w=s*p;var x=1-l/c;var y=m/b;g.push(u);g.push(v);g.push(w);k.push(x);k.push(y);a.push(d*u);a.push(d*v);a.push(d*w)}}if(h<1){var z=Math.cos((m-1)*Math.PI/b)*d;a.push(0,z,0);g.push(1,1,1);k.push(1,1)}else{a.push(0,0,0);g.push(1,1,1);k.push(1,1)}var A=a.length/3-1;var B=[];for(m=0;m<b;m++){if(m>=j)break;for(l=0;l<c;l++){if(l>=i)break;var C=m*(i+1)+l;var D=C+i+1;B.push(C);B.push(D);B.push(C+1);B.push(D);B.push(D+1);B.push(C+1)}if(c>=i){n=(i+1)*m;B.push(n,n+i+1,A);B.push(n+i,n+i*2+1,A)}}if(b>j){for(l=1;l<=i;l++){n=m*i+l;B.push(n,n+1,A)}B.push(n+1,m*i+1,A)}return{primitive:"triangles",positions:a,normals:g,uv:k,indices:B}}})}})();(function(){var a=SceneJS.createNodeType("quad","geometry");a.prototype._init=function(a){this.attr.type="quad";var b=a.solid!=undefined?a.solid:true;var c=a.xSize||1;var d=a.ySize||1;SceneJS_geometry.prototype._init.call(this,{coreId:a.coreId||"quad_"+c+"_"+d+(b?"_solid":"_wire"),create:function(){var e=a.xDiv||1;var f=a.yDiv||1;var g,h,i,j;if(e==1&&f==1){g=[c,d,0,-c,d,0,-c,-d,0,c,-d,0];h=[0,0,1,0,0,1,0,0,1,0,0,1];i=[1,1,0,1,0,0,1,0];j=[2,1,0,3,2,0]}else{if(e<0){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"quad xDiv should be greater than zero")}if(f<0){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"quad yDiv should be greater than zero")}g=[];h=[];i=[];j=[];var k=c*2/e;var l=d*2/f;var m=.5/e;var n=.5/f;var o=0;for(var p=-d,q=0;p<=d;p+=l,q+=n){for(var r=-c,s=0;r<=c;r+=k,s+=m){g.push(r);g.push(p);g.push(0);h.push(0);h.push(0);h.push(1);i.push(s);i.push(q);if(p<d&&r<c){j.push(o+2);j.push(o+1);j.push(o);j.push(o+3);j.push(o+2);j.push(o)}o+=3}}}return{primitive:b?"triangles":"lines",positions:g,normals:h,uv:i,indices:j,colors:[]}}})}})();(function(){var a=SceneJS.createNodeType("disk","geometry");a.prototype._init=function(a){this.attr.type="disk";var b=a.radius||1;var c=a.height||1;var d=a.rings||30;var e=a.innerRadius||0;if(e>b){e=b}var f=a.semiMajorAxis||1;var g=1/f;var h=a.sweep||1;if(h>1){h=1}var i=d*h;SceneJS_geometry.prototype._init.call(this,{coreId:a.coreId||"disk_"+b+"_"+c+"_"+d+"_"+e+"_"+f+"_"+h,create:function(){var a=[];var h=[];var j=[];var k=c*-.5;var l=c*.5;if(e<=0){h.push(0);h.push(-1);h.push(0);j.push(s);j.push(t);a.push(0);a.push(k);a.push(0);h.push(0);h.push(1);h.push(0);j.push(s);j.push(t);a.push(0);a.push(l);a.push(0)}for(var m=0;m<=d;m++){if(m>i)break;var n=m*2*Math.PI/d;var o=g*Math.sin(n);var p=f*Math.cos(n);var q=p;var r=o;var s=1-m/d;var t=.5;h.push(0);h.push(-1);h.push(0);j.push(s);j.push(t);a.push(b*q);a.push(k);a.push(b*r);h.push(q);h.push(0);h.push(r);j.push(s);j.push(t);a.push(b*q);a.push(k);a.push(b*r);h.push(0);h.push(1);h.push(0);j.push(s);j.push(t);a.push(b*q);a.push(l);a.push(b*r);h.push(q);h.push(0);h.push(r);j.push(s);j.push(t);a.push(b*q);a.push(l);a.push(b*r);if(e>0){h.push(0);h.push(-1);h.push(0);j.push(s);j.push(t);a.push(e*q);a.push(k);a.push(e*r);h.push(-q);h.push(0);h.push(-r);j.push(s);j.push(t);a.push(e*q);a.push(k);a.push(e*r);h.push(0);h.push(1);h.push(0);j.push(s);j.push(t);a.push(e*q);a.push(l);a.push(e*r);h.push(-q);h.push(0);h.push(-r);j.push(s);j.push(t);a.push(e*q);a.push(l);a.push(e*r)}if(m+1>i){h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(b*f);a.push(k);a.push(0);h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(b*f);a.push(l);a.push(0);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(b*q);a.push(k);a.push(b*r);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(b*q);a.push(l);a.push(b*r);if(e>0){h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(e*f);a.push(k);a.push(0);h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(e*f);a.push(l);a.push(0);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(e*q);a.push(k);a.push(e*r);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(e*q);a.push(l);a.push(e*r)}else{h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(0);a.push(k);a.push(0);h.push(0);h.push(0);h.push(-1);j.push(s);j.push(t);a.push(0);a.push(l);a.push(0);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(0);a.push(k);a.push(0);h.push(-r);h.push(0);h.push(q);j.push(s);j.push(t);a.push(0);a.push(l);a.push(0)}break}}var u=[];if(e>0){var v;for(var m=0;m<d;m++){if(m+1>i){v=(m+1)*8;u.push(v);u.push(v+4);u.push(v+5);u.push(v);u.push(v+5);u.push(v+1);u.push(v+2);u.push(v+7);u.push(v+6);u.push(v+2);u.push(v+3);u.push(v+7);break}v=m*8;u.push(v+1);u.push(v+3);u.push(v+11);u.push(v+1);u.push(v+11);u.push(v+9);u.push(v+5);u.push(v+7);u.push(v+15);u.push(v+5);u.push(v+15);u.push(v+13);u.push(v);u.push(v+8);u.push(v+12);u.push(v+0);u.push(v+12);u.push(v+4);u.push(v+2);u.push(v+6);u.push(v+14);u.push(v+2);u.push(v+14);u.push(v+10)}}else{for(var m=0;m<d;m++){if(m+1>i){v=2+(m+1)*4;u.push(v);u.push(v+4);u.push(v+5);u.push(v+0);u.push(v+5);u.push(v+1);u.push(v+2);u.push(v+7);u.push(v+6);u.push(v+2);u.push(v+3);u.push(v+7);break}var v=m*4+2;u.push(v+1);u.push(v+3);u.push(v+7);u.push(v+1);u.push(v+7);u.push(v+5);u.push(v);u.push(0);u.push(v+4);u.push(v+2);u.push(1);u.push(v+6)}}return{primitive:"triangles",positions:a,normals:h,uv:j,indices:u}}})}})();var SceneJS_vectorTextModule=new function(){function b(b){return a[b]}function c(a,b){return b}function d(a,b){return 7*b/25}function e(a,c,d){var e=0;var f=d.length;for(var g=0;g<f;g++){var h=b(d.charAt(g));if(h)e+=h.width*c/25}return e}var a={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};this.getGeometry=function(a,c,d,e){var f={positions:[],indices:[]};var g=e.split("\n");var h=0;var i=d;for(var j=0;j<g.length;j++){var k=c;var l=g[j];var m=l.length;var n=a/25;for(var o=0;o<m;o++){var p=b(l.charAt(o));if(p=="\n"){alert("newline")}if(!p){continue}var q=1;var r=-1;var s=-1;var t=false;for(var u=0;u<p.points.length;u++){var v=p.points[u];if(v[0]==-1&&v[1]==-1){q=1;t=false;continue}f.positions.push(k+v[0]*n);f.positions.push(i+v[1]*n);f.positions.push(0);if(r==-1){r=h}else if(s==-1){s=h}else{r=s;s=h}h++;if(q){q=false}else{f.indices.push(r);f.indices.push(s)}t=true}k+=p.width*n}i+=25*n}return f}};var SceneJS_bitmapTextModule=new function(){function a(a){if(a.length!=4){return a}for(var b=0;b<a.length;b++){a[b]*=255}return"rgba("+a.join(",")+")"}SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){});this.createText=function(b,c,d){var e=document.createElement("canvas");var f=e.getContext("2d");f.font=c+"px "+b;var g=f.measureText(d).width;e.width=g;e.height=c;f.font=c+"px "+b;f.textBaseline="middle";f.fillStyle=a([.5,10,30,.5]);f.fillStyle="#FFFF00";var h=0;var i=c/2;f.fillText(d,h,i);return{image:e,width:e.width,height:e.height}}};SceneJS.Text=SceneJS.createNodeType("text");SceneJS.Text.prototype._init=function(a){var b=a.mode||"bitmap";if(b!="vector"&&b!="bitmap"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Text unsupported mode - should be 'vector' or 'bitmap'")}this._mode=b;if(this._mode=="bitmap"){var c=SceneJS_bitmapTextModule.createText("Helvetica",a.size||1,a.text||"");var d=c.width/16;var e=c.height/16;var f=[d,e,.01,0,e,.1,0,0,.1,d,0,.01];var g=[0,0,-1,0,0,-1,0,0,-1,0,0,-1];var h=[1,1,0,1,0,0,1,0];var i=[0,1,2,0,2,3];if(a.doubleSided){var j=.01;f=f.concat([d,0,-j,0,0,-j,0,e,-j,d,e,-j]);g=g.concat([0,0,1,0,0,1,0,0,1,0,0,1]);h=h.concat([0,0,1,0,1,1,0,1]);i=i.concat([4,5,6,4,6,7])}this.addNode({type:"texture",layers:[{image:c.image,minFilter:"linear",magFilter:"linear",wrapS:"repeat",wrapT:"repeat",isDepth:false,depthMode:"luminance",depthCompareMode:"compareRToTexture",depthCompareFunc:"lequal",flipY:false,width:1,height:1,internalFormat:"lequal",sourceFormat:"alpha",sourceType:"unsignedByte",applyTo:"baseColor",blendMode:"add"}],nodes:[{type:"material",emit:1,baseColor:{r:1,g:0,b:0},specularColor:{r:.9,g:.9,b:.9},specular:.9,shine:100,nodes:[{type:"geometry",primitive:"triangles",positions:f,normals:g,uv:h,indices:i}]}]})}else{var k=this;this.addNode({type:"geometry",create:function(){var b=SceneJS_vectorTextModule.getGeometry(3,0,0,a.text);return{resource:k.attr.id,primitive:"lines",positions:b.positions,normals:[],uv:[],indices:b.indices,colors:[]}}})}};SceneJS.Text.prototype._compile=function(){if(this._mode=="bitmap"){this._compileNodes()}};var SceneJS_modelTransformModule=new function(){var a={matrix:SceneJS_math_identityMat4(),fixed:true,identity:true};var b=[];var c=[];var d=0;var e;this.transform=a;var f;var g=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){d=0;e=null;g.transform=a;f=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(a){if(f){if(d>0){var b=g.transform;if(!b.matrixAsArray){b.matrixAsArray=new Float32Array(b.matrix);b.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(b.matrix,SceneJS_math_mat4())))}else{b.matrixAsArray.set(b.matrix);b.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(b.matrix,SceneJS_math_mat4())))}SceneJS_DrawList.setModelTransform(e,b.matrixAsArray,b.normalMatrixAsArray)}else{SceneJS_DrawList.setModelTransform()}f=false}});this.pushTransform=function(a,g){b[d]=a;c[d]=g;d++;e=a;this.transform=g;f=true};this.popTransform=function(){d--;if(d>0){e=b[d-1];this.transform=c[d-1]}else{e=null;this.transform=a}f=true}};(function(){var a=SceneJS.createNodeType("rotate");a.prototype._init=function(a){if(this.core._nodeCount==1){this.setMultOrder(a.multOrder);this.setAngle(a.angle);this.setXYZ({x:a.x,y:a.y,z:a.z})}this._mat=null;this._xf={}};a.prototype.setMultOrder=function(a){a=a||"post";if(a!="post"&&a!="pre"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal rotate multOrder - '"+a+"' should be 'pre' or 'post'")}this.core.multOrder=a;this._postMult=a=="post";this._compileMemoLevel=0};a.prototype.setAngle=function(a){this.core.angle=a||0;this._compileMemoLevel=0};a.prototype.getAngle=function(){return this.core.angle};a.prototype.setXYZ=function(a){a=a||{};this.core.x=a.x||0;this.core.y=a.y||0;this.core.z=a.z||0;this._compileMemoLevel=0};a.prototype.getXYZ=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}};a.prototype.setX=function(a){this.core.x=a;this._compileMemoLevel=0};a.prototype.getX=function(){return this.core.x};a.prototype.setY=function(a){this.core.y=a;this._compileMemoLevel=0};a.prototype.getY=function(){return this.core.y};a.prototype.setZ=function(a){this.core.z=a;this._compileMemoLevel=0};a.prototype.getZ=function(){return this.core.z};a.prototype.incX=function(a){this.core.x+=a;this._compileMemoLevel=0};a.prototype.incY=function(a){this.core.y+=a};a.prototype.incZ=function(a){this.core.z+=a;this._compileMemoLevel=0};a.prototype.incAngle=function(a){this.core.angle+=a;this._compileMemoLevel=0};a.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_rotationMat4v(this.core.angle*Math.PI/180,[this.core.x,this.core.y,this.core.z])};a.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z,angle:this.core.angle}};a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=this._compileMemoLevel;if(this._compileMemoLevel==0){this._compileMemoLevel=1;if(this.core.x!=0||this.core.y!=0||this.core.z!=0){var b=this.core.angle;this._mat=SceneJS_math_rotationMat4v(b*Math.PI/180,[this.core.x,this.core.y,this.core.z])}else{this._mat=SceneJS_math_identityMat4()}}var c=SceneJS_modelTransformModule.transform;if(a<2||!c.fixed){var d=SceneJS_math_mat4();if(this._postMult){SceneJS_math_mulMat4(c.matrix,this._mat,d)}else{SceneJS_math_mulMat4(this._mat,c.matrix,d)}this._xf.localMatrix=this._mat;this._xf.matrix=d;this._xf.fixed=a==2;if(this._compileMemoLevel==1&&c.fixed){this._compileMemoLevel=2}}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)};a.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})();(function(){var a=SceneJS.createNodeType("translate");a.prototype._init=function(a){this._mat=null;this._xf={};if(this.core._nodeCount==1){this.setMultOrder(a.multOrder);this.setXyz({x:a.x,y:a.y,z:a.z})}};a.prototype.setMultOrder=function(a){a=a||"post";if(a!="post"&&a!="pre"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal translate multOrder - '"+a+"' should be 'pre' or 'post'")}this.core.multOrder=a;this._postMult=a=="post";this._compileMemoLevel=0};a.prototype.setXyz=function(a){a=a||{};var b=a.x||0;var c=a.y||0;var d=a.z||0;this.core.x=b;this.core.y=c;this.core.z=d;this._compileMemoLevel=0};a.prototype.getXyz=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}};a.prototype.setX=function(a){this.core.x=a;this._compileMemoLevel=0};a.prototype.getX=function(){return this.core.x};a.prototype.setY=function(a){this.core.y=a;this._compileMemoLevel=0};a.prototype.getY=function(){return this.core.y};a.prototype.setZ=function(a){this.core.z=a;this._compileMemoLevel=0};a.prototype.getZ=function(){return this.core.z};a.prototype.incX=function(a){this.core.x+=a;this._compileMemoLevel=0};a.prototype.incY=function(a){this.core.y+=a};a.prototype.incZ=function(a){this.core.z+=a;this._compileMemoLevel=0};a.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_translationMat4v([this.core.x,this.core.y,this.core.z])};a.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}};a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=this._compileMemoLevel;if(this._compileMemoLevel==0){this._mat=SceneJS_math_translationMat4v([this.core.x,this.core.y,this.core.z]);this._compileMemoLevel=1}var b=SceneJS_modelTransformModule.transform;if(a<2||!b.fixed){var c=SceneJS_math_mat4();if(this._postMult){SceneJS_math_mulMat4(b.matrix,this._mat,c)}else{SceneJS_math_mulMat4(this._mat,b.matrix,c)}this._xf.localMatrix=this._mat;this._xf.matrix=c;this._xf.fixed=a==2;if(this._compileMemoLevel==1&&b.fixed){this._compileMemoLevel=2}}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)};a.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})();(function(){var a=SceneJS.createNodeType("scale");a.prototype._init=function(a){if(this.core._nodeCount==1){this.setMultOrder(a.multOrder);this.setXYZ({x:a.x,y:a.y,z:a.z})}this._mat=null;this._xf={}};a.prototype.setMultOrder=function(a){a=a||"post";if(a!="post"&&a!="pre"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal scale multOrder - '"+a+"' should be 'pre' or 'post'")}this.core.multOrder=a;this._postMult=a=="post";this._compileMemoLevel=0};a.prototype.setXYZ=function(a){a=a||{};this.core.x=a.x!=undefined?a.x:1;this.core.y=a.y!=undefined?a.y:1;this.core.z=a.z!=undefined?a.z:1;this._resetCompilationMemos();return this};a.prototype.getXYZ=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}};a.prototype.setX=function(a){this.core.x=a!=undefined&&a!=null?a:1;this._resetCompilationMemos();return this};a.prototype.getX=function(){return this.core.x};a.prototype.setY=function(a){this.core.y=a!=undefined&&a!=null?a:1;this._resetCompilationMemos();return this};a.prototype.getY=function(){return this.core.y};a.prototype.setZ=function(a){this.core.z=a!=undefined&&a!=null?a:1;this._resetCompilationMemos();return this};a.prototype.getZ=function(){return this.core.z};a.prototype.incX=function(a){this.core.x+=a;this._compileMemoLevel=0};a.prototype.incY=function(a){this.core.y+=a};a.prototype.incZ=function(a){this.core.z+=a;this._compileMemoLevel=0};a.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_scalingMat4v([this.core.x,this.core.y,this.core.z])};a.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}};a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=this._compileMemoLevel;if(this._compileMemoLevel==0){this._compileMemoLevel=1;this._mat=SceneJS_math_scalingMat4v([this.core.x,this.core.y,this.core.z])}var b=SceneJS_modelTransformModule.transform;if(a<2||!b.fixed){var c=SceneJS_math_mat4();if(this._postMult){SceneJS_math_mulMat4(b.matrix,this._mat,c)}else{SceneJS_math_mulMat4(this._mat,b.matrix,c)}this._xf.localMatrix=this._mat;this._xf.matrix=c;this._xf.fixed=a==2;if(this._compileMemoLevel==1&&b.fixed){this._compileMemoLevel=2}}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)};a.prototype._postCompile=function(a){SceneJS_modelTransformModule.popTransform()}})();(function(){var a=SceneJS.createNodeType("matrix");a.prototype._init=function(a){this._xf={};if(this.core._nodeCount==1){this.setMultOrder(a.multOrder);this.setElements(a.elements)}};a.prototype.setMultOrder=function(a){a=a||"post";if(a!="post"&&a!="pre"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal matrix multOrder - '"+a+"' should be 'pre' or 'post'")}this.attr.multOrder=a;this._postMult=a=="post";this._compileMemoLevel=0};a.prototype.setElements=function(a){a=a||SceneJS_math_identityMat4();if(!a){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements undefined")}if(a.length!=16){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements should number 16")}if(!this.core.mat){this.core.mat=a}else{for(var b=0;b<16;b++){this.core.mat[b]=a[b]}}this._resetCompilationMemos();return this};a.prototype.getElements=function(){var a=new Array(16);for(var b=0;b<16;b++){a[b]=this.core.mat[b]}return a};a.prototype.getMatrix=function(){return this.core.mat.slice(0)};a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=this._compileMemoLevel;if(this._compileMemoLevel==0){this._compileMemoLevel=1}var b=SceneJS_modelTransformModule.transform;if(a<2||!b.fixed){var c=SceneJS_math_mat4();if(this._postMult){SceneJS_math_mulMat4(b.matrix,this.core.mat,c)}else{SceneJS_math_mulMat4(this.core.mat,b.matrix,c)}this._xf.localMatrix=this.core.mat;this._xf.matrix=c;this._xf.fixed=a==2;if(this._compileMemoLevel==1&&b.fixed){this._compileMemoLevel=2}}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)};a.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})();(function(){var a=SceneJS.createNodeType("quaternion");a.prototype._init=function(a){if(this.core._nodeCount==1){this.setMultOrder(a.multOrder);this.core.q=SceneJS_math_identityQuaternion();if(a.x||a.y||a.x||a.angle||a.w){this.setRotation(a)}if(a.rotations){for(var b=0;b<a.rotations.length;b++){this.addRotation(a.rotations[b])}}}this._mat=null;this._xf={}};a.prototype.setMultOrder=function(a){a=a||"post";if(a!="post"&&a!="pre"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal quaternion multOrder - '"+a+"' should be 'pre' or 'post'")}this.core.multOrder=a;this._postMult=a=="post";this._compileMemoLevel=0};a.prototype.setRotation=function(a){a=a||{};this.core.q=SceneJS_math_angleAxisQuaternion(a.x||0,a.y||0,a.z||0,a.angle||0);this._resetCompilationMemos();return this};a.prototype.getRotation=function(){return SceneJS_math_angleAxisFromQuaternion(this.core.q)};a.prototype.addRotation=function(a){this.core.q=SceneJS_math_mulQuaternions(SceneJS_math_angleAxisQuaternion(a.x||0,a.y||0,a.z||0,a.angle||0),this.core.q);this._resetCompilationMemos();return this};a.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_newMat4FromQuaternion(this.core.q)};a.prototype.normalize=function(){this.core.q=SceneJS_math_normalizeQuaternion(this.core.q);this._resetCompilationMemos();return this};a.prototype.getAttributes=function(){return{x:this.core.q[0],y:this.core.q[1],z:this.core.q[2],w:this.core.q[3]}};a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=this._compileMemoLevel;if(this._compileMemoLevel==0){this._mat=SceneJS_math_newMat4FromQuaternion(this.core.q);this._compileMemoLevel=1}var b=SceneJS_modelTransformModule.transform;if(a<2||!b.fixed){var c=SceneJS_math_mat4();if(this._postMult){SceneJS_math_mulMat4(b.matrix,this._mat,c)}else{SceneJS_math_mulMat4(this._mat,b.matrix,c)}this._xf.localMatrix=this._mat;this._xf.matrix=c;this._xf.fixed=a==2;if(this._compileMemoLevel==1&&b.fixed){this._compileMemoLevel=2}}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)};a.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})();var SceneJS_viewTransformModule=new function(){function h(){if(f){if(d>0){var a=g.transform;if(!a.matrixAsArray){a.matrixAsArray=new Float32Array(a.matrix);a.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(a.matrix,SceneJS_math_mat4())))}else{a.matrixAsArray.set(a.matrix);a.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(a.matrix,SceneJS_math_mat4())))}SceneJS_DrawList.setViewTransform(e,a.matrixAsArray,a.normalMatrixAsArray,a.lookAt)}else{SceneJS_DrawList.setViewTransform()}f=false}}var a={matrix:SceneJS_math_identityMat4(),fixed:true,identity:true,lookAt:SceneJS_math_LOOKAT_ARRAYS};var b=[];var c=[];var d=0;var e;this.transform=a;var f;var g=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){d=0;e=null;g.transform=a;f=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){h()});this.pushTransform=function(a,g){b[d]=a;c[d]=g;d++;e=a;this.transform=g;f=true;SceneJS_eventModule.fireEvent(SceneJS_eventModule.VIEW_TRANSFORM_UPDATED,this.transform);h()};this.popTransform=function(){d--;if(d>0){e=b[d-1];this.transform=c[d-1]}else{e=null;this.transform=a}SceneJS_eventModule.fireEvent(SceneJS_eventModule.VIEW_TRANSFORM_UPDATED,this.transform);f=true;h()}};(function(){var a=SceneJS.createNodeType("lookAt");a.prototype._init=function(a){this._mat=null;this._xf={type:"lookat"};if(this.core._nodeCount==1){if(!a.eye&&!a.look&&!a.up){this.setEye({x:0,y:0,z:1});this.setLook({x:0,y:0,z:0});this.setUp({x:0,y:1,z:0})}else{this.setEye(a.eye);this.setLook(a.look);this.setUp(a.up)}}};a.prototype.setEye=function(a){a=a||{};this.core.eyeX=a.x!=undefined&&a.x!=null?a.x:0;this.core.eyeY=a.y!=undefined&&a.y!=null?a.y:0;this.core.eyeZ=a.z!=undefined&&a.z!=null?a.z:0;this._compileMemoLevel=0};a.prototype.setEyeX=function(a){this.core.eyeX=a||0;this._compileMemoLevel=0};a.prototype.setEyeY=function(a){this.core.eyeY=a||0;this._compileMemoLevel=0};a.prototype.incEye=function(a){a=a||{};this.core.eyeX+=a.x!=undefined&&a.x!=null?a.x:0;this.core.eyeY+=a.y!=undefined&&a.y!=null?a.y:0;this.core.eyeZ+=a.z!=undefined&&a.z!=null?a.z:0;this._compileMemoLevel=0};a.prototype.incEyeX=function(a){this.core.eyeX+=a;this._compileMemoLevel=0};a.prototype.incEyeY=function(a){this.core.eyeY+=a;this._compileMemoLevel=0};a.prototype.incEyeZ=function(a){this.core.eyeZ+=a;this._compileMemoLevel=0};a.prototype.setEyeZ=function(a){this.core.eyeZ=a||0;this._compileMemoLevel=0};a.prototype.getEye=function(){return{x:this.core.eyeX,y:this.core.eyeY,z:this.core.eyeZ}};a.prototype.setLook=function(a){a=a||{};this.core.lookX=a.x!=undefined&&a.x!=null?a.x:0;this.core.lookY=a.y!=undefined&&a.y!=null?a.y:0;this.core.lookZ=a.z!=undefined&&a.z!=null?a.z:0;this._compileMemoLevel=0};a.prototype.setLookX=function(a){this.core.lookX=a||0;this._compileMemoLevel=0};a.prototype.setLookY=function(a){this.core.lookY=a||0;this._compileMemoLevel=0};a.prototype.setLookZ=function(a){this.core.lookZ=a||0;this._compileMemoLevel=0};a.prototype.incLook=function(a){a=a||{};this.core.lookX+=a.x!=undefined&&a.x!=null?a.x:0;this.core.lookY+=a.y!=undefined&&a.y!=null?a.y:0;this.core.lookZ+=a.z!=undefined&&a.z!=null?a.z:0;this._compileMemoLevel=0};a.prototype.getLook=function(){return{x:this.core.lookX,y:this.core.lookY,z:this.core.lookZ}};a.prototype.setUp=function(a){a=a||{y:1};var b=a.x!=undefined&&a.x!=null?a.x:0;var c=a.y!=undefined&&a.y!=null?a.y:0;var d=a.z!=undefined&&a.z!=null?a.z:0;if(b==0&&c==0&&d==0){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Lookat up vector is zero length - at least one of its x,y and z components must be non-zero")}this.core.upX=b;this.core.upY=c;this.core.upZ=d;this._compileMemoLevel=0};a.prototype.setUpX=function(a){this.core.upX=a||0;this._compileMemoLevel=0};a.prototype.setUpY=function(a){this.core.upY=y||0;this._compileMemoLevel=0};a.prototype.setUpZ=function(a){this.core.upZ=z||0;this._compileMemoLevel=0};a.prototype.getUp=function(){return{x:this.core.upX,y:this.core.upY,z:this.core.upZ}};a.prototype.incUp=function(a){a=a||{};this.core.upX+=a.x!=undefined&&a.x!=null?a.x:0;this.core.upY+=a.y!=undefined&&a.y!=null?a.y:0;this.core.upZ+=a.z!=undefined&&a.z!=null?a.z:0;this._compileMemoLevel=0};a.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_lookAtMat4c(this.core.eyeX,this.core.eyeY,this.core.eyeZ,this.core.lookX,this.core.lookY,this.core.lookZ,this.core.upX,this.core.upY,this.core.upZ)};a.prototype.getAttributes=function(){return{look:{x:this.core.lookX,y:this.core.lookY,z:this.core.lookZ},eye:{x:this.core.eyeX,y:this.core.eyeY,z:this.core.eyeZ},up:{x:this.core.upX,y:this.core.upY,z:this.core.upZ}}};a.prototype._compile=function(){if(this._compileMemoLevel==0){this._mat=SceneJS_math_lookAtMat4c(this.core.eyeX,this.core.eyeY,this.core.eyeZ,this.core.lookX,this.core.lookY,this.core.lookZ,this.core.upX,this.core.upY,this.core.upZ);this._compileMemoLevel=1;this._xf.matrix=this._mat;this._xf.lookAt={eye:[this.core.eyeX,this.core.eyeY,this.core.eyeZ],look:[this.core.lookX,this.core.lookY,this.core.lookZ],up:[this.core.upX,this.core.upY,this.core.upZ]}}SceneJS_viewTransformModule.pushTransform(this.attr.id,this._xf);this._compileNodes();SceneJS_viewTransformModule.popTransform()}})();(function(){var a=SceneJS.createNodeType("stationary");a.prototype._compile=function(){var a=this._compileMemoLevel;var b=SceneJS_viewTransformModule.transform;var c=b.lookAt;if(c){if(this._compileMemoLevel==0||!b.fixed){var d=SceneJS_math_mat4();SceneJS_math_mulMat4(b.matrix,SceneJS_math_translationMat4v(c.eye),d);this._xform={matrix:d,lookAt:c,fixed:a==1};if(b.fixed){this._compileMemoLevel=1}}SceneJS_viewTransformModule.pushTransform(this.attr.id,this._xform);this._compileNodes();SceneJS_viewTransformModule.popTransform()}else{this._compileNodes()}}})();(function(){var a=SceneJS.createNodeType("billboard");a.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};a.prototype._preCompile=function(){var a=SceneJS_viewTransformModule.transform;var b=a.lookAt;var c=SceneJS_modelTransformModule.transform;var d=c.matrix.slice(0);var e=[d[0],d[1],d[2],0,d[4],d[5],d[6],0,d[8],d[9],d[10],0,0,0,0,1];SceneJS_math_inverseMat4(e);SceneJS_math_mulMat4(d,e,d);var f=[];SceneJS_math_subVec3(b.eye,b.look,f);SceneJS_math_normalizeVec3(f);var g=[];SceneJS_math_cross3Vec3(b.up,f,g);SceneJS_math_normalizeVec3(g);var h=[];SceneJS_math_cross3Vec3(f,g,h);SceneJS_math_normalizeVec3(h);SceneJS_math_mulMat4(d,[g[0],g[1],g[2],0,h[0],h[1],h[2],0,f[0],f[1],f[2],0,0,0,0,1],d);SceneJS_modelTransformModule.pushTransform(this.attr.id,{matrix:d})};a.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})();(function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setProjectionTransform(a[c-1],b[c-1])}else{SceneJS_DrawList.setProjectionTransform()}d=false}});var e=SceneJS.createNodeType("camera");e.prototype._init=function(a){if(this.core._nodeCount==1){this.setOptics(a.optics)}};e.prototype.setOptics=function(a){var b=this.core;if(!a){b.optics={type:a.type,left:a.left||-1,bottom:a.bottom||-1,near:a.near||.1,right:a.right||1,top:a.top||1,far:a.far||5e3}}else{if(a.type=="ortho"){b.optics=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:a.type,left:a.left,bottom:a.bottom,near:a.near,right:a.right,top:a.top,far:a.far})}else if(a.type=="frustum"){b.optics={type:a.type,left:a.left||-1,bottom:a.bottom||-1,near:a.near||.1,right:a.right||1,top:a.top||1,far:a.far||5e3}}else if(a.type=="perspective"){b.optics={type:a.type,fovy:a.fovy||60,aspect:a.aspect||1,near:a.near||.1,far:a.far||5e3}}else if(!a.type){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Camera configuration invalid: optics type not specified - "+"supported types are 'perspective', 'frustum' and 'ortho'")}else{throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Camera configuration invalid: optics type not supported - "+"supported types are 'perspective', 'frustum' and 'ortho'")}}this._rebuild()};e.prototype._rebuild=function(){var a=this.core.optics;if(a.type=="ortho"){this.core.matrix=SceneJS_math_orthoMat4c(a.left,a.right,a.bottom,a.top,a.near,a.far)}else if(a.type=="frustum"){this.core.matrix=SceneJS_math_frustumMatrix4(a.left,a.right,a.bottom,a.top,a.near,a.far)}else if(a.type=="perspective"){this.core.matrix=SceneJS_math_perspectiveMatrix4(a.fovy*Math.PI/180,a.aspect,a.near,a.far)}if(!this.core.matrixAsArray){this.core.matrixAsArray=new Float32Array(this.core.matrix)}else{this.core.matrixAsArray.set(this.core.matrix)}};e.prototype.getOptics=function(){var a={};for(var b in this.core.optics){if(this.core.optics.hasOwnProperty(b)){a[b]=this.core.optics[b]}}return a};e.prototype.getMatrix=function(){if(this._compileMemoLevel==0){this._rebuild()}return this.core.matrix.slice(0)};e.prototype._compile=function(){a[c]=this.attr.id;b[c]=this.core;c++;d=true;this._compileNodes();c--;d=true}})();(function(){var a=SceneJS.createNodeType("xform");a.prototype._init=function(a){this._xf={};if(this.core._nodeCount==1){this.setElements(a.elements)}};a.prototype.setElements=function(a){a=a||SceneJS_math_identityMat4();if(a.length!=16){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements should number 16")}var b=this.core;if(!b.matrix){b.matrix=a}else{for(var c=0;c<16;c++){b.matrix[c]=a[c]}}if(!b.matrixAsArray){b.matrixAsArray=new Float32Array(a);b.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(a,SceneJS_math_mat4())))}else{b.matrixAsArray.set(a);b.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(a,SceneJS_math_mat4())))}return this};a.prototype._compile=function(){SceneJS_modelTransformModule.pushTransform(this.attr.id,this.core);this._compileNodes();SceneJS_modelTransformModule.popTransform()}})();new function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setLights(a[c-1],b.slice(0,c))}else{SceneJS_DrawList.setLights()}d=false}});var e=SceneJS.createNodeType("light");e.prototype._init=function(a){a=a||{};if(this.core._nodeCount==1){this.core.light={viewSpace:!!a.viewSpace};this.setMode(a.mode);this.setColor(a.color);this.setDiffuse(a.diffuse);this.setSpecular(a.specular);this.setPos(a.pos);this.setDir(a.dir);this.setConstantAttenuation(a.constantAttenuation);this.setLinearAttenuation(a.linearAttenuation);this.setQuadraticAttenuation(a.quadraticAttenuation)}};e.prototype.setMode=function(a){a=a||"dir";if(a!="dir"&&a!="point"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light unsupported mode - should be 'dir' or 'point' or 'ambient'")}this.core.light.mode=a};e.prototype.getMode=function(){return this.core.light.mode};e.prototype.setColor=function(a){a=a||{};this.core.light.color=[a.r!=undefined?a.r:1,a.g!=undefined?a.g:1,a.b!=undefined?a.b:1]};e.prototype.getColor=function(){return{r:this.core.light.color[0],g:this.core.light.color[1],b:this.core.light.color[2]}};e.prototype.setDiffuse=function(a){this.core.light.diffuse=a!=undefined?a:true};e.prototype.getDiffuse=function(){return this.core.light.diffuse};e.prototype.setSpecular=function(a){this.core.light.specular=a||true};e.prototype.getSpecular=function(){return this.core.light.specular};e.prototype.setPos=function(a){a=a||{};this.core.light.pos=[a.x||0,a.y||0,a.z||0]};e.prototype.getPos=function(){return{x:this.core.light.pos[0],y:this.core.light.pos[1],z:this.core.light.pos[2]}};e.prototype.setDir=function(a){a=a||{};this.core.light.dir=[a.x||0,a.y||0,a.z==undefined||a.z==null?-1:a.z]};e.prototype.getDir=function(){return{x:this.core.light.dir[0],y:this.core.light.dir[1],z:this.core.light.dir[2]}};e.prototype.setConstantAttenuation=function(a){this.core.light.constantAttenuation=a!=undefined?a:1};e.prototype.getConstantAttenuation=function(){return this.core.light.constantAttenuation};e.prototype.setLinearAttenuation=function(a){this.core.light.linearAttenuation=a||0};e.prototype.getLinearAttenuation=function(){return this.core.light.linearAttenuation};e.prototype.setQuadraticAttenuation=function(a){this.core.light.quadraticAttenuation=a||0};e.prototype.getQuadraticAttenuation=function(){return this.core.light.quadraticAttenuation};e.prototype._compile=function(){var e=SceneJS_modelTransformModule.transform.matrix;if(this.core.light.mode=="point"){this.core.light.worldPos=SceneJS_math_transformPoint3(e,this.core.light.pos)}else if(this.core.light.mode=="dir"){this.core.light.worldDir=SceneJS_math_transformVector3(e,this.core.light.dir)}a[c]=this.attr.id;b[c]=this.core.light;c++;d=true;this._compileNodes()}};new function(){var a={baseColor:[0,0,0],specularColor:[0,0,0],specular:1,shine:10,reflect:.8,alpha:1,emit:0};var b=[];var c=[];var d=0;var e;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){d=0;e=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(e){if(d>0){SceneJS_DrawList.setMaterial(b[d-1],c[d-1])}else{SceneJS_DrawList.setMaterial()}e=false}});var f=SceneJS.createNodeType("material");f.prototype._init=function(a){if(this.core._nodeCount==1){this.setBaseColor(a.baseColor);this.setSpecularColor(a.specularColor);this.setSpecular(a.specular);this.setShine(a.shine);this.setReflect(a.reflect);this.setEmit(a.emit);this.setAlpha(a.alpha);this.setOpacity(a.opacity)}};f.prototype.setBaseColor=function(b){this.core.baseColor=b?[b.r!=undefined&&b.r!=null?b.r:0,b.g!=undefined&&b.g!=null?b.g:0,b.b!=undefined&&b.b!=null?b.b:0]:a.baseColor};f.prototype.getBaseColor=function(){return{r:this.core.baseColor[0],g:this.core.baseColor[1],b:this.core.baseColor[2]}};f.prototype.setSpecularColor=function(b){this.core.specularColor=b?[b.r!=undefined&&b.r!=null?b.r:0,b.g!=undefined&&b.g!=null?b.g:0,b.b!=undefined&&b.b!=null?b.b:0]:a.specularColor};f.prototype.getSpecularColor=function(){return{r:this.core.specularColor[0],g:this.core.specularColor[1],b:this.core.specularColor[2]}};f.prototype.setSpecular=function(b){this.core.specular=b!=undefined&&b!=null?b:a.specular};f.prototype.getSpecular=function(){return this.core.specular};f.prototype.setShine=function(b){this.core.shine=b!=undefined&&b!=null?b:a.shine};f.prototype.getShine=function(){return this.core.shine};f.prototype.setReflect=function(b){this.core.reflect=b!=undefined&&b!=null?b:a.reflect};f.prototype.getReflect=function(){return this.core.reflect};f.prototype.setEmit=function(b){this.core.emit=b!=undefined&&b!=null?b:a.emit};f.prototype.getEmit=function(){return this.core.emit};f.prototype.setAlpha=function(b){this.core.alpha=b!=undefined&&b!=null?b:a.alpha};f.prototype.getAlpha=function(){return this.core.alpha};f.prototype.setOpacity=function(b){this.core.opacity=b!=undefined&&b!=null?b:a.opacity};f.prototype.getOpacity=function(){return this.core.opacity};f.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};f.prototype._preCompile=function(){b[d]=this.core._coreId;c[d]=this.core;d++;e=true};f.prototype._postCompile=function(){d--;e=true};f.prototype._destroy=function(){}};new function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setColortrans(a[c-1],b[c-1])}else{SceneJS_DrawList.setColortrans()}d=false}});var e=SceneJS.createNodeType("colortrans");e.prototype._init=function(a){if(this.core._nodeCount==1){this.setScale(a.scale);this.setAdd(a.add);this.setSaturation(a.saturation)}};e.prototype.setSaturation=function(a){this.core.saturation=a};e.prototype.mulSaturation=function(a){this.core.saturation*=a};e.prototype.incSaturation=function(a){this.core.saturation+=a};e.prototype.getSaturation=function(){return this.core.saturation};e.prototype.setScale=function(a){a=a||{};this.core.scale={r:a.r!=undefined?a.r:1,g:a.g!=undefined?a.g:1,b:a.b!=undefined?a.b:1,a:a.a!=undefined?a.a:1}};e.prototype.incScale=function(a){a=a||{};var b=this.core.scale;if(a.r){b.r+=a.r}if(a.g){b.g+=a.g}if(a.b){b.b+=a.b}if(a.a){b.a+=a.a}};e.prototype.mulScale=function(a){a=a||{};var b=this.core.scale;if(a.r){b.r*=a.r}if(a.g){b.g*=a.g}if(a.b){b.b*=a.b}if(a.a){b.a*=a.a}};e.prototype.getScale=function(){return this.core.scale};e.prototype.setAdd=function(a){a=a||{};this.core.add={r:a.r!=undefined?a.r:0,g:a.g!=undefined?a.g:0,b:a.b!=undefined?a.b:0,a:a.a!=undefined?a.a:0}};e.prototype.incAdd=function(a){a=a||{};var b=this.core.add;if(a.r){b.r+=a.r}if(a.g){b.g+=a.g}if(a.b){b.b+=a.b}if(a.a){b.a+=a.a}};e.prototype.mulAdd=function(a){a=a||{};var b=this.core.add;if(a.r){b.r*=a.r}if(a.g){b.g*=a.g}if(a.b){b.b*=a.b}if(a.a){b.a*=a.a}};e.prototype.getAdd=function(){return this.core.add};e.prototype._compile=function(){a[c]=this.core._coreId;b[c]=this.core;c++;d=true;this._compileNodes();c--;d=true}};var SceneJS_textureModule=new function(){function e(a,b,c){var d=a.canvas.context;var e=SceneJS._createUUID();var h;try{if(b.autoUpdate){h=function(){try{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,image)}catch(a){d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,image,null)}d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)}}return new SceneJS_webgl_Texture2D(d,{textureId:e,canvas:a.canvas,image:b.image,url:b.uri,texels:b.texels,minFilter:f("minFilter",d,b,d.NEAREST_MIPMAP_NEAREST),magFilter:f("magFilter",d,b,d.LINEAR),wrapS:f("wrapS",d,b,d.CLAMP_TO_EDGE),wrapT:f("wrapT",d,b,d.CLAMP_TO_EDGE),isDepth:g(b.isDepth,false),depthMode:f("depthMode",d,b,d.LUMINANCE),depthCompareMode:f("depthCompareMode",d,b,d.COMPARE_R_TO_TEXTURE),depthCompareFunc:f("depthCompareFunc",d,b,d.LEQUAL),flipY:g(b.flipY,true),width:g(b.width,1),height:g(b.height,1),internalFormat:f("internalFormat",d,b,d.LEQUAL),sourceFormat:f("sourceType",d,b,d.ALPHA),sourceType:f("sourceType",d,b,d.UNSIGNED_BYTE),logging:SceneJS_loggingModule,update:h},c)}catch(i){throw SceneJS_errorModule.fatalError(SceneJS.errors.ERROR,"Failed to create texture: "+i.message||i)}}function f(a,b,c,d){var e=c[a];if(e==undefined){return d}var f=SceneJS_webgl_enumMap[e];if(f==undefined){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+a+"' value: '"+e+"'")}var g=b[f];return g}function g(a,b){return a==undefined?b:a}function h(a){a.destroy()}var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setTexture(a[c-1],b[c-1])}else{SceneJS_DrawList.setTexture()}d=false}});var i=SceneJS.createNodeType("texture");i.prototype._init=function(a){if(this.core._nodeCount==1){this.core.layers=[];this.core.params={};var b=SceneJS_debugModule.getConfigs("texturing")||{};var c=b.waitForLoad!=undefined&&b.waitForLoad!=null?b.waitForLoad:a.waitForLoad;if(!a.layers){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers missing")}if(!SceneJS._isArray(a.layers)){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers should be an array")}for(var d=0;d<a.layers.length;d++){var f=a.layers[d];if(!f.uri&&!f.frameBuf&&!f.video&&!f.image&&!f.canvasId){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+d+"  has no uri, frameBuf, video or canvasId specified")}if(f.applyFrom){if(f.applyFrom!="uv"&&f.applyFrom!="uv2"&&f.applyFrom!="normal"&&f.applyFrom!="geometry"){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+d+"  applyFrom value is unsupported - "+"should be either 'uv', 'uv2', 'normal' or 'geometry'")}}if(f.applyTo){if(f.applyTo!="baseColor"&&f.applyTo!="specular"&&f.applyTo!="emit"&&f.applyTo!="alpha"&&f.applyTo!="normals"){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+d+" applyTo value is unsupported - "+"should be either 'baseColor', 'specular' or 'normals'")}}if(f.blendMode){if(f.blendMode!="add"&&f.blendMode!="multiply"){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+d+" blendMode value is unsupported - "+"should be either 'add' or 'multiply'")}}var g={image:null,creationParams:f,waitForLoad:c,texture:null,applyFrom:f.applyFrom||"uv",applyTo:f.applyTo||"baseColor",blendMode:f.blendMode||"add",blendFactor:f.blendFactor!=undefined&&f.blendFactor!=null?f.blendFactor:1,translate:{x:0,y:0},scale:{x:1,y:1},rotate:{z:0}};this.core.layers.push(g);this._setLayerTransform(f,g);if(g.creationParams.frameBuf){g.texture=SceneJS._compilationStates.getState("frameBuf",this.scene.attr.id,g.creationParams.frameBuf)}else if(g.creationParams.video){g.texture=SceneJS._compilationStates.getState("video",this.scene.attr.id,g.creationParams.video)}else{SceneJS_sceneStatusModule.nodeLoading(this);var i=this;g.texture=e(this.scene,g.creationParams,function(){SceneJS_sceneStatusModule.nodeLoaded(i);if(i._destroyed){h(g.texture)}SceneJS_compileModule.nodeUpdated(i,"loaded")})}}}};i.prototype.setLayer=function(a){if(a.index==undefined||a.index==null){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index null or undefined")}if(a.index<0||a.index>=this.core.layers.length){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this.core.layers.length+" layers defined)")}this._setLayer(parseInt(a.index),a)};i.prototype.setLayers=function(a){var b;for(var c in a){if(a.hasOwnProperty(c)){if(c!=undefined||c!=null){b=parseInt(c);if(b<0||b>=this.core.layers.length){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this.core.layers.length+" layers defined)")}this._setLayer(b,a[c]||{})}}}};i.prototype._setLayer=function(a,b){b=b||{};var c=this.core.layers[a];if(b.blendFactor!=undefined&&b.blendFactor!=null){c.blendFactor=b.blendFactor}this._setLayerTransform(b,c)};i.prototype._setLayerTransform=function(a,b){var c;var d;if(a.translate){var e=a.translate;if(e.x!=undefined){b.translate.x=e.x}if(e.y!=undefined){b.translate.y=e.y}c=SceneJS_math_translationMat4v([e.x||0,e.y||0,0])}if(a.scale){var f=a.scale;if(f.x!=undefined){b.scale.x=f.x}if(f.y!=undefined){b.scale.y=f.y}d=SceneJS_math_scalingMat4v([f.x||1,f.y||1,1]);c=c?SceneJS_math_mulMat4(c,d):d}if(a.rotate){var g=a.rotate;if(g.z!=undefined){b.rotate.z=g.z||0}d=SceneJS_math_rotationMat4v(g.z*.0174532925,[0,0,1]);c=c?SceneJS_math_mulMat4(c,d):d}if(c){b.matrix=c;if(!b.matrixAsArray){b.matrixAsArray=new Float32Array(b.matrix)}else{b.matrixAsArray.set(b.matrix)}b.matrixAsArray=new Float32Array(b.matrix)}};i.prototype._compile=function(){a[c]=this.core._coreId;b[c]=this.core;c++;d=true;this._compileNodes();c--;d=true};i.prototype._destroy=function(){if(this.core._nodeCount==1){var a;for(var b=0,c=this.core.layers.length;b<c;b++){a=this.core.layers[b];if(a.texture){h(a.texture)}}}}};new function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setClips(a[c-1],b.slice(0,c))}else{SceneJS_DrawList.setClips()}d=false}});var e=SceneJS.createNodeType("clip");e.prototype._init=function(a){if(this.core._nodeCount==1){this.setMode(a.mode);this.setA(a.a);this.setB(a.b);this.setC(a.c)}};e.prototype.setMode=function(a){a=a||"outside";if(a!="disabled"&&a!="inside"&&a!="outside"){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.clip has a mode of unsupported type: '"+a+" - should be 'disabled', 'inside' or 'outside'")}this.core.mode=a};e.prototype.getMode=function(){return this.core.mode};e.prototype.setAbc=function(a){a=a||{};this.setA(a.a);this.setB(a.b);this.setC(a.c)};e.prototype.getAbc=function(){return{a:this.getA(),b:this.getB(),c:this.getC()}};e.prototype.setA=function(a){a=a||{};this.core.a=[a.x!=undefined?a.x:0,a.y!=undefined?a.y:0,a.z!=undefined?a.z:0,1]};e.prototype.getA=function(){return{x:this.core.a[0],y:this.core.a[1],z:this.core.a[2]}};e.prototype.setB=function(a){a=a||{};this.core.b=[a.x!=undefined?a.x:0,a.y!=undefined?a.y:0,a.z!=undefined?a.z:0,1]};e.prototype.getB=function(){return{x:this.core.b[0],y:this.core.b[1],z:this.core.b[2]}};e.prototype.setC=function(a){a=a||{};this.core.c=[a.x!=undefined?a.x:0,a.y!=undefined?a.y:0,a.z!=undefined?a.z:0,1]};e.prototype.getC=function(){return{x:this.core.c[0],y:this.core.c[1],z:this.core.c[2]}};e.prototype.getAttributes=function(){return{mode:this.core.mode,a:this.getA(),b:this.getB(),c:this.getC()}};e.prototype._compile=function(){var e=this.core;var f=SceneJS_modelTransformModule.transform.matrix;var g=SceneJS_math_transformPoint3(f,e.a);var h=SceneJS_math_transformPoint3(f,e.b);var i=SceneJS_math_transformPoint3(f,e.c);var j=SceneJS_math_normalizeVec3(SceneJS_math_cross3Vec4(SceneJS_math_normalizeVec3(SceneJS_math_subVec3(h,g,[0,0,0]),[0,0,0]),SceneJS_math_normalizeVec3(SceneJS_math_subVec3(h,i,[0,0,0]),[0,0,0])));var k=SceneJS_math_dotVector3(j,g);e.normalAndDist=[j[0],j[1],j[2],k];b[c]=e;a[c]=this.attr.id;c++;d=true;this._compileNodes()}};new function(){function e(a){if(document.getElementById(a.canvas.canvasId)){var b;for(var c=0,d=a.targets.length;c<d;c++){b=a.targets[c];if(b.vertexBuf){b.vertexBuf.destroy()}if(b.normalBuf){b.normalBuf.destroy()}if(b.uvBuf){b.uvBuf.destroy()}if(b.uvBuf2){b.uvBuf2.destroy()}}}}function f(a,b,c,d){if(typeof b=="string"){var e=SceneJS.Services.getService(SceneJS.Services.MORPH_GEO_LOADER_SERVICE_ID);e.loadMorphGeometry(b,function(b){d(i(a,b,c))})}else{return i(a,g(b),c)}}function g(a){var b={keys:a.keys,targets:[]};for(var c=0,d=a.targets.length;c<d;c++){b.targets.push(h(a.targets[c]))}return b}function h(a){return{positions:a.positions?new Float32Array(a.positions):undefined,normals:a.normals?new Float32Array(a.normals):undefined,uv:a.uv?new Float32Array(a.uv):undefined,uv2:a.uv2?new Float32Array(a.uv2):undefined}}function i(a,b,c){var d=a.canvas.context;var e={scene:a,canvas:a.canvas,keys:b.keys,targets:[],key1:0,key2:1};try{var f=d.STATIC_DRAW;var g;var h;for(var i=0,j=b.targets.length;i<j;i++){g=b.targets[i];h={};e.targets.push(h);if(g.positions&&g.positions.length>0){h.vertexBuf=new SceneJS_webgl_ArrayBuffer(d,d.ARRAY_BUFFER,g.positions,g.positions.length,3,f)}if(g.normals&&g.normals.length>0){h.normalBuf=new SceneJS_webgl_ArrayBuffer(d,d.ARRAY_BUFFER,g.normals,g.normals.length,3,f)}if(g.uv&&g.uv.length>0){h.uvBuf=new SceneJS_webgl_ArrayBuffer(d,d.ARRAY_BUFFER,g.uv,g.uv.length,2,f)}if(g.uv2&&g.uv2.length>0){h.uvBuf2=new SceneJS_webgl_ArrayBuffer(d,d.ARRAY_BUFFER,g.uv2,g.uv2.length,2,f)}}return e}catch(k){for(var i=0,j=e.targets.length;i<j;i++){g=e.targets[i];if(g.vertexBuf){g.vertexBuf.destroy()}if(g.normalBuf){g.normalBuf.destroy()}if(g.uvBuf){g.uvBuf.destroy()}if(g.uvBuf2){g.uvBuf2.destroy()}}throw k}}var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setMorph(a[c-1],b[c-1])}else{SceneJS_DrawList.setMorph()}d=false}});var j=SceneJS.createNodeType("morphGeometry");j.prototype._init=function(a){if(this.core._nodeCount==1){if(a.create instanceof Function){var b=this._createMorphData(a.create());SceneJS._apply(f(this.scene,b,a.options),this.core)}else if(a.stream){this._stream=a.stream;this.core._loading=true;var c=this;f(this.scene,this._stream,a.options,function(a){SceneJS._apply(a,c.core);c.core._loading=false;SceneJS_compileModule.nodeUpdated(c,"loaded")})}else{SceneJS._apply(f(this.scene,this._createMorphData(a),a.options),this.core)}this.setFactor(a.factor)}this.core.factor=a.factor||0;this.core.clamp=!!a.clamp};j.prototype._createMorphData=function(a){var b=a.targets||[];if(b.length<2){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets")}var c=a.keys||[];if(c.length!=b.length){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets")}var d;var e;var f;var g;var h;for(var i=0,j=b.length;i<j;i++){h=b[i];if(!d&&h.positions){d=h.positions.slice(0)}if(!e&&h.normals){e=h.normals.slice(0)}if(!f&&h.uv){f=h.uv.slice(0)}if(!g&&h.uv2){g=h.uv2.slice(0)}}for(var i=0,j=b.length;i<j;i++){h=b[i];if(!h.positions){h.positions=d}if(!h.normals){h.normals=e}if(!h.uv){h.uv=f}if(!h.uv2){h.uv2=g}}return{keys:c,targets:b,key1:0,key2:1,factor:0}};j.prototype.getState=function(){return this.core};j.prototype.getStream=function(){return this._stream};j.prototype.setFactor=function(a){a=a||0;var b=this.core;var c=b.keys;var d=b.key1;var e=b.key2;if(a<c[0]){d=0;e=1}else if(a>c[c.length-1]){d=c.length-2;e=d+1}else{while(c[d]>a){d--;e--}while(c[e]<a){d++;e++}}b.factor=(a-c[d])/(c[e]-c[d]);b.key1=d;b.key2=e};j.prototype.getFactor=function(){return this.core.factor};j.prototype._compile=function(){this._preCompile();this._compileNodes();this._postCompile()};j.prototype._preCompile=function(){if(!this.core._loading){a[c]=this.attr.id;b[c]=this.core;c++;d=true}};j.prototype._postCompile=function(){if(!this.core._loading){c--;d=true}};j.prototype._destroy=function(){if(this.core._nodeCount==1){e(this.core)}}};(function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(e){if(d){if(c>0){SceneJS_DrawList.setName(a[c-1],b[c-1])}else{SceneJS_DrawList.setName()}d=false}});var e=SceneJS.createNodeType("name");e.prototype._init=function(a){if(this.core._nodeCount==1){this.setName(a.name)}};e.prototype.setName=function(a){this.core.name=a||"unnamed"};e.prototype._compile=function(){var e=this.attr.id;a[c]=e;b[c]=this.core.name;c++;d=true;this._compileNodes();c--;d=true}})();new function(){var a={};SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_IDLE,function(b){var c=a[b.sceneId];if(c){for(var d in c){if(c.hasOwnProperty(d)){c[d].update()}}SceneJS_compileModule.redraw(b.sceneId)}});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(b){a[b.sceneId]=null});var b=SceneJS.createNodeType("video");b.prototype._init=function(b){if(!b.src){throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"video node parameter expected: 'src'")}var c=this._video=document.createElement("video");c.style.display="none";c.setAttribute("loop","loop");c.autoplay=true;c.addEventListener("ended",function(){this.play()},true);document.getElementsByTagName("body")[0].appendChild(c);this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");c.src=b.src;var d=this._gl=this.scene.canvas.context;this._texture=d.createTexture();var e=this.attr.id;var f=this;var g={id:e,update:function(){var a=f._video;var b=f._gl;var c=f._canvas;var d=f._texture;var e=f._ctx;b.bindTexture(b.TEXTURE_2D,d);if(a.readyState>0){if(a.height<=0){a.style.display="";a.height=a.offsetHeight;a.width=a.offsetWidth;a.style.display="none"}c.height=a.height;c.width=a.width;e.drawImage(a,0,0);try{b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c)}catch(g){b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c,null)}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.generateMipmap(b.TEXTURE_2D)}},getTexture:function(){return{bind:function(a){var b=f._gl;b.activeTexture(b["TEXTURE"+a]);b.bindTexture(b.TEXTURE_2D,f._texture)},unbind:function(a){var b=f._gl;b.activeTexture(b["TEXTURE"+a]);b.bindTexture(b.TEXTURE_2D,null)}}}};g.update();var h=this.scene.attr.id;var i=a[h];if(!i){i=a[h]={}}this._buf=i[e]=g};SceneJS._compilationStates.setSupplier("video",{get:function(b,c){var d=a[b];return{bind:function(a){var b=d[c];if(b){b.getTexture().bind(a)}},unbind:function(a){var b=d[c];if(b){b.getTexture().unbind(a)}}}}});b.prototype._compile=function(){this._compileNodes()};b.prototype._destroy=function(){if(this._buf){var b=a[this.scene.attr.id]}}};new function(){function f(b,c){var d=b.canvas;var e=d.context;var f=d.canvas.width;var g=d.canvas.height;var h=e.createFramebuffer();var i=e.createRenderbuffer();var j=e.createTexture();var k=false;e.bindFramebuffer(e.FRAMEBUFFER,h);e.bindTexture(e.TEXTURE_2D,j);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,f,g,0,e.RGBA,e.UNSIGNED_BYTE,null)}catch(l){var m=new WebGLUnsignedByteArray(f*g*4);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,f,g,0,e.RGBA,e.UNSIGNED_BYTE,m)}e.bindRenderbuffer(e.RENDERBUFFER,i);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,f,g);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,j,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,h);if(!e.isFramebuffer(h)){throw SceneJS_errorModule.fatalError("Invalid framebuffer")}var n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_COMPLETE:break;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case e.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: "+n)}var o={id:c,bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,h);e.clearColor(0,0,0,1);e.clearDepth(1);e.enable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.depthRange(0,1);e.disable(e.SCISSOR_TEST);e.disable(e.BLEND)},unbind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.bindRenderbuffer(e.RENDERBUFFER,i);k=true},isRendered:function(){return k},getTexture:function(){return{bind:function(a){e.activeTexture(e["TEXTURE"+a]);e.bindTexture(e.TEXTURE_2D,j)},unbind:function(a){e.activeTexture(e["TEXTURE"+a]);e.bindTexture(e.TEXTURE_2D,null)}}}};var p=a[b.attr.id];if(!p){p=a[b.attr.id]={}}p[c]=o;return o}function g(a){}var a={};var b=[];var c=[];var d=0;var e;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){d=0;e=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(e){if(d>0){SceneJS_DrawList.setFrameBuf(b[d-1],c[d-1])}else{SceneJS_DrawList.setFrameBuf()}e=false}});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(b){a[b.sceneId]=null});SceneJS._compilationStates.setSupplier("frameBuf",{get:function(b,c){var d=a[b];return{bind:function(a){var b=d[c];if(b&&b.isRendered()){b.getTexture().bind(a)}},unbind:function(a){var b=d[c];if(b&&b.isRendered()){b.getTexture().unbind(a)}}}}});var h=SceneJS.createNodeType("frameBuf");h.prototype._init=function(){this._buf=f(this.scene,this.attr.id)};h.prototype._compile=function(){b[d]=this.attr.id;c[d]=this._buf;d++;e=true;this._compileNodes();d--;e=true};h.prototype._destroy=function(){if(this._buf){g(this._buf)}}};new function(){function j(a){var b;var c={};var d;for(var e=0;e<h;e++){b=a[e];for(d in b){if(b.hasOwnProperty(d)){c[d]=b[d]}}}return c}function k(a,b){var c;for(var d in a){if(a.hasOwnProperty(d)){c=b[d];if(!c){c=b[d]=[]}c.push(a[d])}}}var a=[];var b=[];var c=[];var d={};var e=[];var f=[];var g=[];var h=0;var i;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){h=0;i=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(i){if(h>0){var d={shaders:{fragment:{code:e.slice(0,h).join("\n"),hooks:j(f)},vertex:{code:b.slice(0,h).join("\n"),hooks:j(c)}},paramsStack:g.slice(0,h),hash:a.slice(0,h).join(".")};SceneJS_DrawList.setShader(a[h-1],d)}else{SceneJS_DrawList.setShader()}i=false}});var l=SceneJS.createNodeType("shader");l.prototype._init=function(a){if(this.core._nodeCount==1){this._setShaders(a.shaders);this.setParams(a.params)}};l.prototype._setShaders=function(a){a=a||[];this.core.shaders={};var b;for(var c=0,d=a.length;c<d;c++){b=a[c];if(!b.stage){throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"shader 'stage' attribute expected")}var e;if(b.code){if(SceneJS._isArray(b.code)){e=b.code.join("")}else{e=b.code}}this.core.shaders[b.stage]={code:e,hooks:b.hooks}}};l.prototype.setParams=function(a){a=a||{};var b=this.core.params;if(!b){b=this.core.params={}}for(var c in a){if(a.hasOwnProperty(c)){b[c]=a[c]}}};l.prototype.getParams=function(){var a=this.core.params;if(!a){return{}}var b={};for(var c in a){if(a.hasOwnProperty(c)){b[c]=a[c]}}return b};l.prototype._compile=function(){a[h]=this.core._coreId;var d=this.core.shaders;var j=d.fragment||{};var k=d.vertex||{};e[h]=j.code||"";f[h]=j.hooks||{};b[h]=k.code||"";c[h]=k.hooks||{};g[h]=this.core.params||{};h++;i=true;this._compileNodes();h--;i=true}};new function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(d){if(c>0){SceneJS_DrawList.setShaderParams(a[c-1],b.slice(0,c))}else{SceneJS_DrawList.setShaderParams()}d=false}});var e=SceneJS.createNodeType("shaderParams");e.prototype._init=function(a){if(this.core._nodeCount==1){this.setParams(a.params)}};e.prototype.setParams=function(a){a=a||{};var b=this.core;if(!b.params){b.params={}}for(var c in a){if(a.hasOwnProperty(c)){b.params[c]=a[c]}}};e.prototype._compile=function(){a[c]=this.core._coreId;b[c]=this.core.params;c++;d=true;this._compileNodes();c--;d=true}};var SceneJS_nodeEventsModule=new function(){var a=[];var b=[];var c=0;var d;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){c=0;d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SHADER_ACTIVATED,function(){d=true});SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(e){if(d){if(c>0){SceneJS_DrawList.setRenderListeners(a[c-1],b.slice(0,c))}else{SceneJS_DrawList.setRenderListeners()}d=false}});this.preVisitNode=function(e){var f=e.listeners["rendered"];if(f&&f.length>0){a[c]=e.attr.id;b[c]=function(a){e._fireEvent("rendered",a)};c++;d=true}};this.postVisitNode=function(b){if(b.attr.id==a[c-1]){c--;d=true}}};eval(function(a,b,c,d,e,f){e=function(a){return(a<b?"":e(parseInt(a/b)))+((a=a%b)>35?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){while(c--)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}];e=function(){return"\\w+"};c=1}while(c--)if(d[c])a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]);return a}("9 17={3i:'0.1.3',16:1e-6};l v(){}v.23={e:l(i){8(i<1||i>7.4.q)?w:7.4[i-1]},2R:l(){8 7.4.q},1u:l(){8 F.1x(7.2u(7))},24:l(a){9 n=7.4.q;9 V=a.4||a;o(n!=V.q){8 1L}J{o(F.13(7.4[n-1]-V[n-1])>17.16){8 1L}}H(--n);8 2x},1q:l(){8 v.u(7.4)},1b:l(a){9 b=[];7.28(l(x,i){b.19(a(x,i))});8 v.u(b)},28:l(a){9 n=7.4.q,k=n,i;J{i=k-n;a(7.4[i],i+1)}H(--n)},2q:l(){9 r=7.1u();o(r===0){8 7.1q()}8 7.1b(l(x){8 x/r})},1C:l(a){9 V=a.4||a;9 n=7.4.q,k=n,i;o(n!=V.q){8 w}9 b=0,1D=0,1F=0;7.28(l(x,i){b+=x*V[i-1];1D+=x*x;1F+=V[i-1]*V[i-1]});1D=F.1x(1D);1F=F.1x(1F);o(1D*1F===0){8 w}9 c=b/(1D*1F);o(c<-1){c=-1}o(c>1){c=1}8 F.37(c)},1m:l(a){9 b=7.1C(a);8(b===w)?w:(b<=17.16)},34:l(a){9 b=7.1C(a);8(b===w)?w:(F.13(b-F.1A)<=17.16)},2k:l(a){9 b=7.2u(a);8(b===w)?w:(F.13(b)<=17.16)},2j:l(a){9 V=a.4||a;o(7.4.q!=V.q){8 w}8 7.1b(l(x,i){8 x+V[i-1]})},2C:l(a){9 V=a.4||a;o(7.4.q!=V.q){8 w}8 7.1b(l(x,i){8 x-V[i-1]})},22:l(k){8 7.1b(l(x){8 x*k})},x:l(k){8 7.22(k)},2u:l(a){9 V=a.4||a;9 i,2g=0,n=7.4.q;o(n!=V.q){8 w}J{2g+=7.4[n-1]*V[n-1]}H(--n);8 2g},2f:l(a){9 B=a.4||a;o(7.4.q!=3||B.q!=3){8 w}9 A=7.4;8 v.u([(A[1]*B[2])-(A[2]*B[1]),(A[2]*B[0])-(A[0]*B[2]),(A[0]*B[1])-(A[1]*B[0])])},2A:l(){9 m=0,n=7.4.q,k=n,i;J{i=k-n;o(F.13(7.4[i])>F.13(m)){m=7.4[i]}}H(--n);8 m},2Z:l(x){9 a=w,n=7.4.q,k=n,i;J{i=k-n;o(a===w&&7.4[i]==x){a=i+1}}H(--n);8 a},3g:l(){8 S.2X(7.4)},2d:l(){8 7.1b(l(x){8 F.2d(x)})},2V:l(x){8 7.1b(l(y){8(F.13(y-x)<=17.16)?x:y})},1o:l(a){o(a.K){8 a.1o(7)}9 V=a.4||a;o(V.q!=7.4.q){8 w}9 b=0,2b;7.28(l(x,i){2b=x-V[i-1];b+=2b*2b});8 F.1x(b)},3a:l(a){8 a.1h(7)},2T:l(a){8 a.1h(7)},1V:l(t,a){9 V,R,x,y,z;2S(7.4.q){27 2:V=a.4||a;o(V.q!=2){8 w}R=S.1R(t).4;x=7.4[0]-V[0];y=7.4[1]-V[1];8 v.u([V[0]+R[0][0]*x+R[0][1]*y,V[1]+R[1][0]*x+R[1][1]*y]);1I;27 3:o(!a.U){8 w}9 C=a.1r(7).4;R=S.1R(t,a.U).4;x=7.4[0]-C[0];y=7.4[1]-C[1];z=7.4[2]-C[2];8 v.u([C[0]+R[0][0]*x+R[0][1]*y+R[0][2]*z,C[1]+R[1][0]*x+R[1][1]*y+R[1][2]*z,C[2]+R[2][0]*x+R[2][1]*y+R[2][2]*z]);1I;2P:8 w}},1t:l(a){o(a.K){9 P=7.4.2O();9 C=a.1r(P).4;8 v.u([C[0]+(C[0]-P[0]),C[1]+(C[1]-P[1]),C[2]+(C[2]-(P[2]||0))])}1d{9 Q=a.4||a;o(7.4.q!=Q.q){8 w}8 7.1b(l(x,i){8 Q[i-1]+(Q[i-1]-x)})}},1N:l(){9 V=7.1q();2S(V.4.q){27 3:1I;27 2:V.4.19(0);1I;2P:8 w}8 V},2n:l(){8'['+7.4.2K(', ')+']'},26:l(a){7.4=(a.4||a).2O();8 7}};v.u=l(a){9 V=25 v();8 V.26(a)};v.i=v.u([1,0,0]);v.j=v.u([0,1,0]);v.k=v.u([0,0,1]);v.2J=l(n){9 a=[];J{a.19(F.2F())}H(--n);8 v.u(a)};v.1j=l(n){9 a=[];J{a.19(0)}H(--n);8 v.u(a)};l S(){}S.23={e:l(i,j){o(i<1||i>7.4.q||j<1||j>7.4[0].q){8 w}8 7.4[i-1][j-1]},33:l(i){o(i>7.4.q){8 w}8 v.u(7.4[i-1])},2E:l(j){o(j>7.4[0].q){8 w}9 a=[],n=7.4.q,k=n,i;J{i=k-n;a.19(7.4[i][j-1])}H(--n);8 v.u(a)},2R:l(){8{2D:7.4.q,1p:7.4[0].q}},2D:l(){8 7.4.q},1p:l(){8 7.4[0].q},24:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(7.4.q!=M.q||7.4[0].q!=M[0].q){8 1L}9 b=7.4.q,15=b,i,G,10=7.4[0].q,j;J{i=15-b;G=10;J{j=10-G;o(F.13(7.4[i][j]-M[i][j])>17.16){8 1L}}H(--G)}H(--b);8 2x},1q:l(){8 S.u(7.4)},1b:l(a){9 b=[],12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;b[i]=[];J{j=10-G;b[i][j]=a(7.4[i][j],i+1,j+1)}H(--G)}H(--12);8 S.u(b)},2i:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}8(7.4.q==M.q&&7.4[0].q==M[0].q)},2j:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2i(M)){8 w}8 7.1b(l(x,i,j){8 x+M[i-1][j-1]})},2C:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2i(M)){8 w}8 7.1b(l(x,i,j){8 x-M[i-1][j-1]})},2B:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}8(7.4[0].q==M.q)},22:l(a){o(!a.4){8 7.1b(l(x){8 x*a})}9 b=a.1u?2x:1L;9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}o(!7.2B(M)){8 w}9 d=7.4.q,15=d,i,G,10=M[0].q,j;9 e=7.4[0].q,4=[],21,20,c;J{i=15-d;4[i]=[];G=10;J{j=10-G;21=0;20=e;J{c=e-20;21+=7.4[i][c]*M[c][j]}H(--20);4[i][j]=21}H(--G)}H(--d);9 M=S.u(4);8 b?M.2E(1):M},x:l(a){8 7.22(a)},32:l(a,b,c,d){9 e=[],12=c,i,G,j;9 f=7.4.q,1p=7.4[0].q;J{i=c-12;e[i]=[];G=d;J{j=d-G;e[i][j]=7.4[(a+i-1)%f][(b+j-1)%1p]}H(--G)}H(--12);8 S.u(e)},31:l(){9 a=7.4.q,1p=7.4[0].q;9 b=[],12=1p,i,G,j;J{i=1p-12;b[i]=[];G=a;J{j=a-G;b[i][j]=7.4[j][i]}H(--G)}H(--12);8 S.u(b)},1y:l(){8(7.4.q==7.4[0].q)},2A:l(){9 m=0,12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;J{j=10-G;o(F.13(7.4[i][j])>F.13(m)){m=7.4[i][j]}}H(--G)}H(--12);8 m},2Z:l(x){9 a=w,12=7.4.q,15=12,i,G,10=7.4[0].q,j;J{i=15-12;G=10;J{j=10-G;o(7.4[i][j]==x){8{i:i+1,j:j+1}}}H(--G)}H(--12);8 w},30:l(){o(!7.1y){8 w}9 a=[],n=7.4.q,k=n,i;J{i=k-n;a.19(7.4[i][i])}H(--n);8 v.u(a)},1K:l(){9 M=7.1q(),1c;9 n=7.4.q,k=n,i,1s,1n=7.4[0].q,p;J{i=k-n;o(M.4[i][i]==0){2e(j=i+1;j<k;j++){o(M.4[j][i]!=0){1c=[];1s=1n;J{p=1n-1s;1c.19(M.4[i][p]+M.4[j][p])}H(--1s);M.4[i]=1c;1I}}}o(M.4[i][i]!=0){2e(j=i+1;j<k;j++){9 a=M.4[j][i]/M.4[i][i];1c=[];1s=1n;J{p=1n-1s;1c.19(p<=i?0:M.4[j][p]-M.4[i][p]*a)}H(--1s);M.4[j]=1c}}}H(--n);8 M},3h:l(){8 7.1K()},2z:l(){o(!7.1y()){8 w}9 M=7.1K();9 a=M.4[0][0],n=M.4.q-1,k=n,i;J{i=k-n+1;a=a*M.4[i][i]}H(--n);8 a},3f:l(){8 7.2z()},2y:l(){8(7.1y()&&7.2z()===0)},2Y:l(){o(!7.1y()){8 w}9 a=7.4[0][0],n=7.4.q-1,k=n,i;J{i=k-n+1;a+=7.4[i][i]}H(--n);8 a},3e:l(){8 7.2Y()},1Y:l(){9 M=7.1K(),1Y=0;9 a=7.4.q,15=a,i,G,10=7.4[0].q,j;J{i=15-a;G=10;J{j=10-G;o(F.13(M.4[i][j])>17.16){1Y++;1I}}H(--G)}H(--a);8 1Y},3d:l(){8 7.1Y()},2W:l(a){9 M=a.4||a;o(1g(M[0][0])=='1f'){M=S.u(M).4}9 T=7.1q(),1p=T.4[0].q;9 b=T.4.q,15=b,i,G,10=M[0].q,j;o(b!=M.q){8 w}J{i=15-b;G=10;J{j=10-G;T.4[i][1p+j]=M[i][j]}H(--G)}H(--b);8 T},2w:l(){o(!7.1y()||7.2y()){8 w}9 a=7.4.q,15=a,i,j;9 M=7.2W(S.I(a)).1K();9 b,1n=M.4[0].q,p,1c,2v;9 c=[],2c;J{i=a-1;1c=[];b=1n;c[i]=[];2v=M.4[i][i];J{p=1n-b;2c=M.4[i][p]/2v;1c.19(2c);o(p>=15){c[i].19(2c)}}H(--b);M.4[i]=1c;2e(j=0;j<i;j++){1c=[];b=1n;J{p=1n-b;1c.19(M.4[j][p]-M.4[i][p]*M.4[j][i])}H(--b);M.4[j]=1c}}H(--a);8 S.u(c)},3c:l(){8 7.2w()},2d:l(){8 7.1b(l(x){8 F.2d(x)})},2V:l(x){8 7.1b(l(p){8(F.13(p-x)<=17.16)?x:p})},2n:l(){9 a=[];9 n=7.4.q,k=n,i;J{i=k-n;a.19(v.u(7.4[i]).2n())}H(--n);8 a.2K('\\n')},26:l(a){9 i,4=a.4||a;o(1g(4[0][0])!='1f'){9 b=4.q,15=b,G,10,j;7.4=[];J{i=15-b;G=4[i].q;10=G;7.4[i]=[];J{j=10-G;7.4[i][j]=4[i][j]}H(--G)}H(--b);8 7}9 n=4.q,k=n;7.4=[];J{i=k-n;7.4.19([4[i]])}H(--n);8 7}};S.u=l(a){9 M=25 S();8 M.26(a)};S.I=l(n){9 a=[],k=n,i,G,j;J{i=k-n;a[i]=[];G=k;J{j=k-G;a[i][j]=(i==j)?1:0}H(--G)}H(--n);8 S.u(a)};S.2X=l(a){9 n=a.q,k=n,i;9 M=S.I(n);J{i=k-n;M.4[i][i]=a[i]}H(--n);8 M};S.1R=l(b,a){o(!a){8 S.u([[F.1H(b),-F.1G(b)],[F.1G(b),F.1H(b)]])}9 d=a.1q();o(d.4.q!=3){8 w}9 e=d.1u();9 x=d.4[0]/e,y=d.4[1]/e,z=d.4[2]/e;9 s=F.1G(b),c=F.1H(b),t=1-c;8 S.u([[t*x*x+c,t*x*y-s*z,t*x*z+s*y],[t*x*y+s*z,t*y*y+c,t*y*z-s*x],[t*x*z-s*y,t*y*z+s*x,t*z*z+c]])};S.3b=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[1,0,0],[0,c,-s],[0,s,c]])};S.39=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[c,0,s],[0,1,0],[-s,0,c]])};S.38=l(t){9 c=F.1H(t),s=F.1G(t);8 S.u([[c,-s,0],[s,c,0],[0,0,1]])};S.2J=l(n,m){8 S.1j(n,m).1b(l(){8 F.2F()})};S.1j=l(n,m){9 a=[],12=n,i,G,j;J{i=n-12;a[i]=[];G=m;J{j=m-G;a[i][j]=0}H(--G)}H(--12);8 S.u(a)};l 14(){}14.23={24:l(a){8(7.1m(a)&&7.1h(a.K))},1q:l(){8 14.u(7.K,7.U)},2U:l(a){9 V=a.4||a;8 14.u([7.K.4[0]+V[0],7.K.4[1]+V[1],7.K.4[2]+(V[2]||0)],7.U)},1m:l(a){o(a.W){8 a.1m(7)}9 b=7.U.1C(a.U);8(F.13(b)<=17.16||F.13(b-F.1A)<=17.16)},1o:l(a){o(a.W){8 a.1o(7)}o(a.U){o(7.1m(a)){8 7.1o(a.K)}9 N=7.U.2f(a.U).2q().4;9 A=7.K.4,B=a.K.4;8 F.13((A[0]-B[0])*N[0]+(A[1]-B[1])*N[1]+(A[2]-B[2])*N[2])}1d{9 P=a.4||a;9 A=7.K.4,D=7.U.4;9 b=P[0]-A[0],2a=P[1]-A[1],29=(P[2]||0)-A[2];9 c=F.1x(b*b+2a*2a+29*29);o(c===0)8 0;9 d=(b*D[0]+2a*D[1]+29*D[2])/c;9 e=1-d*d;8 F.13(c*F.1x(e<0?0:e))}},1h:l(a){9 b=7.1o(a);8(b!==w&&b<=17.16)},2T:l(a){8 a.1h(7)},1v:l(a){o(a.W){8 a.1v(7)}8(!7.1m(a)&&7.1o(a)<=17.16)},1U:l(a){o(a.W){8 a.1U(7)}o(!7.1v(a)){8 w}9 P=7.K.4,X=7.U.4,Q=a.K.4,Y=a.U.4;9 b=X[0],1z=X[1],1B=X[2],1T=Y[0],1S=Y[1],1M=Y[2];9 c=P[0]-Q[0],2s=P[1]-Q[1],2r=P[2]-Q[2];9 d=-b*c-1z*2s-1B*2r;9 e=1T*c+1S*2s+1M*2r;9 f=b*b+1z*1z+1B*1B;9 g=1T*1T+1S*1S+1M*1M;9 h=b*1T+1z*1S+1B*1M;9 k=(d*g/f+h*e)/(g-h*h);8 v.u([P[0]+k*b,P[1]+k*1z,P[2]+k*1B])},1r:l(a){o(a.U){o(7.1v(a)){8 7.1U(a)}o(7.1m(a)){8 w}9 D=7.U.4,E=a.U.4;9 b=D[0],1l=D[1],1k=D[2],1P=E[0],1O=E[1],1Q=E[2];9 x=(1k*1P-b*1Q),y=(b*1O-1l*1P),z=(1l*1Q-1k*1O);9 N=v.u([x*1Q-y*1O,y*1P-z*1Q,z*1O-x*1P]);9 P=11.u(a.K,N);8 P.1U(7)}1d{9 P=a.4||a;o(7.1h(P)){8 v.u(P)}9 A=7.K.4,D=7.U.4;9 b=D[0],1l=D[1],1k=D[2],1w=A[0],18=A[1],1a=A[2];9 x=b*(P[1]-18)-1l*(P[0]-1w),y=1l*((P[2]||0)-1a)-1k*(P[1]-18),z=1k*(P[0]-1w)-b*((P[2]||0)-1a);9 V=v.u([1l*x-1k*z,1k*y-b*x,b*z-1l*y]);9 k=7.1o(P)/V.1u();8 v.u([P[0]+V.4[0]*k,P[1]+V.4[1]*k,(P[2]||0)+V.4[2]*k])}},1V:l(t,a){o(1g(a.U)=='1f'){a=14.u(a.1N(),v.k)}9 R=S.1R(t,a.U).4;9 C=a.1r(7.K).4;9 A=7.K.4,D=7.U.4;9 b=C[0],1E=C[1],1J=C[2],1w=A[0],18=A[1],1a=A[2];9 x=1w-b,y=18-1E,z=1a-1J;8 14.u([b+R[0][0]*x+R[0][1]*y+R[0][2]*z,1E+R[1][0]*x+R[1][1]*y+R[1][2]*z,1J+R[2][0]*x+R[2][1]*y+R[2][2]*z],[R[0][0]*D[0]+R[0][1]*D[1]+R[0][2]*D[2],R[1][0]*D[0]+R[1][1]*D[1]+R[1][2]*D[2],R[2][0]*D[0]+R[2][1]*D[1]+R[2][2]*D[2]])},1t:l(a){o(a.W){9 A=7.K.4,D=7.U.4;9 b=A[0],18=A[1],1a=A[2],2N=D[0],1l=D[1],1k=D[2];9 c=7.K.1t(a).4;9 d=b+2N,2h=18+1l,2o=1a+1k;9 Q=a.1r([d,2h,2o]).4;9 e=[Q[0]+(Q[0]-d)-c[0],Q[1]+(Q[1]-2h)-c[1],Q[2]+(Q[2]-2o)-c[2]];8 14.u(c,e)}1d o(a.U){8 7.1V(F.1A,a)}1d{9 P=a.4||a;8 14.u(7.K.1t([P[0],P[1],(P[2]||0)]),7.U)}},1Z:l(a,b){a=v.u(a);b=v.u(b);o(a.4.q==2){a.4.19(0)}o(b.4.q==2){b.4.19(0)}o(a.4.q>3||b.4.q>3){8 w}9 c=b.1u();o(c===0){8 w}7.K=a;7.U=v.u([b.4[0]/c,b.4[1]/c,b.4[2]/c]);8 7}};14.u=l(a,b){9 L=25 14();8 L.1Z(a,b)};14.X=14.u(v.1j(3),v.i);14.Y=14.u(v.1j(3),v.j);14.Z=14.u(v.1j(3),v.k);l 11(){}11.23={24:l(a){8(7.1h(a.K)&&7.1m(a))},1q:l(){8 11.u(7.K,7.W)},2U:l(a){9 V=a.4||a;8 11.u([7.K.4[0]+V[0],7.K.4[1]+V[1],7.K.4[2]+(V[2]||0)],7.W)},1m:l(a){9 b;o(a.W){b=7.W.1C(a.W);8(F.13(b)<=17.16||F.13(F.1A-b)<=17.16)}1d o(a.U){8 7.W.2k(a.U)}8 w},2k:l(a){9 b=7.W.1C(a.W);8(F.13(F.1A/2-b)<=17.16)},1o:l(a){o(7.1v(a)||7.1h(a)){8 0}o(a.K){9 A=7.K.4,B=a.K.4,N=7.W.4;8 F.13((A[0]-B[0])*N[0]+(A[1]-B[1])*N[1]+(A[2]-B[2])*N[2])}1d{9 P=a.4||a;9 A=7.K.4,N=7.W.4;8 F.13((A[0]-P[0])*N[0]+(A[1]-P[1])*N[1]+(A[2]-(P[2]||0))*N[2])}},1h:l(a){o(a.W){8 w}o(a.U){8(7.1h(a.K)&&7.1h(a.K.2j(a.U)))}1d{9 P=a.4||a;9 A=7.K.4,N=7.W.4;9 b=F.13(N[0]*(A[0]-P[0])+N[1]*(A[1]-P[1])+N[2]*(A[2]-(P[2]||0)));8(b<=17.16)}},1v:l(a){o(1g(a.U)=='1f'&&1g(a.W)=='1f'){8 w}8!7.1m(a)},1U:l(a){o(!7.1v(a)){8 w}o(a.U){9 A=a.K.4,D=a.U.4,P=7.K.4,N=7.W.4;9 b=(N[0]*(P[0]-A[0])+N[1]*(P[1]-A[1])+N[2]*(P[2]-A[2]))/(N[0]*D[0]+N[1]*D[1]+N[2]*D[2]);8 v.u([A[0]+D[0]*b,A[1]+D[1]*b,A[2]+D[2]*b])}1d o(a.W){9 c=7.W.2f(a.W).2q();9 N=7.W.4,A=7.K.4,O=a.W.4,B=a.K.4;9 d=S.1j(2,2),i=0;H(d.2y()){i++;d=S.u([[N[i%3],N[(i+1)%3]],[O[i%3],O[(i+1)%3]]])}9 e=d.2w().4;9 x=N[0]*A[0]+N[1]*A[1]+N[2]*A[2];9 y=O[0]*B[0]+O[1]*B[1]+O[2]*B[2];9 f=[e[0][0]*x+e[0][1]*y,e[1][0]*x+e[1][1]*y];9 g=[];2e(9 j=1;j<=3;j++){g.19((i==j)?0:f[(j+(5-i)%3)%3])}8 14.u(g,c)}},1r:l(a){9 P=a.4||a;9 A=7.K.4,N=7.W.4;9 b=(A[0]-P[0])*N[0]+(A[1]-P[1])*N[1]+(A[2]-(P[2]||0))*N[2];8 v.u([P[0]+N[0]*b,P[1]+N[1]*b,(P[2]||0)+N[2]*b])},1V:l(t,a){9 R=S.1R(t,a.U).4;9 C=a.1r(7.K).4;9 A=7.K.4,N=7.W.4;9 b=C[0],1E=C[1],1J=C[2],1w=A[0],18=A[1],1a=A[2];9 x=1w-b,y=18-1E,z=1a-1J;8 11.u([b+R[0][0]*x+R[0][1]*y+R[0][2]*z,1E+R[1][0]*x+R[1][1]*y+R[1][2]*z,1J+R[2][0]*x+R[2][1]*y+R[2][2]*z],[R[0][0]*N[0]+R[0][1]*N[1]+R[0][2]*N[2],R[1][0]*N[0]+R[1][1]*N[1]+R[1][2]*N[2],R[2][0]*N[0]+R[2][1]*N[1]+R[2][2]*N[2]])},1t:l(a){o(a.W){9 A=7.K.4,N=7.W.4;9 b=A[0],18=A[1],1a=A[2],2M=N[0],2L=N[1],2Q=N[2];9 c=7.K.1t(a).4;9 d=b+2M,2p=18+2L,2m=1a+2Q;9 Q=a.1r([d,2p,2m]).4;9 e=[Q[0]+(Q[0]-d)-c[0],Q[1]+(Q[1]-2p)-c[1],Q[2]+(Q[2]-2m)-c[2]];8 11.u(c,e)}1d o(a.U){8 7.1V(F.1A,a)}1d{9 P=a.4||a;8 11.u(7.K.1t([P[0],P[1],(P[2]||0)]),7.W)}},1Z:l(a,b,c){a=v.u(a);a=a.1N();o(a===w){8 w}b=v.u(b);b=b.1N();o(b===w){8 w}o(1g(c)=='1f'){c=w}1d{c=v.u(c);c=c.1N();o(c===w){8 w}}9 d=a.4[0],18=a.4[1],1a=a.4[2];9 e=b.4[0],1W=b.4[1],1X=b.4[2];9 f,1i;o(c!==w){9 g=c.4[0],2l=c.4[1],2t=c.4[2];f=v.u([(1W-18)*(2t-1a)-(1X-1a)*(2l-18),(1X-1a)*(g-d)-(e-d)*(2t-1a),(e-d)*(2l-18)-(1W-18)*(g-d)]);1i=f.1u();o(1i===0){8 w}f=v.u([f.4[0]/1i,f.4[1]/1i,f.4[2]/1i])}1d{1i=F.1x(e*e+1W*1W+1X*1X);o(1i===0){8 w}f=v.u([b.4[0]/1i,b.4[1]/1i,b.4[2]/1i])}7.K=a;7.W=f;8 7}};11.u=l(a,b,c){9 P=25 11();8 P.1Z(a,b,c)};11.2I=11.u(v.1j(3),v.k);11.2H=11.u(v.1j(3),v.i);11.2G=11.u(v.1j(3),v.j);11.36=11.2I;11.35=11.2H;11.3j=11.2G;9 $V=v.u;9 $M=S.u;9 $L=14.u;9 $P=11.u;",62,206,"||||elements|||this|return|var||||||||||||function|||if||length||||create|Vector|null|||||||||Math|nj|while||do|anchor||||||||Matrix||direction||normal||||kj|Plane|ni|abs|Line|ki|precision|Sylvester|A2|push|A3|map|els|else||undefined|typeof|contains|mod|Zero|D3|D2|isParallelTo|kp|distanceFrom|cols|dup|pointClosestTo|np|reflectionIn|modulus|intersects|A1|sqrt|isSquare|X2|PI|X3|angleFrom|mod1|C2|mod2|sin|cos|break|C3|toRightTriangular|false|Y3|to3D|E2|E1|E3|Rotation|Y2|Y1|intersectionWith|rotate|v12|v13|rank|setVectors|nc|sum|multiply|prototype|eql|new|setElements|case|each|PA3|PA2|part|new_element|round|for|cross|product|AD2|isSameSizeAs|add|isPerpendicularTo|v22|AN3|inspect|AD3|AN2|toUnitVector|PsubQ3|PsubQ2|v23|dot|divisor|inverse|true|isSingular|determinant|max|canMultiplyFromLeft|subtract|rows|col|random|ZX|YZ|XY|Random|join|N2|N1|D1|slice|default|N3|dimensions|switch|liesIn|translate|snapTo|augment|Diagonal|trace|indexOf|diagonal|transpose|minor|row|isAntiparallelTo|ZY|YX|acos|RotationZ|RotationY|liesOn|RotationX|inv|rk|tr|det|toDiagonalMatrix|toUpperTriangular|version|XZ".split("|"),0,{}))

/*
* 0.1.0: Copyright (c) 2006-2007 Erin Catto http://box2d-js.sourceforge.net/
* 0.2.0:
*     Created by rene7705@gmail.com, http://mediabeez.ws/downloads/
*     purpose: replace prototype dependency with jquery dependency
*     Copyright (c) 2010 Erin Catto
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked, and must not be
* misrepresented the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/

var b2Root=function(){function a(){this.initialize.apply(this,arguments)}return a};var b2Settings=new b2Root;jQuery.extend(b2Settings.prototype,{initialize:function(){}});b2Settings.USHRT_MAX=65535;b2Settings.b2_pi=Math.PI;b2Settings.b2_massUnitsPerKilogram=1;b2Settings.b2_timeUnitsPerSecond=1;b2Settings.b2_lengthUnitsPerMeter=30;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxShapesPerBody=64;b2Settings.b2_maxPolyVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=.005*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi;b2Settings.b2_velocityThreshold=1*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_maxLinearCorrection=.2*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi;b2Settings.b2_contactBaumgarte=.2;b2Settings.b2_timeToSleep=.5*b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_linearSleepTolerance=.01*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_angularSleepTolerance=2/180/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2Assert=function(a){if(!a){var b;b.x++}};var b2Vec2=new b2Root;jQuery.extend(b2Vec2.prototype,{initialize:function(a,b){this.x=a;this.y=b},SetZero:function(){this.x=0;this.y=0},Set:function(a,b){this.x=a;this.y=b},SetV:function(a){this.x=a.x;this.y=a.y},Negative:function(){return new b2Vec2(-this.x,-this.y)},Copy:function(){return new b2Vec2(this.x,this.y)},Add:function(a){this.x+=a.x;this.y+=a.y},Subtract:function(a){this.x-=a.x;this.y-=a.y},Multiply:function(a){this.x*=a;this.y*=a},MulM:function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y},MulTM:function(a){var b=b2Math.b2Dot(this,a.col1);this.y=b2Math.b2Dot(this,a.col2);this.x=b},CrossVF:function(a){var b=this.x;this.x=a*this.y;this.y=-a*b},CrossFV:function(a){var b=this.x;this.x=-a*this.y;this.y=a*b},MinV:function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y},MaxV:function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y},Abs:function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y)},Length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Normalize:function(){var a=this.Length();if(a<Number.MIN_VALUE){return 0}var b=1/a;this.x*=b;this.y*=b;return a},IsValid:function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)},x:null,y:null});b2Vec2.Make=function(a,b){return new b2Vec2(a,b)};var b2Mat22=new b2Root;jQuery.extend(b2Mat22.prototype,{initialize:function(a,b,c){if(a==null)a=0;this.col1=new b2Vec2;this.col2=new b2Vec2;if(b!=null&&c!=null){this.col1.SetV(b);this.col2.SetV(c)}else{var d=Math.cos(a);var e=Math.sin(a);this.col1.x=d;this.col2.x=-e;this.col1.y=e;this.col2.y=d}},Set:function(a){var b=Math.cos(a);var c=Math.sin(a);this.col1.x=b;this.col2.x=-c;this.col1.y=c;this.col2.y=b},SetVV:function(a,b){this.col1.SetV(a);this.col2.SetV(b)},Copy:function(){return new b2Mat22(0,this.col1,this.col2)},SetM:function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)},AddM:function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y},SetIdentity:function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1},SetZero:function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0},Invert:function(a){var b=this.col1.x;var c=this.col2.x;var d=this.col1.y;var e=this.col2.y;var f=b*e-c*d;f=1/f;a.col1.x=f*e;a.col2.x=-f*c;a.col1.y=-f*d;a.col2.y=f*b;return a},Solve:function(a,b,c){var d=this.col1.x;var e=this.col2.x;var f=this.col1.y;var g=this.col2.y;var h=d*g-e*f;h=1/h;a.x=h*(g*b-e*c);a.y=h*(d*c-f*b);return a},Abs:function(){this.col1.Abs();this.col2.Abs()},col1:new b2Vec2,col2:new b2Vec2});var b2Math=new b2Root;jQuery.extend(b2Math.prototype,{initialize:function(){}});b2Math.b2IsValid=function(a){return isFinite(a)};b2Math.b2Dot=function(a,b){return a.x*b.x+a.y*b.y};b2Math.b2CrossVV=function(a,b){return a.x*b.y-a.y*b.x};b2Math.b2CrossVF=function(a,b){var c=new b2Vec2(b*a.y,-b*a.x);return c};b2Math.b2CrossFV=function(a,b){var c=new b2Vec2(-a*b.y,a*b.x);return c};b2Math.b2MulMV=function(a,b){var c=new b2Vec2(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return c};b2Math.b2MulTMV=function(a,b){var c=new b2Vec2(b2Math.b2Dot(b,a.col1),b2Math.b2Dot(b,a.col2));return c};b2Math.AddVV=function(a,b){var c=new b2Vec2(a.x+b.x,a.y+b.y);return c};b2Math.SubtractVV=function(a,b){var c=new b2Vec2(a.x-b.x,a.y-b.y);return c};b2Math.MulFV=function(a,b){var c=new b2Vec2(a*b.x,a*b.y);return c};b2Math.AddMM=function(a,b){var c=new b2Mat22(0,b2Math.AddVV(a.col1,b.col1),b2Math.AddVV(a.col2,b.col2));return c};b2Math.b2MulMM=function(a,b){var c=new b2Mat22(0,b2Math.b2MulMV(a,b.col1),b2Math.b2MulMV(a,b.col2));return c};b2Math.b2MulTMM=function(a,b){var c=new b2Vec2(b2Math.b2Dot(a.col1,b.col1),b2Math.b2Dot(a.col2,b.col1));var d=new b2Vec2(b2Math.b2Dot(a.col1,b.col2),b2Math.b2Dot(a.col2,b.col2));var e=new b2Mat22(0,c,d);return e};b2Math.b2Abs=function(a){return a>0?a:-a};b2Math.b2AbsV=function(a){var b=new b2Vec2(b2Math.b2Abs(a.x),b2Math.b2Abs(a.y));return b};b2Math.b2AbsM=function(a){var b=new b2Mat22(0,b2Math.b2AbsV(a.col1),b2Math.b2AbsV(a.col2));return b};b2Math.b2Min=function(a,b){return a<b?a:b};b2Math.b2MinV=function(a,b){var c=new b2Vec2(b2Math.b2Min(a.x,b.x),b2Math.b2Min(a.y,b.y));return c};b2Math.b2Max=function(a,b){return a>b?a:b};b2Math.b2MaxV=function(a,b){var c=new b2Vec2(b2Math.b2Max(a.x,b.x),b2Math.b2Max(a.y,b.y));return c};b2Math.b2Clamp=function(a,b,c){return b2Math.b2Max(b,b2Math.b2Min(a,c))};b2Math.b2ClampV=function(a,b,c){return b2Math.b2MaxV(b,b2Math.b2MinV(a,c))};b2Math.b2Swap=function(a,b){var c=a[0];a[0]=b[0];b[0]=c};b2Math.b2Random=function(){return Math.random()*2-1};b2Math.b2NextPowerOfTwo=function(a){a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;a|=a>>16&65535;return a+1};b2Math.b2IsPowerOfTwo=function(a){var b=a>0&&(a&a-1)==0;return b};b2Math.tempVec2=new b2Vec2;b2Math.tempVec3=new b2Vec2;b2Math.tempVec4=new b2Vec2;b2Math.tempVec5=new b2Vec2;b2Math.tempMat=new b2Mat22;var b2ShapeDef=new b2Root;jQuery.extend(b2ShapeDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0,0);this.localRotation=0;this.friction=.2;this.restitution=0;this.density=0;this.categoryBits=1;this.maskBits=65535;this.groupIndex=0},ComputeMass:function(a){a.center=new b2Vec2(0,0);if(this.density==0){a.mass=0;a.center.Set(0,0);a.I=0}switch(this.type){case b2Shape.e_circleShape:{var b=this;a.mass=this.density*b2Settings.b2_pi*b.radius*b.radius;a.center.Set(0,0);a.I=.5*a.mass*b.radius*b.radius}break;case b2Shape.e_boxShape:{var c=this;a.mass=4*this.density*c.extents.x*c.extents.y;a.center.Set(0,0);a.I=a.mass/3*b2Math.b2Dot(c.extents,c.extents)}break;case b2Shape.e_polyShape:{var d=this;b2Shape.PolyMass(a,d.vertices,d.vertexCount,this.density)}break;default:a.mass=0;a.center.Set(0,0);a.I=0;break}},type:0,userData:null,localPosition:null,localRotation:null,friction:null,restitution:null,density:null,categoryBits:0,maskBits:0,groupIndex:0});var b2Shape=new b2Root;jQuery.extend(b2Shape.prototype,{TestPoint:function(a){return false},GetUserData:function(){return this.m_userData},GetType:function(){return this.m_type},GetBody:function(){return this.m_body},GetPosition:function(){return this.m_position},GetRotationMatrix:function(){return this.m_R},ResetProxy:function(a){},GetNext:function(){return this.m_next},initialize:function(a,b){this.m_R=new b2Mat22;this.m_position=new b2Vec2;this.m_userData=a.userData;this.m_friction=a.friction;this.m_restitution=a.restitution;this.m_body=b;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0;this.m_categoryBits=a.categoryBits;this.m_maskBits=a.maskBits;this.m_groupIndex=a.groupIndex},DestroyProxy:function(){if(this.m_proxyId!=b2Pair.b2_nullProxy){this.m_body.m_world.m_broadPhase.DestroyProxy(this.m_proxyId);this.m_proxyId=b2Pair.b2_nullProxy}},Synchronize:function(a,b,c,d){},QuickSync:function(a,b){},Support:function(a,b,c){},GetMaxRadius:function(){return this.m_maxRadius},m_next:null,m_R:new b2Mat22,m_position:new b2Vec2,m_type:0,m_userData:null,m_body:null,m_friction:null,m_restitution:null,m_maxRadius:null,m_proxyId:0,m_categoryBits:0,m_maskBits:0,m_groupIndex:0});b2Shape.Create=function(a,b,c){switch(a.type){case b2Shape.e_circleShape:{return new b2CircleShape(a,b,c)};case b2Shape.e_boxShape:case b2Shape.e_polyShape:{return new b2PolyShape(a,b,c)}}return null};b2Shape.Destroy=function(a){if(a.m_proxyId!=b2Pair.b2_nullProxy)a.m_body.m_world.m_broadPhase.DestroyProxy(a.m_proxyId)};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_boxShape=1;b2Shape.e_polyShape=2;b2Shape.e_meshShape=3;b2Shape.e_shapeTypeCount=4;b2Shape.PolyMass=function(a,b,c,d){var e=new b2Vec2;e.SetZero();var f=0;var g=0;var h=new b2Vec2(0,0);var i=1/3;for(var j=0;j<c;++j){var k=h;var l=b[j];var m=j+1<c?b[j+1]:b[0];var n=b2Math.SubtractVV(l,k);var o=b2Math.SubtractVV(m,k);var p=b2Math.b2CrossVV(n,o);var q=.5*p;f+=q;var r=new b2Vec2;r.SetV(k);r.Add(l);r.Add(m);r.Multiply(i*q);e.Add(r);var s=k.x;var t=k.y;var u=n.x;var v=n.y;var w=o.x;var x=o.y;var y=i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s;var z=i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t;g+=p*(y+z)}a.mass=d*f;e.Multiply(1/f);a.center=e;g=d*(g-f*b2Math.b2Dot(e,e));a.I=g};b2Shape.PolyCentroid=function(a,b,c){var d=0;var e=0;var f=0;var g=0;var h=0;var i=1/3;for(var j=0;j<b;++j){var k=g;var l=h;var m=a[j].x;var n=a[j].y;var o=j+1<b?a[j+1].x:a[0].x;var p=j+1<b?a[j+1].y:a[0].y;var q=m-k;var r=n-l;var s=o-k;var t=p-l;var u=q*t-r*s;var v=.5*u;f+=v;d+=v*i*(k+m+o);e+=v*i*(l+n+p)}d*=1/f;e*=1/f;c.Set(d,e)};var b2BoxDef=new b2Root;jQuery.extend(b2BoxDef.prototype,b2ShapeDef.prototype);jQuery.extend(b2BoxDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0,0);this.localRotation=0;this.friction=.2;this.restitution=0;this.density=0;this.categoryBits=1;this.maskBits=65535;this.groupIndex=0;this.type=b2Shape.e_boxShape;this.extents=new b2Vec2(1,1)},extents:null});var b2CircleDef=new b2Root;jQuery.extend(b2CircleDef.prototype,b2ShapeDef.prototype);jQuery.extend(b2CircleDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0,0);this.localRotation=0;this.friction=.2;this.restitution=0;this.density=0;this.categoryBits=1;this.maskBits=65535;this.groupIndex=0;this.type=b2Shape.e_circleShape;this.radius=1},radius:null});var b2CircleShape=new b2Root;jQuery.extend(b2CircleShape.prototype,b2Shape.prototype);jQuery.extend(b2CircleShape.prototype,{TestPoint:function(a){var b=new b2Vec2;b.SetV(a);b.Subtract(this.m_position);return b2Math.b2Dot(b,b)<=this.m_radius*this.m_radius},initialize:function(a,b,c){this.m_R=new b2Mat22;this.m_position=new b2Vec2;this.m_userData=a.userData;this.m_friction=a.friction;this.m_restitution=a.restitution;this.m_body=b;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0;this.m_categoryBits=a.categoryBits;this.m_maskBits=a.maskBits;this.m_groupIndex=a.groupIndex;this.m_localPosition=new b2Vec2;var d=a;this.m_localPosition.Set(a.localPosition.x-c.x,a.localPosition.y-c.y);this.m_type=b2Shape.e_circleShape;this.m_radius=d.radius;this.m_R.SetM(this.m_body.m_R);var e=this.m_R.col1.x*this.m_localPosition.x+this.m_R.col2.x*this.m_localPosition.y;var f=this.m_R.col1.y*this.m_localPosition.x+this.m_R.col2.y*this.m_localPosition.y;this.m_position.x=this.m_body.m_position.x+e;this.m_position.y=this.m_body.m_position.y+f;this.m_maxRadius=Math.sqrt(e*e+f*f)+this.m_radius;var g=new b2AABB;g.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);g.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);var h=this.m_body.m_world.m_broadPhase;if(h.InRange(g)){this.m_proxyId=h.CreateProxy(g,this)}else{this.m_proxyId=b2Pair.b2_nullProxy}if(this.m_proxyId==b2Pair.b2_nullProxy){this.m_body.Freeze()}},Synchronize:function(a,b,c,d){this.m_R.SetM(d);this.m_position.x=d.col1.x*this.m_localPosition.x+d.col2.x*this.m_localPosition.y+c.x;this.m_position.y=d.col1.y*this.m_localPosition.x+d.col2.y*this.m_localPosition.y+c.y;if(this.m_proxyId==b2Pair.b2_nullProxy){return}var e=a.x+(b.col1.x*this.m_localPosition.x+b.col2.x*this.m_localPosition.y);var f=a.y+(b.col1.y*this.m_localPosition.x+b.col2.y*this.m_localPosition.y);var g=Math.min(e,this.m_position.x);var h=Math.min(f,this.m_position.y);var i=Math.max(e,this.m_position.x);var j=Math.max(f,this.m_position.y);var k=new b2AABB;k.minVertex.Set(g-this.m_radius,h-this.m_radius);k.maxVertex.Set(i+this.m_radius,j+this.m_radius);var l=this.m_body.m_world.m_broadPhase;if(l.InRange(k)){l.MoveProxy(this.m_proxyId,k)}else{this.m_body.Freeze()}},QuickSync:function(a,b){this.m_R.SetM(b);this.m_position.x=b.col1.x*this.m_localPosition.x+b.col2.x*this.m_localPosition.y+a.x;this.m_position.y=b.col1.y*this.m_localPosition.x+b.col2.y*this.m_localPosition.y+a.y},ResetProxy:function(a){if(this.m_proxyId==b2Pair.b2_nullProxy){return}var b=a.GetProxy(this.m_proxyId);a.DestroyProxy(this.m_proxyId);b=null;var c=new b2AABB;c.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);c.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);if(a.InRange(c)){this.m_proxyId=a.CreateProxy(c,this)}else{this.m_proxyId=b2Pair.b2_nullProxy}if(this.m_proxyId==b2Pair.b2_nullProxy){this.m_body.Freeze()}},Support:function(a,b,c){var d=Math.sqrt(a*a+b*b);a/=d;b/=d;c.Set(this.m_position.x+this.m_radius*a,this.m_position.y+this.m_radius*b)},m_localPosition:new b2Vec2,m_radius:null});var b2MassData=new b2Root;jQuery.extend(b2MassData.prototype,{mass:0,center:new b2Vec2(0,0),I:0,initialize:function(){this.center=new b2Vec2(0,0)}});var b2PolyDef=new b2Root;jQuery.extend(b2PolyDef.prototype,b2ShapeDef.prototype);jQuery.extend(b2PolyDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0,0);this.localRotation=0;this.friction=.2;this.restitution=0;this.density=0;this.categoryBits=1;this.maskBits=65535;this.groupIndex=0;this.vertices=new Array(b2Settings.b2_maxPolyVertices);this.type=b2Shape.e_polyShape;this.vertexCount=0;for(var a=0;a<b2Settings.b2_maxPolyVertices;a++){this.vertices[a]=new b2Vec2}},vertices:new Array(b2Settings.b2_maxPolyVertices),vertexCount:0});var b2AABB=new b2Root;jQuery.extend(b2AABB.prototype,{IsValid:function(){var a=this.maxVertex.x;var b=this.maxVertex.y;a=this.maxVertex.x;b=this.maxVertex.y;a-=this.minVertex.x;b-=this.minVertex.y;var c=a>=0&&b>=0;c=c&&this.minVertex.IsValid()&&this.maxVertex.IsValid();return c},minVertex:new b2Vec2,maxVertex:new b2Vec2,initialize:function(){this.minVertex=new b2Vec2;this.maxVertex=new b2Vec2}});var b2OBB=new b2Root;jQuery.extend(b2OBB.prototype,{R:new b2Mat22,center:new b2Vec2,extents:new b2Vec2,initialize:function(){this.R=new b2Mat22;this.center=new b2Vec2;this.extents=new b2Vec2}});var b2PolyShape=new b2Root;jQuery.extend(b2PolyShape.prototype,b2Shape.prototype);jQuery.extend(b2PolyShape.prototype,{TestPoint:function(a){var b=new b2Vec2;b.SetV(a);b.Subtract(this.m_position);b.MulTM(this.m_R);for(var c=0;c<this.m_vertexCount;++c){var d=new b2Vec2;d.SetV(b);d.Subtract(this.m_vertices[c]);var e=b2Math.b2Dot(this.m_normals[c],d);if(e>0){return false}}return true},initialize:function(a,b,c){this.m_R=new b2Mat22;this.m_position=new b2Vec2;this.m_userData=a.userData;this.m_friction=a.friction;this.m_restitution=a.restitution;this.m_body=b;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0;this.m_categoryBits=a.categoryBits;this.m_maskBits=a.maskBits;this.m_groupIndex=a.groupIndex;this.syncAABB=new b2AABB;this.syncMat=new b2Mat22;this.m_localCentroid=new b2Vec2;this.m_localOBB=new b2OBB;var d=0;var e;var f;var g;var h=new b2AABB;this.m_vertices=new Array(b2Settings.b2_maxPolyVertices);this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices);this.m_normals=new Array(b2Settings.b2_maxPolyVertices);this.m_type=b2Shape.e_polyShape;var i=new b2Mat22(a.localRotation);if(a.type==b2Shape.e_boxShape){this.m_localCentroid.x=a.localPosition.x-c.x;this.m_localCentroid.y=a.localPosition.y-c.y;var j=a;this.m_vertexCount=4;e=j.extents.x;f=j.extents.y;var k=Math.max(0,e-2*b2Settings.b2_linearSlop);var l=Math.max(0,f-2*b2Settings.b2_linearSlop);g=this.m_vertices[0]=new b2Vec2;g.x=i.col1.x*e+i.col2.x*f;g.y=i.col1.y*e+i.col2.y*f;g=this.m_vertices[1]=new b2Vec2;g.x=i.col1.x*-e+i.col2.x*f;g.y=i.col1.y*-e+i.col2.y*f;g=this.m_vertices[2]=new b2Vec2;g.x=i.col1.x*-e+i.col2.x*-f;g.y=i.col1.y*-e+i.col2.y*-f;g=this.m_vertices[3]=new b2Vec2;g.x=i.col1.x*e+i.col2.x*-f;g.y=i.col1.y*e+i.col2.y*-f;g=this.m_coreVertices[0]=new b2Vec2;g.x=i.col1.x*k+i.col2.x*l;g.y=i.col1.y*k+i.col2.y*l;g=this.m_coreVertices[1]=new b2Vec2;g.x=i.col1.x*-k+i.col2.x*l;g.y=i.col1.y*-k+i.col2.y*l;g=this.m_coreVertices[2]=new b2Vec2;g.x=i.col1.x*-k+i.col2.x*-l;g.y=i.col1.y*-k+i.col2.y*-l;g=this.m_coreVertices[3]=new b2Vec2;g.x=i.col1.x*k+i.col2.x*-l;g.y=i.col1.y*k+i.col2.y*-l}else{var m=a;this.m_vertexCount=m.vertexCount;b2Shape.PolyCentroid(m.vertices,m.vertexCount,b2PolyShape.tempVec);var n=b2PolyShape.tempVec.x;var o=b2PolyShape.tempVec.y;this.m_localCentroid.x=a.localPosition.x+(i.col1.x*n+i.col2.x*o)-c.x;this.m_localCentroid.y=a.localPosition.y+(i.col1.y*n+i.col2.y*o)-c.y;for(d=0;d<this.m_vertexCount;++d){this.m_vertices[d]=new b2Vec2;this.m_coreVertices[d]=new b2Vec2;e=m.vertices[d].x-n;f=m.vertices[d].y-o;this.m_vertices[d].x=i.col1.x*e+i.col2.x*f;this.m_vertices[d].y=i.col1.y*e+i.col2.y*f;var p=this.m_vertices[d].x;var q=this.m_vertices[d].y;var r=Math.sqrt(p*p+q*q);if(r>Number.MIN_VALUE){p*=1/r;q*=1/r}this.m_coreVertices[d].x=this.m_vertices[d].x-2*b2Settings.b2_linearSlop*p;this.m_coreVertices[d].y=this.m_vertices[d].y-2*b2Settings.b2_linearSlop*q}}var s=Number.MAX_VALUE;var t=Number.MAX_VALUE;var u=-Number.MAX_VALUE;var v=-Number.MAX_VALUE;this.m_maxRadius=0;for(d=0;d<this.m_vertexCount;++d){var w=this.m_vertices[d];s=Math.min(s,w.x);t=Math.min(t,w.y);u=Math.max(u,w.x);v=Math.max(v,w.y);this.m_maxRadius=Math.max(this.m_maxRadius,w.Length())}this.m_localOBB.R.SetIdentity();this.m_localOBB.center.Set((s+u)*.5,(t+v)*.5);this.m_localOBB.extents.Set((u-s)*.5,(v-t)*.5);var x=0;var y=0;for(d=0;d<this.m_vertexCount;++d){this.m_normals[d]=new b2Vec2;x=d;y=d+1<this.m_vertexCount?d+1:0;this.m_normals[d].x=this.m_vertices[y].y-this.m_vertices[x].y;this.m_normals[d].y=-(this.m_vertices[y].x-this.m_vertices[x].x);this.m_normals[d].Normalize()}for(d=0;d<this.m_vertexCount;++d){x=d;y=d+1<this.m_vertexCount?d+1:0}this.m_R.SetM(this.m_body.m_R);this.m_position.x=this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y);b2PolyShape.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.Abs();e=b2PolyShape.tAbsR.col1.x*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.x*this.m_localOBB.extents.y;f=b2PolyShape.tAbsR.col1.y*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.y*this.m_localOBB.extents.y;var z=this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y);var A=this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);h.minVertex.x=z-e;h.minVertex.y=A-f;h.maxVertex.x=z+e;h.maxVertex.y=A+f;var B=this.m_body.m_world.m_broadPhase;if(B.InRange(h)){this.m_proxyId=B.CreateProxy(h,this)}else{this.m_proxyId=b2Pair.b2_nullProxy}if(this.m_proxyId==b2Pair.b2_nullProxy){this.m_body.Freeze()}},syncAABB:new b2AABB,syncMat:new b2Mat22,Synchronize:function(a,b,c,d){this.m_R.SetM(d);this.m_position.x=this.m_body.m_position.x+(d.col1.x*this.m_localCentroid.x+d.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(d.col1.y*this.m_localCentroid.x+d.col2.y*this.m_localCentroid.y);if(this.m_proxyId==b2Pair.b2_nullProxy){return}var e;var f;var g=b.col1;var h=b.col2;var i=this.m_localOBB.R.col1;var j=this.m_localOBB.R.col2;this.syncMat.col1.x=g.x*i.x+h.x*i.y;this.syncMat.col1.y=g.y*i.x+h.y*i.y;this.syncMat.col2.x=g.x*j.x+h.x*j.y;this.syncMat.col2.y=g.y*j.x+h.y*j.y;this.syncMat.Abs();e=this.m_localCentroid.x+this.m_localOBB.center.x;f=this.m_localCentroid.y+this.m_localOBB.center.y;var k=a.x+(b.col1.x*e+b.col2.x*f);var l=a.y+(b.col1.y*e+b.col2.y*f);e=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;f=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=k-e;this.syncAABB.minVertex.y=l-f;this.syncAABB.maxVertex.x=k+e;this.syncAABB.maxVertex.y=l+f;g=d.col1;h=d.col2;i=this.m_localOBB.R.col1;j=this.m_localOBB.R.col2;this.syncMat.col1.x=g.x*i.x+h.x*i.y;this.syncMat.col1.y=g.y*i.x+h.y*i.y;this.syncMat.col2.x=g.x*j.x+h.x*j.y;this.syncMat.col2.y=g.y*j.x+h.y*j.y;this.syncMat.Abs();e=this.m_localCentroid.x+this.m_localOBB.center.x;f=this.m_localCentroid.y+this.m_localOBB.center.y;k=c.x+(d.col1.x*e+d.col2.x*f);l=c.y+(d.col1.y*e+d.col2.y*f);e=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;f=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,k-e);this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,l-f);this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,k+e);this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,l+f);var m=this.m_body.m_world.m_broadPhase;if(m.InRange(this.syncAABB)){m.MoveProxy(this.m_proxyId,this.syncAABB)}else{this.m_body.Freeze()}},QuickSync:function(a,b){this.m_R.SetM(b);this.m_position.x=a.x+(b.col1.x*this.m_localCentroid.x+b.col2.x*this.m_localCentroid.y);this.m_position.y=a.y+(b.col1.y*this.m_localCentroid.x+b.col2.y*this.m_localCentroid.y)},ResetProxy:function(a){if(this.m_proxyId==b2Pair.b2_nullProxy){return}var b=a.GetProxy(this.m_proxyId);a.DestroyProxy(this.m_proxyId);b=null;var c=b2Math.b2MulMM(this.m_R,this.m_localOBB.R);var d=b2Math.b2AbsM(c);var e=b2Math.b2MulMV(d,this.m_localOBB.extents);var f=b2Math.b2MulMV(this.m_R,this.m_localOBB.center);f.Add(this.m_position);var g=new b2AABB;g.minVertex.SetV(f);g.minVertex.Subtract(e);g.maxVertex.SetV(f);g.maxVertex.Add(e);if(a.InRange(g)){this.m_proxyId=a.CreateProxy(g,this)}else{this.m_proxyId=b2Pair.b2_nullProxy}if(this.m_proxyId==b2Pair.b2_nullProxy){this.m_body.Freeze()}},Support:function(a,b,c){var d=a*this.m_R.col1.x+b*this.m_R.col1.y;var e=a*this.m_R.col2.x+b*this.m_R.col2.y;var f=0;var g=this.m_coreVertices[0].x*d+this.m_coreVertices[0].y*e;for(var h=1;h<this.m_vertexCount;++h){var i=this.m_coreVertices[h].x*d+this.m_coreVertices[h].y*e;if(i>g){f=h;g=i}}c.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[f].x+this.m_R.col2.x*this.m_coreVertices[f].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[f].x+this.m_R.col2.y*this.m_coreVertices[f].y))},m_localCentroid:new b2Vec2,m_localOBB:new b2OBB,m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null});b2PolyShape.tempVec=new b2Vec2;b2PolyShape.tAbsR=new b2Mat22;var b2Bound=new b2Root;jQuery.extend(b2Bound.prototype,{IsLower:function(){return(this.value&1)==0},IsUpper:function(){return(this.value&1)==1},Swap:function(a){var b=this.value;var c=this.proxyId;var d=this.stabbingCount;this.value=a.value;this.proxyId=a.proxyId;this.stabbingCount=a.stabbingCount;a.value=b;a.proxyId=c;a.stabbingCount=d},value:0,proxyId:0,stabbingCount:0,initialize:function(){}});var b2BoundValues=new b2Root;jQuery.extend(b2BoundValues.prototype,{lowerValues:[0,0],upperValues:[0,0],initialize:function(){this.lowerValues=[0,0];this.upperValues=[0,0]}});var b2BufferedPair=new b2Root;jQuery.extend(b2BufferedPair.prototype,{proxyId1:0,proxyId2:0,initialize:function(){}});var b2Pair=new b2Root;jQuery.extend(b2Pair.prototype,{SetBuffered:function(){this.status|=b2Pair.e_pairBuffered},ClearBuffered:function(){this.status&=~b2Pair.e_pairBuffered},IsBuffered:function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},SetRemoved:function(){this.status|=b2Pair.e_pairRemoved},ClearRemoved:function(){this.status&=~b2Pair.e_pairRemoved},IsRemoved:function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},SetFinal:function(){this.status|=b2Pair.e_pairFinal},IsFinal:function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},userData:null,proxyId1:0,proxyId2:0,next:0,status:0,initialize:function(){}});b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=1;b2Pair.e_pairRemoved=2;b2Pair.e_pairFinal=4;var b2PairCallback=new b2Root;jQuery.extend(b2PairCallback.prototype,{PairAdded:function(a,b){return null},PairRemoved:function(a,b,c){},initialize:function(){}});var b2PairManager=new b2Root;jQuery.extend(b2PairManager.prototype,{initialize:function(){var a=0;this.m_hashTable=new Array(b2Pair.b2_tableCapacity);for(a=0;a<b2Pair.b2_tableCapacity;++a){this.m_hashTable[a]=b2Pair.b2_nullPair}this.m_pairs=new Array(b2Settings.b2_maxPairs);for(a=0;a<b2Settings.b2_maxPairs;++a){this.m_pairs[a]=new b2Pair}this.m_pairBuffer=new Array(b2Settings.b2_maxPairs);for(a=0;a<b2Settings.b2_maxPairs;++a){this.m_pairBuffer[a]=new b2BufferedPair}for(a=0;a<b2Settings.b2_maxPairs;++a){this.m_pairs[a].proxyId1=b2Pair.b2_nullProxy;this.m_pairs[a].proxyId2=b2Pair.b2_nullProxy;this.m_pairs[a].userData=null;this.m_pairs[a].status=0;this.m_pairs[a].next=a+1}this.m_pairs[b2Settings.b2_maxPairs-1].next=b2Pair.b2_nullPair;this.m_pairCount=0},Initialize:function(a,b){this.m_broadPhase=a;this.m_callback=b},AddBufferedPair:function(a,b){var c=this.AddPair(a,b);if(c.IsBuffered()==false){c.SetBuffered();this.m_pairBuffer[this.m_pairBufferCount].proxyId1=c.proxyId1;this.m_pairBuffer[this.m_pairBufferCount].proxyId2=c.proxyId2;++this.m_pairBufferCount}c.ClearRemoved();if(b2BroadPhase.s_validate){this.ValidateBuffer()}},RemoveBufferedPair:function(a,b){var c=this.Find(a,b);if(c==null){return}if(c.IsBuffered()==false){c.SetBuffered();this.m_pairBuffer[this.m_pairBufferCount].proxyId1=c.proxyId1;this.m_pairBuffer[this.m_pairBufferCount].proxyId2=c.proxyId2;++this.m_pairBufferCount}c.SetRemoved();if(b2BroadPhase.s_validate){this.ValidateBuffer()}},Commit:function(){var a=0;var b=0;var c=this.m_broadPhase.m_proxyPool;for(a=0;a<this.m_pairBufferCount;++a){var d=this.Find(this.m_pairBuffer[a].proxyId1,this.m_pairBuffer[a].proxyId2);d.ClearBuffered();var e=c[d.proxyId1];var f=c[d.proxyId2];if(d.IsRemoved()){if(d.IsFinal()==true){this.m_callback.PairRemoved(e.userData,f.userData,d.userData)}this.m_pairBuffer[b].proxyId1=d.proxyId1;this.m_pairBuffer[b].proxyId2=d.proxyId2;++b}else{if(d.IsFinal()==false){d.userData=this.m_callback.PairAdded(e.userData,f.userData);d.SetFinal()}}}for(a=0;a<b;++a){this.RemovePair(this.m_pairBuffer[a].proxyId1,this.m_pairBuffer[a].proxyId2)}this.m_pairBufferCount=0;if(b2BroadPhase.s_validate){this.ValidateTable()}},AddPair:function(a,b){if(a>b){var c=a;a=b;b=c}var d=b2PairManager.Hash(a,b)&b2Pair.b2_tableMask;var e=e=this.FindHash(a,b,d);if(e!=null){return e}var f=this.m_freePair;e=this.m_pairs[f];this.m_freePair=e.next;e.proxyId1=a;e.proxyId2=b;e.status=0;e.userData=null;e.next=this.m_hashTable[d];this.m_hashTable[d]=f;++this.m_pairCount;return e},RemovePair:function(a,b){if(a>b){var c=a;a=b;b=c}var d=b2PairManager.Hash(a,b)&b2Pair.b2_tableMask;var e=this.m_hashTable[d];var f=null;while(e!=b2Pair.b2_nullPair){if(b2PairManager.Equals(this.m_pairs[e],a,b)){var g=e;if(f){f.next=this.m_pairs[e].next}else{this.m_hashTable[d]=this.m_pairs[e].next}var h=this.m_pairs[g];var i=h.userData;h.next=this.m_freePair;h.proxyId1=b2Pair.b2_nullProxy;h.proxyId2=b2Pair.b2_nullProxy;h.userData=null;h.status=0;this.m_freePair=g;--this.m_pairCount;return i}else{f=this.m_pairs[e];e=f.next}}return null},Find:function(a,b){if(a>b){var c=a;a=b;b=c}var d=b2PairManager.Hash(a,b)&b2Pair.b2_tableMask;return this.FindHash(a,b,d)},FindHash:function(a,b,c){var d=this.m_hashTable[c];while(d!=b2Pair.b2_nullPair&&b2PairManager.Equals(this.m_pairs[d],a,b)==false){d=this.m_pairs[d].next}if(d==b2Pair.b2_nullPair){return null}return this.m_pairs[d]},ValidateBuffer:function(){},ValidateTable:function(){},m_broadPhase:null,m_callback:null,m_pairs:null,m_freePair:0,m_pairCount:0,m_pairBuffer:null,m_pairBufferCount:0,m_hashTable:null});b2PairManager.Hash=function(a,b){var c=b<<16&4294901760|a;c=~c+(c<<15&4294934528);c=c^c>>12&1048575;c=c+(c<<2&4294967292);c=c^c>>4&268435455;c=c*2057;c=c^c>>16&65535;return c};b2PairManager.Equals=function(a,b,c){return a.proxyId1==b&&a.proxyId2==c};b2PairManager.EqualsPair=function(a,b){return a.proxyId1==b.proxyId1&&a.proxyId2==b.proxyId2};var b2BroadPhase=new b2Root;jQuery.extend(b2BroadPhase.prototype,{initialize:function(a,b){this.m_pairManager=new b2PairManager;this.m_proxyPool=new Array(b2Settings.b2_maxPairs);this.m_bounds=new Array(2*b2Settings.b2_maxProxies);this.m_queryResults=new Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2;var c=0;this.m_pairManager.Initialize(this,b);this.m_worldAABB=a;this.m_proxyCount=0;for(c=0;c<b2Settings.b2_maxProxies;c++){this.m_queryResults[c]=0}this.m_bounds=new Array(2);for(c=0;c<2;c++){this.m_bounds[c]=new Array(2*b2Settings.b2_maxProxies);for(var d=0;d<2*b2Settings.b2_maxProxies;d++){this.m_bounds[c][d]=new b2Bound}}var e=a.maxVertex.x;var f=a.maxVertex.y;e-=a.minVertex.x;f-=a.minVertex.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/e;this.m_quantizationFactor.y=b2Settings.USHRT_MAX/f;var g;for(c=0;c<b2Settings.b2_maxProxies-1;++c){g=new b2Proxy;this.m_proxyPool[c]=g;g.SetNext(c+1);g.timeStamp=0;g.overlapCount=b2BroadPhase.b2_invalid;g.userData=null}g=new b2Proxy;this.m_proxyPool[b2Settings.b2_maxProxies-1]=g;g.SetNext(b2Pair.b2_nullProxy);g.timeStamp=0;g.overlapCount=b2BroadPhase.b2_invalid;g.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0},InRange:function(a){var b;var c;var d;var e;b=a.minVertex.x;c=a.minVertex.y;b-=this.m_worldAABB.maxVertex.x;c-=this.m_worldAABB.maxVertex.y;d=this.m_worldAABB.minVertex.x;e=this.m_worldAABB.minVertex.y;d-=a.maxVertex.x;e-=a.maxVertex.y;b=b2Math.b2Max(b,d);c=b2Math.b2Max(c,e);return b2Math.b2Max(b,c)<0},GetProxy:function(a){if(a==b2Pair.b2_nullProxy||this.m_proxyPool[a].IsValid()==false){return null}return this.m_proxyPool[a]},CreateProxy:function(a,b){var c=0;var d;var e=this.m_freeProxy;d=this.m_proxyPool[e];this.m_freeProxy=d.GetNext();d.overlapCount=0;d.userData=b;var f=2*this.m_proxyCount;var g=new Array;var h=new Array;this.ComputeBounds(g,h,a);for(var i=0;i<2;++i){var j=this.m_bounds[i];var k=0;var l=0;var m=[k];var n=[l];this.Query(m,n,g[i],h[i],j,f,i);k=m[0];l=n[0];var o=new Array;var p=0;var q=f-l;var r;var s;for(p=0;p<q;p++){o[p]=new b2Bound;r=o[p];s=j[l+p];r.value=s.value;r.proxyId=s.proxyId;r.stabbingCount=s.stabbingCount}q=o.length;var t=l+2;for(p=0;p<q;p++){s=o[p];r=j[t+p];r.value=s.value;r.proxyId=s.proxyId;r.stabbingCount=s.stabbingCount}o=new Array;q=l-k;for(p=0;p<q;p++){o[p]=new b2Bound;r=o[p];s=j[k+p];r.value=s.value;r.proxyId=s.proxyId;r.stabbingCount=s.stabbingCount}q=o.length;t=k+1;for(p=0;p<q;p++){s=o[p];r=j[t+p];r.value=s.value;r.proxyId=s.proxyId;r.stabbingCount=s.stabbingCount}++l;j[k].value=g[i];j[k].proxyId=e;j[l].value=h[i];j[l].proxyId=e;j[k].stabbingCount=k==0?0:j[k-1].stabbingCount;j[l].stabbingCount=j[l-1].stabbingCount;for(c=k;c<l;++c){j[c].stabbingCount++}for(c=k;c<f+2;++c){var u=this.m_proxyPool[j[c].proxyId];if(j[c].IsLower()){u.lowerBounds[i]=c}else{u.upperBounds[i]=c}}}++this.m_proxyCount;for(var v=0;v<this.m_queryResultCount;++v){this.m_pairManager.AddBufferedPair(e,this.m_queryResults[v])}this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return e},DestroyProxy:function(a){var b=this.m_proxyPool[a];var c=2*this.m_proxyCount;for(var d=0;d<2;++d){var e=this.m_bounds[d];var f=b.lowerBounds[d];var g=b.upperBounds[d];var h=e[f].value;var i=e[g].value;var j=new Array;var k=0;var l=g-f-1;var m;var n;for(k=0;k<l;k++){j[k]=new b2Bound;m=j[k];n=e[f+1+k];m.value=n.value;m.proxyId=n.proxyId;m.stabbingCount=n.stabbingCount}l=j.length;var o=f;for(k=0;k<l;k++){n=j[k];m=e[o+k];m.value=n.value;m.proxyId=n.proxyId;m.stabbingCount=n.stabbingCount}j=new Array;l=c-g-1;for(k=0;k<l;k++){j[k]=new b2Bound;m=j[k];n=e[g+1+k];m.value=n.value;m.proxyId=n.proxyId;m.stabbingCount=n.stabbingCount}l=j.length;o=g-1;for(k=0;k<l;k++){n=j[k];m=e[o+k];m.value=n.value;m.proxyId=n.proxyId;m.stabbingCount=n.stabbingCount}l=c-2;for(var p=f;p<l;++p){var q=this.m_proxyPool[e[p].proxyId];if(e[p].IsLower()){q.lowerBounds[d]=p}else{q.upperBounds[d]=p}}l=g-1;for(var r=f;r<l;++r){e[r].stabbingCount--}this.Query([0],[0],h,i,e,c-2,d)}for(var s=0;s<this.m_queryResultCount;++s){this.m_pairManager.RemoveBufferedPair(a,this.m_queryResults[s])}this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();b.userData=null;b.overlapCount=b2BroadPhase.b2_invalid;b.lowerBounds[0]=b2BroadPhase.b2_invalid;b.lowerBounds[1]=b2BroadPhase.b2_invalid;b.upperBounds[0]=b2BroadPhase.b2_invalid;b.upperBounds[1]=b2BroadPhase.b2_invalid;b.SetNext(this.m_freeProxy);this.m_freeProxy=a;--this.m_proxyCount},MoveProxy:function(a,b){var c=0;var d=0;var e;var f;var g;var h=0;var i;if(a==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=a){return}if(b.IsValid()==false){return}var j=2*this.m_proxyCount;var k=this.m_proxyPool[a];var l=new b2BoundValues;this.ComputeBounds(l.lowerValues,l.upperValues,b);var m=new b2BoundValues;for(c=0;c<2;++c){m.lowerValues[c]=this.m_bounds[c][k.lowerBounds[c]].value;m.upperValues[c]=this.m_bounds[c][k.upperBounds[c]].value}for(c=0;c<2;++c){var n=this.m_bounds[c];var o=k.lowerBounds[c];var p=k.upperBounds[c];var q=l.lowerValues[c];var r=l.upperValues[c];var s=q-n[o].value;var t=r-n[p].value;n[o].value=q;n[p].value=r;if(s<0){d=o;while(d>0&&q<n[d-1].value){e=n[d];f=n[d-1];var u=f.proxyId;var v=this.m_proxyPool[f.proxyId];f.stabbingCount++;if(f.IsUpper()==true){if(this.TestOverlap(l,v)){this.m_pairManager.AddBufferedPair(a,u)}v.upperBounds[c]++;e.stabbingCount++}else{v.lowerBounds[c]++;e.stabbingCount--}k.lowerBounds[c]--;e.Swap(f);--d}}if(t>0){d=p;while(d<j-1&&n[d+1].value<=r){e=n[d];g=n[d+1];h=g.proxyId;i=this.m_proxyPool[h];g.stabbingCount++;if(g.IsLower()==true){if(this.TestOverlap(l,i)){this.m_pairManager.AddBufferedPair(a,h)}i.lowerBounds[c]--;e.stabbingCount++}else{i.upperBounds[c]--;e.stabbingCount--}k.upperBounds[c]++;e.Swap(g);d++}}if(s>0){d=o;while(d<j-1&&n[d+1].value<=q){e=n[d];g=n[d+1];h=g.proxyId;i=this.m_proxyPool[h];g.stabbingCount--;if(g.IsUpper()){if(this.TestOverlap(m,i)){this.m_pairManager.RemoveBufferedPair(a,h)}i.upperBounds[c]--;e.stabbingCount--}else{i.lowerBounds[c]--;e.stabbingCount++}k.lowerBounds[c]++;e.Swap(g);d++}}if(t<0){d=p;while(d>0&&r<n[d-1].value){e=n[d];f=n[d-1];u=f.proxyId;v=this.m_proxyPool[u];f.stabbingCount--;if(f.IsLower()==true){if(this.TestOverlap(m,v)){this.m_pairManager.RemoveBufferedPair(a,u)}v.lowerBounds[c]++;e.stabbingCount--}else{v.upperBounds[c]++;e.stabbingCount++}k.upperBounds[c]--;e.Swap(f);d--}}}},Commit:function(){this.m_pairManager.Commit()},QueryAABB:function(a,b,c){var d=new Array;var e=new Array;this.ComputeBounds(d,e,a);var f=0;var g=0;var h=[f];var i=[g];this.Query(h,i,d[0],e[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(h,i,d[1],e[1],this.m_bounds[1],2*this.m_proxyCount,1);var j=0;for(var k=0;k<this.m_queryResultCount&&j<c;++k,++j){var l=this.m_proxyPool[this.m_queryResults[k]];b[k]=l.userData}this.m_queryResultCount=0;this.IncrementTimeStamp();return j},Validate:function(){var a;var b;var c;var d;for(var e=0;e<2;++e){var f=this.m_bounds[e];var g=2*this.m_proxyCount;var h=0;for(var i=0;i<g;++i){var j=f[i];if(j.IsLower()==true){h++}else{h--}}}},ComputeBounds:function(a,b,c){var d=c.minVertex.x;var e=c.minVertex.y;d=b2Math.b2Min(d,this.m_worldAABB.maxVertex.x);e=b2Math.b2Min(e,this.m_worldAABB.maxVertex.y);d=b2Math.b2Max(d,this.m_worldAABB.minVertex.x);e=b2Math.b2Max(e,this.m_worldAABB.minVertex.y);var f=c.maxVertex.x;var g=c.maxVertex.y;f=b2Math.b2Min(f,this.m_worldAABB.maxVertex.x);g=b2Math.b2Min(g,this.m_worldAABB.maxVertex.y);f=b2Math.b2Max(f,this.m_worldAABB.minVertex.x);g=b2Math.b2Max(g,this.m_worldAABB.minVertex.y);a[0]=this.m_quantizationFactor.x*(d-this.m_worldAABB.minVertex.x)&b2Settings.USHRT_MAX-1;b[0]=this.m_quantizationFactor.x*(f-this.m_worldAABB.minVertex.x)&65535|1;a[1]=this.m_quantizationFactor.y*(e-this.m_worldAABB.minVertex.y)&b2Settings.USHRT_MAX-1;b[1]=this.m_quantizationFactor.y*(g-this.m_worldAABB.minVertex.y)&65535|1},TestOverlapValidate:function(a,b){for(var c=0;c<2;++c){var d=this.m_bounds[c];if(d[a.lowerBounds[c]].value>d[b.upperBounds[c]].value)return false;if(d[a.upperBounds[c]].value<d[b.lowerBounds[c]].value)return false}return true},TestOverlap:function(a,b){for(var c=0;c<2;++c){var d=this.m_bounds[c];if(a.lowerValues[c]>d[b.upperBounds[c]].value)return false;if(a.upperValues[c]<d[b.lowerBounds[c]].value)return false}return true},Query:function(a,b,c,d,e,f,g){var h=b2BroadPhase.BinarySearch(e,f,c);var i=b2BroadPhase.BinarySearch(e,f,d);for(var j=h;j<i;++j){if(e[j].IsLower()){this.IncrementOverlapCount(e[j].proxyId)}}if(h>0){var k=h-1;var l=e[k].stabbingCount;while(l){if(e[k].IsLower()){var m=this.m_proxyPool[e[k].proxyId];if(h<=m.upperBounds[g]){this.IncrementOverlapCount(e[k].proxyId);--l}}--k}}a[0]=h;b[0]=i},IncrementOverlapCount:function(a){var b=this.m_proxyPool[a];if(b.timeStamp<this.m_timeStamp){b.timeStamp=this.m_timeStamp;b.overlapCount=1}else{b.overlapCount=2;this.m_queryResults[this.m_queryResultCount]=a;++this.m_queryResultCount}},IncrementTimeStamp:function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var a=0;a<b2Settings.b2_maxProxies;++a){this.m_proxyPool[a].timeStamp=0}this.m_timeStamp=1}else{++this.m_timeStamp}},m_pairManager:new b2PairManager,m_proxyPool:new Array(b2Settings.b2_maxPairs),m_freeProxy:0,m_bounds:new Array(2*b2Settings.b2_maxProxies),m_queryResults:new Array(b2Settings.b2_maxProxies),m_queryResultCount:0,m_worldAABB:null,m_quantizationFactor:new b2Vec2,m_proxyCount:0,m_timeStamp:0});b2BroadPhase.s_validate=false;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;b2BroadPhase.BinarySearch=function(a,b,c){var d=0;var e=b-1;while(d<=e){var f=Math.floor((d+e)/2);if(a[f].value>c){e=f-1}else if(a[f].value<c){d=f+1}else{return f}}return d};var b2Collision=new b2Root;jQuery.extend(b2Collision.prototype,{initialize:function(){}});b2Collision.b2_nullFeature=255;b2Collision.ClipSegmentToLine=function(a,b,c,d){var e=0;var f=b[0].v;var g=b[1].v;var h=b2Math.b2Dot(c,b[0].v)-d;var i=b2Math.b2Dot(c,b[1].v)-d;if(h<=0)a[e++]=b[0];if(i<=0)a[e++]=b[1];if(h*i<0){var j=h/(h-i);var k=a[e].v;k.x=f.x+j*(g.x-f.x);k.y=f.y+j*(g.y-f.y);if(h>0){a[e].id=b[0].id}else{a[e].id=b[1].id}++e}return e};b2Collision.EdgeSeparation=function(a,b,c){var d=a.m_vertices;var e=c.m_vertexCount;var f=c.m_vertices;var g=a.m_normals[b].x;var h=a.m_normals[b].y;var i=g;var j=a.m_R;g=j.col1.x*i+j.col2.x*h;h=j.col1.y*i+j.col2.y*h;var k=g;var l=h;j=c.m_R;i=k*j.col1.x+l*j.col1.y;l=k*j.col2.x+l*j.col2.y;k=i;var m=0;var n=Number.MAX_VALUE;for(var o=0;o<e;++o){var p=f[o];var q=p.x*k+p.y*l;if(q<n){n=q;m=o}}j=a.m_R;var r=a.m_position.x+(j.col1.x*d[b].x+j.col2.x*d[b].y);var s=a.m_position.y+(j.col1.y*d[b].x+j.col2.y*d[b].y);j=c.m_R;var t=c.m_position.x+(j.col1.x*f[m].x+j.col2.x*f[m].y);var u=c.m_position.y+(j.col1.y*f[m].x+j.col2.y*f[m].y);t-=r;u-=s;var v=t*g+u*h;return v};b2Collision.FindMaxSeparation=function(a,b,c,d){var e=b.m_vertexCount;var f=c.m_position.x-b.m_position.x;var g=c.m_position.y-b.m_position.y;var h=f*b.m_R.col1.x+g*b.m_R.col1.y;var i=f*b.m_R.col2.x+g*b.m_R.col2.y;var j=0;var k=-Number.MAX_VALUE;for(var l=0;l<e;++l){var m=b.m_normals[l].x*h+b.m_normals[l].y*i;if(m>k){k=m;j=l}}var n=b2Collision.EdgeSeparation(b,j,c);if(n>0&&d==false){return n}var o=j-1>=0?j-1:e-1;var p=b2Collision.EdgeSeparation(b,o,c);if(p>0&&d==false){return p}var q=j+1<e?j+1:0;var r=b2Collision.EdgeSeparation(b,q,c);if(r>0&&d==false){return r}var s=0;var t;var u=0;if(p>n&&p>r){u=-1;s=o;t=p}else if(r>n){u=1;s=q;t=r}else{a[0]=j;return n}while(true){if(u==-1)j=s-1>=0?s-1:e-1;else j=s+1<e?s+1:0;n=b2Collision.EdgeSeparation(b,j,c);if(n>0&&d==false){return n}if(n>t){s=j;t=n}else{break}}a[0]=s;return t};b2Collision.FindIncidentEdge=function(a,b,c,d){var e=b.m_vertexCount;var f=b.m_vertices;var g=d.m_vertexCount;var h=d.m_vertices;var i=c;var j=c+1==e?0:c+1;var k=f[j];var l=k.x;var m=k.y;k=f[i];l-=k.x;m-=k.y;var n=l;l=m;m=-n;var o=1/Math.sqrt(l*l+m*m);l*=o;m*=o;var p=l;var q=m;n=p;var r=b.m_R;p=r.col1.x*n+r.col2.x*q;q=r.col1.y*n+r.col2.y*q;var s=p;var t=q;r=d.m_R;n=s*r.col1.x+t*r.col1.y;t=s*r.col2.x+t*r.col2.y;s=n;var u=0;var v=0;var w=Number.MAX_VALUE;for(var x=0;x<g;++x){var y=x;var z=x+1<g?x+1:0;k=h[z];var A=k.x;var B=k.y;k=h[y];A-=k.x;B-=k.y;n=A;A=B;B=-n;o=1/Math.sqrt(A*A+B*B);A*=o;B*=o;var C=A*s+B*t;if(C<w){w=C;u=y;v=z}}var D;D=a[0];k=D.v;k.SetV(h[u]);k.MulM(d.m_R);k.Add(d.m_position);D.id.features.referenceFace=c;D.id.features.incidentEdge=u;D.id.features.incidentVertex=u;D=a[1];k=D.v;k.SetV(h[v]);k.MulM(d.m_R);k.Add(d.m_position);D.id.features.referenceFace=c;D.id.features.incidentEdge=u;D.id.features.incidentVertex=v};b2Collision.b2CollidePolyTempVec=new b2Vec2;b2Collision.b2CollidePoly=function(a,b,c,d){a.pointCount=0;var e=0;var f=[e];var g=b2Collision.FindMaxSeparation(f,b,c,d);e=f[0];if(g>0&&d==false)return;var h=0;var i=[h];var j=b2Collision.FindMaxSeparation(i,c,b,d);h=i[0];if(j>0&&d==false)return;var k;var l;var m=0;var n=0;var o=.98;var p=.001;if(j>o*g+p){k=c;l=b;m=h;n=1}else{k=b;l=c;m=e;n=0}var q=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(q,k,m,l);var r=k.m_vertexCount;var s=k.m_vertices;var t=s[m];var u=m+1<r?s[m+1]:s[0];var v=u.x-t.x;var w=u.y-t.y;var x=u.x-t.x;var y=u.y-t.y;var z=x;var A=k.m_R;x=A.col1.x*z+A.col2.x*y;y=A.col1.y*z+A.col2.y*y;var B=1/Math.sqrt(x*x+y*y);x*=B;y*=B;var C=x;var D=y;z=C;C=D;D=-z;var E=t.x;var F=t.y;z=E;A=k.m_R;E=A.col1.x*z+A.col2.x*F;F=A.col1.y*z+A.col2.y*F;E+=k.m_position.x;F+=k.m_position.y;var G=u.x;var H=u.y;z=G;A=k.m_R;G=A.col1.x*z+A.col2.x*H;H=A.col1.y*z+A.col2.y*H;G+=k.m_position.x;H+=k.m_position.y;var I=C*E+D*F;var J=-(x*E+y*F);var K=x*G+y*H;var L=[new ClipVertex,new ClipVertex];var M=[new ClipVertex,new ClipVertex];var N=0;b2Collision.b2CollidePolyTempVec.Set(-x,-y);N=b2Collision.ClipSegmentToLine(L,q,b2Collision.b2CollidePolyTempVec,J);if(N<2)return;b2Collision.b2CollidePolyTempVec.Set(x,y);N=b2Collision.ClipSegmentToLine(M,L,b2Collision.b2CollidePolyTempVec,K);if(N<2)return;if(n){a.normal.Set(-C,-D)}else{a.normal.Set(C,D)}var O=0;for(var P=0;P<b2Settings.b2_maxManifoldPoints;++P){var Q=M[P].v;var R=C*Q.x+D*Q.y-I;if(R<=0||d==true){var S=a.points[O];S.separation=R;S.position.SetV(M[P].v);S.id.Set(M[P].id);S.id.features.flip=n;++O}}a.pointCount=O};b2Collision.b2CollideCircle=function(a,b,c,d){a.pointCount=0;var e=c.m_position.x-b.m_position.x;var f=c.m_position.y-b.m_position.y;var g=e*e+f*f;var h=b.m_radius+c.m_radius;if(g>h*h&&d==false){return}var i;if(g<Number.MIN_VALUE){i=-h;a.normal.Set(0,1)}else{var j=Math.sqrt(g);i=j-h;var k=1/j;a.normal.x=k*e;a.normal.y=k*f}a.pointCount=1;var l=a.points[0];l.id.set_key(0);l.separation=i;l.position.x=c.m_position.x-c.m_radius*a.normal.x;l.position.y=c.m_position.y-c.m_radius*a.normal.y};b2Collision.b2CollidePolyAndCircle=function(a,b,c,d){a.pointCount=0;var e;var f;var g;var h=c.m_position.x-b.m_position.x;var i=c.m_position.y-b.m_position.y;var j=b.m_R;var k=h*j.col1.x+i*j.col1.y;i=h*j.col2.x+i*j.col2.y;h=k;var l;var m=0;var n=-Number.MAX_VALUE;var o=c.m_radius;for(var p=0;p<b.m_vertexCount;++p){var q=b.m_normals[p].x*(h-b.m_vertices[p].x)+b.m_normals[p].y*(i-b.m_vertices[p].y);if(q>o){return}if(q>n){n=q;m=p}}if(n<Number.MIN_VALUE){a.pointCount=1;var r=b.m_normals[m];a.normal.x=j.col1.x*r.x+j.col2.x*r.y;a.normal.y=j.col1.y*r.x+j.col2.y*r.y;e=a.points[0];e.id.features.incidentEdge=m;e.id.features.incidentVertex=b2Collision.b2_nullFeature;e.id.features.referenceFace=b2Collision.b2_nullFeature;e.id.features.flip=0;e.position.x=c.m_position.x-o*a.normal.x;e.position.y=c.m_position.y-o*a.normal.y;e.separation=n-o;return}var s=m;var t=s+1<b.m_vertexCount?s+1:0;var u=b.m_vertices[t].x-b.m_vertices[s].x;var v=b.m_vertices[t].y-b.m_vertices[s].y;var w=Math.sqrt(u*u+v*v);u/=w;v/=w;if(w<Number.MIN_VALUE){f=h-b.m_vertices[s].x;g=i-b.m_vertices[s].y;l=Math.sqrt(f*f+g*g);f/=l;g/=l;if(l>o){return}a.pointCount=1;a.normal.Set(j.col1.x*f+j.col2.x*g,j.col1.y*f+j.col2.y*g);e=a.points[0];e.id.features.incidentEdge=b2Collision.b2_nullFeature;e.id.features.incidentVertex=s;e.id.features.referenceFace=b2Collision.b2_nullFeature;e.id.features.flip=0;e.position.x=c.m_position.x-o*a.normal.x;e.position.y=c.m_position.y-o*a.normal.y;e.separation=l-o;return}var x=(h-b.m_vertices[s].x)*u+(i-b.m_vertices[s].y)*v;e=a.points[0];e.id.features.incidentEdge=b2Collision.b2_nullFeature;e.id.features.incidentVertex=b2Collision.b2_nullFeature;e.id.features.referenceFace=b2Collision.b2_nullFeature;e.id.features.flip=0;var y,z;if(x<=0){y=b.m_vertices[s].x;z=b.m_vertices[s].y;e.id.features.incidentVertex=s}else if(x>=w){y=b.m_vertices[t].x;z=b.m_vertices[t].y;e.id.features.incidentVertex=t}else{y=u*x+b.m_vertices[s].x;z=v*x+b.m_vertices[s].y;e.id.features.incidentEdge=s}f=h-y;g=i-z;l=Math.sqrt(f*f+g*g);f/=l;g/=l;if(l>o){return}a.pointCount=1;a.normal.Set(j.col1.x*f+j.col2.x*g,j.col1.y*f+j.col2.y*g);e.position.x=c.m_position.x-o*a.normal.x;e.position.y=c.m_position.y-o*a.normal.y;e.separation=l-o};b2Collision.b2TestOverlap=function(a,b){var c=b.minVertex;var d=a.maxVertex;var e=c.x-d.x;var f=c.y-d.y;c=a.minVertex;d=b.maxVertex;var g=c.x-d.x;var h=c.y-d.y;if(e>0||f>0)return false;if(g>0||h>0)return false;return true};var Features=new b2Root;jQuery.extend(Features.prototype,{set_referenceFace:function(a){this._referenceFace=a;this._m_id._key=this._m_id._key&4294967040|this._referenceFace&255},get_referenceFace:function(){return this._referenceFace},_referenceFace:0,set_incidentEdge:function(a){this._incidentEdge=a;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},get_incidentEdge:function(){return this._incidentEdge},_incidentEdge:0,set_incidentVertex:function(a){this._incidentVertex=a;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},get_incidentVertex:function(){return this._incidentVertex},_incidentVertex:0,set_flip:function(a){this._flip=a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},get_flip:function(){return this._flip},_flip:0,_m_id:null,initialize:function(){}});var b2ContactID=new b2Root;jQuery.extend(b2ContactID.prototype,{initialize:function(){this.features=new Features;this.features._m_id=this},Set:function(a){this.set_key(a._key)},Copy:function(){var a=new b2ContactID;a.set_key(this._key);return a},get_key:function(){return this._key},set_key:function(a){this._key=a;this.features._referenceFace=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255},features:new Features,_key:0});var b2ContactPoint=new b2Root;jQuery.extend(b2ContactPoint.prototype,{position:new b2Vec2,separation:null,normalImpulse:null,tangentImpulse:null,id:new b2ContactID,initialize:function(){this.position=new b2Vec2;this.id=new b2ContactID}});var b2Distance=new b2Root;jQuery.extend(b2Distance.prototype,{initialize:function(){}});b2Distance.ProcessTwo=function(a,b,c,d,e){var f=-e[1].x;var g=-e[1].y;var h=e[0].x-e[1].x;var i=e[0].y-e[1].y;var j=Math.sqrt(h*h+i*i);h/=j;i/=j;var k=f*h+g*i;if(k<=0||j<Number.MIN_VALUE){a.SetV(c[1]);b.SetV(d[1]);c[0].SetV(c[1]);d[0].SetV(d[1]);e[0].SetV(e[1]);return 1}k/=j;a.x=c[1].x+k*(c[0].x-c[1].x);a.y=c[1].y+k*(c[0].y-c[1].y);b.x=d[1].x+k*(d[0].x-d[1].x);b.y=d[1].y+k*(d[0].y-d[1].y);return 2};b2Distance.ProcessThree=function(a,b,c,d,e){var f=e[0].x;var g=e[0].y;var h=e[1].x;var i=e[1].y;var j=e[2].x;var k=e[2].y;var l=h-f;var m=i-g;var n=j-f;var o=k-g;var p=j-h;var q=k-i;var r=-(f*l+g*m);var s=h*l+i*m;var t=-(f*n+g*o);var u=j*n+k*o;var v=-(h*p+i*q);var w=j*p+k*q;if(u<=0&&w<=0){a.SetV(c[2]);b.SetV(d[2]);c[0].SetV(c[2]);d[0].SetV(d[2]);e[0].SetV(e[2]);return 1}var x=l*o-m*n;var y=x*(f*i-g*h);var z=x*(h*k-i*j);if(z<=0&&v>=0&&w>=0){var A=v/(v+w);a.x=c[1].x+A*(c[2].x-c[1].x);a.y=c[1].y+A*(c[2].y-c[1].y);b.x=d[1].x+A*(d[2].x-d[1].x);b.y=d[1].y+A*(d[2].y-d[1].y);c[0].SetV(c[2]);d[0].SetV(d[2]);e[0].SetV(e[2]);return 2}var B=x*(j*g-k*f);if(B<=0&&t>=0&&u>=0){var A=t/(t+u);a.x=c[0].x+A*(c[2].x-c[0].x);a.y=c[0].y+A*(c[2].y-c[0].y);b.x=d[0].x+A*(d[2].x-d[0].x);b.y=d[0].y+A*(d[2].y-d[0].y);c[1].SetV(c[2]);d[1].SetV(d[2]);e[1].SetV(e[2]);return 2}var C=z+B+y;C=1/C;var D=z*C;var E=B*C;var F=1-D-E;a.x=D*c[0].x+E*c[1].x+F*c[2].x;a.y=D*c[0].y+E*c[1].y+F*c[2].y;b.x=D*d[0].x+E*d[1].x+F*d[2].x;b.y=D*d[0].y+E*d[1].y+F*d[2].y;return 3};b2Distance.InPoinsts=function(a,b,c){for(var d=0;d<c;++d){if(a.x==b[d].x&&a.y==b[d].y){return true}}return false};b2Distance.Distance=function(a,b,c,d){var e=new Array(3);var f=new Array(3);var g=new Array(3);var h=0;a.SetV(c.m_position);b.SetV(d.m_position);var i=0;var j=20;for(var k=0;k<j;++k){var l=b.x-a.x;var m=b.y-a.y;var n=c.Support(l,m);var o=d.Support(-l,-m);i=l*l+m*m;var p=o.x-n.x;var q=o.y-n.y;var r=l*p+m*q;if(i-b2Dot(l*p+m*q)<=.01*i){if(h==0){a.SetV(n);b.SetV(o)}b2Distance.g_GJK_Iterations=k;return Math.sqrt(i)}switch(h){case 0:e[0].SetV(n);f[0].SetV(o);g[0]=w;a.SetV(e[0]);b.SetV(f[0]);++h;break;case 1:e[1].SetV(n);f[1].SetV(o);g[1].x=p;g[1].y=q;h=b2Distance.ProcessTwo(a,b,e,f,g);break;case 2:e[2].SetV(n);f[2].SetV(o);g[2].x=p;g[2].y=q;h=b2Distance.ProcessThree(a,b,e,f,g);break}if(h==3){b2Distance.g_GJK_Iterations=k;return 0}var s=-Number.MAX_VALUE;for(var t=0;t<h;++t){s=b2Math.b2Max(s,g[t].x*g[t].x+g[t].y*g[t].y)}if(h==3||i<=100*Number.MIN_VALUE*s){b2Distance.g_GJK_Iterations=k;return Math.sqrt(i)}}b2Distance.g_GJK_Iterations=j;return Math.sqrt(i)};b2Distance.g_GJK_Iterations=0;var b2Manifold=new b2Root;jQuery.extend(b2Manifold.prototype,{initialize:function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++){this.points[a]=new b2ContactPoint}this.normal=new b2Vec2},points:null,normal:null,pointCount:0});var b2Proxy=new b2Root;jQuery.extend(b2Proxy.prototype,{GetNext:function(){return this.lowerBounds[0]},SetNext:function(a){this.lowerBounds[0]=a},IsValid:function(){return this.overlapCount!=b2BroadPhase.b2_invalid},lowerBounds:[0,0],upperBounds:[0,0],overlapCount:0,timeStamp:0,userData:null,initialize:function(){this.lowerBounds=[0,0];this.upperBounds=[0,0]}});var ClipVertex=new b2Root;jQuery.extend(ClipVertex.prototype,{v:new b2Vec2,id:new b2ContactID,initialize:function(){this.v=new b2Vec2;this.id=new b2ContactID}});var b2BodyDef=new b2Root;jQuery.extend(b2BodyDef.prototype,{initialize:function(){this.shapes=new Array;this.userData=null;for(var a=0;a<b2Settings.b2_maxShapesPerBody;a++){this.shapes[a]=null}this.position=new b2Vec2(0,0);this.rotation=0;this.linearVelocity=new b2Vec2(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.isSleeping=false;this.preventRotation=false},userData:null,shapes:new Array,position:null,rotation:null,linearVelocity:null,angularVelocity:null,linearDamping:null,angularDamping:null,allowSleep:null,isSleeping:null,preventRotation:null,AddShape:function(a){for(var b=0;b<b2Settings.b2_maxShapesPerBody;++b){if(this.shapes[b]==null){this.shapes[b]=a;break}}}});var b2Body=new b2Root;jQuery.extend(b2Body.prototype,{SetOriginPosition:function(a,b){if(this.IsFrozen()){return}this.m_rotation=b;this.m_R.Set(this.m_rotation);this.m_position=b2Math.AddVV(a,b2Math.b2MulMV(this.m_R,this.m_center));this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var c=this.m_shapeList;c!=null;c=c.m_next){c.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R)}this.m_world.m_broadPhase.Commit()},GetOriginPosition:function(){return b2Math.SubtractVV(this.m_position,b2Math.b2MulMV(this.m_R,this.m_center))},SetCenterPosition:function(a,b){if(this.IsFrozen()){return}this.m_rotation=b;this.m_R.Set(this.m_rotation);this.m_position.SetV(a);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var c=this.m_shapeList;c!=null;c=c.m_next){c.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R)}this.m_world.m_broadPhase.Commit()},GetCenterPosition:function(){return this.m_position},GetRotation:function(){return this.m_rotation},GetRotationMatrix:function(){return this.m_R},SetLinearVelocity:function(a){this.m_linearVelocity.SetV(a)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(a){this.m_angularVelocity=a},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(a,b){if(this.IsSleeping()==false){this.m_force.Add(a);this.m_torque+=b2Math.b2CrossVV(b2Math.SubtractVV(b,this.m_position),a)}},ApplyTorque:function(a){if(this.IsSleeping()==false){this.m_torque+=a}},ApplyImpulse:function(a,b){if(this.IsSleeping()==false){this.m_linearVelocity.Add(b2Math.MulFV(this.m_invMass,a));this.m_angularVelocity+=this.m_invI*b2Math.b2CrossVV(b2Math.SubtractVV(b,this.m_position),a)}},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I},GetWorldPoint:function(a){return b2Math.AddVV(this.m_position,b2Math.b2MulMV(this.m_R,a))},GetWorldVector:function(a){return b2Math.b2MulMV(this.m_R,a)},GetLocalPoint:function(a){return b2Math.b2MulTMV(this.m_R,b2Math.SubtractVV(a,this.m_position))},GetLocalVector:function(a){return b2Math.b2MulTMV(this.m_R,a)},IsStatic:function(){return(this.m_flags&b2Body.e_staticFlag)==b2Body.e_staticFlag},IsFrozen:function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag},IsSleeping:function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag},AllowSleeping:function(a){if(a){this.m_flags|=b2Body.e_allowSleepFlag}else{this.m_flags&=~b2Body.e_allowSleepFlag;this.WakeUp()}},WakeUp:function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0},GetShapeList:function(){return this.m_shapeList},GetContactList:function(){return this.m_contactList},GetJointList:function(){return this.m_jointList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(a,b){this.sMat0=new b2Mat22;this.m_position=new b2Vec2;this.m_R=new b2Mat22(0);this.m_position0=new b2Vec2;var c=0;var d;var e;this.m_flags=0;this.m_position.SetV(a.position);this.m_rotation=a.rotation;this.m_R.Set(this.m_rotation);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;this.m_world=b;this.m_linearDamping=b2Math.b2Clamp(1-a.linearDamping,0,1);this.m_angularDamping=b2Math.b2Clamp(1-a.angularDamping,0,1);this.m_force=new b2Vec2(0,0);this.m_torque=0;this.m_mass=0;var f=new Array(b2Settings.b2_maxShapesPerBody);for(c=0;c<b2Settings.b2_maxShapesPerBody;c++){f[c]=new b2MassData}this.m_shapeCount=0;this.m_center=new b2Vec2(0,0);for(c=0;c<b2Settings.b2_maxShapesPerBody;++c){d=a.shapes[c];if(d==null)break;e=f[c];d.ComputeMass(e);this.m_mass+=e.mass;this.m_center.x+=e.mass*(d.localPosition.x+e.center.x);this.m_center.y+=e.mass*(d.localPosition.y+e.center.y);++this.m_shapeCount}if(this.m_mass>0){this.m_center.Multiply(1/this.m_mass);this.m_position.Add(b2Math.b2MulMV(this.m_R,this.m_center))}else{this.m_flags|=b2Body.e_staticFlag}this.m_I=0;for(c=0;c<this.m_shapeCount;++c){d=a.shapes[c];e=f[c];this.m_I+=e.I;var g=b2Math.SubtractVV(b2Math.AddVV(d.localPosition,e.center),this.m_center);this.m_I+=e.mass*b2Math.b2Dot(g,g)}if(this.m_mass>0){this.m_invMass=1/this.m_mass}else{this.m_invMass=0}if(this.m_I>0&&a.preventRotation==false){this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}this.m_linearVelocity=b2Math.AddVV(a.linearVelocity,b2Math.b2CrossFV(a.angularVelocity,this.m_center));this.m_angularVelocity=a.angularVelocity;this.m_jointList=null;this.m_contactList=null;this.m_prev=null;this.m_next=null;this.m_shapeList=null;for(c=0;c<this.m_shapeCount;++c){d=a.shapes[c];var h=b2Shape.Create(d,this,this.m_center);h.m_next=this.m_shapeList;this.m_shapeList=h}this.m_sleepTime=0;if(a.allowSleep){this.m_flags|=b2Body.e_allowSleepFlag}if(a.isSleeping){this.m_flags|=b2Body.e_sleepFlag}if(this.m_flags&b2Body.e_sleepFlag||this.m_invMass==0){this.m_linearVelocity.Set(0,0);this.m_angularVelocity=0}this.m_userData=a.userData},Destroy:function(){var a=this.m_shapeList;while(a){var b=a;a=a.m_next;b2Shape.Destroy(b)}},sMat0:new b2Mat22,SynchronizeShapes:function(){this.sMat0.Set(this.m_rotation0);for(var a=this.m_shapeList;a!=null;a=a.m_next){a.Synchronize(this.m_position0,this.sMat0,this.m_position,this.m_R)}},QuickSyncShapes:function(){for(var a=this.m_shapeList;a!=null;a=a.m_next){a.QuickSync(this.m_position,this.m_R)}},IsConnected:function(a){for(var b=this.m_jointList;b!=null;b=b.next){if(b.other==a)return b.joint.m_collideConnected==false}return false},Freeze:function(){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;for(var a=this.m_shapeList;a!=null;a=a.m_next){a.DestroyProxy()}},m_flags:0,m_position:new b2Vec2,m_rotation:null,m_R:new b2Mat22(0),m_position0:new b2Vec2,m_rotation0:null,m_linearVelocity:null,m_angularVelocity:null,m_force:null,m_torque:null,m_center:null,m_world:null,m_prev:null,m_next:null,m_shapeList:null,m_shapeCount:0,m_jointList:null,m_contactList:null,m_mass:null,m_invMass:null,m_I:null,m_invI:null,m_linearDamping:null,m_angularDamping:null,m_sleepTime:null,m_userData:null});b2Body.e_staticFlag=1;b2Body.e_frozenFlag=2;b2Body.e_islandFlag=4;b2Body.e_sleepFlag=8;b2Body.e_allowSleepFlag=16;b2Body.e_destroyFlag=32;var b2CollisionFilter=new b2Root;jQuery.extend(b2CollisionFilter.prototype,{ShouldCollide:function(a,b){if(a.m_groupIndex==b.m_groupIndex&&a.m_groupIndex!=0){return a.m_groupIndex>0}var c=(a.m_maskBits&b.m_categoryBits)!=0&&(a.m_categoryBits&b.m_maskBits)!=0;return c},initialize:function(){}});b2CollisionFilter.b2_defaultFilter=new b2CollisionFilter;var b2ContactNode=new b2Root;jQuery.extend(b2ContactNode.prototype,{other:null,contact:null,prev:null,next:null,initialize:function(){}});var b2Contact=new b2Root;jQuery.extend(b2Contact.prototype,{GetManifolds:function(){return null},GetManifoldCount:function(){return this.m_manifoldCount},GetNext:function(){return this.m_next},GetShape1:function(){return this.m_shape1},GetShape2:function(){return this.m_shape2},initialize:function(a,b){this.m_node1=new b2ContactNode;this.m_node2=new b2ContactNode;this.m_flags=0;if(!a||!b){this.m_shape1=null;this.m_shape2=null;return}this.m_shape1=a;this.m_shape2=b;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null},Evaluate:function(){},m_flags:0,m_prev:null,m_next:null,m_node1:new b2ContactNode,m_node2:new b2ContactNode,m_shape1:null,m_shape2:null,m_manifoldCount:0,m_friction:null,m_restitution:null});b2Contact.e_islandFlag=1;b2Contact.e_destroyFlag=2;b2Contact.AddType=function(a,b,c,d){b2Contact.s_registers[c][d].createFcn=a;b2Contact.s_registers[c][d].destroyFcn=b;b2Contact.s_registers[c][d].primary=true;if(c!=d){b2Contact.s_registers[d][c].createFcn=a;b2Contact.s_registers[d][c].destroyFcn=b;b2Contact.s_registers[d][c].primary=false}};b2Contact.InitializeRegisters=function(){b2Contact.s_registers=new Array(b2Shape.e_shapeTypeCount);for(var a=0;a<b2Shape.e_shapeTypeCount;a++){b2Contact.s_registers[a]=new Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++){b2Contact.s_registers[a][b]=new b2ContactRegister}}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polyShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyContact.Create,b2PolyContact.Destroy,b2Shape.e_polyShape,b2Shape.e_polyShape)};b2Contact.Create=function(a,b,c){if(b2Contact.s_initialized==false){b2Contact.InitializeRegisters();b2Contact.s_initialized=true}var d=a.m_type;var e=b.m_type;var f=b2Contact.s_registers[d][e].createFcn;if(f){if(b2Contact.s_registers[d][e].primary){return f(a,b,c)}else{var g=f(b,a,c);for(var h=0;h<g.GetManifoldCount();++h){var i=g.GetManifolds()[h];i.normal=i.normal.Negative()}return g}}else{return null}};b2Contact.Destroy=function(a,b){if(a.GetManifoldCount()>0){a.m_shape1.m_body.WakeUp();a.m_shape2.m_body.WakeUp()}var c=a.m_shape1.m_type;var d=a.m_shape2.m_type;var e=b2Contact.s_registers[c][d].destroyFcn;e(a,b)};b2Contact.s_registers=null;b2Contact.s_initialized=false;var b2CircleContact=new b2Root;jQuery.extend(b2CircleContact.prototype,b2Contact.prototype);jQuery.extend(b2CircleContact.prototype,{initialize:function(a,b){this.m_node1=new b2ContactNode;this.m_node2=new b2ContactNode;this.m_flags=0;if(!a||!b){this.m_shape1=null;this.m_shape2=null;return}this.m_shape1=a;this.m_shape2=b;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new b2Manifold];this.m_manifold[0].pointCount=0;this.m_manifold[0].points[0].normalImpulse=0;this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollideCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount>0){this.m_manifoldCount=1}else{this.m_manifoldCount=0}},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]});b2CircleContact.Create=function(a,b,c){return new b2CircleContact(a,b)};b2CircleContact.Destroy=function(a,b){};var b2Conservative=new b2Root;jQuery.extend(b2Conservative.prototype,{initialize:function(){}});b2Conservative.R1=new b2Mat22;b2Conservative.R2=new b2Mat22;b2Conservative.x1=new b2Vec2;b2Conservative.x2=new b2Vec2;b2Conservative.Conservative=function(a,b){var c=a.GetBody();var e=b.GetBody();var f=c.m_position.x-c.m_position0.x;var g=c.m_position.y-c.m_position0.y;var h=c.m_rotation-c.m_rotation0;var i=e.m_position.x-e.m_position0.x;var j=e.m_position.y-e.m_position0.y;var k=e.m_rotation-e.m_rotation0;var l=a.GetMaxRadius();var m=b.GetMaxRadius();var n=c.m_position0.x;var o=c.m_position0.y;var p=c.m_rotation0;var q=e.m_position0.x;var r=e.m_position0.y;var s=e.m_rotation0;var t=n;var u=o;var v=p;var w=q;var x=r;var y=s;b2Conservative.R1.Set(v);b2Conservative.R2.Set(y);a.QuickSync(p1,b2Conservative.R1);b.QuickSync(p2,b2Conservative.R2);var z=0;var A=10;var B;var C;var D=0;var E=true;for(var F=0;F<A;++F){var G=b2Distance.Distance(b2Conservative.x1,b2Conservative.x2,a,b);if(G<b2Settings.b2_linearSlop){if(F==0){E=false}else{E=true}break}if(F==0){B=b2Conservative.x2.x-b2Conservative.x1.x;C=b2Conservative.x2.y-b2Conservative.x1.y;var H=Math.sqrt(B*B+C*C);var I=B*(f-i)+C*(g-j)+Math.abs(h)*l+Math.abs(k)*m;if(Math.abs(I)<Number.MIN_VALUE){E=false;break}D=1/I}var J=G*D;var K=z+J;if(K<0||1<K){E=false;break}if(K<(1+100*Number.MIN_VALUE)*z){E=true;break}z=K;t=n+z*v1.x;u=o+z*v1.y;v=p+z*h;w=q+z*v2.x;x=r+z*v2.y;y=s+z*k;b2Conservative.R1.Set(v);b2Conservative.R2.Set(y);a.QuickSync(p1,b2Conservative.R1);b.QuickSync(p2,b2Conservative.R2)}if(E){B=b2Conservative.x2.x-b2Conservative.x1.x;C=b2Conservative.x2.y-b2Conservative.x1.y;var L=Math.sqrt(B*B+C*C);if(L>FLT_EPSILON){d*=b2_linearSlop/L}if(c.IsStatic()){c.m_position.x=t;c.m_position.y=u}else{c.m_position.x=t-B;c.m_position.y=u-C}c.m_rotation=v;c.m_R.Set(v);c.QuickSyncShapes();if(e.IsStatic()){e.m_position.x=w;e.m_position.y=x}else{e.m_position.x=w+B;e.m_position.y=x+C}e.m_position.x=w+B;e.m_position.y=x+C;e.m_rotation=y;e.m_R.Set(y);e.QuickSyncShapes();return true}a.QuickSync(c.m_position,c.m_R);b.QuickSync(e.m_position,e.m_R);return false};var b2ContactConstraint=new b2Root;jQuery.extend(b2ContactConstraint.prototype,{initialize:function(){this.normal=new b2Vec2;this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++){this.points[a]=new b2ContactConstraintPoint}},points:null,normal:new b2Vec2,manifold:null,body1:null,body2:null,friction:null,restitution:null,pointCount:0});var b2ContactConstraintPoint=new b2Root;jQuery.extend(b2ContactConstraintPoint.prototype,{localAnchor1:new b2Vec2,localAnchor2:new b2Vec2,normalImpulse:null,tangentImpulse:null,positionImpulse:null,normalMass:null,tangentMass:null,separation:null,velocityBias:null,initialize:function(){this.localAnchor1=new b2Vec2;this.localAnchor2=new b2Vec2}});var b2ContactRegister=new b2Root;jQuery.extend(b2ContactRegister.prototype,{createFcn:null,destroyFcn:null,primary:null,initialize:function(){}});var b2ContactSolver=new b2Root;jQuery.extend(b2ContactSolver.prototype,{initialize:function(a,b,c){this.m_constraints=new Array;this.m_allocator=c;var d=0;var e;var f;this.m_constraintCount=0;for(d=0;d<b;++d){this.m_constraintCount+=a[d].GetManifoldCount()}for(d=0;d<this.m_constraintCount;d++){this.m_constraints[d]=new b2ContactConstraint}var g=0;for(d=0;d<b;++d){var h=a[d];var i=h.m_shape1.m_body;var j=h.m_shape2.m_body;var k=h.GetManifoldCount();var l=h.GetManifolds();var m=h.m_friction;var n=h.m_restitution;var o=i.m_linearVelocity.x;var p=i.m_linearVelocity.y;var q=j.m_linearVelocity.x;var r=j.m_linearVelocity.y;var s=i.m_angularVelocity;var t=j.m_angularVelocity;for(var u=0;u<k;++u){var v=l[u];var w=v.normal.x;var x=v.normal.y;var y=this.m_constraints[g];y.body1=i;y.body2=j;y.manifold=v;y.normal.x=w;y.normal.y=x;y.pointCount=v.pointCount;y.friction=m;y.restitution=n;for(var z=0;z<y.pointCount;++z){var A=v.points[z];var B=y.points[z];B.normalImpulse=A.normalImpulse;B.tangentImpulse=A.tangentImpulse;B.separation=A.separation;var C=A.position.x-i.m_position.x;var D=A.position.y-i.m_position.y;var E=A.position.x-j.m_position.x;var F=A.position.y-j.m_position.y;e=B.localAnchor1;f=i.m_R;e.x=C*f.col1.x+D*f.col1.y;e.y=C*f.col2.x+D*f.col2.y;e=B.localAnchor2;f=j.m_R;e.x=E*f.col1.x+F*f.col1.y;e.y=E*f.col2.x+F*f.col2.y;var G=C*C+D*D;var H=E*E+F*F;var I=C*w+D*x;var J=E*w+F*x;var K=i.m_invMass+j.m_invMass;K+=i.m_invI*(G-I*I)+j.m_invI*(H-J*J);B.normalMass=1/K;var L=x;var M=-w;var N=C*L+D*M;var O=E*L+F*M;var P=i.m_invMass+j.m_invMass;P+=i.m_invI*(G-N*N)+j.m_invI*(H-O*O);B.tangentMass=1/P;B.velocityBias=0;if(B.separation>0){B.velocityBias=-60*B.separation}var Q=q+ -t*F-o- -s*D;var R=r+t*E-p-s*C;var S=y.normal.x*Q+y.normal.y*R;if(S<-b2Settings.b2_velocityThreshold){B.velocityBias+=-y.restitution*S}}++g}}},PreSolve:function(){var a;var b;var c;for(var d=0;d<this.m_constraintCount;++d){var e=this.m_constraints[d];var f=e.body1;var g=e.body2;var h=f.m_invMass;var i=f.m_invI;var j=g.m_invMass;var k=g.m_invI;var l=e.normal.x;var m=e.normal.y;var n=m;var o=-l;var p=0;var q=0;if(b2World.s_enableWarmStarting){q=e.pointCount;for(p=0;p<q;++p){var r=e.points[p];var s=r.normalImpulse*l+r.tangentImpulse*n;var t=r.normalImpulse*m+r.tangentImpulse*o;c=f.m_R;a=r.localAnchor1;var u=c.col1.x*a.x+c.col2.x*a.y;var v=c.col1.y*a.x+c.col2.y*a.y;c=g.m_R;a=r.localAnchor2;var w=c.col1.x*a.x+c.col2.x*a.y;var x=c.col1.y*a.x+c.col2.y*a.y;f.m_angularVelocity-=i*(u*t-v*s);f.m_linearVelocity.x-=h*s;f.m_linearVelocity.y-=h*t;g.m_angularVelocity+=k*(w*t-x*s);g.m_linearVelocity.x+=j*s;g.m_linearVelocity.y+=j*t;r.positionImpulse=0}}else{q=e.pointCount;for(p=0;p<q;++p){var y=e.points[p];y.normalImpulse=0;y.tangentImpulse=0;y.positionImpulse=0}}}},SolveVelocityConstraints:function(){var a=0;var b;var c;var d;var e;var f;var g;var h;var i;var j;var k;var l;var m;var n;for(var o=0;o<this.m_constraintCount;++o){var p=this.m_constraints[o];var q=p.body1;var r=p.body2;var s=q.m_angularVelocity;var t=q.m_linearVelocity;var u=r.m_angularVelocity;var v=r.m_linearVelocity;var w=q.m_invMass;var x=q.m_invI;var y=r.m_invMass;var z=r.m_invI;var A=p.normal.x;var B=p.normal.y;var C=B;var D=-A;var E=p.pointCount;for(a=0;a<E;++a){b=p.points[a];m=q.m_R;n=b.localAnchor1;c=m.col1.x*n.x+m.col2.x*n.y;d=m.col1.y*n.x+m.col2.y*n.y;m=r.m_R;n=b.localAnchor2;e=m.col1.x*n.x+m.col2.x*n.y;f=m.col1.y*n.x+m.col2.y*n.y;g=v.x+ -u*f-t.x- -s*d;h=v.y+u*e-t.y-s*c;var F=g*A+h*B;i=-b.normalMass*(F-b.velocityBias);j=b2Math.b2Max(b.normalImpulse+i,0);i=j-b.normalImpulse;k=i*A;l=i*B;t.x-=w*k;t.y-=w*l;s-=x*(c*l-d*k);v.x+=y*k;v.y+=y*l;u+=z*(e*l-f*k);b.normalImpulse=j;g=v.x+ -u*f-t.x- -s*d;h=v.y+u*e-t.y-s*c;var G=g*C+h*D;i=b.tangentMass*-G;var H=p.friction*b.normalImpulse;j=b2Math.b2Clamp(b.tangentImpulse+i,-H,H);i=j-b.tangentImpulse;k=i*C;l=i*D;t.x-=w*k;t.y-=w*l;s-=x*(c*l-d*k);v.x+=y*k;v.y+=y*l;u+=z*(e*l-f*k);b.tangentImpulse=j}q.m_angularVelocity=s;r.m_angularVelocity=u}},SolvePositionConstraints:function(a){var b=0;var c;var d;for(var e=0;e<this.m_constraintCount;++e){var f=this.m_constraints[e];var g=f.body1;var h=f.body2;var i=g.m_position;var j=g.m_rotation;var k=h.m_position;var l=h.m_rotation;var m=g.m_invMass;var n=g.m_invI;var o=h.m_invMass;var p=h.m_invI;var q=f.normal.x;var r=f.normal.y;var s=r;var t=-q;var u=f.pointCount;for(var v=0;v<u;++v){var w=f.points[v];c=g.m_R;d=w.localAnchor1;var x=c.col1.x*d.x+c.col2.x*d.y;var y=c.col1.y*d.x+c.col2.y*d.y;c=h.m_R;d=w.localAnchor2;var z=c.col1.x*d.x+c.col2.x*d.y;var A=c.col1.y*d.x+c.col2.y*d.y;var B=i.x+x;var C=i.y+y;var D=k.x+z;var E=k.y+A;var F=D-B;var G=E-C;var H=F*q+G*r+w.separation;b=b2Math.b2Min(b,H);var I=a*b2Math.b2Clamp(H+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);var J=-w.normalMass*I;var K=w.positionImpulse;w.positionImpulse=b2Math.b2Max(K+J,0);J=w.positionImpulse-K;var L=J*q;var M=J*r;i.x-=m*L;i.y-=m*M;j-=n*(x*M-y*L);g.m_R.Set(j);k.x+=o*L;k.y+=o*M;l+=p*(z*M-A*L);h.m_R.Set(l)}g.m_rotation=j;h.m_rotation=l}return b>=-b2Settings.b2_linearSlop},PostSolve:function(){for(var a=0;a<this.m_constraintCount;++a){var b=this.m_constraints[a];var c=b.manifold;for(var d=0;d<b.pointCount;++d){var e=c.points[d];var f=b.points[d];e.normalImpulse=f.normalImpulse;e.tangentImpulse=f.tangentImpulse}}},m_allocator:null,m_constraints:new Array,m_constraintCount:0});var b2PolyAndCircleContact=new b2Root;jQuery.extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);jQuery.extend(b2PolyAndCircleContact.prototype,{initialize:function(a,b){this.m_node1=new b2ContactNode;this.m_node2=new b2ContactNode;this.m_flags=0;if(!a||!b){this.m_shape1=null;this.m_shape2=null;return}this.m_shape1=a;this.m_shape2=b;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new b2Manifold];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polyShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold[0].pointCount=0;this.m_manifold[0].points[0].normalImpulse=0;this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollidePolyAndCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount>0){this.m_manifoldCount=1}else{this.m_manifoldCount=0}},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]});b2PolyAndCircleContact.Create=function(a,b,c){return new b2PolyAndCircleContact(a,b)};b2PolyAndCircleContact.Destroy=function(a,b){};var b2PolyContact=new b2Root;jQuery.extend(b2PolyContact.prototype,b2Contact.prototype);jQuery.extend(b2PolyContact.prototype,{initialize:function(a,b){this.m_node1=new b2ContactNode;this.m_node2=new b2ContactNode;this.m_flags=0;if(!a||!b){this.m_shape1=null;this.m_shape2=null;return}this.m_shape1=a;this.m_shape2=b;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m0=new b2Manifold;this.m_manifold=[new b2Manifold];this.m_manifold[0].pointCount=0},m0:new b2Manifold,Evaluate:function(){var a=this.m_manifold[0];var b=this.m0.points;for(var c=0;c<a.pointCount;c++){var d=b[c];var e=a.points[c];d.normalImpulse=e.normalImpulse;d.tangentImpulse=e.tangentImpulse;d.id=e.id.Copy()}this.m0.pointCount=a.pointCount;b2Collision.b2CollidePoly(a,this.m_shape1,this.m_shape2,false);if(a.pointCount>0){var f=[false,false];for(var g=0;g<a.pointCount;++g){var h=a.points[g];h.normalImpulse=0;h.tangentImpulse=0;var i=h.id.key;for(var j=0;j<this.m0.pointCount;++j){if(f[j]==true)continue;var k=this.m0.points[j];var l=k.id;if(l.key==i){f[j]=true;h.normalImpulse=k.normalImpulse;h.tangentImpulse=k.tangentImpulse;break}}}this.m_manifoldCount=1}else{this.m_manifoldCount=0}},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]});b2PolyContact.Create=function(a,b,c){return new b2PolyContact(a,b)};b2PolyContact.Destroy=function(a,b){};var b2JointDef=new b2Root;jQuery.extend(b2JointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false},type:0,userData:null,body1:null,body2:null,collideConnected:null});var b2JointNode=new b2Root;jQuery.extend(b2JointNode.prototype,{other:null,joint:null,prev:null,next:null,initialize:function(){}});var b2Joint=new b2Root;jQuery.extend(b2Joint.prototype,{GetType:function(){return this.m_type},GetAnchor1:function(){return null},GetAnchor2:function(){return null},GetReactionForce:function(a){return null},GetReactionTorque:function(a){return 0},GetBody1:function(){return this.m_body1},GetBody2:function(){return this.m_body2},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData},PrepareVelocitySolver:function(){},SolveVelocityConstraints:function(a){},PreparePositionSolver:function(){},SolvePositionConstraints:function(){return false},m_type:0,m_prev:null,m_next:null,m_node1:new b2JointNode,m_node2:new b2JointNode,m_body1:null,m_body2:null,m_islandFlag:null,m_collideConnected:null,m_userData:null});b2Joint.Create=function(a,b){var c=null;switch(a.type){case b2Joint.e_distanceJoint:{c=new b2DistanceJoint(a)}break;case b2Joint.e_mouseJoint:{c=new b2MouseJoint(a)}break;case b2Joint.e_prismaticJoint:{c=new b2PrismaticJoint(a)}break;case b2Joint.e_revoluteJoint:{c=new b2RevoluteJoint(a)}break;case b2Joint.e_pulleyJoint:{c=new b2PulleyJoint(a)}break;case b2Joint.e_gearJoint:{c=new b2GearJoint(a)}break;default:break}return c};b2Joint.Destroy=function(a,b){};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;var b2Jacobian=new b2Root;jQuery.extend(b2Jacobian.prototype,{linear1:new b2Vec2,angular1:null,linear2:new b2Vec2,angular2:null,SetZero:function(){this.linear1.SetZero();this.angular1=0;this.linear2.SetZero();this.angular2=0},Set:function(a,b,c,d){this.linear1.SetV(a);this.angular1=b;this.linear2.SetV(c);this.angular2=d},Compute:function(a,b,c,d){return this.linear1.x*a.x+this.linear1.y*a.y+this.angular1*b+(this.linear2.x*c.x+this.linear2.y*c.y)+this.angular2*d},initialize:function(){this.linear1=new b2Vec2;this.linear2=new b2Vec2}});var b2DistanceJoint=new b2Root;jQuery.extend(b2DistanceJoint.prototype,b2Joint.prototype);jQuery.extend(b2DistanceJoint.prototype,{initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u=new b2Vec2;var b;var c;var d;b=this.m_body1.m_R;c=a.anchorPoint1.x-this.m_body1.m_position.x;d=a.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor1.y=c*b.col2.x+d*b.col2.y;b=this.m_body2.m_R;c=a.anchorPoint2.x-this.m_body2.m_position.x;d=a.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor2.y=c*b.col2.x+d*b.col2.y;c=a.anchorPoint2.x-a.anchorPoint1.x;d=a.anchorPoint2.y-a.anchorPoint1.y;this.m_length=Math.sqrt(c*c+d*d);this.m_impulse=0},PrepareVelocitySolver:function(){var a;a=this.m_body1.m_R;var b=a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y;var c=a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y;a=this.m_body2.m_R;var d=a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y;var e=a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y;this.m_u.x=this.m_body2.m_position.x+d-this.m_body1.m_position.x-b;this.m_u.y=this.m_body2.m_position.y+e-this.m_body1.m_position.y-c;var f=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(f>b2Settings.b2_linearSlop){this.m_u.Multiply(1/f)}else{this.m_u.SetZero()}var g=b*this.m_u.y-c*this.m_u.x;var h=d*this.m_u.y-e*this.m_u.x;this.m_mass=this.m_body1.m_invMass+this.m_body1.m_invI*g*g+this.m_body2.m_invMass+this.m_body2.m_invI*h*h;this.m_mass=1/this.m_mass;if(b2World.s_enableWarmStarting){var i=this.m_impulse*this.m_u.x;var j=this.m_impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*i;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*j;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(b*j-c*i);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*i;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*j;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(d*j-e*i)}else{this.m_impulse=0}},SolveVelocityConstraints:function(a){var b;b=this.m_body1.m_R;var c=b.col1.x*this.m_localAnchor1.x+b.col2.x*this.m_localAnchor1.y;var d=b.col1.y*this.m_localAnchor1.x+b.col2.y*this.m_localAnchor1.y;b=this.m_body2.m_R;var e=b.col1.x*this.m_localAnchor2.x+b.col2.x*this.m_localAnchor2.y;var f=b.col1.y*this.m_localAnchor2.x+b.col2.y*this.m_localAnchor2.y;var g=this.m_body1.m_linearVelocity.x+ -this.m_body1.m_angularVelocity*d;var h=this.m_body1.m_linearVelocity.y+this.m_body1.m_angularVelocity*c;var i=this.m_body2.m_linearVelocity.x+ -this.m_body2.m_angularVelocity*f;var j=this.m_body2.m_linearVelocity.y+this.m_body2.m_angularVelocity*e;var k=this.m_u.x*(i-g)+this.m_u.y*(j-h);var l=-this.m_mass*k;this.m_impulse+=l;var m=l*this.m_u.x;var n=l*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*m;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*n;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(c*n-d*m);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*m;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*n;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(e*n-f*m)},SolvePositionConstraints:function(){var a;a=this.m_body1.m_R;var b=a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y;var c=a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y;a=this.m_body2.m_R;var d=a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y;var e=a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y;var f=this.m_body2.m_position.x+d-this.m_body1.m_position.x-b;var g=this.m_body2.m_position.y+e-this.m_body1.m_position.y-c;var h=Math.sqrt(f*f+g*g);f/=h;g/=h;var i=h-this.m_length;i=b2Math.b2Clamp(i,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var j=-this.m_mass*i;this.m_u.Set(f,g);var k=j*this.m_u.x;var l=j*this.m_u.y;this.m_body1.m_position.x-=this.m_body1.m_invMass*k;this.m_body1.m_position.y-=this.m_body1.m_invMass*l;this.m_body1.m_rotation-=this.m_body1.m_invI*(b*l-c*k);this.m_body2.m_position.x+=this.m_body2.m_invMass*k;this.m_body2.m_position.y+=this.m_body2.m_invMass*l;this.m_body2.m_rotation+=this.m_body2.m_invI*(d*l-e*k);this.m_body1.m_R.Set(this.m_body1.m_rotation);this.m_body2.m_R.Set(this.m_body2.m_rotation);return b2Math.b2Abs(i)<b2Settings.b2_linearSlop},GetAnchor1:function(){return b2Math.AddVV(this.m_body1.m_position,b2Math.b2MulMV(this.m_body1.m_R,this.m_localAnchor1))},GetAnchor2:function(){return b2Math.AddVV(this.m_body2.m_position,b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor2))},GetReactionForce:function(a){var b=new b2Vec2;b.SetV(this.m_u);b.Multiply(this.m_impulse*a);return b},GetReactionTorque:function(a){return 0},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u:new b2Vec2,m_impulse:null,m_mass:null,m_length:null});var b2DistanceJointDef=new b2Root;jQuery.extend(b2DistanceJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2DistanceJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.anchorPoint1=new b2Vec2;this.anchorPoint2=new b2Vec2;this.type=b2Joint.e_distanceJoint},anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2});var b2GearJoint=new b2Root;jQuery.extend(b2GearJoint.prototype,b2Joint.prototype);jQuery.extend(b2GearJoint.prototype,{GetAnchor1:function(){var a=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var a=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y))},GetReactionForce:function(a){return new b2Vec2},GetReactionTorque:function(a){return 0},GetRatio:function(){return this.m_ratio},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_J=new b2Jacobian;this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var b;var c;this.m_ground1=a.joint1.m_body1;this.m_body1=a.joint1.m_body2;if(a.joint1.m_type==b2Joint.e_revoluteJoint){this.m_revolute1=a.joint1;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);b=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=a.joint1;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);b=this.m_prismatic1.GetJointTranslation()}this.m_ground2=a.joint2.m_body1;this.m_body2=a.joint2.m_body2;if(a.joint2.m_type==b2Joint.e_revoluteJoint){this.m_revolute2=a.joint2;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);c=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=a.joint2;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);c=this.m_prismatic2.GetJointTranslation()}this.m_ratio=a.ratio;this.m_constant=b+this.m_ratio*c;this.m_impulse=0},PrepareVelocitySolver:function(){var a=this.m_ground1;var b=this.m_ground2;var c=this.m_body1;var d=this.m_body2;var e;var f;var g;var h;var i;var j;var k;var l=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angular1=-1;l+=c.m_invI}else{i=a.m_R;j=this.m_prismatic1.m_localXAxis1;e=i.col1.x*j.x+i.col2.x*j.y;f=i.col1.y*j.x+i.col2.y*j.y;i=c.m_R;g=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y;h=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;k=g*f-h*e;this.m_J.linear1.Set(-e,-f);this.m_J.angular1=-k;l+=c.m_invMass+c.m_invI*k*k}if(this.m_revolute2){this.m_J.angular2=-this.m_ratio;l+=this.m_ratio*this.m_ratio*d.m_invI}else{i=b.m_R;j=this.m_prismatic2.m_localXAxis1;e=i.col1.x*j.x+i.col2.x*j.y;f=i.col1.y*j.x+i.col2.y*j.y;i=d.m_R;g=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y;h=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y;k=g*f-h*e;this.m_J.linear2.Set(-this.m_ratio*e,-this.m_ratio*f);this.m_J.angular2=-this.m_ratio*k;l+=this.m_ratio*this.m_ratio*(d.m_invMass+d.m_invI*k*k)}this.m_mass=1/l;c.m_linearVelocity.x+=c.m_invMass*this.m_impulse*this.m_J.linear1.x;c.m_linearVelocity.y+=c.m_invMass*this.m_impulse*this.m_J.linear1.y;c.m_angularVelocity+=c.m_invI*this.m_impulse*this.m_J.angular1;d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linear2.x;d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linear2.y;d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angular2},SolveVelocityConstraints:function(a){var b=this.m_body1;var c=this.m_body2;var d=this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity);var e=-this.m_mass*d;this.m_impulse+=e;b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linear1.x;b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linear1.y;b.m_angularVelocity+=b.m_invI*e*this.m_J.angular1;c.m_linearVelocity.x+=c.m_invMass*e*this.m_J.linear2.x;c.m_linearVelocity.y+=c.m_invMass*e*this.m_J.linear2.y;c.m_angularVelocity+=c.m_invI*e*this.m_J.angular2},SolvePositionConstraints:function(){var a=0;var b=this.m_body1;var c=this.m_body2;var d;var e;if(this.m_revolute1){d=this.m_revolute1.GetJointAngle()}else{d=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){e=this.m_revolute2.GetJointAngle()}else{e=this.m_prismatic2.GetJointTranslation()}var f=this.m_constant-(d+this.m_ratio*e);var g=-this.m_mass*f;b.m_position.x+=b.m_invMass*g*this.m_J.linear1.x;b.m_position.y+=b.m_invMass*g*this.m_J.linear1.y;b.m_rotation+=b.m_invI*g*this.m_J.angular1;c.m_position.x+=c.m_invMass*g*this.m_J.linear2.x;c.m_position.y+=c.m_invMass*g*this.m_J.linear2.y;c.m_rotation+=c.m_invI*g*this.m_J.angular2;b.m_R.Set(b.m_rotation);c.m_R.Set(c.m_rotation);return a<b2Settings.b2_linearSlop},m_ground1:null,m_ground2:null,m_revolute1:null,m_prismatic1:null,m_revolute2:null,m_prismatic2:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_J:new b2Jacobian,m_constant:null,m_ratio:null,m_mass:null,m_impulse:null});var b2GearJointDef=new b2Root;jQuery.extend(b2GearJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2GearJointDef.prototype,{initialize:function(){this.type=b2Joint.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1},joint1:null,joint2:null,ratio:null});var b2MouseJoint=new b2Root;jQuery.extend(b2MouseJoint.prototype,b2Joint.prototype);jQuery.extend(b2MouseJoint.prototype,{GetAnchor1:function(){return this.m_target},GetAnchor2:function(){var a=b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);a.Add(this.m_body2.m_position);return a},GetReactionForce:function(a){var b=new b2Vec2;b.SetV(this.m_impulse);b.Multiply(a);return b},GetReactionTorque:function(a){return 0},SetTarget:function(a){this.m_body2.WakeUp();this.m_target=a},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.m_localAnchor=new b2Vec2;this.m_target=new b2Vec2;this.m_impulse=new b2Vec2;this.m_ptpMass=new b2Mat22;this.m_C=new b2Vec2;this.m_target.SetV(a.target);var b=this.m_target.x-this.m_body2.m_position.x;var c=this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=b*this.m_body2.m_R.col1.x+c*this.m_body2.m_R.col1.y;this.m_localAnchor.y=b*this.m_body2.m_R.col2.x+c*this.m_body2.m_R.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();var d=this.m_body2.m_mass;var e=2*b2Settings.b2_pi*a.frequencyHz;var f=2*d*a.dampingRatio*e;var g=d*e*e;this.m_gamma=1/(f+a.timeStep*g);this.m_beta=a.timeStep*g/(f+a.timeStep*g)},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,PrepareVelocitySolver:function(){var a=this.m_body2;var b;b=a.m_R;var c=b.col1.x*this.m_localAnchor.x+b.col2.x*this.m_localAnchor.y;var d=b.col1.y*this.m_localAnchor.x+b.col2.y*this.m_localAnchor.y;var e=a.m_invMass;var f=a.m_invI;this.K1.col1.x=e;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=f*d*d;this.K2.col2.x=-f*c*d;this.K2.col1.y=-f*c*d;this.K2.col2.y=f*c*c;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_ptpMass);this.m_C.x=a.m_position.x+c-this.m_target.x;this.m_C.y=a.m_position.y+d-this.m_target.y;a.m_angularVelocity*=.98;var g=this.m_impulse.x;var h=this.m_impulse.y;a.m_linearVelocity.x+=e*g;a.m_linearVelocity.y+=e*h;a.m_angularVelocity+=f*(c*h-d*g)},SolveVelocityConstraints:function(a){var b=this.m_body2;var c;c=b.m_R;var d=c.col1.x*this.m_localAnchor.x+c.col2.x*this.m_localAnchor.y;var e=c.col1.y*this.m_localAnchor.x+c.col2.y*this.m_localAnchor.y;var f=b.m_linearVelocity.x+ -b.m_angularVelocity*e;var g=b.m_linearVelocity.y+b.m_angularVelocity*d;c=this.m_ptpMass;var h=f+this.m_beta*a.inv_dt*this.m_C.x+this.m_gamma*this.m_impulse.x;var i=g+this.m_beta*a.inv_dt*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(c.col1.x*h+c.col2.x*i);var k=-(c.col1.y*h+c.col2.y*i);var l=this.m_impulse.x;var m=this.m_impulse.y;this.m_impulse.x+=j;this.m_impulse.y+=k;var n=this.m_impulse.Length();if(n>a.dt*this.m_maxForce){this.m_impulse.Multiply(a.dt*this.m_maxForce/n)}j=this.m_impulse.x-l;k=this.m_impulse.y-m;b.m_linearVelocity.x+=b.m_invMass*j;b.m_linearVelocity.y+=b.m_invMass*k;b.m_angularVelocity+=b.m_invI*(d*k-e*j)},SolvePositionConstraints:function(){return true},m_localAnchor:new b2Vec2,m_target:new b2Vec2,m_impulse:new b2Vec2,m_ptpMass:new b2Mat22,m_C:new b2Vec2,m_maxForce:null,m_beta:null,m_gamma:null});var b2MouseJointDef=new b2Root;jQuery.extend(b2MouseJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2MouseJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.target=new b2Vec2;this.type=b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7;this.timeStep=1/60},target:new b2Vec2,maxForce:null,frequencyHz:null,dampingRatio:null,timeStep:null});var b2PrismaticJoint=new b2Root;jQuery.extend(b2PrismaticJoint.prototype,b2Joint.prototype);jQuery.extend(b2PrismaticJoint.prototype,{GetAnchor1:function(){var a=this.m_body1;var b=new b2Vec2;b.SetV(this.m_localAnchor1);b.MulM(a.m_R);b.Add(a.m_position);return b},GetAnchor2:function(){var a=this.m_body2;var b=new b2Vec2;b.SetV(this.m_localAnchor2);b.MulM(a.m_R);b.Add(a.m_position);return b},GetJointTranslation:function(){var a=this.m_body1;var b=this.m_body2;var c;c=a.m_R;var d=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;var e=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;var f=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;var g=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;var h=a.m_position.x+d;var i=a.m_position.y+e;var j=b.m_position.x+f;var k=b.m_position.y+g;var l=j-h;var m=k-i;c=a.m_R;var n=c.col1.x*this.m_localXAxis1.x+c.col2.x*this.m_localXAxis1.y;var o=c.col1.y*this.m_localXAxis1.x+c.col2.y*this.m_localXAxis1.y;var p=n*l+o*m;return p},GetJointSpeed:function(){var a=this.m_body1;var b=this.m_body2;var c;c=a.m_R;var d=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;var e=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;var f=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;var g=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;var h=a.m_position.x+d;var i=a.m_position.y+e;var j=b.m_position.x+f;var k=b.m_position.y+g;var l=j-h;var m=k-i;c=a.m_R;var n=c.col1.x*this.m_localXAxis1.x+c.col2.x*this.m_localXAxis1.y;var o=c.col1.y*this.m_localXAxis1.x+c.col2.y*this.m_localXAxis1.y;var p=a.m_linearVelocity;var q=b.m_linearVelocity;var r=a.m_angularVelocity;var s=b.m_angularVelocity;var t=l*-r*o+m*r*n+(n*(q.x+ -s*g-p.x- -r*e)+o*(q.y+s*f-p.y-r*d));return t},GetMotorForce:function(a){return a*this.m_motorImpulse},SetMotorSpeed:function(a){this.m_motorSpeed=a},SetMotorForce:function(a){this.m_maxMotorForce=a},GetReactionForce:function(a){var b=a*this.m_limitImpulse;var c;c=this.m_body1.m_R;var d=b*(c.col1.x*this.m_localXAxis1.x+c.col2.x*this.m_localXAxis1.y);var e=b*(c.col1.y*this.m_localXAxis1.x+c.col2.y*this.m_localXAxis1.y);var f=b*(c.col1.x*this.m_localYAxis1.x+c.col2.x*this.m_localYAxis1.y);var g=b*(c.col1.y*this.m_localYAxis1.x+c.col2.y*this.m_localYAxis1.y);return new b2Vec2(d+f,e+g)},GetReactionTorque:function(a){return a*this.m_angularImpulse},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_localXAxis1=new b2Vec2;this.m_localYAxis1=new b2Vec2;this.m_linearJacobian=new b2Jacobian;this.m_motorJacobian=new b2Jacobian;var b;var c;var d;b=this.m_body1.m_R;c=a.anchorPoint.x-this.m_body1.m_position.x;d=a.anchorPoint.y-this.m_body1.m_position.y;this.m_localAnchor1.Set(c*b.col1.x+d*b.col1.y,c*b.col2.x+d*b.col2.y);b=this.m_body2.m_R;c=a.anchorPoint.x-this.m_body2.m_position.x;d=a.anchorPoint.y-this.m_body2.m_position.y;this.m_localAnchor2.Set(c*b.col1.x+d*b.col1.y,c*b.col2.x+d*b.col2.y);b=this.m_body1.m_R;c=a.axis.x;d=a.axis.y;this.m_localXAxis1.Set(c*b.col1.x+d*b.col1.y,c*b.col2.x+d*b.col2.y);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_linearJacobian.SetZero();this.m_linearMass=0;this.m_linearImpulse=0;this.m_angularMass=0;this.m_angularImpulse=0;this.m_motorJacobian.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_limitImpulse=0;this.m_limitPositionImpulse=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.motorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor},PrepareVelocitySolver:function(){var a=this.m_body1;var b=this.m_body2;var c;c=a.m_R;var d=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;var e=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;var f=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;var g=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;var h=a.m_invMass;var i=b.m_invMass;var j=a.m_invI;var k=b.m_invI;c=a.m_R;var l=c.col1.x*this.m_localYAxis1.x+c.col2.x*this.m_localYAxis1.y;var m=c.col1.y*this.m_localYAxis1.x+c.col2.y*this.m_localYAxis1.y;var n=b.m_position.x+f-a.m_position.x;var o=b.m_position.y+g-a.m_position.y;this.m_linearJacobian.linear1.x=-l;this.m_linearJacobian.linear1.y=-m;this.m_linearJacobian.linear2.x=l;this.m_linearJacobian.linear2.y=m;this.m_linearJacobian.angular1=-(n*m-o*l);this.m_linearJacobian.angular2=f*m-g*l;this.m_linearMass=h+j*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+i+k*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;this.m_linearMass=1/this.m_linearMass;this.m_angularMass=1/(j+k);if(this.m_enableLimit||this.m_enableMotor){c=a.m_R;var p=c.col1.x*this.m_localXAxis1.x+c.col2.x*this.m_localXAxis1.y;var q=c.col1.y*this.m_localXAxis1.x+c.col2.y*this.m_localXAxis1.y;this.m_motorJacobian.linear1.x=-p;this.m_motorJacobian.linear1.y=-q;this.m_motorJacobian.linear2.x=p;this.m_motorJacobian.linear2.y=q;this.m_motorJacobian.angular1=-(n*q-o*p);this.m_motorJacobian.angular2=f*q-g*p;this.m_motorMass=h+j*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+i+k*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2;this.m_motorMass=1/this.m_motorMass;if(this.m_enableLimit){var r=n-d;var s=o-e;var t=p*r+q*s;if(b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop){this.m_limitState=b2Joint.e_equalLimits}else if(t<=this.m_lowerTranslation){if(this.m_limitState!=b2Joint.e_atLowerLimit){this.m_limitImpulse=0}this.m_limitState=b2Joint.e_atLowerLimit}else if(t>=this.m_upperTranslation){if(this.m_limitState!=b2Joint.e_atUpperLimit){this.m_limitImpulse=0}this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0}}}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit==false){this.m_limitImpulse=0}if(b2World.s_enableWarmStarting){var u=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x;var v=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y;var w=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x;var x=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y;var y=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1;var z=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2;a.m_linearVelocity.x+=h*u;a.m_linearVelocity.y+=h*v;a.m_angularVelocity+=j*y;b.m_linearVelocity.x+=i*w;b.m_linearVelocity.y+=i*x;b.m_angularVelocity+=k*z}else{this.m_linearImpulse=0;this.m_angularImpulse=0;this.m_limitImpulse=0;this.m_motorImpulse=0}this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(a){var b=this.m_body1;var c=this.m_body2;var d=b.m_invMass;var e=c.m_invMass;var f=b.m_invI;var g=c.m_invI;var h;var i=this.m_linearJacobian.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity);var j=-this.m_linearMass*i;this.m_linearImpulse+=j;b.m_linearVelocity.x+=d*j*this.m_linearJacobian.linear1.x;b.m_linearVelocity.y+=d*j*this.m_linearJacobian.linear1.y;b.m_angularVelocity+=f*j*this.m_linearJacobian.angular1;c.m_linearVelocity.x+=e*j*this.m_linearJacobian.linear2.x;c.m_linearVelocity.y+=e*j*this.m_linearJacobian.linear2.y;c.m_angularVelocity+=g*j*this.m_linearJacobian.angular2;var k=c.m_angularVelocity-b.m_angularVelocity;var l=-this.m_angularMass*k;this.m_angularImpulse+=l;b.m_angularVelocity-=f*l;c.m_angularVelocity+=g*l;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var m=this.m_motorJacobian.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity)-this.m_motorSpeed;var n=-this.m_motorMass*m;var o=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+n,-a.dt*this.m_maxMotorForce,a.dt*this.m_maxMotorForce);n=this.m_motorImpulse-o;b.m_linearVelocity.x+=d*n*this.m_motorJacobian.linear1.x;b.m_linearVelocity.y+=d*n*this.m_motorJacobian.linear1.y;b.m_angularVelocity+=f*n*this.m_motorJacobian.angular1;c.m_linearVelocity.x+=e*n*this.m_motorJacobian.linear2.x;c.m_linearVelocity.y+=e*n*this.m_motorJacobian.linear2.y;c.m_angularVelocity+=g*n*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var p=this.m_motorJacobian.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity);var q=-this.m_motorMass*p;if(this.m_limitState==b2Joint.e_equalLimits){this.m_limitImpulse+=q}else if(this.m_limitState==b2Joint.e_atLowerLimit){h=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+q,0);q=this.m_limitImpulse-h}else if(this.m_limitState==b2Joint.e_atUpperLimit){h=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+q,0);q=this.m_limitImpulse-h}b.m_linearVelocity.x+=d*q*this.m_motorJacobian.linear1.x;b.m_linearVelocity.y+=d*q*this.m_motorJacobian.linear1.y;b.m_angularVelocity+=f*q*this.m_motorJacobian.angular1;c.m_linearVelocity.x+=e*q*this.m_motorJacobian.linear2.x;c.m_linearVelocity.y+=e*q*this.m_motorJacobian.linear2.y;c.m_angularVelocity+=g*q*this.m_motorJacobian.angular2}},SolvePositionConstraints:function(){var a;var b;var c=this.m_body1;var d=this.m_body2;var e=c.m_invMass;var f=d.m_invMass;var g=c.m_invI;var h=d.m_invI;var i;i=c.m_R;var j=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y;var k=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=d.m_R;var l=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y;var m=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y;var n=c.m_position.x+j;var o=c.m_position.y+k;var p=d.m_position.x+l;var q=d.m_position.y+m;var r=p-n;var s=q-o;i=c.m_R;var t=i.col1.x*this.m_localYAxis1.x+i.col2.x*this.m_localYAxis1.y;var u=i.col1.y*this.m_localYAxis1.x+i.col2.y*this.m_localYAxis1.y;var v=t*r+u*s;v=b2Math.b2Clamp(v,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var w=-this.m_linearMass*v;c.m_position.x+=e*w*this.m_linearJacobian.linear1.x;c.m_position.y+=e*w*this.m_linearJacobian.linear1.y;c.m_rotation+=g*w*this.m_linearJacobian.angular1;d.m_position.x+=f*w*this.m_linearJacobian.linear2.x;d.m_position.y+=f*w*this.m_linearJacobian.linear2.y;d.m_rotation+=h*w*this.m_linearJacobian.angular2;var x=b2Math.b2Abs(v);var y=d.m_rotation-c.m_rotation-this.m_initialAngle;y=b2Math.b2Clamp(y,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var z=-this.m_angularMass*y;c.m_rotation-=c.m_invI*z;c.m_R.Set(c.m_rotation);d.m_rotation+=d.m_invI*z;d.m_R.Set(d.m_rotation);var A=b2Math.b2Abs(y);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){i=c.m_R;j=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y;k=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=d.m_R;l=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y;m=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y;n=c.m_position.x+j;o=c.m_position.y+k;p=d.m_position.x+l;q=d.m_position.y+m;r=p-n;s=q-o;i=c.m_R;var B=i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y;var C=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y;var D=B*r+C*s;var E=0;if(this.m_limitState==b2Joint.e_equalLimits){a=b2Math.b2Clamp(D,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);E=-this.m_motorMass*a;x=b2Math.b2Max(x,b2Math.b2Abs(y))}else if(this.m_limitState==b2Joint.e_atLowerLimit){a=D-this.m_lowerTranslation;x=b2Math.b2Max(x,-a);a=b2Math.b2Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);E=-this.m_motorMass*a;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+E,0);E=this.m_limitPositionImpulse-b}else if(this.m_limitState==b2Joint.e_atUpperLimit){a=D-this.m_upperTranslation;x=b2Math.b2Max(x,a);a=b2Math.b2Clamp(a-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection);E=-this.m_motorMass*a;b=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+E,0);E=this.m_limitPositionImpulse-b}c.m_position.x+=e*E*this.m_motorJacobian.linear1.x;c.m_position.y+=e*E*this.m_motorJacobian.linear1.y;c.m_rotation+=g*E*this.m_motorJacobian.angular1;c.m_R.Set(c.m_rotation);d.m_position.x+=f*E*this.m_motorJacobian.linear2.x;d.m_position.y+=f*E*this.m_motorJacobian.linear2.y;d.m_rotation+=h*E*this.m_motorJacobian.angular2;d.m_R.Set(d.m_rotation)}return x<=b2Settings.b2_linearSlop&&A<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_localXAxis1:new b2Vec2,m_localYAxis1:new b2Vec2,m_initialAngle:null,m_linearJacobian:new b2Jacobian,m_linearMass:null,m_linearImpulse:null,m_angularMass:null,m_angularImpulse:null,m_motorJacobian:new b2Jacobian,m_motorMass:null,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_lowerTranslation:null,m_upperTranslation:null,m_maxMotorForce:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});var b2PrismaticJointDef=new b2Root;jQuery.extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2PrismaticJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.type=b2Joint.e_prismaticJoint;this.anchorPoint=new b2Vec2(0,0);this.axis=new b2Vec2(0,0);this.lowerTranslation=0;this.upperTranslation=0;this.motorForce=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false},anchorPoint:null,axis:null,lowerTranslation:null,upperTranslation:null,motorForce:null,motorSpeed:null,enableLimit:null,enableMotor:null});var b2PulleyJoint=new b2Root;jQuery.extend(b2PulleyJoint.prototype,b2Joint.prototype);jQuery.extend(b2PulleyJoint.prototype,{GetAnchor1:function(){var a=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var a=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y))},GetGroundPoint1:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor1.x,this.m_ground.m_position.y+this.m_groundAnchor1.y)},GetGroundPoint2:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor2.x,this.m_ground.m_position.y+this.m_groundAnchor2.y)},GetReactionForce:function(a){return new b2Vec2},GetReactionTorque:function(a){return 0},GetLength1:function(){var a;a=this.m_body1.m_R;var b=this.m_body1.m_position.x+(a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y);var c=this.m_body1.m_position.y+(a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y);var d=b-(this.m_ground.m_position.x+this.m_groundAnchor1.x);var e=c-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return Math.sqrt(d*d+e*e)},GetLength2:function(){var a;a=this.m_body2.m_R;var b=this.m_body2.m_position.x+(a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y);var c=this.m_body2.m_position.y+(a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y);var d=b-(this.m_ground.m_position.x+this.m_groundAnchor2.x);var e=c-(this.m_ground.m_position.y+this.m_groundAnchor2.y);return Math.sqrt(d*d+e*e)},GetRatio:function(){return this.m_ratio},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.m_groundAnchor1=new b2Vec2;this.m_groundAnchor2=new b2Vec2;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_u1=new b2Vec2;this.m_u2=new b2Vec2;var b;var c;var d;this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundPoint1.x-this.m_ground.m_position.x;this.m_groundAnchor1.y=a.groundPoint1.y-this.m_ground.m_position.y;this.m_groundAnchor2.x=a.groundPoint2.x-this.m_ground.m_position.x;this.m_groundAnchor2.y=a.groundPoint2.y-this.m_ground.m_position.y;b=this.m_body1.m_R;c=a.anchorPoint1.x-this.m_body1.m_position.x;d=a.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor1.y=c*b.col2.x+d*b.col2.y;b=this.m_body2.m_R;c=a.anchorPoint2.x-this.m_body2.m_position.x;d=a.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor2.y=c*b.col2.x+d*b.col2.y;this.m_ratio=a.ratio;c=a.groundPoint1.x-a.anchorPoint1.x;d=a.groundPoint1.y-a.anchorPoint1.y;var e=Math.sqrt(c*c+d*d);c=a.groundPoint2.x-a.anchorPoint2.x;d=a.groundPoint2.y-a.anchorPoint2.y;var f=Math.sqrt(c*c+d*d);var g=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,e);var h=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,f);this.m_constant=g+this.m_ratio*h;this.m_maxLength1=b2Math.b2Clamp(a.maxLength1,g,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Clamp(a.maxLength2,h,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_pulleyImpulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0},PrepareVelocitySolver:function(){var a=this.m_body1;var b=this.m_body2;var c;c=a.m_R;var d=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;var e=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;var f=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;var g=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;var h=a.m_position.x+d;var i=a.m_position.y+e;var j=b.m_position.x+f;var k=b.m_position.y+g;var l=this.m_ground.m_position.x+this.m_groundAnchor1.x;var m=this.m_ground.m_position.y+this.m_groundAnchor1.y;var n=this.m_ground.m_position.x+this.m_groundAnchor2.x;var o=this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(h-l,i-m);this.m_u2.Set(j-n,k-o);var p=this.m_u1.Length();var q=this.m_u2.Length();if(p>b2Settings.b2_linearSlop){this.m_u1.Multiply(1/p)}else{this.m_u1.SetZero()}if(q>b2Settings.b2_linearSlop){this.m_u2.Multiply(1/q)}else{this.m_u2.SetZero()}if(p<this.m_maxLength1){this.m_limitState1=b2Joint.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse1=0}if(q<this.m_maxLength2){this.m_limitState2=b2Joint.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse2=0}var r=d*this.m_u1.y-e*this.m_u1.x;var s=f*this.m_u2.y-g*this.m_u2.x;this.m_limitMass1=a.m_invMass+a.m_invI*r*r;this.m_limitMass2=b.m_invMass+b.m_invI*s*s;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;var t=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x;var u=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y;var v=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x;var w=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;a.m_linearVelocity.x+=a.m_invMass*t;a.m_linearVelocity.y+=a.m_invMass*u;a.m_angularVelocity+=a.m_invI*(d*u-e*t);b.m_linearVelocity.x+=b.m_invMass*v;b.m_linearVelocity.y+=b.m_invMass*w;b.m_angularVelocity+=b.m_invI*(f*w-g*v)},SolveVelocityConstraints:function(a){var b=this.m_body1;var c=this.m_body2;var d;d=b.m_R;var e=d.col1.x*this.m_localAnchor1.x+d.col2.x*this.m_localAnchor1.y;var f=d.col1.y*this.m_localAnchor1.x+d.col2.y*this.m_localAnchor1.y;d=c.m_R;var g=d.col1.x*this.m_localAnchor2.x+d.col2.x*this.m_localAnchor2.y;var h=d.col1.y*this.m_localAnchor2.x+d.col2.y*this.m_localAnchor2.y;var i;var j;var k;var l;var m;var n;var o;var p;var q;var r;var s;i=b.m_linearVelocity.x+ -b.m_angularVelocity*f;j=b.m_linearVelocity.y+b.m_angularVelocity*e;k=c.m_linearVelocity.x+ -c.m_angularVelocity*h;l=c.m_linearVelocity.y+c.m_angularVelocity*g;q=-(this.m_u1.x*i+this.m_u1.y*j)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l);r=-this.m_pulleyMass*q;this.m_pulleyImpulse+=r;m=-r*this.m_u1.x;n=-r*this.m_u1.y;o=-this.m_ratio*r*this.m_u2.x;p=-this.m_ratio*r*this.m_u2.y;b.m_linearVelocity.x+=b.m_invMass*m;b.m_linearVelocity.y+=b.m_invMass*n;b.m_angularVelocity+=b.m_invI*(e*n-f*m);c.m_linearVelocity.x+=c.m_invMass*o;c.m_linearVelocity.y+=c.m_invMass*p;c.m_angularVelocity+=c.m_invI*(g*p-h*o);if(this.m_limitState1==b2Joint.e_atUpperLimit){i=b.m_linearVelocity.x+ -b.m_angularVelocity*f;j=b.m_linearVelocity.y+b.m_angularVelocity*e;q=-(this.m_u1.x*i+this.m_u1.y*j);r=-this.m_limitMass1*q;s=this.m_limitImpulse1;this.m_limitImpulse1=b2Math.b2Max(0,this.m_limitImpulse1+r);r=this.m_limitImpulse1-s;m=-r*this.m_u1.x;n=-r*this.m_u1.y;b.m_linearVelocity.x+=b.m_invMass*m;b.m_linearVelocity.y+=b.m_invMass*n;b.m_angularVelocity+=b.m_invI*(e*n-f*m)}if(this.m_limitState2==b2Joint.e_atUpperLimit){k=c.m_linearVelocity.x+ -c.m_angularVelocity*h;l=c.m_linearVelocity.y+c.m_angularVelocity*g;q=-(this.m_u2.x*k+this.m_u2.y*l);r=-this.m_limitMass2*q;s=this.m_limitImpulse2;this.m_limitImpulse2=b2Math.b2Max(0,this.m_limitImpulse2+r);r=this.m_limitImpulse2-s;o=-r*this.m_u2.x;p=-r*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*o;c.m_linearVelocity.y+=c.m_invMass*p;c.m_angularVelocity+=c.m_invI*(g*p-h*o)}},SolvePositionConstraints:function(){var a=this.m_body1;var b=this.m_body2;var c;var d=this.m_ground.m_position.x+this.m_groundAnchor1.x;var e=this.m_ground.m_position.y+this.m_groundAnchor1.y;var f=this.m_ground.m_position.x+this.m_groundAnchor2.x;var g=this.m_ground.m_position.y+this.m_groundAnchor2.y;var h;var i;var j;var k;var l;var m;var n;var o;var p;var q;var r;var s;var t;var u=0;{c=a.m_R;h=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;i=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;j=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;k=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;l=a.m_position.x+h;m=a.m_position.y+i;n=b.m_position.x+j;o=b.m_position.y+k;this.m_u1.Set(l-d,m-e);this.m_u2.Set(n-f,o-g);p=this.m_u1.Length();q=this.m_u2.Length();if(p>b2Settings.b2_linearSlop){this.m_u1.Multiply(1/p)}else{this.m_u1.SetZero()}if(q>b2Settings.b2_linearSlop){this.m_u2.Multiply(1/q)}else{this.m_u2.SetZero()}r=this.m_constant-p-this.m_ratio*q;u=b2Math.b2Max(u,Math.abs(r));r=b2Math.b2Clamp(r,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);s=-this.m_pulleyMass*r;l=-s*this.m_u1.x;m=-s*this.m_u1.y;n=-this.m_ratio*s*this.m_u2.x;o=-this.m_ratio*s*this.m_u2.y;a.m_position.x+=a.m_invMass*l;a.m_position.y+=a.m_invMass*m;a.m_rotation+=a.m_invI*(h*m-i*l);b.m_position.x+=b.m_invMass*n;b.m_position.y+=b.m_invMass*o;b.m_rotation+=b.m_invI*(j*o-k*n);a.m_R.Set(a.m_rotation);b.m_R.Set(b.m_rotation)}if(this.m_limitState1==b2Joint.e_atUpperLimit){c=a.m_R;h=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;i=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;l=a.m_position.x+h;m=a.m_position.y+i;this.m_u1.Set(l-d,m-e);p=this.m_u1.Length();if(p>b2Settings.b2_linearSlop){this.m_u1.x*=1/p;this.m_u1.y*=1/p}else{this.m_u1.SetZero()}r=this.m_maxLength1-p;u=b2Math.b2Max(u,-r);r=b2Math.b2Clamp(r+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);s=-this.m_limitMass1*r;t=this.m_limitPositionImpulse1;this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+s);s=this.m_limitPositionImpulse1-t;l=-s*this.m_u1.x;m=-s*this.m_u1.y;a.m_position.x+=a.m_invMass*l;a.m_position.y+=a.m_invMass*m;a.m_rotation+=a.m_invI*(h*m-i*l);a.m_R.Set(a.m_rotation)}if(this.m_limitState2==b2Joint.e_atUpperLimit){c=b.m_R;j=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;k=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;n=b.m_position.x+j;o=b.m_position.y+k;this.m_u2.Set(n-f,o-g);q=this.m_u2.Length();if(q>b2Settings.b2_linearSlop){this.m_u2.x*=1/q;this.m_u2.y*=1/q}else{this.m_u2.SetZero()}r=this.m_maxLength2-q;u=b2Math.b2Max(u,-r);r=b2Math.b2Clamp(r+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0);s=-this.m_limitMass2*r;t=this.m_limitPositionImpulse2;this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+s);s=this.m_limitPositionImpulse2-t;n=-s*this.m_u2.x;o=-s*this.m_u2.y;b.m_position.x+=b.m_invMass*n;b.m_position.y+=b.m_invMass*o;b.m_rotation+=b.m_invI*(j*o-k*n);b.m_R.Set(b.m_rotation)}return u<b2Settings.b2_linearSlop},m_ground:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u1:new b2Vec2,m_u2:new b2Vec2,m_constant:null,m_ratio:null,m_maxLength1:null,m_maxLength2:null,m_pulleyMass:null,m_limitMass1:null,m_limitMass2:null,m_pulleyImpulse:null,m_limitImpulse1:null,m_limitImpulse2:null,m_limitPositionImpulse1:null,m_limitPositionImpulse2:null,m_limitState1:0,m_limitState2:0});b2PulleyJoint.b2_minPulleyLength=b2Settings.b2_lengthUnitsPerMeter;var b2PulleyJointDef=new b2Root;jQuery.extend(b2PulleyJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2PulleyJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.groundPoint1=new b2Vec2;this.groundPoint2=new b2Vec2;this.anchorPoint1=new b2Vec2;this.anchorPoint2=new b2Vec2;this.type=b2Joint.e_pulleyJoint;this.groundPoint1.Set(-1,1);this.groundPoint2.Set(1,1);this.anchorPoint1.Set(-1,0);this.anchorPoint2.Set(1,0);this.maxLength1=.5*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=.5*b2PulleyJoint.b2_minPulleyLength;this.ratio=1;this.collideConnected=true},groundPoint1:new b2Vec2,groundPoint2:new b2Vec2,anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2,maxLength1:null,maxLength2:null,ratio:null});var b2RevoluteJoint=new b2Root;jQuery.extend(b2RevoluteJoint.prototype,b2Joint.prototype);jQuery.extend(b2RevoluteJoint.prototype,{GetAnchor1:function(){var a=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var a=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(a.col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y))},GetJointAngle:function(){return this.m_body2.m_rotation-this.m_body1.m_rotation},GetJointSpeed:function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity},GetMotorTorque:function(a){return a*this.m_motorImpulse},SetMotorSpeed:function(a){this.m_motorSpeed=a},SetMotorTorque:function(a){this.m_maxMotorTorque=a},GetReactionForce:function(a){var b=this.m_ptpImpulse.Copy();b.Multiply(a);return b},GetReactionTorque:function(a){return a*this.m_limitImpulse},initialize:function(a){this.m_node1=new b2JointNode;this.m_node2=new b2JointNode;this.m_type=a.type;this.m_prev=null;this.m_next=null;this.m_body1=a.body1;this.m_body2=a.body2;this.m_collideConnected=a.collideConnected;this.m_islandFlag=false;this.m_userData=a.userData;this.K=new b2Mat22;this.K1=new b2Mat22;this.K2=new b2Mat22;this.K3=new b2Mat22;this.m_localAnchor1=new b2Vec2;this.m_localAnchor2=new b2Vec2;this.m_ptpImpulse=new b2Vec2;this.m_ptpMass=new b2Mat22;var b;var c;var d;b=this.m_body1.m_R;c=a.anchorPoint.x-this.m_body1.m_position.x;d=a.anchorPoint.y-this.m_body1.m_position.y;this.m_localAnchor1.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor1.y=c*b.col2.x+d*b.col2.y;b=this.m_body2.m_R;c=a.anchorPoint.x-this.m_body2.m_position.x;d=a.anchorPoint.y-this.m_body2.m_position.y;this.m_localAnchor2.x=c*b.col1.x+d*b.col1.y;this.m_localAnchor2.y=c*b.col2.x+d*b.col2.y;this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_ptpImpulse.Set(0,0);this.m_motorImpulse=0;this.m_limitImpulse=0;this.m_limitPositionImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.motorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,K3:new b2Mat22,PrepareVelocitySolver:function(){var a=this.m_body1;var b=this.m_body2;var c;c=a.m_R;var d=c.col1.x*this.m_localAnchor1.x+c.col2.x*this.m_localAnchor1.y;var e=c.col1.y*this.m_localAnchor1.x+c.col2.y*this.m_localAnchor1.y;c=b.m_R;var f=c.col1.x*this.m_localAnchor2.x+c.col2.x*this.m_localAnchor2.y;var g=c.col1.y*this.m_localAnchor2.x+c.col2.y*this.m_localAnchor2.y;var h=a.m_invMass;var i=b.m_invMass;var j=a.m_invI;var k=b.m_invI;this.K1.col1.x=h+i;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h+i;this.K2.col1.x=j*e*e;this.K2.col2.x=-j*d*e;this.K2.col1.y=-j*d*e;this.K2.col2.y=j*d*d;this.K3.col1.x=k*g*g;this.K3.col2.x=-k*f*g;this.K3.col1.y=-k*f*g;this.K3.col2.y=k*f*f;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_ptpMass);this.m_motorMass=1/(j+k);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var l=b.m_rotation-a.m_rotation-this.m_intialAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop){this.m_limitState=b2Joint.e_equalLimits}else if(l<=this.m_lowerAngle){if(this.m_limitState!=b2Joint.e_atLowerLimit){this.m_limitImpulse=0}this.m_limitState=b2Joint.e_atLowerLimit}else if(l>=this.m_upperAngle){if(this.m_limitState!=b2Joint.e_atUpperLimit){this.m_limitImpulse=0}this.m_limitState=b2Joint.e_atUpperLimit}else{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0}}else{this.m_limitImpulse=0}if(b2World.s_enableWarmStarting){a.m_linearVelocity.x-=h*this.m_ptpImpulse.x;a.m_linearVelocity.y-=h*this.m_ptpImpulse.y;a.m_angularVelocity-=j*(d*this.m_ptpImpulse.y-e*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse);b.m_linearVelocity.x+=i*this.m_ptpImpulse.x;b.m_linearVelocity.y+=i*this.m_ptpImpulse.y;b.m_angularVelocity+=k*(f*this.m_ptpImpulse.y-g*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse)}else{this.m_ptpImpulse.SetZero();this.m_motorImpulse=0;this.m_limitImpulse=0}this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(a){var b=this.m_body1;var c=this.m_body2;var d;d=b.m_R;var e=d.col1.x*this.m_localAnchor1.x+d.col2.x*this.m_localAnchor1.y;var f=d.col1.y*this.m_localAnchor1.x+d.col2.y*this.m_localAnchor1.y;d=c.m_R;var g=d.col1.x*this.m_localAnchor2.x+d.col2.x*this.m_localAnchor2.y;var h=d.col1.y*this.m_localAnchor2.x+d.col2.y*this.m_localAnchor2.y;var i;var j=c.m_linearVelocity.x+ -c.m_angularVelocity*h-b.m_linearVelocity.x- -b.m_angularVelocity*f;var k=c.m_linearVelocity.y+c.m_angularVelocity*g-b.m_linearVelocity.y-b.m_angularVelocity*e;var l=-(this.m_ptpMass.col1.x*j+this.m_ptpMass.col2.x*k);var m=-(this.m_ptpMass.col1.y*j+this.m_ptpMass.col2.y*k);this.m_ptpImpulse.x+=l;this.m_ptpImpulse.y+=m;b.m_linearVelocity.x-=b.m_invMass*l;b.m_linearVelocity.y-=b.m_invMass*m;b.m_angularVelocity-=b.m_invI*(e*m-f*l);c.m_linearVelocity.x+=c.m_invMass*l;c.m_linearVelocity.y+=c.m_invMass*m;c.m_angularVelocity+=c.m_invI*(g*m-h*l);if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var n=c.m_angularVelocity-b.m_angularVelocity-this.m_motorSpeed;var o=-this.m_motorMass*n;var p=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+o,-a.dt*this.m_maxMotorTorque,a.dt*this.m_maxMotorTorque);o=this.m_motorImpulse-p;b.m_angularVelocity-=b.m_invI*o;c.m_angularVelocity+=c.m_invI*o}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var q=c.m_angularVelocity-b.m_angularVelocity;var r=-this.m_motorMass*q;if(this.m_limitState==b2Joint.e_equalLimits){this.m_limitImpulse+=r}else if(this.m_limitState==b2Joint.e_atLowerLimit){i=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+r,0);r=this.m_limitImpulse-i}else if(this.m_limitState==b2Joint.e_atUpperLimit){i=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+r,0);r=this.m_limitImpulse-i}b.m_angularVelocity-=b.m_invI*r;c.m_angularVelocity+=c.m_invI*r}},SolvePositionConstraints:function(){var a;var b;var c=this.m_body1;var d=this.m_body2;var e=0;var f;f=c.m_R;var g=f.col1.x*this.m_localAnchor1.x+f.col2.x*this.m_localAnchor1.y;var h=f.col1.y*this.m_localAnchor1.x+f.col2.y*this.m_localAnchor1.y;f=d.m_R;var i=f.col1.x*this.m_localAnchor2.x+f.col2.x*this.m_localAnchor2.y;var j=f.col1.y*this.m_localAnchor2.x+f.col2.y*this.m_localAnchor2.y;var k=c.m_position.x+g;var l=c.m_position.y+h;var m=d.m_position.x+i;var n=d.m_position.y+j;var o=m-k;var p=n-l;e=Math.sqrt(o*o+p*p);var q=c.m_invMass;var r=d.m_invMass;var s=c.m_invI;var t=d.m_invI;this.K1.col1.x=q+r;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=q+r;this.K2.col1.x=s*h*h;this.K2.col2.x=-s*g*h;this.K2.col1.y=-s*g*h;this.K2.col2.y=s*g*g;this.K3.col1.x=t*j*j;this.K3.col2.x=-t*i*j;this.K3.col1.y=-t*i*j;this.K3.col2.y=t*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-o,-p);var u=b2RevoluteJoint.tImpulse.x;var v=b2RevoluteJoint.tImpulse.y;c.m_position.x-=c.m_invMass*u;c.m_position.y-=c.m_invMass*v;c.m_rotation-=c.m_invI*(g*v-h*u);c.m_R.Set(c.m_rotation);d.m_position.x+=d.m_invMass*u;d.m_position.y+=d.m_invMass*v;d.m_rotation+=d.m_invI*(i*v-j*u);d.m_R.Set(d.m_rotation);var w=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var x=d.m_rotation-c.m_rotation-this.m_intialAngle;var y=0;if(this.m_limitState==b2Joint.e_equalLimits){b=b2Math.b2Clamp(x,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);y=-this.m_motorMass*b;w=b2Math.b2Abs(b)}else if(this.m_limitState==b2Joint.e_atLowerLimit){b=x-this.m_lowerAngle;w=b2Math.b2Max(0,-b);b=b2Math.b2Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0);y=-this.m_motorMass*b;a=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+y,0);y=this.m_limitPositionImpulse-a}else if(this.m_limitState==b2Joint.e_atUpperLimit){b=x-this.m_upperAngle;w=b2Math.b2Max(0,b);b=b2Math.b2Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection);y=-this.m_motorMass*b;a=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+y,0);y=this.m_limitPositionImpulse-a}c.m_rotation-=c.m_invI*y;c.m_R.Set(c.m_rotation);d.m_rotation+=d.m_invI*y;d.m_R.Set(d.m_rotation)}return e<=b2Settings.b2_linearSlop&&w<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_ptpImpulse:new b2Vec2,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_ptpMass:new b2Mat22,m_motorMass:null,m_intialAngle:null,m_lowerAngle:null,m_upperAngle:null,m_maxMotorTorque:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});b2RevoluteJoint.tImpulse=new b2Vec2;var b2RevoluteJointDef=new b2Root;jQuery.extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);jQuery.extend(b2RevoluteJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.type=b2Joint.e_revoluteJoint;this.anchorPoint=new b2Vec2(0,0);this.lowerAngle=0;this.upperAngle=0;this.motorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false},anchorPoint:null,lowerAngle:null,upperAngle:null,motorTorque:null,motorSpeed:null,enableLimit:null,enableMotor:null});var b2NullContact=new b2Root;jQuery.extend(b2NullContact.prototype,b2Contact.prototype);jQuery.extend(b2NullContact.prototype,{initialize:function(a,b){this.m_node1=new b2ContactNode;this.m_node2=new b2ContactNode;this.m_flags=0;if(!a||!b){this.m_shape1=null;this.m_shape2=null;return}this.m_shape1=a;this.m_shape2=b;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null},Evaluate:function(){},GetManifolds:function(){return null}});var b2ContactManager=new b2Root;jQuery.extend(b2ContactManager.prototype,b2PairCallback.prototype);jQuery.extend(b2ContactManager.prototype,{initialize:function(){this.m_nullContact=new b2NullContact;this.m_world=null;this.m_destroyImmediate=false},PairAdded:function(a,b){var c=a;var d=b;var e=c.m_body;var f=d.m_body;if(e.IsStatic()&&f.IsStatic()){return this.m_nullContact}if(c.m_body==d.m_body){return this.m_nullContact}if(f.IsConnected(e)){return this.m_nullContact}if(this.m_world.m_filter!=null&&this.m_world.m_filter.ShouldCollide(c,d)==false){return this.m_nullContact}if(f.m_invMass==0){var g=c;c=d;d=g;var h=e;e=f;f=h}var i=b2Contact.Create(c,d,this.m_world.m_blockAllocator);if(i==null){return this.m_nullContact}else{i.m_prev=null;i.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=i}this.m_world.m_contactList=i;this.m_world.m_contactCount++}return i},PairRemoved:function(a,b,c){if(c==null){return}var d=c;if(d!=this.m_nullContact){if(this.m_destroyImmediate==true){this.DestroyContact(d);d=null}else{d.m_flags|=b2Contact.e_destroyFlag}}},DestroyContact:function(a){if(a.m_prev){a.m_prev.m_next=a.m_next}if(a.m_next){a.m_next.m_prev=a.m_prev}if(a==this.m_world.m_contactList){this.m_world.m_contactList=a.m_next}if(a.GetManifoldCount()>0){var b=a.m_shape1.m_body;var c=a.m_shape2.m_body;var d=a.m_node1;var e=a.m_node2;b.WakeUp();c.WakeUp();if(d.prev){d.prev.next=d.next}if(d.next){d.next.prev=d.prev}if(d==b.m_contactList){b.m_contactList=d.next}d.prev=null;d.next=null;if(e.prev){e.prev.next=e.next}if(e.next){e.next.prev=e.prev}if(e==c.m_contactList){c.m_contactList=e.next}e.prev=null;e.next=null}b2Contact.Destroy(a,this.m_world.m_blockAllocator);--this.m_world.m_contactCount},CleanContactList:function(){var a=this.m_world.m_contactList;while(a!=null){var b=a;a=a.m_next;if(b.m_flags&b2Contact.e_destroyFlag){this.DestroyContact(b);b=null}}},Collide:function(){var a;var b;var c;var d;for(var e=this.m_world.m_contactList;e!=null;e=e.m_next){if(e.m_shape1.m_body.IsSleeping()&&e.m_shape2.m_body.IsSleeping()){continue}var f=e.GetManifoldCount();e.Evaluate();var g=e.GetManifoldCount();if(f==0&&g>0){a=e.m_shape1.m_body;b=e.m_shape2.m_body;c=e.m_node1;d=e.m_node2;c.contact=e;c.other=b;c.prev=null;c.next=a.m_contactList;if(c.next!=null){c.next.prev=e.m_node1}a.m_contactList=e.m_node1;d.contact=e;d.other=a;d.prev=null;d.next=b.m_contactList;if(d.next!=null){d.next.prev=d}b.m_contactList=d}else if(f>0&&g==0){a=e.m_shape1.m_body;b=e.m_shape2.m_body;c=e.m_node1;d=e.m_node2;if(c.prev){c.prev.next=c.next}if(c.next){c.next.prev=c.prev}if(c==a.m_contactList){a.m_contactList=c.next}c.prev=null;c.next=null;if(d.prev){d.prev.next=d.next}if(d.next){d.next.prev=d.prev}if(d==b.m_contactList){b.m_contactList=d.next}d.prev=null;d.next=null}}},m_world:null,m_nullContact:new b2NullContact,m_destroyImmediate:null});var b2Island=new b2Root;jQuery.extend(b2Island.prototype,{initialize:function(a,b,c,d){var e=0;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodies=new Array(a);for(e=0;e<a;e++)this.m_bodies[e]=null;this.m_contacts=new Array(b);for(e=0;e<b;e++)this.m_contacts[e]=null;this.m_joints=new Array(c);for(e=0;e<c;e++)this.m_joints[e]=null;this.m_allocator=d},Clear:function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0},Solve:function(a,b){var c=0;var d;for(c=0;c<this.m_bodyCount;++c){d=this.m_bodies[c];if(d.m_invMass==0)continue;d.m_linearVelocity.Add(b2Math.MulFV(a.dt,b2Math.AddVV(b,b2Math.MulFV(d.m_invMass,d.m_force))));d.m_angularVelocity+=a.dt*d.m_invI*d.m_torque;d.m_linearVelocity.Multiply(d.m_linearDamping);d.m_angularVelocity*=d.m_angularDamping;d.m_position0.SetV(d.m_position);d.m_rotation0=d.m_rotation}var e=new b2ContactSolver(this.m_contacts,this.m_contactCount,this.m_allocator);e.PreSolve();for(c=0;c<this.m_jointCount;++c){this.m_joints[c].PrepareVelocitySolver()}for(c=0;c<a.iterations;++c){e.SolveVelocityConstraints();for(var f=0;f<this.m_jointCount;++f){this.m_joints[f].SolveVelocityConstraints(a)}}for(c=0;c<this.m_bodyCount;++c){d=this.m_bodies[c];if(d.m_invMass==0)continue;d.m_position.x+=a.dt*d.m_linearVelocity.x;d.m_position.y+=a.dt*d.m_linearVelocity.y;d.m_rotation+=a.dt*d.m_angularVelocity;d.m_R.Set(d.m_rotation)}for(c=0;c<this.m_jointCount;++c){this.m_joints[c].PreparePositionSolver()}if(b2World.s_enablePositionCorrection){for(b2Island.m_positionIterationCount=0;b2Island.m_positionIterationCount<a.iterations;++b2Island.m_positionIterationCount){var g=e.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);var h=true;for(c=0;c<this.m_jointCount;++c){var i=this.m_joints[c].SolvePositionConstraints();h=h&&i}if(g&&h){break}}}e.PostSolve();for(c=0;c<this.m_bodyCount;++c){d=this.m_bodies[c];if(d.m_invMass==0)continue;d.m_R.Set(d.m_rotation);d.SynchronizeShapes();d.m_force.Set(0,0);d.m_torque=0}},UpdateSleep:function(a){var b=0;var c;var d=Number.MAX_VALUE;var e=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;var f=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(b=0;b<this.m_bodyCount;++b){c=this.m_bodies[b];if(c.m_invMass==0){continue}if((c.m_flags&b2Body.e_allowSleepFlag)==0){c.m_sleepTime=0;d=0}if((c.m_flags&b2Body.e_allowSleepFlag)==0||c.m_angularVelocity*c.m_angularVelocity>f||b2Math.b2Dot(c.m_linearVelocity,c.m_linearVelocity)>e){c.m_sleepTime=0;d=0}else{c.m_sleepTime+=a;d=b2Math.b2Min(d,c.m_sleepTime)}}if(d>=b2Settings.b2_timeToSleep){for(b=0;b<this.m_bodyCount;++b){c=this.m_bodies[b];c.m_flags|=b2Body.e_sleepFlag}}},AddBody:function(a){this.m_bodies[this.m_bodyCount++]=a},AddContact:function(a){this.m_contacts[this.m_contactCount++]=a},AddJoint:function(a){this.m_joints[this.m_jointCount++]=a},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null});b2Island.m_positionIterationCount=0;var b2TimeStep=new b2Root;jQuery.extend(b2TimeStep.prototype,{dt:null,inv_dt:null,iterations:0,initialize:function(){}});var b2World=new b2Root;jQuery.extend(b2World.prototype,{initialize:function(a,b,c){this.step=new b2TimeStep;this.m_contactManager=new b2ContactManager;this.m_listener=null;this.m_filter=b2CollisionFilter.b2_defaultFilter;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodyDestroyList=null;this.m_allowSleep=c;this.m_gravity=b;this.m_contactManager.m_world=this;this.m_broadPhase=new b2BroadPhase(a,this.m_contactManager);var d=new b2BodyDef;this.m_groundBody=this.CreateBody(d)},SetListener:function(a){this.m_listener=a},SetFilter:function(a){this.m_filter=a},CreateBody:function(a){var b=new b2Body(a,this);b.m_prev=null;b.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=b}this.m_bodyList=b;++this.m_bodyCount;return b},DestroyBody:function(a){if(a.m_flags&b2Body.e_destroyFlag){return}if(a.m_prev){a.m_prev.m_next=a.m_next}if(a.m_next){a.m_next.m_prev=a.m_prev}if(a==this.m_bodyList){this.m_bodyList=a.m_next}a.m_flags|=b2Body.e_destroyFlag;--this.m_bodyCount;a.m_prev=null;a.m_next=this.m_bodyDestroyList;this.m_bodyDestroyList=a},CleanBodyList:function(){this.m_contactManager.m_destroyImmediate=true;var a=this.m_bodyDestroyList;while(a){var b=a;a=a.m_next;var c=b.m_jointList;while(c){var d=c;c=c.next;if(this.m_listener){this.m_listener.NotifyJointDestroyed(d.joint)}this.DestroyJoint(d.joint)}b.Destroy()}this.m_bodyDestroyList=null;this.m_contactManager.m_destroyImmediate=false},CreateJoint:function(a){var b=b2Joint.Create(a,this.m_blockAllocator);b.m_prev=null;b.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=b}this.m_jointList=b;++this.m_jointCount;b.m_node1.joint=b;b.m_node1.other=b.m_body2;b.m_node1.prev=null;b.m_node1.next=b.m_body1.m_jointList;if(b.m_body1.m_jointList)b.m_body1.m_jointList.prev=b.m_node1;b.m_body1.m_jointList=b.m_node1;b.m_node2.joint=b;b.m_node2.other=b.m_body1;b.m_node2.prev=null;b.m_node2.next=b.m_body2.m_jointList;if(b.m_body2.m_jointList)b.m_body2.m_jointList.prev=b.m_node2;b.m_body2.m_jointList=b.m_node2;if(a.collideConnected==false){var c=a.body1.m_shapeCount<a.body2.m_shapeCount?a.body1:a.body2;for(var d=c.m_shapeList;d;d=d.m_next){d.ResetProxy(this.m_broadPhase)}}return b},DestroyJoint:function(a){var b=a.m_collideConnected;if(a.m_prev){a.m_prev.m_next=a.m_next}if(a.m_next){a.m_next.m_prev=a.m_prev}if(a==this.m_jointList){this.m_jointList=a.m_next}var c=a.m_body1;var d=a.m_body2;c.WakeUp();d.WakeUp();if(a.m_node1.prev){a.m_node1.prev.next=a.m_node1.next}if(a.m_node1.next){a.m_node1.next.prev=a.m_node1.prev}if(a.m_node1==c.m_jointList){c.m_jointList=a.m_node1.next}a.m_node1.prev=null;a.m_node1.next=null;if(a.m_node2.prev){a.m_node2.prev.next=a.m_node2.next}if(a.m_node2.next){a.m_node2.next.prev=a.m_node2.prev}if(a.m_node2==d.m_jointList){d.m_jointList=a.m_node2.next}a.m_node2.prev=null;a.m_node2.next=null;b2Joint.Destroy(a,this.m_blockAllocator);--this.m_jointCount;if(b==false){var e=c.m_shapeCount<d.m_shapeCount?c:d;for(var f=e.m_shapeList;f;f=f.m_next){f.ResetProxy(this.m_broadPhase)}}},GetGroundBody:function(){return this.m_groundBody},step:new b2TimeStep,Step:function(a,b){var c;var d;this.step.dt=a;this.step.iterations=b;if(a>0){this.step.inv_dt=1/a}else{this.step.inv_dt=0}this.m_positionIterationCount=0;this.m_contactManager.CleanContactList();this.CleanBodyList();this.m_contactManager.Collide();var e=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(c=this.m_bodyList;c!=null;c=c.m_next){c.m_flags&=~b2Body.e_islandFlag}for(var f=this.m_contactList;f!=null;f=f.m_next){f.m_flags&=~b2Contact.e_islandFlag}for(var g=this.m_jointList;g!=null;g=g.m_next){g.m_islandFlag=false}var h=this.m_bodyCount;var i=new Array(this.m_bodyCount);for(var j=0;j<this.m_bodyCount;j++)i[j]=null;for(var k=this.m_bodyList;k!=null;k=k.m_next){if(k.m_flags&(b2Body.e_staticFlag|b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag)){continue}e.Clear();var l=0;i[l++]=k;k.m_flags|=b2Body.e_islandFlag;while(l>0){c=i[--l];e.AddBody(c);c.m_flags&=~b2Body.e_sleepFlag;if(c.m_flags&b2Body.e_staticFlag){continue}for(var m=c.m_contactList;m!=null;m=m.next){if(m.contact.m_flags&b2Contact.e_islandFlag){continue}e.AddContact(m.contact);m.contact.m_flags|=b2Contact.e_islandFlag;d=m.other;if(d.m_flags&b2Body.e_islandFlag){continue}i[l++]=d;d.m_flags|=b2Body.e_islandFlag}for(var n=c.m_jointList;n!=null;n=n.next){if(n.joint.m_islandFlag==true){continue}e.AddJoint(n.joint);n.joint.m_islandFlag=true;d=n.other;if(d.m_flags&b2Body.e_islandFlag){continue}i[l++]=d;d.m_flags|=b2Body.e_islandFlag}}e.Solve(this.step,this.m_gravity);this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount);if(this.m_allowSleep){e.UpdateSleep(a)}for(var o=0;o<e.m_bodyCount;++o){c=e.m_bodies[o];if(c.m_flags&b2Body.e_staticFlag){c.m_flags&=~b2Body.e_islandFlag}if(c.IsFrozen()&&this.m_listener){var p=this.m_listener.NotifyBoundaryViolated(c);if(p==b2WorldListener.b2_destroyBody){this.DestroyBody(c);c=null;e.m_bodies[o]=null}}}}this.m_broadPhase.Commit()},Query:function(a,b,c){var d=new Array;var e=this.m_broadPhase.QueryAABB(a,d,c);for(var f=0;f<e;++f){b[f]=d[f]}return e},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},m_blockAllocator:null,m_stackAllocator:null,m_broadPhase:null,m_contactManager:new b2ContactManager,m_bodyList:null,m_contactList:null,m_jointList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_bodyDestroyList:null,m_gravity:null,m_allowSleep:null,m_groundBody:null,m_listener:null,m_filter:null,m_positionIterationCount:0});b2World.s_enablePositionCorrection=1;b2World.s_enableWarmStarting=1;var b2WorldListener=new b2Root;jQuery.extend(b2WorldListener.prototype,{NotifyJointDestroyed:function(a){},NotifyBoundaryViolated:function(a){return b2WorldListener.b2_freezeBody},initialize:function(){}});b2WorldListener.b2_freezeBody=0;b2WorldListener.b2_destroyBody=1