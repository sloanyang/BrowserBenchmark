var guide={isDoable:false,isConformity:false,operations:0,time:0,internalCounter:false,testName:"CSS 3D Transform",testVersion:"2.0",compareScore:10.1,isConformity:0};var oldOffset=[[{},{},{},{},{},{}],[{},{},{},{},{},{}]];var oldMatrix="none";var debugData={};var rotateX=[0,0];var rotateY=[0,0];var rotateZ=[0,0];var pulse=[-0.25,0.25];var pulseReverse=[false,true];var zOrders=[[],[]];var divider=1;var test={init:function(){delete $.fx.step.transform;(function(u,p,j){var x=j.createElement("div"),w=x.style,t=["O","ms","Webkit","Moz"],q,s=t.length,o=["transform","transformOrigin","transformStyle","perspective","perspectiveOrigin","backfaceVisibility"],i,v=t.length;while(s--){if(t[s]+r(o[0]) in w){q=t[s];continue}}if(!q){return}while(v--){i=q+r(o[v]);if(i in w){u.cssNumber[o[v]]=true;u.cssProps[o[v]]=i;i==="MozTransform"&&(u.cssHooks[o[v]]={get:function(a,b){return(b?u.css(a,i).split("px").join(""):a.style[i])},set:function(b,a){/matrix\([^)p]*\)/.test(a)&&(a=a.replace(/matrix((?:[^,]*,){4})([^,]*),([^)]*)/,"matrix$1$2px,$3px"));b.style[i]=a}})}}function r(a){return a.slice(0,1).toUpperCase()+a.slice(1)}})(jQuery,window,document);$.ajax({url:"/ajax/set_test",async:false,type:"POST",data:{test_name:guide.testName,test_version:guide.testVersion}});if(Modernizr.csstransforms3d){guide.operations=450;guide.time=null;guide.internalCounter=true;guide.isDoable=true;if(test.isFlat()){debugData.warning="Cube is flat, final score is divided by 5";divider=5}}return guide},run:function(b,a){$(".cube").each(function(e){_this=this;var f=new Date();internalStart=f.getTime();var c=test.getMatrix(e);if(typeof(oldOffset[e][0].top)=="undefined"){test.setOffset($(this).children("figure"),e)}$(this).animate({transform:c},1,function(){$(this).css("z-index",zOrders[e][a]);if(test.offsetChanged($(this).children("figure"),e)){test.setOffset($(this).children("figure"),e);benchmark.increaseCounter()}else{debugData["round_"+(a+1)]={error:"Counter not increased since old top-left ("+oldOffset[e].top+", "+oldOffset[e].left+") is same as new top-left ("+$(this).offset().top+", "+$(this).offset().left+")",from:"transform: "+oldMatrix,to:"transform: "+c}}oldMatrix=c;if(b&&e==1){var d=0;var g=benchmark.elapsedTime();if(counter!=0){d=counter/g*1000/divider}debugData.elapsedTime=g;debugData.operations=counter;debugData.ops=d;benchmark.submitResult(d,guide,debugData)}})})},setOffset:function(b,a){$(b).children("figure").each(function(c){oldOffset[a][c]=$(this).offset()})},offsetChanged:function(c,b){var a=false;$(c).each(function(e,d){if(a==false&&(Math.round(oldOffset[b][e].top)!=Math.round($(d).offset().top)||Math.round(oldOffset[b][e].left)!=Math.round($(d).offset().left))){a=true}});return a},isFlat:function(){return $("div.cube").first().css("transform-style")!="preserve-3d"},getMatrix:function(d){var l=Math.PI/180;var c=1+pulse[d];if(pulseReverse[d]==false){pulse[d]+=0.008;if(pulse[d]>=0.99){pulseReverse[d]=true}}else{pulse[d]-=0.008;if(pulse[d]<=-0.99){pulseReverse[d]=false}}var f=Math.abs(d-1);if(pulse[d]>pulse[f]){zOrders[d].push("100")}else{zOrders[d].push("10")}var h,a,j,o,k,n,g;h=$M([[1,0,0,0],[0,Math.cos(rotateX[d]*l),Math.sin(-rotateX[d]*l),0],[0,Math.sin(rotateX[d]*l),Math.cos(rotateX[d]*l),0],[0,0,0,1]]);a=$M([[Math.cos(rotateY[d]*l),0,Math.sin(rotateY[d]*l),0],[0,1,0,0],[Math.sin(-rotateY[d]*l),0,Math.cos(rotateY[d]*l),0],[0,0,0,1]]);j=$M([[Math.cos(rotateZ[d]*l),Math.sin(-rotateZ[d]*l),0,0],[Math.sin(rotateZ[d]*l),Math.cos(rotateZ[d]*l),0,0],[0,0,1,0],[0,0,0,1]]);o=c;k=$M([[o,0,0,0],[0,o,0,0],[0,0,o,0],[0,0,0,1]]);g=$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[Math.sin(rotateX[d]*l)*250+250,Math.sin(rotateY[d]*l)*150+150,0,1]]);n=h.x(a).x(j).x(k).x(g);o="matrix3d(";o+=n.e(1,1).toFixed(10)+","+n.e(1,2).toFixed(10)+","+n.e(1,3)+","+n.e(1,4).toFixed(10)+",";o+=n.e(2,1).toFixed(10)+","+n.e(2,2).toFixed(10)+","+n.e(2,3)+","+n.e(2,4).toFixed(10)+",";o+=n.e(3,1).toFixed(10)+","+n.e(3,2).toFixed(10)+","+n.e(3,3)+","+n.e(3,4).toFixed(10)+",";o+=n.e(4,1).toFixed(10)+","+n.e(4,2).toFixed(10)+","+n.e(4,3)+","+n.e(4,4).toFixed(10);o+=")";var m=Math.abs(mathExtended.randFloat());m=mathExtended.roundFloat((m-Math.floor(m)),1);var b=Math.abs(mathExtended.randFloat());b=mathExtended.roundFloat((b-Math.floor(b)),1);var e=Math.abs(mathExtended.randFloat());e=mathExtended.roundFloat((e-Math.floor(e)),1);if(d==0){rotateX[d]-=(2+m);rotateY[d]-=(3+b);rotateZ[d]-=(2+e)}else{rotateX[d]+=(1+m);rotateY[d]+=(2+b);rotateZ[d]+=(1+e)}return o}};