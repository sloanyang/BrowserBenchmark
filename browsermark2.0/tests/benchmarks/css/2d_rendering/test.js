var guide={isDoable:false,operations:0,time:0,internalCounter:false,testName:"CSS 2D Transform",testVersion:"2.0",compareScore:13.7,isConformity:0};var oldPosition={};var debugData={round:[]};oldCount=0;oldElapsed=0;oldMatrix="none";lowestScore=0;highestScore=0;var test={init:function(){(function(an,am,al,ak,aj){function I(t){t=t.split(")");var s=an.trim,r=-1,q=t.length-1,p,o,n,m=ab?new Float32Array(6):[],d=ab?new Float32Array(6):[],a=ab?new Float32Array(6):[1,0,0,1,0,0];m[0]=m[3]=a[0]=a[3]=1;m[1]=m[2]=m[4]=m[5]=0;while(++r<q){p=t[r].split("(");o=s(p[0]);n=p[1];d[0]=d[3]=1;d[1]=d[2]=d[4]=d[5]=0;switch(o){case P+"X":d[4]=parseInt(n,10);break;case P+"Y":d[5]=parseInt(n,10);break;case P:n=n.split(",");d[4]=parseInt(n[0],10);d[5]=parseInt(n[1]||0,10);break;case N:n=O(n);d[0]=ak.cos(n);d[1]=ak.sin(n);d[2]=-ak.sin(n);d[3]=ak.cos(n);break;case L+"X":d[0]=+n;break;case L+"Y":d[3]=n;break;case L:n=n.split(",");d[0]=n[0];d[3]=n.length>1?n[1]:n[0];break;case K+"X":d[2]=ak.tan(O(n));break;case K+"Y":d[1]=ak.tan(O(n));break;case J:n=n.split(",");d[0]=n[0];d[1]=n[1];d[2]=n[2];d[3]=n[3];d[4]=parseInt(n[4],10);d[5]=parseInt(n[5],10);break}a[0]=m[0]*d[0]+m[2]*d[1];a[1]=m[1]*d[0]+m[3]*d[1];a[2]=m[0]*d[2]+m[2]*d[3];a[3]=m[1]*d[2]+m[3]*d[3];a[4]=m[0]*d[4]+m[2]*d[5]+m[4];a[5]=m[1]*d[4]+m[3]*d[5]+m[5];m=[a[0],a[1],a[2],a[3],a[4],a[5]]}return a}function H(j){var d,p,o,n=j[0],m=j[1],l=j[2],k=j[3];if(n*k-m*l){d=ak.sqrt(n*n+m*m);n/=d;m/=d;o=n*l+m*k;l-=n*o;k-=m*o;p=ak.sqrt(l*l+k*k);l/=p;k/=p;o/=p;if(n*k<m*l){n=-n;m=-m;o=-o;d=-d}}else{d=p=o=0}return[[P,[+j[4],+j[5]]],[N,ak.atan2(m,n)],[K+"X",ak.atan(o)],[L,[d,p]]]}function Y(a,p){var o={start:[],end:[]},n=-1,m,l,k,j;(a=="none"||U(a))&&(a="");(p=="none"||U(p))&&(p="");if(a&&p&&!p.indexOf("matrix")&&M(a).join()==M(p.split(")")[0]).join()){o.origin=a;a="";p=p.slice(p.indexOf(")")+1)}if(!a&&!p){return}if(!a||!p||S(a)==S(p)){a&&(a=a.split(")"))&&(m=a.length);p&&(p=p.split(")"))&&(m=p.length);while(++n<m-1){a[n]&&(l=a[n].split("("));p[n]&&(k=p[n].split("("));j=an.trim((l||k)[0]);Q(o.start,W(j,l?l[1]:0));Q(o.end,W(j,k?k[1]:0))}}else{o.start=H(I(a));o.end=H(I(p))}return o}function W(g,f){var k=+!g.indexOf(L),j,h=g.replace(/e[XY]/,"e");switch(g){case P+"Y":case L+"Y":f=[k,f?parseFloat(f):k];break;case P+"X":case P:case L+"X":j=1;case L:f=f?(f=f.split(","))&&[parseFloat(f[0]),parseFloat(f.length>1?f[1]:g==L?j||f[0]:k+"")]:[k,k];break;case K+"X":case K+"Y":case N:f=f?O(f):0;break;case J:return H(f?M(f):[1,0,0,1,0,0]);break}return[[h,f]]}function U(b){return V.test(b)}function S(b){return b.replace(/(?:\([^)]*\))|\s/g,"")}function Q(e,d,f){while(f=d.shift()){e.push(f)}}function O(b){return ~b.indexOf("deg")?parseInt(b,10)*(ak.PI*2/360):~b.indexOf("grad")?parseInt(b,10)*(ak.PI/200):parseFloat(b)}function M(b){b=/([^,]*),([^,]*),([^,]*),([^,]*),([^,p]*)(?:px)?,([^)p]*)(?:px)?/.exec(b);return[b[1],b[2],b[3],b[4],b[5],b[6]]}var ai=al.createElement("div"),ah=ai.style,ag="Transform",af=["O"+ag,"ms"+ag,"Webkit"+ag,"Moz"+ag],ae=af.length,ad,ac,ab="Float32Array" in am,aa,Z,X=/Matrix([^)]*)/,V=/^\s*matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*(?:,\s*0(?:px)?\s*){2}\)\s*$/,T="transform",R="transformOrigin",P="translate",N="rotate",L="scale",K="skew",J="matrix";while(ae--){if(af[ae] in ah){an.support[T]=ad=af[ae];an.support[R]=ad+"Origin";continue}}if(!ad){an.support.matrixFilter=ac=ah.filter===""}an.cssNumber[T]=an.cssNumber[R]=true;if(ad&&ad!=T){an.cssProps[T]=ad;an.cssProps[R]=ad+"Origin";if(ad=="Moz"+ag){aa={get:function(a,d){return d?an.css(a,ad).split("px").join(""):a.style[ad]},set:function(d,c){d.style[ad]=/matrix\([^)p]*\)/.test(c)?c.replace(/matrix((?:[^,]*,){4})([^,]*),([^)]*)/,J+"$1$2px,$3px"):c}}}else{if(/^1\.[0-5](?:\.|$)/.test(an.fn.jquery)){aa={get:function(a,d){return d?an.css(a,ad.replace(/^ms/,"Ms")):a.style[ad]}}}}}else{if(ac){aa={get:function(a,m,l){var k=m&&a.currentStyle?a.currentStyle:a.style,j,e;if(k&&X.test(k.filter)){j=RegExp.$1.split(",");j=[j[0].split("=")[1],j[2].split("=")[1],j[1].split("=")[1],j[3].split("=")[1]]}else{j=[1,0,0,1]}if(!an.cssHooks[R]){j[4]=k?parseInt(k.left,10)||0:0;j[5]=k?parseInt(k.top,10)||0:0}else{e=an._data(a,"transformTranslate",aj);j[4]=e?e[0]:0;j[5]=e?e[1]:0}return l?j:J+"("+j+")"},set:function(a,p,o){var n=a.style,m,l,k,j;if(!o){n.zoom=1}p=I(p);l=["Matrix(M11="+p[0],"M12="+p[2],"M21="+p[1],"M22="+p[3],"SizingMethod='auto expand'"].join();k=(m=a.currentStyle)&&m.filter||n.filter||"";n.filter=X.test(k)?k.replace(X,l):k+" progid:DXImageTransform.Microsoft."+l+")";if(!an.cssHooks[R]){if(j=an.transform.centerOrigin){n[j=="margin"?"marginLeft":"left"]=-(a.offsetWidth/2)+a.clientWidth/2+"px";n[j=="margin"?"marginTop":"top"]=-(a.offsetHeight/2)+a.clientHeight/2+"px"}n.left=p[4]+"px";n.top=p[5]+"px"}else{an.cssHooks[R].set(a,p)}}}}}if(aa){an.cssHooks[T]=aa}Z=aa&&aa.get||an.css;an.fx.step.transform=function(v){var u=v.elem,t=v.start,s=v.end,r=v.pos,o="",n=100000,l,k,d,a;if(!t||typeof t==="string"){if(!t){t=Z(u,ad)}if(ac){u.style.zoom=1}s=s.split("+=").join(t);an.extend(v,Y(t,s));t=v.start;s=v.end}l=t.length;while(l--){k=t[l];d=s[l];a=+false;switch(k[0]){case P:a="px";case L:a||(a="");o=k[0]+"("+ak.round((k[1][0]+(d[1][0]-k[1][0])*r)*n)/n+a+","+ak.round((k[1][1]+(d[1][1]-k[1][1])*r)*n)/n+a+")"+o;break;case K+"X":case K+"Y":case N:o=k[0]+"("+ak.round((k[1]+(d[1]-k[1])*r)*n)/n+"rad)"+o;break}}v.origin&&(o=v.origin+o);aa&&aa.set?aa.set(u,o,+true):u.style[ad]=o};an.transform={centerOrigin:"margin"}})(jQuery,window,document,Math);$.ajax({url:"/ajax/set_test",async:false,type:"POST",data:{test_name:guide.testName,test_version:guide.testVersion}});if(Modernizr.csstransforms){guide.operations=47;guide.time=null;guide.internalCounter=true;guide.isDoable=true}return guide},run:function(f,a){var b="";for(i=0;i<6;i++){randFloat=mathExtended.randFloat();if(Math.abs(randFloat)==randFloat){randFloat=randFloat-Math.floor(randFloat)}else{randFloat=randFloat-Math.floor(randFloat)-1}randFloat=mathExtended.roundFloat(randFloat,3);b=b+randFloat+", "}b=b.substring(0,b.length-2);var e=new Date();internalStart=e.getTime();var c="matrix("+b+")";if(f){c="none"}oldPosition=$("img#transform_this").offset();$("img#transform_this").animate({transform:c,msTransform:c},{duration:300,step:function(){if(Math.round(oldPosition.top)!=Math.round($(this).position().top)||Math.round(oldPosition.left)!=Math.round($(this).position().left)){benchmark.increaseCounter();oldPosition=$(this).position()}},complete:function(){var h=e.getTime()-internalStart;benchmark.increaseElapsedTime(h);var g=benchmark.elapsedTime();if(f){var d=0;if(counter!=0){d=counter/g*1000;debugData.round[a]=["Round "+(a+1),"From "+oldMatrix+" to "+c,"Elapsed time: "+(g-oldElapsed)+" microseconds","Operations: "+(counter-oldCount)+" pcs","Operations per second: "+((counter-oldCount)/(g-oldElapsed)*1000)];debugData.elapsedTime=g;debugData.operations=counter;debugData.ops=d}else{debugData.round[a]=["Round "+(a+1),"From "+oldMatrix+" to "+c,"Elapsed time: "+(g-oldElapsed)+" microseconds","Operations: 0 pcs","Operations per second: 0"];debugData.elapsedTime=g;debugData.operations=0;debugData.ops=0}benchmark.submitResult(d,guide,debugData);if(debug==true){benchmark.logger(debugData)}}else{if(counter!=0){score=((counter-oldCount)/(g-oldElapsed)*1000);debugData.round[a]=["Round "+(a+1),"From "+oldMatrix+" to "+c,"Elapsed time: "+(g-oldElapsed)+" microseconds","Operations: "+(counter-oldCount)+" pcs","Operations per second: "+score];oldCount=counter;oldElapsed=g;oldMatrix=c;if(lowestScore==0||lowestScore>score){lowestScore=score}if(highestScore==0||highestScore<score){highestScore=score}}else{debugData.round[a]=["Round "+(a+1),"From "+oldMatrix+" to "+c,"Elapsed time: "+(g-oldElapsed)+" microseconds","Operations: 0 pcs","Operations per second: 0"]}}}})}};